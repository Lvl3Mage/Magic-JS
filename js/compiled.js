let aboutState={preload:loadAboutAssets,create:showAbout};function loadAboutAssets(){game.load.image("backButton","assets/imgs/Titles/BACK.png");game.load.image("aboutTitle","assets/imgs/Titles/ABOUT.png");game.load.image("slideButtonOpen","assets/imgs/Buttons/HandButton.png");game.load.image("slideButtonClosed","assets/imgs/Buttons/FistButton.png")}
function showAbout(){game.camera.flash(0,2E3);title=game.add.image(game.camera.width/2,50,"aboutTitle");title.anchor.setTo(.5,0);title.scale.setTo(.5,.5);game.add.tween(title).to({y:title.y+10},2E3,Phaser.Easing.Linear.None,!0,0,-1,!0);game.add.text(game.camera.width/2,220,"A game created by GROUP 1: Karl Marx",{font:"20px Merryweather",fill:"#ffffff",align:"center"}).anchor.setTo(.5,0);game.add.text(game.camera.width/2,250,"Composed by: Saul Pacheco Trilles, Karl Kalantarov and Lucas Godoy Nebot",
{font:"20px Merryweather",fill:"#ffffff",align:"center"}).anchor.setTo(.5,0);game.add.text(game.camera.width/2,280,"Unravel the enigmatic rules of the game with a mere touch upon the mystical hand below...",{font:"20px Merryweather",fill:"#ffffff",align:"center"}).anchor.setTo(.5,0);slides=game.add.image(game.camera.width/2,320,"slideButtonOpen");slides.anchor.setTo(.5,0);slides.inputEnabled=!0;slides.events.onInputDown.add(onHandButtonPressed,this);back=game.add.image(game.camera.width/2,game.camera.height-
150,"backButton");back.anchor.setTo(.5,0);back.scale.setTo(.3,.3);back.inputEnabled=!0;back.events.onInputDown.add(onBackButtonPressed,this);back.events.onInputOver.add(onBackHover,this);back.events.onInputOut.add(onBackOut,this)}function onHandButtonPressed(){slides.loadTexture("slideButtonClosed");slides.scale.setTo(.8,.8);game.camera.fade(0,1E3,!0,1);game.camera.onFadeComplete.addOnce(function(){game.state.start("instructions")},this)}
function onBackButtonPressed(){game.camera.fade(0,1E3);game.camera.onFadeComplete.add(function(){game.state.start("welcomescreen")},this)}function onBackHover(t){game.add.tween(t.scale).to({x:.35,y:.35},1E3,Phaser.Easing.Quartic.Out,!0,0,0,!1)}function onBackOut(t){game.tweens.removeFrom(t.scale);game.add.tween(t.scale).to({x:.3,y:.3},1E3,Phaser.Easing.Quartic.Out,!0,0,0,!1)};class Component{constructor(t){}BeforeDestroy(){}Destroy(){this.BeforeDestroy();this.destroyed=!0}};class Collectible extends Component{constructor(t,e,v,l){super(t);t.Subscribe("scene-update",this.Update,this);this.sprite=game.add.sprite(e,v,l.spriteName);l.spriteScale?this.sprite.scale.setTo(l.spriteScale,l.spriteScale):this.sprite.scale.setTo(1,1);this.sprite.getParentComponent=()=>this;this.config=l;this.collectDistance=50;this.bopPhaseOffset=Math.random();this.attractionDistance=200;this.maxAttractionVelocity=2E3;this.velocity=new Vector2(0,0)}Update(){const t=game.time.totalElapsedSeconds()+
Mathf.TransformRange(0,1,0,Math.PI,this.bopPhaseOffset);this.sprite.anchor.setTo(.5,Mathf.TransformRange(-1,1,.5,1,Math.sin(t)));this.MoveToPlayer();50>sceneData.player.GetPosition().Sub(new Vector2(this.sprite.centerX,this.sprite.centerY)).Length()&&(this.config.onPlayerCollision.call(this),this.Destroy())}MoveToPlayer(){var t=sceneData.player.GetPosition().Sub(new Vector2(this.sprite.centerX,this.sprite.centerY)),e=t.Length();e=Mathf.TransformRange(0,this.attractionDistance,this.maxAttractionVelocity,
0,e);e=Mathf.Clamp(e,0,this.maxAttractionVelocity);t=t.Normalized();this.velocity=Vector2.Lerp(this.velocity,t.Scale(e),.1);this.sprite.x+=this.velocity.x*game.time.elapsed*.001;this.sprite.y+=this.velocity.y*game.time.elapsed*.001}BeforeDestroy(){sceneData.sounds.collectible.play();this.sprite.destroy()}};class Enemy extends Component{constructor(t,e,v){super(t);t.Subscribe("scene-update",this.Update,this);this.enemyType=e;this.spriteScale=new Vector2(gameConfig.enemies[this.enemyType].scaleAmt,gameConfig.enemies[this.enemyType].scaleAmt);this.spriteAnchor=new Vector2(.5,.5);this.shadowAnchor=new Vector2(.5,.5);Object.defineProperty(this,"jumpFrequency",{get:()=>gameConfig.enemies[this.enemyType].stats.jumpFrequency});this.jumpHeightFactor=.7;this.jumpSqueeze=.2;this.jumpSqueezeSharpness=.5;this.shadowJumpAlpha=
.4;this.shadowAlpha=.1;this.shadowScale=.5;this.shadowJumpScale=.7;this.health=gameConfig.enemies[this.enemyType].stats.maxHealth;Object.defineProperty(this,"roamVelocity",{get:()=>gameConfig.enemies[this.enemyType].stats.roamVelocity});Object.defineProperty(this,"damage",{get:()=>gameConfig.enemies[this.enemyType].stats.damage});Object.defineProperty(this,"immunityDuration",{get:()=>gameConfig.enemies[this.enemyType].stats.immunityDuration});Object.defineProperty(this,"attackVelocity",{get:()=>gameConfig.enemies[this.enemyType].stats.attackVelocity});
this.accelerationFactor=.1;Object.defineProperty(this,"attackRange",{get:()=>gameConfig.enemies[this.enemyType].stats.attackRange});this.moveDelay=1E3;this.moveTimer=Math.random()*this.moveDelay;this.sprite=game.add.sprite(v.x,v.y,gameConfig.enemies[this.enemyType].spriteName);this.sprite.anchor.setTo(.5,0);this.sprite.scale.setTo(this.spriteScale.x,this.spriteScale.y);this.sprite.getParentComponent=()=>this;this.shadow=game.add.sprite(v.x,v.y,"shadow");this.shadow.anchor.setTo(this.shadowAnchor.x,
this.shadowAnchor.y);this.shadow.scale.setTo(this.shadowScale,this.shadowScale);game.physics.p2.enable(this.sprite,!1);this.body=this.sprite.body;this.body.setCollisionGroup(sceneData.collisionGroups.enemies);this.body.collides(sceneData.collisionGroups.player,this.onPlayerCollision,this);this.body.collides([sceneData.collisionGroups.safeZones,sceneData.collisionGroups.walls,sceneData.collisionGroups.projectiles,sceneData.collisionGroups.enemies]);this.body.getParentComponent=()=>this;this.sprite.body.fixedRotation=
!0;this.roamDirection=this.randomDirection();this.immune;sceneData.layers.enemies.addChild(this.sprite);sceneData.layers.shadows.addChild(this.shadow);this.onDestroy=()=>{}}Update(){this.UpdateRoamDirection();this.Move();this.UpdateJump();this.shadow.x=this.sprite.x;this.shadow.y=this.sprite.y;this.ProcessDespawn()}ProcessDespawn(){sceneData.player.GetPosition().Sub(new Vector2(this.sprite.centerX,this.sprite.centerY)).Length()>gameConfig.enemyDespawnDistance&&this.Destroy()}Move(){let t;t=this.isAggressive()?
this.GetAttackDirection().Scale(this.attackVelocity):this.roamDirection.Scale(this.roamVelocity);this.AccelerateTo(t)}AccelerateTo(t){var e=Mathf.TransformRange(0,Math.PI,1,0,this.GetJumpPhase()%Math.PI);t=t.Scale(e);e=this.GetVelocity();let v=this.accelerationFactor*(1-this.GetJumpFactor());e=Vector2.Lerp(e,t,v);this.sprite.body.velocity.x=e.x;this.sprite.body.velocity.y=e.y}UpdateRoamDirection(){this.moveTimer+=game.time.elapsed;this.moveTimer>=this.moveDelay&&(this.roamDirection=this.randomDirection(),
this.moveTimer=0)}GetAttackDirection(){var t=sceneData.player.GetPosition();let e=new Vector2(this.sprite.centerX,this.sprite.centerY);t=t.Sub(e);return t=t.Normalized()}UpdateJump(){let t=this.GetJumpFactor();var e=Mathf.TransformRange(0,1,this.shadowScale,this.shadowJumpScale,t);this.shadow.scale.setTo(e,e);this.shadow.alpha=Mathf.TransformRange(0,1,this.shadowAlpha,this.shadowJumpAlpha,t);e=Math.pow(this.GetJumpFactor(Math.PI),this.jumpSqueezeSharpness);e=Mathf.TransformRange(0,1,-this.jumpSqueeze,
this.jumpSqueeze,e);this.sprite.scale.setTo(this.spriteScale.x-e,this.spriteScale.y+e);this.sprite.anchor.setTo(this.spriteAnchor.x,Mathf.TransformRange(0,1,this.spriteAnchor.y,this.spriteAnchor.y+this.jumpHeightFactor,t))}GetJumpPhase(){return game.time.totalElapsedSeconds()*this.jumpFrequency/2}GetJumpFactor(t=0){t=this.GetJumpPhase()+t;return Mathf.SmoothMax(Math.sin(t),Math.sin(t+Math.PI),150)}GetVelocity(){return new Vector2(this.sprite.body.velocity.x,this.sprite.body.velocity.y)}randomDirection(){const t=
Math.random()*Math.PI*2;return new Vector2(Math.cos(t),Math.sin(t))}isAggressive(){let t=sceneData.player.GetPosition();return(new Vector2(this.sprite.centerX,this.sprite.centerY)).Sub(t).Length()<this.attackRange?!0:!1}FlashTint(t,e,v,l=null){var k={step:0};l||(l=this.sprite.tint);game.add.tween(k).to({step:1},e,Phaser.Easing.Default,!0).onUpdateCallback(()=>{this.sprite.tint=Phaser.Color.interpolateColor(l,t,1,k.step,1)}).onComplete.add(()=>{const a=game.add.tween(k).to({step:0},v,Phaser.Easing.Default,
!0);a.onComplete.add(()=>{this.sprite.tint=l});a.onUpdateCallback(()=>{this.sprite.tint=Phaser.Color.interpolateColor(l,t,1,k.step,1)})})}Damage(t){this.immune||0>=this.health||(this.health-=t,this.health=Mathf.Clamp(this.health,0,gameConfig.enemies[this.enemyType].stats.maxHealth),sceneData.sounds.squishy.play(),0>=this.health?this.Die():(this.FlashTint(16335945,50,this.immunityDuration-50,16777215),this.immune=!0,game.time.events.add(this.immunityDuration,()=>{this.immune=!1})))}Die(){this.SpawnCollectable();
this.Destroy()}onPlayerCollision(t,e){e.getParentComponent().takeDamage(this.damage)}SpawnCollectable(){let t=Math.random();console.log(t,gameConfig.enemies[this.enemyType].crystalDropChance);sceneData.collectables=t<gameConfig.enemies[this.enemyType].crystalDropChance?new Collectible(eventSystem,this.sprite.body.x,this.sprite.body.y,{spriteName:"collectible",spriteScale:.5,onPlayerCollision:function(){sceneData.HUD.addCrystals(1)}}):new Collectible(eventSystem,this.sprite.body.x,this.sprite.body.y,
{spriteName:"xp",spriteScale:.3,onPlayerCollision:function(){sceneData.HUD.addScore(5)}})}BeforeDestroy(){this.onDestroy();this.sprite.destroy();this.shadow.destroy()}};class EnemyManager extends Component{constructor(t,e){super(t);t.Subscribe("scene-update",this.Update,this);this.spawnData={};console.log(e);for(let v of Object.keys(e))this.spawnData[v]={spawnTimer:0,enemyCount:0,spawnPoints:e[v],get maxEnemyCount(){return gameConfig.enemies[v].maxAmount},get spawnDelay(){return gameConfig.enemies[v].spawnDelay}}}Update(){for(let t of Object.keys(this.spawnData))this.HandleSpawnType(t)}HandleSpawnType(t){this.spawnData[t].enemyCount>=this.spawnData[t].maxEnemyCount||
(this.spawnData[t].spawnTimer+=.001*game.time.elapsed,this.spawnData[t].spawnTimer>=this.spawnData[t].spawnDelay&&(this.spawnData[t].spawnTimer=0,this.SpawnEnemy(t)))}SpawnEnemy(t){const e=sceneData.player.GetPosition();var v=this.spawnData[t].spawnPoints.filter(l=>l.Sub(e).Length()<=gameConfig.maxEnemySpawnDistance);0==v.length?console.warn("No spawn points found for enemy type:",t):(v=v[Math.floor(Math.random()*v.length)],this.spawnData[t].enemyCount++,(new Enemy(eventSystem,t,new Vector2(v.x,v.y))).onDestroy=
function(){this.spawnData[t].enemyCount--}.bind(this))}Destroy(){this.OnDestroy()}};class EventSystem{constructor(){this.events={}}Subscribe(t,e,v){t in this.events||(this.events[t]=[]);this.events[t].push({callback:e,context:v})}CallEvent(t,e){if(t in this.events)for(let v=0;v<this.events[t].length;v++){const l=this.events[t][v].context;l.destroyed?(this.events[t].splice(v,1),v--):this.events[t][v].callback.bind(l)(...e)}}};class HUD extends Component{constructor(t){super(t);t.Subscribe("scene-update",this.Update,this);this.crystals=this.score=0;this.scoreText;this.level=1;this.levelText;Object.defineProperty(this,"maxHealth",{get:()=>gameConfig.playerStats.maxHealth});this.smoothHealth=sceneData.player.health;this.smoothFactor=.1;Object.defineProperty(this,"maxMana",{get:()=>gameConfig.playerStats.maxMana});this.smoothMana=sceneData.player.mana;this.maskPaddingLeft=20;this.maskPaddingRight=30;this.livesBar;this.livesBarOutline;
this.livesScale=1.5;this.manaBar;this.manaBarOutline;this.manaScale=1.5;this.padding=new Vector2(10,10);this.rightScreen=game.camera.width-10;this.centerScreen=game.camera.width/2;this.leftScreen=10;this.styleHUD={font:"26px Merryweather",fill:"#FFFFFF"};this.scoreTotal=0;this.collectibleTotal;this.showInteractionText=!1;this.createHUD()}Update(){this.updateHealthbarMask();this.updateManabarMask();this.updateInteractionText()}updateHealthbarMask(){this.smoothHealth=Mathf.Lerp(this.smoothHealth,sceneData.player.health,
this.smoothFactor);this.healthBarMask.clear();this.healthBarMask.beginFill(4095);this.healthBarMask.drawRect(this.healthBar.cameraOffset.x+this.maskPaddingLeft,this.healthBar.cameraOffset.y,this.smoothHealth/this.maxHealth*(this.healthBar.width-this.maskPaddingLeft-this.maskPaddingRight),this.healthBar.height);this.healthBarMask.endFill()}updateManabarMask(){this.smoothMana=Mathf.Lerp(this.smoothMana,sceneData.player.mana,this.smoothFactor);this.manaBarMask.clear();this.manaBarMask.beginFill(4095);
this.manaBarMask.drawRect(this.manaBar.cameraOffset.x+this.maskPaddingLeft,this.manaBar.cameraOffset.y,this.smoothMana/this.maxMana*(this.manaBar.width-this.maskPaddingLeft-this.maskPaddingRight),this.manaBar.height);this.manaBarMask.endFill()}createHUD(){this.createScoreText();this.createLevelText();this.createCrystalsText();this.createHealthbar();this.createManaBar();this.createInteractionText()}createText(t,e,v,l,k){k=game.add.text(v,l,k,this.styleHUD);k.anchor.setTo(t,e);k.fixedToCamera=!0;k.cameraOffset=
new Phaser.Point(v,l);sceneData.layers.UI.addChild(k);return k}updateInteractionText(){this.interactionText.cameraOffset=new Phaser.Point(this.rightScreen,game.camera.height-(this.showInteractionText?this.padding.y:-200));console.log(this.interactionText.cameraOffset);this.showInteractionText=!1}createInteractionText(){this.interactionText=this.createText(1,1,this.rightScreen,game.camera.height-this.padding.y,"Press F to interact")}createScoreText(){this.scoreText=this.createText(1,0,this.rightScreen,
this.padding.y);this.updateScoreText()}updateScoreText(){this.scoreText.text="Intelligence: "+this.score}createLevelText(){this.levelText=this.createText(.5,0,this.centerScreen,this.padding.y);this.updateLevelText()}updateLevelText(){this.levelText.text="Difficulty: "+difficultyText}createCrystalsText(){this.crystalText=this.createText(1,0,this.rightScreen,this.padding.y+40);this.updateCrystalsText()}updateCrystalsText(){this.crystalText.text="Crystals: "+this.crystals}createHealthbar(){this.healthBarFill=
game.add.sprite(this.padding.x,this.padding.y,"healthbar_mask_red");this.healthBarFill.scale.setTo(this.livesScale,this.livesScale);this.healthBarFill.fixedToCamera=!0;sceneData.layers.UI.addChild(this.healthBarFill);this.healthBar=game.add.sprite(this.padding.x,this.padding.y,"healthbar_outline");this.healthBar.scale.setTo(this.livesScale,this.livesScale);this.healthBar.fixedToCamera=!0;sceneData.layers.UI.addChild(this.healthBar);this.healthBarMask=game.add.graphics(0,0);this.healthBarMask.fixedToCamera=
!0;sceneData.layers.UI.addChild(this.healthBarMask);this.healthBarFill.mask=this.healthBarMask;this.updateHealthbarMask()}createManaBar(){this.manaBarFill=game.add.sprite(this.padding.x,this.padding.y+110,"manabar_mask");this.manaBarFill.scale.setTo(this.manaScale,this.manaScale);this.manaBarFill.fixedToCamera=!0;sceneData.layers.UI.addChild(this.manaBarFill);this.manaBar=game.add.sprite(this.padding.x,this.padding.y+110,"manabar_outline");this.manaBar.scale.setTo(this.manaScale,this.manaScale);this.manaBar.fixedToCamera=
!0;sceneData.layers.UI.addChild(this.manaBar);this.manaBarMask=game.add.graphics(0,0);this.manaBarMask.fixedToCamera=!0;sceneData.layers.UI.addChild(this.manaBarMask);this.manaBarFill.mask=this.manaBarMask;this.updateManabarMask()}addScore(t){this.score+=t;0<t&&(totalScore=this.scoreTotal+=t);this.updateScoreText()}setScore(t){let e=t-this.score;this.score=t;0<e&&(totalScore=this.scoreTotal+=e);this.updateScoreText()}addCrystals(t){this.crystals+=t;this.updateCrystalsText()}setCrystals(t){this.crystals=
t;this.updateCrystalsText()}setLevel(t){this.level=t;this.updateLevelText()}setHealthInstant(t){this.smoothHealth=t}setManaInstant(t){this.smoothMana=t}getScoreTotal(){return this.scoreTotal}};class Player extends Component{constructor(t,e){super(t);t.Subscribe("scene-update",this.Update,this);this.upKey=game.input.keyboard.addKey(Phaser.Keyboard.W);this.upArrow=game.input.keyboard.addKey(Phaser.Keyboard.UP);this.downKey=game.input.keyboard.addKey(Phaser.Keyboard.S);this.downArrow=game.input.keyboard.addKey(Phaser.Keyboard.DOWN);this.leftKey=game.input.keyboard.addKey(Phaser.Keyboard.A);this.leftArrow=game.input.keyboard.addKey(Phaser.Keyboard.LEFT);this.rightKey=game.input.keyboard.addKey(Phaser.Keyboard.D);
this.rightArrow=game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);Object.defineProperty(this,"maxVelocity",{get:()=>gameConfig.playerStats.maxVelocity});this.accelerationFactor=.1;this.maxTilt=25;this.maxTiltBopAmp=this.bopFreq=15;this.bopAmp=.3;this.shadowScale=.5;this.shadowJumpScale=.7;this.shadowAlpha=.1;this.shadowJumpAlpha=.4;this.shadowAnchor=new Vector2(.5,.6);Object.defineProperty(this,"immunityDuration",{get:()=>gameConfig.playerStats.immunityDuration});this.immune=!1;this.colliderScale=
new Vector2(.5,.7);Object.defineProperty(this,"maxHealth",{get:()=>gameConfig.playerStats.maxHealth});this.health=this.maxHealth;Object.defineProperty(this,"maxMana",{get:()=>gameConfig.playerStats.maxMana});this.mana=this.maxMana;this.maxHandDistance=36;this.handCursorDistance=10;this.handVelocityMultiplier=20;this.handMaxVelocity=400;this.handVelocityLerpFactor=.3;this.handVelocity=new Vector2(0,0);this.handAngularFactor=.2;this.handOrbitPivotOffset=new Vector2(0,-.15);this.debug=!1;this.maxCameraDistance=
700;this.cameraCursorInfluence=this.maxCameraLerp=.3;this.minCameraLerp=.001;this.sprite=game.add.sprite(e.x,e.y,"main-character");this.sprite.getParentComponent=()=>this;game.physics.p2.enable(this.sprite,this.debug);this.body=this.sprite.body;this.body.fixedRotation=!0;this.body.clearShapes();t=new Vector2(this.sprite.width*this.colliderScale.x,this.sprite.height*this.colliderScale.y);this.body.addCapsule(t.y-t.x,t.x/2,0,.5*-t.y,Mathf.Deg2Rad(90));this.body.setCollisionGroup(sceneData.collisionGroups.player);
this.body.collides([sceneData.collisionGroups.enemies,sceneData.collisionGroups.collectables,sceneData.collisionGroups.walls,sceneData.collisionGroups.store]);this.body.getParentComponent=()=>this;this.sprite.anchor.setTo(.5,1);this.handSprite=game.add.sprite(0,0,"hand0");this.handSpriteTextureId=0;this.maxHandTextureId=4;this.handSprite.anchor.setTo(.5,.5);this.handSprite.scale.setTo(-.15,.15);this.sprite.addChild(this.handSprite);sceneData.layers.player.addChild(this.sprite);this.shadow=game.add.sprite(e.x,
e.y,"shadow");this.shadow.anchor.setTo(this.shadowAnchor.x,this.shadowAnchor.y);sceneData.layers.shadows.addChild(this.shadow);this.canFire=!0;this.mouseDownDuration=0;game.camera.x=this.sprite.x-.5*game.camera.width;game.camera.y=this.sprite.y-.5*game.camera.height}GetInputAxis(){let t=new Vector2(0,0);this.upKey.isDown||this.upArrow.isDown?t.y--:(this.downKey.isDown||this.downArrow.isDown)&&t.y++;this.leftKey.isDown||this.leftArrow.isDown?t.x--:(this.rightKey.isDown||this.rightArrow.isDown)&&t.x++;
return t}Update(){this.PlayerMovement();this.PlayerJump();this.TrackCamera();this.HandMovement();this.HandRotation();this.UpdateShadow();if(!this.canFire)this.mouseDownDuration=0;else if(game.input.mousePointer.leftButton.isDown)0==this.mouseDownDuration&&0<this.mana&&sceneData.sounds.charge.play(),this.mouseDownDuration+=game.time.elapsed;else if(0<this.mouseDownDuration){let t=!1;const e=gameConfig.playerStats.attacks;for(let v of Object.keys(e)){const l=e[v];if(this.mouseDownDuration>l.chargeDuration&&
this.mana>=l.manaCost){this.Attack(l);t=!0;break}}t||(sceneData.sounds.empty.play(),game.camera.shake(.01,100));this.mouseDownDuration=0;sceneData.sounds.charge.stop()}}Attack(t){this.mana-=t.manaCost;this.canFire=!1;const e=this.GetHandForward();this.handVelocity=this.handVelocity.Sub(e.Scale(t.handRecoil));this.handSprite.angle-=90*(2*Math.random()-1);let v=this.GetVelocity().Sub(e.Scale(t.recoil));this.SetVelocity(v);game.camera.shake(t.shakeStength,t.shakeDuration);game.time.events.add(t.cooldown,
()=>this.canFire=!0);new Projectile(eventSystem,this.GetHandPosition(),e.Scale(t.speed),{spriteName:"bullet",spriteScale:new Vector2(t.scale,t.scale),mass:60,wobbleFrequency:t.wobbleFrequency,wobbleMagnitude:t.wobbleMagnitude,collisionConfigs:[{collisionGroup:sceneData.collisionGroups.enemies,callback:function(l,k){l=k.getParentComponent();l.Damage(t.damage);k=t.knockbackFactor;l.body.velocity.x=this.GetVelocity().x*k;l.body.velocity.y=this.GetVelocity().y*k;t.destroyOnHit&&this.Destroy()}},{collisionGroup:sceneData.collisionGroups.walls,
callback:function(l,k){this.Destroy()}}]});this.SwapHandTexture()}SwapHandTexture(){this.handSpriteTextureId++;this.handSpriteTextureId>this.maxHandTextureId&&(this.handSpriteTextureId=0);this.handSprite.loadTexture(`hand${this.handSpriteTextureId}`)}UpdateShadow(){this.shadow.x=this.sprite.x;this.shadow.y=this.sprite.y;let t=this.GetPlayerBop(),e=Mathf.TransformRange(0,1,this.shadowScale,this.shadowJumpScale,t);this.shadow.scale.setTo(e,e);this.shadow.alpha=Mathf.TransformRange(0,1,this.shadowAlpha,
this.shadowJumpAlpha,t)}GetTargetVelocity(){return this.GetInputAxis().Scale(this.maxVelocity)}PlayerMovement(){var t=this.GetVelocity();t=Vector2.Lerp(t,this.GetTargetVelocity(),this.accelerationFactor);this.sprite.body.velocity.x=t.x;this.sprite.body.velocity.y=t.y}GetPlayerBop(){const t=this.GetVelocity();return Mathf.TransformRange(0,this.maxVelocity,1,.9+Math.abs(Math.sin(game.time.totalElapsedSeconds()*this.bopFreq*.5)*this.bopAmp),t.Length())}PlayerJump(){var t=this.GetVelocity();let e=this.maxTilt-
Math.abs(Math.sin(game.time.totalElapsedSeconds()*this.bopFreq*.5)*this.maxTiltBopAmp);t=Mathf.TransformRange(-1*this.maxVelocity,1*this.maxVelocity,-e,e,t.x);this.sprite.angle=t;t=this.GetPlayerBop();this.sprite.anchor.setTo(.5,t)}TrackCamera(){var t=CoordUtils.ScreenSpaceToWorldSpace(new Vector2(game.input.mousePointer.x,game.input.mousePointer.y)),e=new Vector2(game.camera.centerX,game.camera.centerY),v=new Vector2(this.sprite.centerX,this.sprite.centerY);t=Vector2.Lerp(v,t,this.cameraCursorInfluence);
v=t.Sub(e).Length();v=Mathf.Clamp(Mathf.TransformRange(0,this.maxCameraDistance,this.minCameraLerp,this.maxCameraLerp,v),0,this.maxCameraLerp);e=Vector2.Lerp(e,t,v).Sub(e);game.camera.x+=e.x;game.camera.y+=e.y}HandMovement(){this.GetPlayerBop();var t=CoordUtils.ScreenSpaceToWorldSpace(new Vector2(game.input.mousePointer.x,game.input.mousePointer.y));t=CoordUtils.InverseTransformPoint(t,this.GetSpriteCenter(this.handOrbitPivotOffset),Mathf.Deg2Rad(this.sprite.angle));var e=t.Length();t=t.Normalized().Scale(Math.min(e-
this.handCursorDistance,this.maxHandDistance));t=CoordUtils.TransformPoint(t,this.GetSpriteCenter(this.handOrbitPivotOffset),Mathf.Deg2Rad(this.sprite.angle));e=CoordUtils.InverseTransformPoint(t,this.GetRootPosition(),Mathf.Deg2Rad(this.sprite.angle));t=new Vector2(this.handSprite.x,this.handSprite.y);e=e.Sub(t).Scale(this.handVelocityMultiplier).ClampLength(0,this.handMaxVelocity);this.handVelocity=Vector2.Lerp(this.handVelocity,e,this.handVelocityLerpFactor);t=Vector2.Add(t,this.handVelocity.Scale(.001*
game.time.delta));this.handSprite.x=t.x;this.handSprite.y=t.y}GetHandForward(){return CoordUtils.TransformPoint(Vector2.right,Vector2.zero,Mathf.Deg2Rad(this.handSprite.angle+this.sprite.angle))}HandRotation(){let t=this.GetHandPosition();var e=CoordUtils.ScreenSpaceToWorldSpace(new Vector2(game.input.mousePointer.x,game.input.mousePointer.y)).Sub(t),v=this.handSprite.angle;let l=Mathf.Rad2Deg(Math.atan2(e.y,e.x))-this.sprite.angle;v=Mathf.DeltaAngle(v,l);this.handSprite.angle+=v*this.handAngularFactor;
v=this.handSprite.scale.y;v=Mathf.Lerp(v,0>Mathf.WrapAngle(this.handSprite.angle-90)?.15:-.15,.3);this.handSprite.scale.setTo(this.handSprite.scale.x,v);this.debug&&(e=CoordUtils.TransformPoint(Vector2.right.Scale(e.Length()),t,Mathf.Deg2Rad(this.handSprite.angle+this.sprite.angle)),game.debug.geom(new Phaser.Line(t.x,t.y,e.x,e.y),"#F00"))}GetHandPosition(){const t=new Vector2(this.handSprite.x,this.handSprite.y);return CoordUtils.TransformPoint(t,this.GetRootPosition(),Mathf.Deg2Rad(this.sprite.angle))}GetRootPosition(){return new Vector2(this.sprite.x,
this.sprite.y)}GetBodyCenter(){return new Vector2(this.sprite.centerX,this.sprite.centerY)}GetSpriteCenter(t=null){t||(t=Vector2.zero);const e=this.GetPlayerBop();return CoordUtils.TransformPoint(new Vector2(t.x,-this.sprite.height*(.5+t.y+e-1)),this.GetRootPosition(),Mathf.Deg2Rad(this.sprite.angle))}GetVelocity(){return new Vector2(this.sprite.body.velocity.x,this.sprite.body.velocity.y)}SetVelocity(t){this.sprite.body.velocity.x=t.x;this.sprite.body.velocity.y=t.y}GetPosition(){return this.GetBodyCenter()}FlashTint(t,
e,v,l=null){var k={step:0};l||(l=this.sprite.tint);game.add.tween(k).to({step:1},e,Phaser.Easing.Default,!0).onUpdateCallback(()=>{this.sprite.tint=Phaser.Color.interpolateColor(l,t,1,k.step,1)}).onComplete.add(()=>{const a=game.add.tween(k).to({step:0},v,Phaser.Easing.Default,!0);a.onComplete.add(()=>{this.sprite.tint=l});a.onUpdateCallback(()=>{this.sprite.tint=Phaser.Color.interpolateColor(l,t,1,k.step,1)})})}takeDamage(t){this.immune||0>=this.health||(this.FlashTint(16335945,50,this.immunityDuration-
50,16777215),this.health-=t,this.health=Mathf.Clamp(this.health,0,this.maxHealth),sceneData.sounds.hurt.play(),this.immune=!0,game.time.events.add(this.immunityDuration,()=>{this.immune=!1}),console.log("OUCHING PLAYER, health: "+this.health),0>=this.health&&(gameWin=!1,game.camera.fade(0,2E3),game.state.start("endScreen")))}Heal(t){0>=this.health||(this.health+=t,this.health=Mathf.Clamp(this.health,0,this.maxHealth))}RestoreMana(t){this.mana+=t;this.mana=Mathf.Clamp(this.mana,0,this.maxMana)}};class Projectile extends Component{constructor(t,e,v,l){super(t);t.Subscribe("scene-update",this.Update,this);t.Subscribe("on-physics-overlap",this.onOverlap,this);this.sprite=game.add.sprite(e.x,e.y,l.spriteName);this.baseScale=Vector2.one;this.wobbleFrequency=l.wobbleFrequency||1;this.wobbleMagnitude=l.wobbleMagnitude||0;l.spriteScale&&(this.baseScale=l.spriteScale);this.sprite.scale.setTo(this.baseScale.x,this.baseScale.y);game.physics.p2.enable(this.sprite,!1);this.body=this.sprite.body;l.collisionGroup?
this.body.setCollisionGroup(collisionGroup):this.body.setCollisionGroup(sceneData.collisionGroups.projectiles);l.layer?l.layer.addChild(this.sprite):sceneData.layers.projectiles.addChild(this.sprite);this.collisionConfigs=l.collisionConfigs;this.body.velocity.x=v.x;this.body.velocity.y=v.y;this.body.collideWorldBounds=!1;l.mass&&(this.body.data.mass=l.mass);this.body.getParentComponent=()=>this;sceneData.sounds.fire.play()}Update(){let t=Math.sin(game.time.totalElapsedSeconds()*this.wobbleFrequency)*
this.wobbleMagnitude;this.sprite.scale.setTo(this.baseScale.x+t,this.baseScale.y+t);this.body.angle=Mathf.Rad2Deg(Math.atan2(this.body.velocity.y,this.body.velocity.x));this.sprite.inWorld||this.Destroy()}BeforeDestroy(){this.sprite.destroy()}GetVelocity(){return new Vector2(this.body.velocity.x,this.body.velocity.y)}onOverlap(t,e){if(t.data.shapes&&0!=t.data.shapes.length&&e.data.shapes&&0!=e.data.shapes.length){var v=[t.data.shapes[0].collisionGroup,e.data.shapes[0].collisionGroup];t=[t,e];if(t.some(l=>
l==this.body))for(let l of this.collisionConfigs)if(v.some(k=>k===l.collisionGroup.mask)){e=l.context||this;let k=v.findIndex(a=>a===l.collisionGroup.mask);l.callback.call(e,t[1-k],t[k])}}}};class SafeZone extends Component{constructor(t,e,v){super(t);t.Subscribe("scene-update",this.Update,this);t.Subscribe("on-physics-overlap",this.onOverlap,this);this.sprite=game.add.sprite(e.x,e.y,"safeZoneArea");this.sprite.anchor.setTo(.5,.5);this.sprite.getParentComponent=()=>this;sceneData.layers.safezone.addChild(this.sprite);game.physics.p2.enable(this.sprite,!1);this.body=this.sprite.body;this.body.fixedRotation=!0;console.log(this.sprite);this.body.clearShapes();this.body.addRectangle(v.x,
v.y);this.body.setCollisionGroup(sceneData.collisionGroups.safeZones);this.body.collides(sceneData.collisionGroups.player,this.onPlayerCollision,this);this.body.collides(sceneData.collisionGroups.enemies);this.body.kinematic=!0;this.playerOverlap=!1;this.safeZoneTimer=this.safeZoneTimerMax=10;this.timerAlert=3;this.tintDuration=2;this.safeZoneText=game.add.text(this.sprite.centerX,this.sprite.centerY+150,"",{font:"50px Merryweather",fill:"#000000"});this.safeZoneText.anchor.setTo(.5,.5);this.createCrystals();
this.setUpStore()}createCrystals(){const t=this.sprite.x,e=this.sprite.y;this.createCrystal(t+30,e-200,"crystal1",20);this.createCrystal(t+50,e-170,"crystal2",15);this.createCrystal(t,e-150,"crystal3",10)}createCrystal(t,e,v,l){t=game.add.sprite(t,e,v);t.anchor.setTo(.5,.5);sceneData.layers.decor.addChild(t);e=game.add.tween(t).to({y:e-l},1E3,Phaser.Easing.Quadratic.InOut,!0,0,-1,!0);return{crystal:t,tween:e}}Update(){sceneData.player.sprite.getBounds();this.sprite.getBounds();this.ProcessPlayerOverlap();
this.updateTimer()}ProcessPlayerOverlap(){this.playerOverlap?(this.safeZoneTimer-=.001*game.time.elapsed,this.safeZoneTimer<this.timerAlert&&!sceneData.sounds.explosion.isPlaying&&sceneData.sounds.explosion.play(),0>=this.safeZoneTimer&&(console.log("AWOOGA"),game.state.start("endScreen"))):(sceneData.sounds.explosion.stop(),this.safeZoneTimer+=.001*game.time.elapsed);this.safeZoneTimer=Mathf.Clamp(this.safeZoneTimer,0,this.safeZoneTimerMax);var t=Mathf.TransformRange(this.timerAlert,this.timerAlert-
this.tintDuration,0,1,this.safeZoneTimer);t=Mathf.Clamp(t,0,1);t=Phaser.Color.interpolateRGB(255,255,255,255,60,60,1,t);console.log(t);this.sprite.tint=t;this.playerOverlap=!1}onOverlap(t,e){t.data.shapes&&0!=t.data.shapes.length&&e.data.shapes&&0!=e.data.shapes.length&&(t=[t.data.shapes[0].collisionGroup,e.data.shapes[0].collisionGroup],t.some(v=>v===sceneData.collisionGroups.player.mask)&&t.some(v=>v===sceneData.collisionGroups.safeZones.mask)&&(this.playerOverlap=!0))}updateTimer(){this.safeZoneText.text=
Math.round(this.safeZoneTimer)}setUpStore(){const t=Object.keys(gameConfig.upgrades);var e=(new Vector2(this.sprite.centerX,this.sprite.centerY)).Sub(new Vector2(200*Math.floor(t.length/2),0));console.log(e);for(let v of t)console.log(e),new Store(eventSystem,e,gameConfig.upgrades[v]),e=e.Add(new Vector2(200,0))}};class Store extends Component{constructor(t,e,v,l={font:"18px Merryweather",fill:"#fff",align:"center"},k={font:"20px Merryweather",fill:"#fff",align:"center"}){super(t);t.Subscribe("scene-update",this.Update,this);t.Subscribe("on-physics-overlap",this.onOverlap,this);this.storeConfig=v;this.storeConfig.getBalance||(this.storeConfig.getBalance=()=>sceneData.HUD.score);this.storeConfig.setBalance||(this.storeConfig.setBalance=a=>sceneData.HUD.setScore(a));this.currentState=0;this.purchaseKey=game.input.keyboard.addKey(Phaser.Keyboard.F);
this.sprite=game.add.sprite(e.x,e.y,v.spriteName);this.sprite.anchor.setTo(.5,.5);sceneData.layers.world.add(this.sprite);v.spriteScale&&this.sprite.scale.setTo(v.spriteScale,v.spriteScale);game.physics.p2.enable(this.sprite,!1);this.body=this.sprite.body;this.body.kinematic=!0;t=new Vector2(this.sprite.centerX,this.sprite.centerY);this.upgradeDescription=game.add.text(t.x,t.y+this.sprite.height/2+25,this.storeConfig.upgradeText,l);this.upgradeDescription.anchor.setTo(.5,.5);sceneData.layers.world.add(this.upgradeDescription);
this.upgradePriceDisplay=game.add.text(t.x,t.y-this.sprite.height/2-25,"",k);this.upgradePriceDisplay.anchor.setTo(.5,.5);sceneData.layers.world.add(this.upgradePriceDisplay);this.isDown=!0;this.disabled=!1;this.body.getParentComponent=()=>this}Update(){this.UpdateText();this.playerOverlap&&this.GetPurchaseKey()&&this.AttemptPurchase();this.ProcessPlayerOverlap();this.ProcessPurchaseKey()}UpdateText(){this.disabled||(this.storeConfig.priceHidden?this.upgradePriceDisplay.setText(""):this.upgradePriceDisplay.setText(`${this.storeConfig.stages[this.currentState].cost} ${this.storeConfig.priceUnits||
"INT"}`),this.CanPurchase()?(this.upgradePriceDisplay.alpha=1,this.upgradeDescription.alpha=1,this.sprite.alpha=1):(this.upgradePriceDisplay.alpha=.7,this.upgradeDescription.alpha=.7,this.sprite.alpha=.7))}CanPurchase(){return this.currentState>this.storeConfig.stages.length-1?!1:this.storeConfig.stages[this.currentState].cost<=this.storeConfig.getBalance()}AttemptPurchase(){if(!(this.disabled||this.currentState>this.storeConfig.stages.length-1)&&this.CanPurchase()){const e=this.storeConfig.stages[this.currentState];
this.storeConfig.setBalance(this.storeConfig.getBalance()-e.cost);for(var t of e.changes)this.CompleteChange(t);this.storeConfig.purchaseSound&&("string"==typeof this.storeConfig.purchaseSound?sceneData.sounds[this.storeConfig.purchaseSound].play():this.storeConfig.purchaseSound.play());t=game.add.tween(this.sprite.scale).to({x:this.storeConfig.spriteScale+.1,y:this.storeConfig.spriteScale+.1},100,Phaser.Easing.Quadratic.InOut,!0);console.log("tween",t);t.onComplete.add(function(){game.add.tween(this.sprite.scale).to({x:this.storeConfig.spriteScale,
y:this.storeConfig.spriteScale},100,Phaser.Easing.Quadratic.InOut,!0)},this);e.repeat?(0==e.repeat&&this.currentState++,0<e.repeat&&e.repeat--):this.currentState++;this.currentState>this.storeConfig.stages.length-1&&this.Disable()}}CompleteChange(t){switch(t.actionType){case "mutate":const e=t.property.split("."),v=t.value,l=t.changeType;this.MutateAtPath(e,k=>{if("add"==l)return k+v;if("set"==l)return v;console.error("Invalid change type: ",l)});break;case "heal":sceneData.player.Heal(gameConfig.playerStats.maxHealth*
t.factor);break;case "reload":sceneData.player.RestoreMana(gameConfig.playerStats.maxMana*t.factor);break;case "custom":t.action()}}MutateAtPath(t,e){let v=gameConfig;for(let l=0;l<t.length-1;l++)console.log(v,t[l]),v=v[t[l]];v[t[t.length-1]]=e(v[t[t.length-1]])}Disable(){this.disabled=!0;this.sprite.alpha=.5;this.upgradeDescription.destroy();this.upgradePriceDisplay.destroy()}ProcessPlayerOverlap(){sceneData.HUD.showInteractionText=sceneData.HUD.showInteractionText||this.playerOverlap;this.playerOverlap=
!1}onOverlap(t,e){if(t.data.shapes&&0!=t.data.shapes.length&&e.data.shapes&&0!=e.data.shapes.length){var v=[t,e];[t.data.shapes[0].collisionGroup,e.data.shapes[0].collisionGroup].some(l=>l===sceneData.collisionGroups.player.mask)&&v.some(l=>l==this.body)&&(this.playerOverlap=!0)}}GetPurchaseKey(){if(!this.isDown&&this.purchaseKey.isDown)return!0}ProcessPurchaseKey(){this.isDown=this.purchaseKey.isDown}};let configState={preload:loadConfigAssets,create:doConfig};function loadConfigAssets(){game.load.image("configTitle","assets/imgs/Titles/CONFIG.png");game.load.image("easyButton","assets/imgs/Buttons/gameeasy.png");game.load.image("avgButton","assets/imgs/Buttons/gamemedium.png");game.load.image("ngtmButton","assets/imgs/Buttons/gamenightmare.png")}
function doConfig(){game.camera.flash(0,2E3);game.input.enabled=!0;title=game.add.image(game.camera.width/2,50,"configTitle");title.anchor.setTo(.5,0);game.add.tween(title).to({y:title.y+10},2E3,Phaser.Easing.Linear.None,!0,0,-1,!0);game.add.text(game.camera.width/2,220,"Select your difficulty...",{font:"40px Merryweather",fill:"#ffffff",align:"center"}).anchor.setTo(.5,0);btnEasy=game.add.button(game.camera.width/2-300,game.camera.height/2+100,"easyButton",onButtonPressed,this);btnEasy.anchor.setTo(.5,
.5);btnEasy.name="btnEasy";btnEasy.events.onInputOver.add(jiggle,this);btnAvg=game.add.button(game.camera.width/2,game.camera.height/2+100,"avgButton",onButtonPressed,this);btnAvg.anchor.setTo(.5,.5);btnAvg.name="btnAvg";btnAvg.events.onInputOver.add(jiggle,this);btnNgtm=game.add.button(game.camera.width/2+300,game.camera.height/2+100,"ngtmButton",onButtonPressed,this);btnNgtm.anchor.setTo(.5,.5);btnNgtm.name="btnNgtm";btnNgtm.events.onInputOver.add(jiggle,this);difficultyDisplay=game.add.text(game.camera.width/
2,game.camera.height/2+250,"Current difficulty: "+difficultyText,{font:"25px Merryweather",fill:"#ffffff"});difficultyDisplay.anchor.setTo(.5,.5)}difficultyText="Easy";function onButtonPressed(t){"btnEasy"===t.name?(difficulty="easy",difficultyText="Easy",goHome()):"btnAvg"===t.name?(difficulty="medium",difficultyText="Medium",goHome()):"btnNgtm"===t.name&&(difficulty="nightmare",difficultyText="Nightmare",goHome())}
function jiggle(t){game.add.tween(t.scale).to({x:1.2,y:.8},200,Phaser.Easing.Cubic.InOut,!0,0,0,!0).onComplete.add(function(){game.add.tween(t.scale).to({x:1,y:1},200,Phaser.Easing.Cubic.InOut,!0)})}function goHome(){game.camera.fade(0,1E3);game.camera.onFadeComplete.add(function(){game.state.start("welcomescreen")},this)};let endState={preload:function(){game.load.image("winbg","assets/imgs/Titles/winscreen.png");game.load.image("endbg","assets/imgs/Titles/losescreen.png")},create:function(){game.camera.flash(0,1E3);game.input.enabled=!0;gameWin?win():gameOver();var t=game.camera.width/2;let e=game.camera.height/2,v={font:"25px Merriweather",fill:"#FFFFFF"};createBtn(t-450,e-100,"Return from whence you came... (main menu)",onHomeBtnPressed,v);createBtn(t-450,e,"Restart",onStartBtnPressed,v);t=game.add.text(0,e+200,
"Your score is: "+totalScore,{font:"35px Merriweather",fill:"#FFFFFF",align:"center"});t.position.x=t.width/2+50;t.anchor.setTo(.5,.5)}},btnReturnStart;function win(){imagebg("winbg")}function gameOver(){imagebg("endbg")}function imagebg(t){background=game.add.image(0,0,t);background.width=game.width;background.height=game.height;background.anchor.setTo(.5,.5);background.x=game.width/2;background.y=game.height/2}
function createBtn(t,e,v,l){t=game.add.text(0,e,v,{font:"30px Merriweather",fill:"#FFFFFF",align:"center"});t.position.x=t.width/2+50;t.anchor.setTo(.5,.5);t.inputEnabled=!0;t.events.onInputDown.add(l,this);t.events.onInputOver.add(onBtnHover,this);t.events.onInputOut.add(onBtnOut,this);return t}function createText(t,e,v,l){v=game.add.text(0,e,v,l);v.position.x=v.width/2;v.anchor.setTo(.5,.5);v.fixedToCamera=!0;v.cameraOffset=new Phaser.Point(t,e)}
function onStartBtnPressed(){game.camera.fade(0,2E3);game.camera.onFadeComplete.add(function(){game.state.start("play")},this)}function onHomeBtnPressed(){game.camera.fade(0,2E3);game.camera.onFadeComplete.add(function(){game.state.start("welcomescreen")},this)}function onBtnHover(t){t.text="~"+t.text+"~";game.add.tween(t.scale).to({x:1.1,y:1.1},1E3,Phaser.Easing.Quartic.Out,!0,0,0,!1)}
function onBtnOut(t){t.text=t.text.replaceAll("~","");game.tweens.removeFrom(t.scale);game.add.tween(t.scale).to({x:1,y:1},1E3,Phaser.Easing.Quartic.Out,!0,0,0,!1)};let currentslide=1,slideDuration=1E4,instructionState={preload:loadInstructionAssets,create:showInstructions};
function loadInstructionAssets(){game.load.image("InstructionsBg","assets/imgs/Backgrounds/TheDungeons.jpeg");game.load.image("instructions1","assets/imgs/Backgrounds/instructions1.png");game.load.image("instructions2","assets/imgs/Backgrounds/instructions2.png");game.load.image("instructions3","assets/imgs/Backgrounds/instructions3.png");game.load.image("instructions4","assets/imgs/Backgrounds/instructions4.png")}
function showInstructions(){game.camera.flash(0,1E3);game.input.enabled=!0;InstructionsBg=game.add.image(game.camera.width/2,0,"InstructionsBg");InstructionsBg.scale.setTo(.6,.6);InstructionsBg.anchor.setTo(.5,0);InstructionsBg.alpha=.2;slide1();game.add.text(game.camera.width/2,game.camera.height-100,"Press SPACE to skip onto the next",{font:"20px Merryweather",fill:"#ffffff",align:"center"}).anchor.setTo(.5,0)}
function slide1(){const t=game.add.text(game.camera.width/2,game.camera.height/2-400,"Your purpose...",{font:"40px Merryweather",fill:"#ffffff",align:"center"});t.anchor.setTo(.5,0);instructions1=game.add.image(game.camera.width/2,game.camera.height/2,"instructions1");instructions1.scale.setTo(2,2);instructions1.anchor.setTo(.5,.5);const e=game.time.events.add(slideDuration,function(){t.destroy();instructions1.destroy();slide2()},this);game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.addOnce(function(){game.time.events.remove(e);
t.destroy();instructions1.destroy();slide2()})}
function slide2(){const t=game.add.text(game.camera.width/2,game.camera.height/2-400,"Your foes...",{font:"40px Merryweather",fill:"#ffffff",align:"center"});t.anchor.setTo(.5,0);instructions2=game.add.image(game.camera.width/2,game.camera.height/2,"instructions2");instructions2.scale.setTo(2,2);instructions2.anchor.setTo(.5,.5);const e=game.time.events.add(slideDuration,function(){t.destroy();instructions2.destroy();slide3()},this);game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.addOnce(function(){game.time.events.remove(e);t.destroy();
instructions2.destroy();slide3()})}
function slide3(){const t=game.add.text(game.camera.width/2,game.camera.height/2-400,"Your path to victory...",{font:"40px Merryweather",fill:"#ffffff",align:"center"});t.anchor.setTo(.5,0);instructions3=game.add.image(game.camera.width/2,game.camera.height/2,"instructions3");instructions3.scale.setTo(2,2);instructions3.anchor.setTo(.5,.5);const e=game.time.events.add(slideDuration,function(){t.destroy();instructions3.destroy();slide4()},this);game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.addOnce(function(){game.time.events.remove(e);t.destroy();
instructions3.destroy();slide4()})}
function slide4(){game.add.text(game.camera.width/2,game.camera.height/2-400,"Your ultimate goal...",{font:"40px Merryweather",fill:"#ffffff",align:"center"}).anchor.setTo(.5,0);instructions4=game.add.image(game.camera.width/2,game.camera.height/2,"instructions4");instructions4.scale.setTo(2,2);instructions4.anchor.setTo(.5,.5);game.time.events.add(slideDuration,function(){game.camera.fade(0,1E3);game.camera.onFadeComplete.add(function(){game.state.start("welcomescreen")},this)},this);game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.addOnce(function(){game.camera.fade(0,
1E3);game.camera.onFadeComplete.add(function(){game.state.start("welcomescreen")},this)})};class CoordUtils{static ScreenSpaceToWorldSpace(t){return new Vector2(t.x+game.camera.x,t.y+game.camera.y)}static WorldSpaceToScreenSpace(t){return new Vector2(t.x-game.camera.x,t.y-game.camera.y)}static TransformPoint(t,e,v){return new Vector2(t.x*Math.cos(v)-t.y*Math.sin(v)+e.x,t.x*Math.sin(v)+t.y*Math.cos(v)+e.y)}static InverseTransformPoint(t,e,v){let l=t.x-e.x;t=t.y-e.y;return new Vector2(l*Math.cos(v)+t*Math.sin(v),-l*Math.sin(v)+t*Math.cos(v))}};class Mathf{static Clamp(t,e,v){return Math.max(e,Math.min(t,v))}static Clamp01(t){return Mathf.Clamp(t,0,1)}static Lerp(t,e,v){return(1-v)*t+v*e}static TransformRange(t,e,v,l,k){return(k-t)*(l-v)/(e-t)+v}static Deg2Rad(t){return Math.PI/180*t}static Rad2Deg(t){return 180/Math.PI*t}static WrapAngle(t){180<t?t-=360:-180>=t&&(t+=360);return t}static DeltaAngle(t,e){t=Mathf.WrapAngle(e-t);180<t&&(t-=360);return t}static SmoothMax(t,e,v){return Math.log(Math.exp(t*v)+Math.exp(e*v))/v}static SmoothMin(t,
e,v){return-Mathf.SmoothMax(-t,-e,v)}static Activation01(t,e){const v=Math.pow(t,e);return v/(v+Math.pow(1-t,e))}};!function(t){var e;"object"==typeof exports?module.exports=t():("undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t())}(function(){return function k(e,v,l){function a(d,f){if(!v[d]){if(!e[d]){var g="function"==typeof require&&require;if(!f&&g)return g(d,!0);if(b)return b(d,!0);throw Error("Cannot find module '"+d+"'");}f=v[d]={exports:{}};e[d][0].call(f.exports,function(h){return a(e[d][1][h]||h)},f,f.exports,k,e,v,l)}return v[d].exports}
for(var b="function"==typeof require&&require,c=0;c<l.length;c++)a(l[c]);return a}({1:[function(e,v,l){function k(){}var a=e("./Scalar");(v.exports=k).lineInt=function(b,c,d){var f,g,h,m,n,p,q,r=[0,0];return f=b[1][1]-b[0][1],g=b[0][0]-b[1][0],h=f*b[0][0]+g*b[0][1],m=c[1][1]-c[0][1],n=c[0][0]-c[1][0],p=m*c[0][0]+n*c[0][1],q=f*n-m*g,a.eq(q,0,d||0)||(r[0]=(n*h-g*p)/q,r[1]=(f*p-m*h)/q),r};k.segmentsIntersect=function(b,c,d,f){var g=c[0]-b[0];c=c[1]-b[1];var h=f[0]-d[0],m=f[1]-d[1];if(0==h*c-m*g)return!1;
f=(g*(d[1]-b[1])+c*(b[0]-d[0]))/(h*c-m*g);b=(h*(b[1]-d[1])+m*(d[0]-b[0]))/(m*g-h*c);return 0<=f&&1>=f&&0<=b&&1>=b}},{"./Scalar":4}],2:[function(e,v,l){function k(){}(v.exports=k).area=function(c,d,f){return(d[0]-c[0])*(f[1]-c[1])-(f[0]-c[0])*(d[1]-c[1])};k.left=function(c,d,f){return 0<k.area(c,d,f)};k.leftOn=function(c,d,f){return 0<=k.area(c,d,f)};k.right=function(c,d,f){return 0>k.area(c,d,f)};k.rightOn=function(c,d,f){return 0>=k.area(c,d,f)};var a=[],b=[];k.collinear=function(c,d,f,g){return g?
(a[0]=d[0]-c[0],a[1]=d[1]-c[1],b[0]=f[0]-d[0],b[1]=f[1]-d[1],Math.acos((a[0]*b[0]+a[1]*b[1])/(Math.sqrt(a[0]*a[0]+a[1]*a[1])*Math.sqrt(b[0]*b[0]+b[1]*b[1])))<g):0==k.area(c,d,f)};k.sqdist=function(c,d){var f=d[0]-c[0];c=d[1]-c[1];return f*f+c*c}},{}],3:[function(e,v,l){function k(){this.vertices=[]}function a(h,m,n,p,q){var r=m[1]-h[1];m=h[0]-m[0];h=r*h[0]+m*h[1];var u=p[1]-n[1];p=n[0]-p[0];n=u*n[0]+p*n[1];var x=r*p-u*m;return d.eq(x,0,q||0)?[0,0]:[(p*h-m*n)/x,(r*n-u*h)/x]}var b=e("./Line"),c=e("./Point"),
d=e("./Scalar");(v.exports=k).prototype.at=function(h){var m=this.vertices,n=m.length;return m[0>h?h%n+n:h%n]};k.prototype.first=function(){return this.vertices[0]};k.prototype.last=function(){return this.vertices[this.vertices.length-1]};k.prototype.clear=function(){this.vertices.length=0};k.prototype.append=function(h,m,n){if(void 0===m)throw Error("From is not given!");if(void 0===n)throw Error("To is not given!");if(n-1<m)throw Error("lol1");if(n>h.vertices.length)throw Error("lol2");if(0>m)throw Error("lol3");
for(;m<n;m++)this.vertices.push(h.vertices[m])};k.prototype.makeCCW=function(){for(var h=0,m=this.vertices,n=1;n<this.vertices.length;++n)(m[n][1]<m[h][1]||m[n][1]==m[h][1]&&m[n][0]>m[h][0])&&(h=n);c.left(this.at(h-1),this.at(h),this.at(h+1))||this.reverse()};k.prototype.reverse=function(){for(var h=[],m=0,n=this.vertices.length;m!==n;m++)h.push(this.vertices.pop());this.vertices=h};k.prototype.isReflex=function(h){return c.right(this.at(h-1),this.at(h),this.at(h+1))};var f=[],g=[];k.prototype.canSee=
function(h,m){var n;if(c.leftOn(this.at(h+1),this.at(h),this.at(m))&&c.rightOn(this.at(h-1),this.at(h),this.at(m)))return!1;var p=c.sqdist(this.at(h),this.at(m));for(var q=0;q!==this.vertices.length;++q)if((q+1)%this.vertices.length!==h&&q!==h&&c.leftOn(this.at(h),this.at(m),this.at(q+1))&&c.rightOn(this.at(h),this.at(m),this.at(q))&&(f[0]=this.at(h),f[1]=this.at(m),g[0]=this.at(q),g[1]=this.at(q+1),n=b.lineInt(f,g),c.sqdist(this.at(h),n)<p))return!1;return!0};k.prototype.copy=function(h,m,n){n=n||
new k;if(n.clear(),h<m)for(var p=h;p<=m;p++)n.vertices.push(this.vertices[p]);else{for(p=0;p<=m;p++)n.vertices.push(this.vertices[p]);for(p=h;p<this.vertices.length;p++)n.vertices.push(this.vertices[p])}return n};k.prototype.getCutEdges=function(){for(var h=[],m,n,p=new k,q=Number.MAX_VALUE,r=0;r<this.vertices.length;++r)if(this.isReflex(r))for(var u=0;u<this.vertices.length;++u)if(this.canSee(r,u)){m=this.copy(r,u,p).getCutEdges();n=this.copy(u,r,p).getCutEdges();for(var x=0;x<n.length;x++)m.push(n[x]);
m.length<q&&(q=(h=m).length,h.push([this.at(r),this.at(u)]))}return h};k.prototype.decomp=function(){var h=this.getCutEdges();return 0<h.length?this.slice(h):[this]};k.prototype.slice=function(h){if(0==h.length)return[this];if(h instanceof Array&&h.length&&h[0]instanceof Array&&2==h[0].length&&h[0][0]instanceof Array){for(var m=[this],n=0;n<h.length;n++)for(var p=h[n],q=0;q<m.length;q++){var r=m[q].slice(p);if(r){m.splice(q,1);m.push(r[0],r[1]);break}}return m}p=h;n=this.vertices.indexOf(p[0]);q=
this.vertices.indexOf(p[1]);return-1!=n&&-1!=q&&[this.copy(n,q),this.copy(q,n)]};k.prototype.isSimple=function(){for(var h=this.vertices,m=0;m<h.length-1;m++)for(var n=0;n<m-1;n++)if(b.segmentsIntersect(h[m],h[m+1],h[n],h[n+1]))return!1;for(m=1;m<h.length-2;m++)if(b.segmentsIntersect(h[0],h[h.length-1],h[m],h[m+1]))return!1;return!0};k.prototype.quickDecomp=function(h,m,n,p,q,r){q=q||100;r=r||0;p=p||25;h=void 0!==h?h:[];m=m||[];n=n||[];var u=[0,0],x=[0,0],w=[0,0],A,C=0,L=0,M=0,P=0,V=new k,aa=new k,
ja=this.vertices;if(3>ja.length)return h;if(q<++r)return console.warn("quickDecomp: max level ("+q+") reached."),h;for(var W=0;W<this.vertices.length;++W)if(this.isReflex(W)){m.push(this.vertices[W]);var E=A=Number.MAX_VALUE;for(var F=0;F<this.vertices.length;++F)c.left(this.at(W-1),this.at(W),this.at(F))&&c.rightOn(this.at(W-1),this.at(W),this.at(F-1))&&(w=a(this.at(W-1),this.at(W),this.at(F),this.at(F-1)),c.right(this.at(W+1),this.at(W),w)&&(C=c.sqdist(this.vertices[W],w))<A&&(A=C,x=w,M=F)),c.left(this.at(W+
1),this.at(W),this.at(F+1))&&c.rightOn(this.at(W+1),this.at(W),this.at(F))&&(w=a(this.at(W+1),this.at(W),this.at(F),this.at(F+1)),c.left(this.at(W-1),this.at(W),w)&&(C=c.sqdist(this.vertices[W],w))<E&&(E=C,u=w,L=F));if(M==(L+1)%this.vertices.length)w[0]=(x[0]+u[0])/2,w[1]=(x[1]+u[1])/2,n.push(w),W<L?(V.append(this,W,L+1),V.vertices.push(w),aa.vertices.push(w),0!=M&&aa.append(this,M,this.vertices.length),aa.append(this,0,W+1)):(0!=W&&V.append(this,W,this.vertices.length),V.append(this,0,L+1),V.vertices.push(w),
aa.vertices.push(w),aa.append(this,M,W+1));else{if(L<M&&(L+=this.vertices.length),u=Number.MAX_VALUE,L<M)return h;for(F=M;F<=L;++F)c.leftOn(this.at(W-1),this.at(W),this.at(F))&&c.rightOn(this.at(W+1),this.at(W),this.at(F))&&(C=c.sqdist(this.at(W),this.at(F)))<u&&(u=C,P=F%this.vertices.length);W<P?(V.append(this,W,P+1),0!=P&&aa.append(this,P,ja.length),aa.append(this,0,W+1)):(0!=W&&V.append(this,W,ja.length),V.append(this,0,P+1),aa.append(this,P,W+1))}return V.vertices.length<aa.vertices.length?(V.quickDecomp(h,
m,n,p,q,r),aa.quickDecomp(h,m,n,p,q,r)):(aa.quickDecomp(h,m,n,p,q,r),V.quickDecomp(h,m,n,p,q,r)),h}return h.push(this),h};k.prototype.removeCollinearPoints=function(h){for(var m=0,n=this.vertices.length-1;3<this.vertices.length&&0<=n;--n)c.collinear(this.at(n-1),this.at(n),this.at(n+1),h)&&(this.vertices.splice(n%this.vertices.length,1),n--,m++);return m}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(e,v,l){(v.exports=function(){}).eq=function(k,a,b){return b=b||0,Math.abs(k-a)<b}},{}],5:[function(e,
v,l){v.exports={Polygon:e("./Polygon"),Point:e("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(e,v,l){v.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5",
"grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(e,v,l){function k(c){this.lowerBound=a.create();c&&c.lowerBound&&a.copy(this.lowerBound,c.lowerBound);this.upperBound=a.create();c&&c.upperBound&&a.copy(this.upperBound,c.upperBound)}var a=e("../math/vec2");e("../utils/Utils");v.exports=k;var b=a.create();
k.prototype.setFromPoints=function(c,d,f,g){var h=this.lowerBound,m=this.upperBound;"number"!=typeof f&&(f=0);0!==f?a.rotate(h,c[0],f):a.copy(h,c[0]);a.copy(m,h);for(var n=Math.cos(f),p=Math.sin(f),q=1;q<c.length;q++){var r=c[q];if(0!==f){var u=r[0];r=r[1];b[0]=n*u-p*r;b[1]=p*u+n*r;r=b}for(u=0;2>u;u++)r[u]>m[u]&&(m[u]=r[u]),r[u]<h[u]&&(h[u]=r[u])}d&&(a.add(this.lowerBound,this.lowerBound,d),a.add(this.upperBound,this.upperBound,d));g&&(this.lowerBound[0]-=g,this.lowerBound[1]-=g,this.upperBound[0]+=
g,this.upperBound[1]+=g)};k.prototype.copy=function(c){a.copy(this.lowerBound,c.lowerBound);a.copy(this.upperBound,c.upperBound)};k.prototype.extend=function(c){for(var d=2;d--;){var f=c.lowerBound[d];this.lowerBound[d]>f&&(this.lowerBound[d]=f);f=c.upperBound[d];this.upperBound[d]<f&&(this.upperBound[d]=f)}};k.prototype.overlaps=function(c){var d=this.lowerBound,f=this.upperBound,g=c.lowerBound;c=c.upperBound;return(g[0]<=f[0]&&f[0]<=c[0]||d[0]<=c[0]&&c[0]<=f[0])&&(g[1]<=f[1]&&f[1]<=c[1]||d[1]<=
c[1]&&c[1]<=f[1])};k.prototype.containsPoint=function(c){var d=this.lowerBound,f=this.upperBound;return d[0]<=c[0]&&c[0]<=f[0]&&d[1]<=c[1]&&c[1]<=f[1]};k.prototype.overlapsRay=function(c){var d=1/c.direction[0],f=1/c.direction[1],g=(this.lowerBound[0]-c.from[0])*d;d*=this.upperBound[0]-c.from[0];var h=(this.lowerBound[1]-c.from[1])*f;f*=this.upperBound[1]-c.from[1];c=Math.max(Math.max(Math.min(g,d),Math.min(h,f)));g=Math.min(Math.min(Math.max(g,d),Math.max(h,f)));return 0>g?-1:g<c?-1:c}},{"../math/vec2":30,
"../utils/Utils":57}],8:[function(e,v,l){function k(d){this.type=d;this.result=[];this.world=null;this.boundingVolumeType=k.AABB}var a=e("../math/vec2"),b=e("../objects/Body");(v.exports=k).AABB=1;k.BOUNDING_CIRCLE=2;k.prototype.setWorld=function(d){this.world=d};k.prototype.getCollisionPairs=function(d){};var c=a.create();k.boundingRadiusCheck=function(d,f){a.sub(c,d.position,f.position);var g=a.squaredLength(c);d=d.boundingRadius+f.boundingRadius;return g<=d*d};k.aabbCheck=function(d,f){return d.getAABB().overlaps(f.getAABB())};
k.prototype.boundingVolumeCheck=function(d,f){switch(this.boundingVolumeType){case k.BOUNDING_CIRCLE:d=k.boundingRadiusCheck(d,f);break;case k.AABB:d=k.aabbCheck(d,f);break;default:throw Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return d};k.canCollide=function(d,f){var g=b.KINEMATIC,h=b.STATIC;return(d.type!==h||f.type!==h)&&!(d.type===g&&f.type===h||d.type===h&&f.type===g)&&(d.type!==g||f.type!==g)&&(d.sleepState!==b.SLEEPING||f.sleepState!==b.SLEEPING)&&!(d.sleepState===
b.SLEEPING&&f.type===h||f.sleepState===b.SLEEPING&&d.type===h)};k.NAIVE=1;k.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(e,v,l){function k(){a.call(this,a.NAIVE)}e("../shapes/Circle");e("../shapes/Plane");e("../shapes/Shape");e("../shapes/Particle");var a=e("../collision/Broadphase");e("../math/vec2");(((v.exports=k).prototype=new a).constructor=k).prototype.getCollisionPairs=function(b){b=b.bodies;for(var c=this.result,d=c.length=0,f=b.length;d!==f;d++)for(var g=b[d],h=0;h<d;h++){var m=
b[h];a.canCollide(g,m)&&this.boundingVolumeCheck(g,m)&&c.push(g,m)}return c};k.prototype.aabbQuery=function(b,c,d){d=d||[];b=b.bodies;for(var f=0;f<b.length;f++){var g=b[f];g.aabbNeedsUpdate&&g.updateAABB();g.aabb.overlaps(c)&&d.push(g)}return d}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(e,v,l){function k(){this.contactEquations=[];this.frictionEquations=[];this.enabledEquations=this.enableFriction=
!0;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.contactEquationPool=new h({size:32});this.frictionEquationPool=new m({size:64});this.restitution=0;this.stiffness=p.DEFAULT_STIFFNESS;this.relaxation=p.DEFAULT_RELAXATION;this.frictionStiffness=p.DEFAULT_STIFFNESS;this.frictionRelaxation=p.DEFAULT_RELAXATION;this.enableFrictionReduction=!0;this.collidingBodiesLastStep=new n;this.contactSkinSize=.01}function a(H,z){c.set(H.vertices[0],.5*-z.length,-z.radius);c.set(H.vertices[1],
.5*z.length,-z.radius);c.set(H.vertices[2],.5*z.length,z.radius);c.set(H.vertices[3],.5*-z.length,z.radius)}function b(H,z,G,J){var N=Ta,K=Ua,Q=Va,T=Ea;z=z.vertices;for(var ba=null,Z=0;Z!==z.length+1;Z++){var ca=z[(Z+1)%z.length];c.rotate(N,z[Z%z.length],J);c.rotate(K,ca,J);f(N,N,G);f(K,K,G);d(Q,N,H);d(T,K,H);ca=c.crossLength(Q,T);if(null===ba&&(ba=ca),0>=ca*ba)return!1;ba=ca}return!0}var c=e("../math/vec2"),d=c.sub,f=c.add,g=c.dot,h=(e("../utils/Utils"),e("../utils/ContactEquationPool")),m=e("../utils/FrictionEquationPool"),
n=e("../utils/TupleDictionary"),p=e("../equations/Equation");l=(e("../equations/ContactEquation"),e("../equations/FrictionEquation"),e("../shapes/Circle"));var q=e("../shapes/Convex"),r=e("../shapes/Shape"),u=(e("../objects/Body"),e("../shapes/Box"));v.exports=k;var x=c.fromValues(0,1),w=c.fromValues(0,0),A=c.fromValues(0,0),C=c.fromValues(0,0),L=c.fromValues(0,0),M=c.fromValues(0,0),P=c.fromValues(0,0),V=c.fromValues(0,0),aa=c.fromValues(0,0),ja=c.fromValues(0,0),W=c.fromValues(0,0),E=c.fromValues(0,
0),F=c.fromValues(0,0),B=c.fromValues(0,0),I=c.fromValues(0,0),X=c.fromValues(0,0),U=c.fromValues(0,0),ia=c.fromValues(0,0),la=c.fromValues(0,0),ma=[],ka=c.create(),pa=c.create();k.prototype.bodiesOverlap=function(H,z){for(var G=0,J=H.shapes.length;G!==J;G++){var N=H.shapes[G];H.toWorldFrame(ka,N.position);for(var K=0,Q=z.shapes.length;K!==Q;K++){var T=z.shapes[K];if(z.toWorldFrame(pa,T.position),this[N.type|T.type](H,N,ka,N.angle+H.angle,z,T,pa,T.angle+z.angle,!0))return!0}}return!1};k.prototype.collidedLastStep=
function(H,z){return!!this.collidingBodiesLastStep.get(0|H.id,0|z.id)};k.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var H=this.contactEquations,z=H.length;z--;){var G=H[z];this.collidingBodiesLastStep.set(G.bodyA.id,G.bodyB.id,!0)}H=this.contactEquations;z=this.frictionEquations;for(G=0;G<H.length;G++)this.contactEquationPool.release(H[G]);for(G=0;G<z.length;G++)this.frictionEquationPool.release(z[G]);this.contactEquations.length=this.frictionEquations.length=0};k.prototype.createContactEquation=
function(H,z,G,J){var N=this.contactEquationPool.get();return N.bodyA=H,N.bodyB=z,N.shapeA=G,N.shapeB=J,N.restitution=this.restitution,N.firstImpact=!this.collidedLastStep(H,z),N.stiffness=this.stiffness,N.relaxation=this.relaxation,N.needsUpdate=!0,N.enabled=this.enabledEquations,N.offset=this.contactSkinSize,N};k.prototype.createFrictionEquation=function(H,z,G,J){var N=this.frictionEquationPool.get();return N.bodyA=H,N.bodyB=z,N.shapeA=G,N.shapeB=J,N.setSlipForce(this.slipForce),N.frictionCoefficient=
this.frictionCoefficient,N.relativeVelocity=this.surfaceVelocity,N.enabled=this.enabledEquations,N.needsUpdate=!0,N.stiffness=this.frictionStiffness,N.relaxation=this.frictionRelaxation,N.contactEquations.length=0,N};k.prototype.createFrictionFromContact=function(H){var z=this.createFrictionEquation(H.bodyA,H.bodyB,H.shapeA,H.shapeB);return c.copy(z.contactPointA,H.contactPointA),c.copy(z.contactPointB,H.contactPointB),c.rotate90cw(z.t,H.normalA),z.contactEquations.push(H),z};k.prototype.createFrictionFromAverage=
function(H){var z=this.contactEquations[this.contactEquations.length-1],G=this.createFrictionEquation(z.bodyA,z.bodyB,z.shapeA,z.shapeB),J=z.bodyA;z.bodyB;c.set(G.contactPointA,0,0);c.set(G.contactPointB,0,0);c.set(G.t,0,0);for(var N=0;N!==H;N++)(z=this.contactEquations[this.contactEquations.length-1-N]).bodyA===J?(c.add(G.t,G.t,z.normalA),c.add(G.contactPointA,G.contactPointA,z.contactPointA),c.add(G.contactPointB,G.contactPointB,z.contactPointB)):(c.sub(G.t,G.t,z.normalA),c.add(G.contactPointA,
G.contactPointA,z.contactPointB),c.add(G.contactPointB,G.contactPointB,z.contactPointA)),G.contactEquations.push(z);H=1/H;return c.scale(G.contactPointA,G.contactPointA,H),c.scale(G.contactPointB,G.contactPointB,H),c.normalize(G.t,G.t),c.rotate90cw(G.t,G.t),G};k.prototype[r.LINE|r.CONVEX]=k.prototype.convexLine=function(H,z,G,J,N,K,Q,T,ba){return!ba&&0};k.prototype[r.LINE|r.BOX]=k.prototype.lineBox=function(H,z,G,J,N,K,Q,T,ba){return!ba&&0};var ta=new u({width:1,height:1}),O=c.create();k.prototype[r.CAPSULE|
r.CONVEX]=k.prototype[r.CAPSULE|r.BOX]=k.prototype.convexCapsule=function(H,z,G,J,N,K,Q,T,ba){c.set(O,K.length/2,0);c.rotate(O,O,T);c.add(O,O,Q);var Z=this.circleConvex(N,K,O,T,H,z,G,J,ba,K.radius);c.set(O,-K.length/2,0);c.rotate(O,O,T);c.add(O,O,Q);var ca=this.circleConvex(N,K,O,T,H,z,G,J,ba,K.radius);return ba&&(Z||ca)?!0:(a(ta,K),this.convexConvex(H,z,G,J,N,ta,Q,T,ba)+Z+ca)};k.prototype[r.CAPSULE|r.LINE]=k.prototype.lineCapsule=function(H,z,G,J,N,K,Q,T,ba){return!ba&&0};var ua=c.create(),ra=c.create(),
xa=new u({width:1,height:1});k.prototype[r.CAPSULE|r.CAPSULE]=k.prototype.capsuleCapsule=function(H,z,G,J,N,K,Q,T,ba){for(var Z=0,ca=0;2>ca;ca++){c.set(ua,(0===ca?-1:1)*z.length/2,0);c.rotate(ua,ua,J);c.add(ua,ua,G);for(var ea=0;2>ea;ea++){c.set(ra,(0===ea?-1:1)*K.length/2,0);c.rotate(ra,ra,T);c.add(ra,ra,Q);this.enableFrictionReduction&&(da=this.enableFriction,this.enableFriction=!1);var na=this.circleCircle(H,z,ua,J,N,K,ra,T,ba,z.radius,K.radius);if(this.enableFrictionReduction&&(this.enableFriction=
da),ba&&na)return!0;Z+=na}}this.enableFrictionReduction&&(da=this.enableFriction,this.enableFriction=!1);a(xa,z);ca=this.convexCapsule(H,xa,G,J,N,K,Q,T,ba);if(this.enableFrictionReduction&&(this.enableFriction=da),ba&&ca)return!0;if(Z+=ca,this.enableFrictionReduction){var da=this.enableFriction;this.enableFriction=!1}a(xa,K);H=this.convexCapsule(N,xa,Q,T,H,z,G,J,ba);return this.enableFrictionReduction&&(this.enableFriction=da),!(!ba||!H)||(Z+=H,this.enableFrictionReduction&&Z&&this.enableFriction&&
this.frictionEquations.push(this.createFrictionFromAverage(Z)),Z)};k.prototype[r.LINE|r.LINE]=k.prototype.lineLine=function(H,z,G,J,N,K,Q,T,ba){return!ba&&0};k.prototype[r.PLANE|r.LINE]=k.prototype.planeLine=function(H,z,G,J,N,K,Q,T,ba){var Z=0;c.set(w,-K.length/2,0);c.set(A,K.length/2,0);c.rotate(C,w,T);c.rotate(L,A,T);f(C,C,Q);f(L,L,Q);c.copy(w,C);c.copy(A,L);d(M,A,w);c.normalize(P,M);c.rotate90cw(ja,P);c.rotate(aa,x,J);ma[0]=w;ma[1]=A;for(J=0;J<ma.length;J++){T=ma[J];d(V,T,G);var ca=g(V,aa);if(0>
ca){if(ba)return!0;var ea=this.createContactEquation(H,N,z,K);Z++;c.copy(ea.normalA,aa);c.normalize(ea.normalA,ea.normalA);c.scale(V,aa,ca);d(ea.contactPointA,T,V);d(ea.contactPointA,ea.contactPointA,H.position);d(ea.contactPointB,T,Q);f(ea.contactPointB,ea.contactPointB,Q);d(ea.contactPointB,ea.contactPointB,N.position);this.contactEquations.push(ea);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ea))}}return!ba&&(this.enableFrictionReduction||
Z&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(Z)),Z)};k.prototype[r.PARTICLE|r.CAPSULE]=k.prototype.particleCapsule=function(H,z,G,J,N,K,Q,T,ba){return this.circleLine(H,z,G,J,N,K,Q,T,ba,K.radius,0)};k.prototype[r.CIRCLE|r.LINE]=k.prototype.circleLine=function(H,z,G,J,N,K,Q,T,ba,Z,ca){Z=Z||0;ca=void 0!==ca?ca:z.radius;c.set(aa,-K.length/2,0);c.set(ja,K.length/2,0);c.rotate(W,aa,T);c.rotate(E,ja,T);f(W,W,Q);f(E,E,Q);c.copy(aa,W);c.copy(ja,E);d(P,ja,aa);c.normalize(V,
P);c.rotate90cw(M,V);d(F,G,aa);T=g(F,M);d(L,aa,Q);d(B,G,Q);J=ca+Z;if(Math.abs(T)<J){c.scale(w,M,T);d(C,G,w);c.scale(A,M,g(M,B));c.normalize(A,A);c.scale(A,A,Z);f(C,C,A);T=g(V,C);var ea=g(V,aa),na=g(V,ja);if(ea<T&&T<na){if(ba)return!0;z=this.createContactEquation(H,N,z,K);return c.scale(z.normalA,w,-1),c.normalize(z.normalA,z.normalA),c.scale(z.contactPointA,z.normalA,ca),f(z.contactPointA,z.contactPointA,G),d(z.contactPointA,z.contactPointA,H.position),d(z.contactPointB,C,Q),f(z.contactPointB,z.contactPointB,
Q),d(z.contactPointB,z.contactPointB,N.position),this.contactEquations.push(z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(z)),1}}ma[0]=aa;ma[1]=ja;for(ea=0;ea<ma.length;ea++)if(T=ma[ea],d(F,T,G),c.squaredLength(F)<Math.pow(J,2)){if(ba)return!0;z=this.createContactEquation(H,N,z,K);return c.copy(z.normalA,F),c.normalize(z.normalA,z.normalA),c.scale(z.contactPointA,z.normalA,ca),f(z.contactPointA,z.contactPointA,G),d(z.contactPointA,z.contactPointA,H.position),d(z.contactPointB,
T,Q),c.scale(I,z.normalA,-Z),f(z.contactPointB,z.contactPointB,I),f(z.contactPointB,z.contactPointB,Q),d(z.contactPointB,z.contactPointB,N.position),this.contactEquations.push(z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(z)),1}return 0};k.prototype[r.CIRCLE|r.CAPSULE]=k.prototype.circleCapsule=function(H,z,G,J,N,K,Q,T,ba){return this.circleLine(H,z,G,J,N,K,Q,T,ba,K.radius)};k.prototype[r.CIRCLE|r.CONVEX]=k.prototype[r.CIRCLE|r.BOX]=k.prototype.circleConvex=function(H,
z,G,J,N,K,Q,T,ba,Z){Z="number"==typeof Z?Z:z.radius;J=!1;for(var ca=Number.MAX_VALUE,ea=K.vertices,na=0;na!==ea.length+1;na++){var da=ea[(na+1)%ea.length];if(c.rotate(w,ea[na%ea.length],T),c.rotate(A,da,T),f(w,w,Q),f(A,A,Q),d(C,A,w),c.normalize(L,C),c.rotate90cw(M,L),c.scale(I,M,-z.radius),f(I,I,G),b(I,K,Q,T))c.sub(X,w,I),da=Math.abs(c.dot(X,M)),da<ca&&(c.copy(U,I),ca=da,c.scale(B,M,da),c.add(B,B,I),J=!0)}if(J){if(ba)return!0;z=this.createContactEquation(H,N,z,K);return c.sub(z.normalA,U,G),c.normalize(z.normalA,
z.normalA),c.scale(z.contactPointA,z.normalA,Z),f(z.contactPointA,z.contactPointA,G),d(z.contactPointA,z.contactPointA,H.position),d(z.contactPointB,B,Q),f(z.contactPointB,z.contactPointB,Q),d(z.contactPointB,z.contactPointB,N.position),this.contactEquations.push(z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(z)),1}if(0<Z)for(na=0;na<ea.length;na++)if(c.rotate(E,ea[na],T),f(E,E,Q),d(W,E,G),c.squaredLength(W)<Math.pow(Z,2)){if(ba)return!0;z=this.createContactEquation(H,
N,z,K);return c.copy(z.normalA,W),c.normalize(z.normalA,z.normalA),c.scale(z.contactPointA,z.normalA,Z),f(z.contactPointA,z.contactPointA,G),d(z.contactPointA,z.contactPointA,H.position),d(z.contactPointB,E,Q),f(z.contactPointB,z.contactPointB,Q),d(z.contactPointB,z.contactPointB,N.position),this.contactEquations.push(z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(z)),1}return 0};var Ta=c.create(),Ua=c.create(),Va=c.create(),Ea=c.create();k.prototype[r.PARTICLE|
r.CONVEX]=k.prototype[r.PARTICLE|r.BOX]=k.prototype.particleConvex=function(H,z,G,J,N,K,Q,T,ba){J=Number.MAX_VALUE;var Z=!1,ca=K.vertices;if(!b(G,K,Q,T))return 0;if(ba)return!0;for(ba=0;ba!==ca.length+1;ba++){var ea=ca[(ba+1)%ca.length];c.rotate(w,ca[ba%ca.length],T);c.rotate(A,ea,T);f(w,w,Q);f(A,A,Q);d(C,A,w);c.normalize(L,C);c.rotate90cw(M,L);d(W,G,w);g(W,M);d(P,w,Q);d(V,G,Q);c.sub(ia,w,G);ea=Math.abs(c.dot(ia,M));ea<J&&(J=ea,c.scale(B,M,ea),c.add(B,B,G),c.copy(la,M),Z=!0)}return Z?(z=this.createContactEquation(H,
N,z,K),c.scale(z.normalA,la,-1),c.normalize(z.normalA,z.normalA),c.set(z.contactPointA,0,0),f(z.contactPointA,z.contactPointA,G),d(z.contactPointA,z.contactPointA,H.position),d(z.contactPointB,B,Q),f(z.contactPointB,z.contactPointB,Q),d(z.contactPointB,z.contactPointB,N.position),this.contactEquations.push(z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(z)),1):0};k.prototype[r.CIRCLE]=k.prototype.circleCircle=function(H,z,G,J,N,K,Q,T,ba,Z,ca){Z=Z||z.radius;ca=ca||
K.radius;d(w,G,Q);J=Z+ca;if(c.squaredLength(w)>Math.pow(J,2))return 0;if(ba)return!0;z=this.createContactEquation(H,N,z,K);return d(z.normalA,Q,G),c.normalize(z.normalA,z.normalA),c.scale(z.contactPointA,z.normalA,Z),c.scale(z.contactPointB,z.normalA,-ca),f(z.contactPointA,z.contactPointA,G),d(z.contactPointA,z.contactPointA,H.position),f(z.contactPointB,z.contactPointB,Q),d(z.contactPointB,z.contactPointB,N.position),this.contactEquations.push(z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(z)),
1};k.prototype[r.PLANE|r.CONVEX]=k.prototype[r.PLANE|r.BOX]=k.prototype.planeConvex=function(H,z,G,J,N,K,Q,T,ba){var Z=0;c.rotate(A,x,J);for(J=0;J!==K.vertices.length;J++)if(c.rotate(w,K.vertices[J],T),f(w,w,Q),d(C,w,G),0>=g(C,A)){if(ba)return!0;Z++;var ca=this.createContactEquation(H,N,z,K);d(C,w,G);c.copy(ca.normalA,A);var ea=g(C,ca.normalA);c.scale(C,ca.normalA,ea);d(ca.contactPointB,w,N.position);d(ca.contactPointA,w,C);d(ca.contactPointA,ca.contactPointA,H.position);this.contactEquations.push(ca);
this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ca))}return this.enableFrictionReduction&&this.enableFriction&&Z&&this.frictionEquations.push(this.createFrictionFromAverage(Z)),Z};k.prototype[r.PARTICLE|r.PLANE]=k.prototype.particlePlane=function(H,z,G,J,N,K,Q,T,ba){T=T||0;d(w,G,Q);c.rotate(A,x,T);J=g(w,A);if(0<J)return 0;if(ba)return!0;z=this.createContactEquation(N,H,K,z);return c.copy(z.normalA,A),c.scale(w,z.normalA,J),d(z.contactPointA,
G,w),d(z.contactPointA,z.contactPointA,N.position),d(z.contactPointB,G,H.position),this.contactEquations.push(z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(z)),1};k.prototype[r.CIRCLE|r.PARTICLE]=k.prototype.circleParticle=function(H,z,G,J,N,K,Q,T,ba){if(d(w,Q,G),c.squaredLength(w)>Math.pow(z.radius,2))return 0;if(ba)return!0;J=this.createContactEquation(H,N,z,K);return c.copy(J.normalA,w),c.normalize(J.normalA,J.normalA),c.scale(J.contactPointA,J.normalA,z.radius),
f(J.contactPointA,J.contactPointA,G),d(J.contactPointA,J.contactPointA,H.position),d(J.contactPointB,Q,N.position),this.contactEquations.push(J),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(J)),1};var Ma=new l({radius:1}),Ca=c.create(),Ba=c.create();c.create();k.prototype[r.PLANE|r.CAPSULE]=k.prototype.planeCapsule=function(H,z,G,J,N,K,Q,T,ba){var Z;c.set(Ca,-K.length/2,0);c.rotate(Ca,Ca,T);f(Ca,Ca,Q);c.set(Ba,K.length/2,0);c.rotate(Ba,Ba,T);f(Ba,Ba,Q);Ma.radius=
K.radius;this.enableFrictionReduction&&(Z=this.enableFriction,this.enableFriction=!1);K=this.circlePlane(N,Ma,Ca,0,H,z,G,J,ba);H=this.circlePlane(N,Ma,Ba,0,H,z,G,J,ba);if(this.enableFrictionReduction&&(this.enableFriction=Z),ba)return K||H;ba=K+H;return this.enableFrictionReduction&&ba&&this.frictionEquations.push(this.createFrictionFromAverage(ba)),ba};k.prototype[r.CIRCLE|r.PLANE]=k.prototype.circlePlane=function(H,z,G,J,N,K,Q,T,ba){J=T||0;d(w,G,Q);c.rotate(A,x,J);J=g(A,w);if(J>z.radius)return 0;
if(ba)return!0;K=this.createContactEquation(N,H,K,z);return c.copy(K.normalA,A),c.scale(K.contactPointB,K.normalA,-z.radius),f(K.contactPointB,K.contactPointB,G),d(K.contactPointB,K.contactPointB,H.position),c.scale(C,K.normalA,J),d(K.contactPointA,w,C),f(K.contactPointA,K.contactPointA,Q),d(K.contactPointA,K.contactPointA,N.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K)),1};k.prototype[r.CONVEX]=k.prototype[r.CONVEX|r.BOX]=
k.prototype[r.BOX]=k.prototype.convexConvex=function(H,z,G,J,N,K,Q,T,ba,Z){var ca=0;Z="number"==typeof Z?Z:0;if(!k.findSeparatingAxis(z,G,J,K,Q,T,w))return 0;d(aa,Q,G);0<g(w,aa)&&c.scale(w,w,-1);var ea=k.getClosestEdge(z,J,w,!0),na=k.getClosestEdge(K,T,w);if(-1===ea||-1===na)return 0;for(var da=0;2>da;da++){var oa=ea,Xa=na,ya=z,Pa=K,Ja=G,Wa=Q,Qa=J,ab=T,Ya=H,Za=N;if(0===da){var za=oa;oa=Xa;Xa=za;za=ya;ya=Pa;Pa=za;za=Ja;Ja=Wa;Wa=za;za=Qa;Qa=ab;ab=za;za=Ya;Ya=Za;Za=za}for(za=Xa;za<Xa+2;za++){c.rotate(A,
Pa.vertices[(za+Pa.vertices.length)%Pa.vertices.length],ab);f(A,A,Wa);for(var qa=0,Ra=oa-1;Ra<oa+2;Ra++){var Ka=ya.vertices[(Ra+ya.vertices.length)%ya.vertices.length],bb=ya.vertices[(Ra+1+ya.vertices.length)%ya.vertices.length];c.rotate(C,Ka,Qa);c.rotate(L,bb,Qa);f(C,C,Ja);f(L,L,Ja);d(M,L,C);c.rotate90cw(ja,M);c.normalize(ja,ja);d(aa,A,C);Ka=g(ja,aa);(Ra===oa&&Ka<=Z||Ra!==oa&&0>=Ka)&&qa++}if(3<=qa){if(ba)return!0;qa=this.createContactEquation(Ya,Za,ya,Pa);ca++;Ka=ya.vertices[oa%ya.vertices.length];
bb=ya.vertices[(oa+1)%ya.vertices.length];c.rotate(C,Ka,Qa);c.rotate(L,bb,Qa);f(C,C,Ja);f(L,L,Ja);d(M,L,C);c.rotate90cw(qa.normalA,M);c.normalize(qa.normalA,qa.normalA);d(aa,A,C);Ka=g(qa.normalA,aa);c.scale(V,qa.normalA,Ka);d(qa.contactPointA,A,Ja);d(qa.contactPointA,qa.contactPointA,V);f(qa.contactPointA,qa.contactPointA,Ja);d(qa.contactPointA,qa.contactPointA,Ya.position);d(qa.contactPointB,A,Wa);f(qa.contactPointB,qa.contactPointB,Wa);d(qa.contactPointB,qa.contactPointB,Za.position);this.contactEquations.push(qa);
this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(qa))}}}return this.enableFrictionReduction&&this.enableFriction&&ca&&this.frictionEquations.push(this.createFrictionFromAverage(ca)),ca};var La=c.fromValues(0,0);k.projectConvexOntoAxis=function(H,z,G,J,N){var K=null,Q=null;c.rotate(La,J,-G);for(G=0;G<H.vertices.length;G++){var T=H.vertices[G];T=g(T,La);(null===K||K<T)&&(K=T);(null===Q||T<Q)&&(Q=T)}K<Q&&(H=Q,Q=K,K=H);z=g(z,J);c.set(N,Q+z,
K+z)};var wa=c.fromValues(0,0),Fa=c.fromValues(0,0),Na=c.fromValues(0,0),va=c.fromValues(0,0),Aa=c.fromValues(0,0),Da=c.fromValues(0,0);k.findSeparatingAxis=function(H,z,G,J,N,K,Q){var T=null,ba=!1;if(H instanceof u&&J instanceof u)for(var Z=0;2!==Z;Z++){var ca=G;1===Z&&(ca=K);for(var ea=0;2!==ea;ea++){0===ea?c.set(va,0,1):1===ea&&c.set(va,1,0);0!==ca&&c.rotate(va,va,ca);k.projectConvexOntoAxis(H,z,G,va,Aa);k.projectConvexOntoAxis(J,N,K,va,Da);var na=Aa;var da=Da;Aa[0]>Da[0]&&(da=Aa,na=Da,!0);na=
0>=(da=da[0]-na[1]);(null===T||T<da)&&(c.copy(Q,va),T=da,ba=na)}}else for(Z=0;2!==Z;Z++){var oa=H;ca=G;1===Z&&(oa=J,ca=K);for(ea=0;ea!==oa.vertices.length;ea++)c.rotate(Fa,oa.vertices[ea],ca),c.rotate(Na,oa.vertices[(ea+1)%oa.vertices.length],ca),d(wa,Na,Fa),c.rotate90cw(va,wa),c.normalize(va,va),k.projectConvexOntoAxis(H,z,G,va,Aa),k.projectConvexOntoAxis(J,N,K,va,Da),na=Aa,da=Da,Aa[0]>Da[0]&&(da=Aa,na=Da,!0),na=0>=(da=da[0]-na[1]),(null===T||T<da)&&(c.copy(Q,va),T=da,ba=na)}return ba};var Oa=c.fromValues(0,
0),$a=c.fromValues(0,0),Sa=c.fromValues(0,0);k.getClosestEdge=function(H,z,G,J){c.rotate(Oa,G,-z);J&&c.scale(Oa,Oa,-1);z=-1;G=H.vertices.length;J=-1;for(var N=0;N!==G;N++){d($a,H.vertices[(N+1)%G],H.vertices[N%G]);c.rotate90cw(Sa,$a);c.normalize(Sa,Sa);var K=g(Sa,Oa);(-1===z||J<K)&&(z=N%G,J=K)}return z};var Ga=c.create(),Ha=c.create(),sa=c.create(),Ia=c.create(),y=c.create(),D=c.create(),S=c.create();k.prototype[r.CIRCLE|r.HEIGHTFIELD]=k.prototype.circleHeightfield=function(H,z,G,J,N,K,Q,T,ba,Z){J=
K.heights;T=(Z=Z||z.radius,K.elementWidth);var ca=Math.floor((G[0]-Z-Q[0])/T),ea=Math.ceil((G[0]+Z-Q[0])/T);0>ca&&(ca=0);ea>=J.length&&(ea=J.length-1);for(var na=J[ca],da=J[ea],oa=ca;oa<ea;oa++)J[oa]<da&&(da=J[oa]),J[oa]>na&&(na=J[oa]);if(G[1]-Z>na)return!ba&&0;for(oa=ca;oa<ea;oa++)if(c.set(sa,oa*T,J[oa]),c.set(Ia,(oa+1)*T,J[oa+1]),c.add(sa,sa,Q),c.add(Ia,Ia,Q),c.sub(D,Ia,sa),c.rotate(D,D,Math.PI/2),c.normalize(D,D),c.scale(Ga,D,-Z),c.add(Ga,Ga,G),c.sub(Ha,Ga,sa),na=c.dot(Ha,D),Ga[0]>=sa[0]&&Ga[0]<
Ia[0]&&0>=na){if(ba)return!0;c.scale(Ha,D,-na);c.add(y,Ga,Ha);c.copy(S,D);da=this.createContactEquation(N,H,K,z);c.copy(da.normalA,S);c.scale(da.contactPointB,da.normalA,-Z);f(da.contactPointB,da.contactPointB,G);d(da.contactPointB,da.contactPointB,H.position);c.copy(da.contactPointA,y);c.sub(da.contactPointA,da.contactPointA,N.position);this.contactEquations.push(da);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(da))}if(na=!1,0<Z)for(oa=ca;oa<=ea;oa++)if(c.set(sa,
oa*T,J[oa]),c.add(sa,sa,Q),c.sub(Ha,G,sa),c.squaredLength(Ha)<Math.pow(Z,2)){if(ba)return!0;na=!0;da=this.createContactEquation(N,H,K,z);c.copy(da.normalA,Ha);c.normalize(da.normalA,da.normalA);c.scale(da.contactPointB,da.normalA,-Z);f(da.contactPointB,da.contactPointB,G);d(da.contactPointB,da.contactPointB,H.position);d(da.contactPointA,sa,Q);f(da.contactPointA,da.contactPointA,Q);d(da.contactPointA,da.contactPointA,N.position);this.contactEquations.push(da);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(da))}return na?
1:0};var R=c.create(),Y=c.create(),ha=c.create(),fa=new q({vertices:[c.create(),c.create(),c.create(),c.create()]});k.prototype[r.BOX|r.HEIGHTFIELD]=k.prototype[r.CONVEX|r.HEIGHTFIELD]=k.prototype.convexHeightfield=function(H,z,G,J,N,K,Q,T,ba){T=K.heights;K=K.elementWidth;var Z=Math.floor((H.aabb.lowerBound[0]-Q[0])/K),ca=Math.ceil((H.aabb.upperBound[0]-Q[0])/K);0>Z&&(Z=0);ca>=T.length&&(ca=T.length-1);for(var ea=T[Z],na=T[ca],da=Z;da<ca;da++)T[da]<na&&(na=T[da]),T[da]>ea&&(ea=T[da]);if(H.aabb.lowerBound[1]>
ea)return!ba&&0;ea=0;for(da=Z;da<ca;da++)c.set(R,da*K,T[da]),c.set(Y,(da+1)*K,T[da+1]),c.add(R,R,Q),c.add(Y,Y,Q),c.set(ha,.5*(Y[0]+R[0]),.5*(Y[1]+R[1]-100)),c.sub(fa.vertices[0],Y,ha),c.sub(fa.vertices[1],R,ha),c.copy(fa.vertices[2],fa.vertices[1]),c.copy(fa.vertices[3],fa.vertices[0]),fa.vertices[2][1]-=100,fa.vertices[3][1]-=100,ea+=this.convexConvex(H,z,G,J,N,fa,ha,0,ba);return ea}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,
"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(e,v,l){function k(f){f=f||{};this.from=f.from?a.fromValues(f.from[0],f.from[1]):a.create();this.to=f.to?a.fromValues(f.to[0],f.to[1]):a.create();this.checkCollisionResponse=void 0===f.checkCollisionResponse||f.checkCollisionResponse;this.skipBackfaces=!!f.skipBackfaces;
this.collisionMask=void 0!==f.collisionMask?f.collisionMask:-1;this.collisionGroup=void 0!==f.collisionGroup?f.collisionGroup:-1;this.mode=void 0!==f.mode?f.mode:k.ANY;this.callback=f.callback||function(g){};this.direction=a.create();this.length=1;this.update()}v.exports=k;var a=e("../math/vec2");e("../collision/RaycastResult");e("../shapes/Shape");e("../collision/AABB");(k.prototype.constructor=k).CLOSEST=1;k.ANY=2;k.ALL=4;k.prototype.update=function(){var f=this.direction;a.sub(f,this.to,this.from);
this.length=a.length(f);a.normalize(f,f)};k.prototype.intersectBodies=function(f,g){for(var h=0,m=g.length;!f.shouldStop(this)&&h<m;h++){var n=g[h],p=n.getAABB();(0<=p.overlapsRay(this)||p.containsPoint(this.from))&&this.intersectBody(f,n)}};var b=a.create();k.prototype.intersectBody=function(f,g){var h=this.checkCollisionResponse;if(!h||g.collisionResponse)for(var m=0,n=g.shapes.length;m<n;m++){var p=g.shapes[m];if((!h||p.collisionResponse)&&0!=(this.collisionGroup&p.collisionMask)&&0!=(p.collisionGroup&
this.collisionMask)&&(a.rotate(b,p.position,g.angle),a.add(b,b,g.position),this.intersectShape(f,p,p.angle+g.angle,b,g),f.shouldStop(this)))break}};k.prototype.intersectShape=function(f,g,h,m,n){var p=this.from,q=this.direction;a.sub(c,m,p);var r=a.dot(c,q);(a.scale(d,q,r),a.add(d,d,p),a.squaredDistance(m,d))>g.boundingRadius*g.boundingRadius||(this._currentBody=n,(this._currentShape=g).raycast(f,this,m,h),this._currentBody=this._currentShape=null)};k.prototype.getAABB=function(f){var g=this.to,h=
this.from;a.set(f.lowerBound,Math.min(g[0],h[0]),Math.min(g[1],h[1]));a.set(f.upperBound,Math.max(g[0],h[0]),Math.max(g[1],h[1]))};a.create();k.prototype.reportIntersection=function(f,g,h,m){this.from;this.to;var n=this._currentShape,p=this._currentBody;if(!(this.skipBackfaces&&0<a.dot(h,this.direction)))switch(this.mode){case k.ALL:f.set(h,n,p,g,m);this.callback(f);break;case k.CLOSEST:(g<f.fraction||!f.hasHit())&&f.set(h,n,p,g,m);break;case k.ANY:f.set(h,n,p,g,m)}};var c=a.create(),d=a.create()},
{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(e,v,l){function k(){this.normal=a.create();this.body=this.shape=null;this.fraction=this.faceIndex=-1;this.isStopped=!1}var a=e("../math/vec2"),b=e("../collision/Ray");(v.exports=k).prototype.reset=function(){a.set(this.normal,0,0);this.body=this.shape=null;this.fraction=this.faceIndex=-1;this.isStopped=!1};k.prototype.getHitDistance=function(c){return a.distance(c.from,c.to)*this.fraction};
k.prototype.hasHit=function(){return-1!==this.fraction};k.prototype.getHitPoint=function(c,d){a.lerp(c,d.from,d.to,this.fraction)};k.prototype.stop=function(){this.isStopped=!0};k.prototype.shouldStop=function(c){return this.isStopped||-1!==this.fraction&&c.mode===b.ANY};k.prototype.set=function(c,d,f,g,h){a.copy(this.normal,c);this.shape=d;this.body=f;this.fraction=g;this.faceIndex=h}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(e,v,l){function k(){b.call(this,b.SAP);this.axisList=[];
this.axisIndex=0;var c=this;this._addBodyHandler=function(d){c.axisList.push(d.body)};this._removeBodyHandler=function(d){d=c.axisList.indexOf(d.body);-1!==d&&c.axisList.splice(d,1)}}var a=e("../utils/Utils"),b=e("../collision/Broadphase");(((v.exports=k).prototype=new b).constructor=k).prototype.setWorld=function(c){this.axisList.length=0;a.appendArray(this.axisList,c.bodies);c.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);c.on("addBody",this._addBodyHandler).on("removeBody",
this._removeBodyHandler);this.world=c};k.sortAxisList=function(c,d){d|=0;for(var f=1,g=c.length;f<g;f++){for(var h=c[f],m=f-1;0<=m&&!(c[m].aabb.lowerBound[d]<=h.aabb.lowerBound[d]);m--)c[m+1]=c[m];c[m+1]=h}return c};k.prototype.sortList=function(){k.sortAxisList(this.axisList,this.axisIndex)};k.prototype.getCollisionPairs=function(c){c=this.axisList;var d=this.result,f=this.axisIndex;d.length=0;for(var g=c.length;g--;){var h=c[g];h.aabbNeedsUpdate&&h.updateAABB()}this.sortList();g=0;for(h=0|c.length;g!==
h;g++)for(var m=c[g],n=g+1;n<h;n++){var p=c[n];if(!(p.aabb.lowerBound[f]<=m.aabb.upperBound[f]))break;b.canCollide(m,p)&&this.boundingVolumeCheck(m,p)&&d.push(m,p)}return d};k.prototype.aabbQuery=function(c,d,f){f=f||[];this.sortList();c=this.axisIndex;var g="x";1===c&&(g="y");2===c&&(g="z");c=this.axisList;for(g=(d.lowerBound[g],d.upperBound[g],0);g<c.length;g++){var h=c[g];h.aabbNeedsUpdate&&h.updateAABB();h.aabb.overlaps(d)&&f.push(h)}return f}},{"../collision/Broadphase":8,"../utils/Utils":57}],
14:[function(e,v,l){function k(b,c,d,f){this.type=d;f=a.defaults(f,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=b;this.bodyB=c;this.collideConnected=f.collideConnected;f.wakeUpBodies&&(b&&b.wakeUp(),c&&c.wakeUp())}v.exports=k;var a=e("../utils/Utils");k.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};k.DISTANCE=1;k.GEAR=2;k.LOCK=3;k.PRISMATIC=4;k.REVOLUTE=5;k.prototype.setStiffness=function(b){for(var c=this.equations,
d=0;d!==c.length;d++){var f=c[d];f.stiffness=b;f.needsUpdate=!0}};k.prototype.setRelaxation=function(b){for(var c=this.equations,d=0;d!==c.length;d++){var f=c[d];f.relaxation=b;f.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(e,v,l){function k(m,n,p){p=d.defaults(p,{localAnchorA:[0,0],localAnchorB:[0,0]});a.call(this,m,n,a.DISTANCE,p);this.localAnchorA=c.fromValues(p.localAnchorA[0],p.localAnchorA[1]);this.localAnchorB=c.fromValues(p.localAnchorB[0],p.localAnchorB[1]);var q=this.localAnchorA,
r=this.localAnchorB;if(this.distance=0,"number"==typeof p.distance)this.distance=p.distance;else{var u=c.create(),x=c.create(),w=c.create();c.rotate(u,q,m.angle);c.rotate(x,r,n.angle);c.add(w,n.position,x);c.sub(w,w,u);c.sub(w,w,m.position);this.distance=c.length(w)}p=void 0===p.maxForce?Number.MAX_VALUE:p.maxForce;m=new b(m,n,-p,p);this.equations=[m];this.maxForce=p;w=c.create();var A=c.create(),C=c.create(),L=this;m.computeGq=function(){var M=this.bodyA,P=this.bodyB,V=M.position,aa=P.position;return c.rotate(A,
q,M.angle),c.rotate(C,r,P.angle),c.add(w,aa,C),c.sub(w,w,A),c.sub(w,w,V),c.length(w)-L.distance};this.setMaxForce(p);this.upperLimitEnabled=!1;this.upperLimit=1;this.lowerLimitEnabled=!1;this.position=this.lowerLimit=0}var a=e("./Constraint"),b=e("../equations/Equation"),c=e("../math/vec2"),d=e("../utils/Utils");((v.exports=k).prototype=new a).constructor=k;var f=c.create(),g=c.create(),h=c.create();k.prototype.update=function(){var m=this.equations[0],n=this.bodyA,p=this.bodyB,q=(this.distance,n.position),
r=p.position,u=this.equations[0];m=m.G;c.rotate(g,this.localAnchorA,n.angle);c.rotate(h,this.localAnchorB,p.angle);c.add(f,r,h);c.sub(f,f,g);c.sub(f,f,q);this.position=c.length(f);n=!1;(this.upperLimitEnabled&&this.position>this.upperLimit&&(u.maxForce=0,u.minForce=-this.maxForce,this.distance=this.upperLimit,n=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(u.maxForce=this.maxForce,u.minForce=0,this.distance=this.lowerLimit,n=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||n)?(u.enabled=
!0,c.normalize(f,f),u=c.crossLength(g,f),n=c.crossLength(h,f),m[0]=-f[0],m[1]=-f[1],m[2]=-u,m[3]=f[0],m[4]=f[1],m[5]=n):u.enabled=!1};k.prototype.setMaxForce=function(m){var n=this.equations[0];n.minForce=-m;n.maxForce=m};k.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(e,v,l){function k(c,d,f){f=f||{};a.call(this,c,d,a.GEAR,f);this.ratio=void 0!==f.ratio?f.ratio:1;this.angle=void 0!==
f.angle?f.angle:d.angle-this.ratio*c.angle;f.angle=this.angle;f.ratio=this.ratio;this.equations=[new b(c,d,f)];void 0!==f.maxTorque&&this.setMaxTorque(f.maxTorque)}var a=e("./Constraint"),b=(e("../equations/Equation"),e("../equations/AngleLockEquation"));e("../math/vec2");(((v.exports=k).prototype=new a).constructor=k).prototype.update=function(){var c=this.equations[0];c.ratio!==this.ratio&&c.setRatio(this.ratio);c.angle=this.angle};k.prototype.setMaxTorque=function(c){this.equations[0].setMaxTorque(c)};
k.prototype.getMaxTorque=function(c){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(e,v,l){function k(n,p,q){q=q||{};a.call(this,n,p,a.LOCK,q);var r=void 0===q.maxForce?Number.MAX_VALUE:q.maxForce,u=(q.localAngleB,new c(n,p,-r,r)),x=new c(n,p,-r,r),w=new c(n,p,-r,r),A=b.create(),C=b.create(),L=this;u.computeGq=function(){return b.rotate(A,L.localOffsetB,n.angle),b.sub(C,p.position,n.position),b.sub(C,
C,A),C[0]};x.computeGq=function(){return b.rotate(A,L.localOffsetB,n.angle),b.sub(C,p.position,n.position),b.sub(C,C,A),C[1]};var M=b.create(),P=b.create();w.computeGq=function(){return b.rotate(M,L.localOffsetB,p.angle-L.localAngleB),b.scale(M,M,-1),b.sub(C,n.position,p.position),b.add(C,C,M),b.rotate(P,M,-Math.PI/2),b.normalize(P,P),b.dot(C,P)};this.localOffsetB=b.create();q.localOffsetB?b.copy(this.localOffsetB,q.localOffsetB):(b.sub(this.localOffsetB,p.position,n.position),b.rotate(this.localOffsetB,
this.localOffsetB,-n.angle));this.localAngleB=0;"number"==typeof q.localAngleB?this.localAngleB=q.localAngleB:this.localAngleB=p.angle-n.angle;this.equations.push(u,x,w);this.setMaxForce(r)}var a=e("./Constraint"),b=e("../math/vec2"),c=e("../equations/Equation");(((v.exports=k).prototype=new a).constructor=k).prototype.setMaxForce=function(n){for(var p=this.equations,q=0;q<this.equations.length;q++)p[q].maxForce=n,p[q].minForce=-n};k.prototype.getMaxForce=function(){return this.equations[0].maxForce};
var d=b.create(),f=b.create(),g=b.create(),h=b.fromValues(1,0),m=b.fromValues(0,1);k.prototype.update=function(){var n=this.equations[0],p=this.equations[1],q=this.equations[2],r=this.bodyB;b.rotate(d,this.localOffsetB,this.bodyA.angle);b.rotate(f,this.localOffsetB,r.angle-this.localAngleB);b.scale(f,f,-1);b.rotate(g,f,Math.PI/2);b.normalize(g,g);n.G[0]=-1;n.G[1]=0;n.G[2]=-b.crossLength(d,h);n.G[3]=1;p.G[0]=0;p.G[1]=-1;p.G[2]=-b.crossLength(d,m);p.G[4]=1;q.G[0]=-g[0];q.G[1]=-g[1];q.G[3]=g[0];q.G[4]=
g[1];q.G[5]=b.crossLength(f,g)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(e,v,l){function k(r,u,x){x=x||{};a.call(this,r,u,a.PRISMATIC,x);var w=d.fromValues(0,0),A=d.fromValues(1,0),C=d.fromValues(0,0);x.localAnchorA&&d.copy(w,x.localAnchorA);x.localAxisA&&d.copy(A,x.localAxisA);x.localAnchorB&&d.copy(C,x.localAnchorB);this.localAnchorA=w;this.localAnchorB=C;this.localAxisA=A;var L=this.maxForce=void 0!==x.maxForce?x.maxForce:Number.MAX_VALUE,M=new c(r,u,-L,L),
P=new d.create,V=new d.create,aa=new d.create,ja=new d.create;(M.computeGq=function(){return d.dot(aa,ja)},M.updateJacobian=function(){var E=this.G,F=r.position,B=u.position;d.rotate(P,w,r.angle);d.rotate(V,C,u.angle);d.add(aa,B,V);d.sub(aa,aa,F);d.sub(aa,aa,P);d.rotate(ja,A,r.angle+Math.PI/2);E[0]=-ja[0];E[1]=-ja[1];E[2]=-d.crossLength(P,ja)+d.crossLength(ja,aa);E[3]=ja[0];E[4]=ja[1];E[5]=d.crossLength(V,ja)},this.equations.push(M),x.disableRotationalLock)||(M=new f(r,u,-L,L),this.equations.push(M));
this.velocity=this.position=0;this.lowerLimitEnabled=void 0!==x.lowerLimit;this.upperLimitEnabled=void 0!==x.upperLimit;this.lowerLimit=void 0!==x.lowerLimit?x.lowerLimit:0;this.upperLimit=void 0!==x.upperLimit?x.upperLimit:1;this.upperLimitEquation=new b(r,u);this.lowerLimitEquation=new b(r,u);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=L;this.motorEquation=new c(r,u);this.motorEnabled=!1;this.motorSpeed=0;
var W=this;x=this.motorEquation;x.computeGW;x.computeGq=function(){return 0};x.computeGW=function(){var E=this.bodyA,F=this.bodyB;return this.gmult(this.G,E.velocity,E.angularVelocity,F.velocity,F.angularVelocity)+W.motorSpeed}}var a=e("./Constraint"),b=e("../equations/ContactEquation"),c=e("../equations/Equation"),d=e("../math/vec2"),f=e("../equations/RotationalLockEquation");((v.exports=k).prototype=new a).constructor=k;var g=d.create(),h=d.create(),m=d.create(),n=d.create(),p=d.create(),q=d.create();
k.prototype.update=function(){var r=this.equations,u=this.upperLimit,x=this.lowerLimit,w=this.upperLimitEquation,A=this.lowerLimitEquation,C=this.bodyA,L=this.bodyB,M=this.localAxisA,P=this.localAnchorA,V=this.localAnchorB;r[0].updateJacobian();d.rotate(g,M,C.angle);d.rotate(n,P,C.angle);d.add(h,n,C.position);d.rotate(p,V,L.angle);d.add(m,p,L.position);var aa;M=this.position=d.dot(m,g)-d.dot(h,g);this.motorEnabled&&(P=this.motorEquation.G,P[0]=g[0],P[1]=g[1],P[2]=d.crossLength(g,p),P[3]=-g[0],P[4]=
-g[1],P[5]=-d.crossLength(g,n));this.upperLimitEnabled&&u<M?(d.scale(w.normalA,g,-1),d.sub(w.contactPointA,h,C.position),d.sub(w.contactPointB,m,L.position),d.scale(q,g,u),d.add(w.contactPointA,w.contactPointA,q),-1===r.indexOf(w)&&r.push(w)):-1!==(aa=r.indexOf(w))&&r.splice(aa,1);this.lowerLimitEnabled&&M<x?(d.scale(A.normalA,g,1),d.sub(A.contactPointA,h,C.position),d.sub(A.contactPointB,m,L.position),d.scale(q,g,x),d.sub(A.contactPointB,A.contactPointB,q),-1===r.indexOf(A)&&r.push(A)):-1!==(aa=
r.indexOf(A))&&r.splice(aa,1)};k.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};k.prototype.disableMotor=function(){if(this.motorEnabled){var r=this.equations.indexOf(this.motorEquation);this.equations.splice(r,1);this.motorEnabled=!1}};k.prototype.setLimits=function(r,u){"number"==typeof r?(this.lowerLimit=r,this.lowerLimitEnabled=!0):(this.lowerLimit=r,this.lowerLimitEnabled=!1);"number"==typeof u?(this.upperLimit=u,this.upperLimitEnabled=
!0):(this.upperLimit=u,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(e,v,l){function k(q,r,u){u=u||{};a.call(this,q,r,a.REVOLUTE,u);var x=this.maxForce=void 0!==u.maxForce?u.maxForce:Number.MAX_VALUE;this.pivotA=f.create();this.pivotB=f.create();u.worldPivot?(f.sub(this.pivotA,u.worldPivot,q.position),f.sub(this.pivotB,u.worldPivot,r.position),f.rotate(this.pivotA,
this.pivotA,-q.angle),f.rotate(this.pivotB,this.pivotB,-r.angle)):(f.copy(this.pivotA,u.localPivotA),f.copy(this.pivotB,u.localPivotB));var w=this.equations=[new b(q,r,-x,x),new b(q,r,-x,x)];u=w[0];w=w[1];var A=this;u.computeGq=function(){return f.rotate(g,A.pivotA,q.angle),f.rotate(h,A.pivotB,r.angle),f.add(p,r.position,h),f.sub(p,p,q.position),f.sub(p,p,g),f.dot(p,m)};w.computeGq=function(){return f.rotate(g,A.pivotA,q.angle),f.rotate(h,A.pivotB,r.angle),f.add(p,r.position,h),f.sub(p,p,q.position),
f.sub(p,p,g),f.dot(p,n)};w.minForce=u.minForce=-x;w.maxForce=u.maxForce=x;this.motorEquation=new c(q,r);this.motorEnabled=!1;this.angle=0;this.upperLimitEnabled=this.lowerLimitEnabled=!1;this.upperLimit=this.lowerLimit=0;this.upperLimitEquation=new d(q,r);this.lowerLimitEquation=new d(q,r);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}var a=e("./Constraint"),b=e("../equations/Equation"),c=e("../equations/RotationalVelocityEquation"),d=e("../equations/RotationalLockEquation"),
f=e("../math/vec2");v.exports=k;var g=f.create(),h=f.create(),m=f.fromValues(1,0),n=f.fromValues(0,1),p=f.create();((k.prototype=new a).constructor=k).prototype.setLimits=function(q,r){"number"==typeof q?(this.lowerLimit=q,this.lowerLimitEnabled=!0):(this.lowerLimit=q,this.lowerLimitEnabled=!1);"number"==typeof r?(this.upperLimit=r,this.upperLimitEnabled=!0):(this.upperLimit=r,this.upperLimitEnabled=!1)};k.prototype.update=function(){var q,r=this.bodyA,u=this.bodyB,x=this.pivotA,w=this.pivotB,A=this.equations,
C=(A[0],A[1],A[0]),L=A[1],M=this.upperLimit,P=this.lowerLimit,V=this.upperLimitEquation,aa=this.lowerLimitEquation,ja=this.angle=u.angle-r.angle;this.upperLimitEnabled&&M<ja?(V.angle=M,-1===A.indexOf(V)&&A.push(V)):-1!==(q=A.indexOf(V))&&A.splice(q,1);this.lowerLimitEnabled&&ja<P?(aa.angle=P,-1===A.indexOf(aa)&&A.push(aa)):-1!==(q=A.indexOf(aa))&&A.splice(q,1);f.rotate(g,x,r.angle);f.rotate(h,w,u.angle);C.G[0]=-1;C.G[1]=0;C.G[2]=-f.crossLength(g,m);C.G[3]=1;C.G[4]=0;C.G[5]=f.crossLength(h,m);L.G[0]=
0;L.G[1]=-1;L.G[2]=-f.crossLength(g,n);L.G[3]=0;L.G[4]=1;L.G[5]=f.crossLength(h,n)};k.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};k.prototype.disableMotor=function(){if(this.motorEnabled){var q=this.equations.indexOf(this.motorEquation);this.equations.splice(q,1);this.motorEnabled=!1}};k.prototype.setMotorSpeed=function(q){if(this.motorEnabled){var r=this.equations.indexOf(this.motorEquation);this.equations[r].relativeVelocity=
q}};k.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(e,v,l){function k(b,c,d){d=d||{};a.call(this,b,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=d.angle||0;this.ratio="number"==typeof d.ratio?d.ratio:1;this.setRatio(this.ratio)}var a=e("./Equation");e("../math/vec2");(((v.exports=
k).prototype=new a).constructor=k).prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};k.prototype.setRatio=function(b){var c=this.G;c[2]=b;c[5]=-1;this.ratio=b};k.prototype.setMaxTorque=function(b){this.maxForce=b;this.minForce=-b}},{"../math/vec2":30,"./Equation":22}],21:[function(e,v,l){function k(g,h){a.call(this,g,h,0,Number.MAX_VALUE);this.contactPointA=b.create();this.penetrationVec=b.create();this.contactPointB=b.create();this.normalA=b.create();
this.restitution=0;this.firstImpact=!1;this.shapeB=this.shapeA=null}var a=e("./Equation"),b=e("../math/vec2");(((v.exports=k).prototype=new a).constructor=k).prototype.computeB=function(g,h,m){var n,p,q=this.contactPointA,r=this.contactPointB,u=this.bodyA.position,x=this.bodyB.position,w=this.penetrationVec,A=this.normalA,C=this.G,L=b.crossLength(q,A),M=b.crossLength(r,A);return C[0]=-A[0],C[1]=-A[1],C[2]=-L,C[3]=A[0],C[4]=A[1],C[5]=M,b.add(w,x,r),b.sub(w,w,u),b.sub(w,w,q),n=this.firstImpact&&0!==
this.restitution?(p=0,1/h*(1+this.restitution)*this.computeGW()):(p=b.dot(A,w)+this.offset,this.computeGW()),-p*g-n*h-m*this.computeGiMf()};var c=b.create(),d=b.create(),f=b.create();k.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(c,this.contactPointA),this.bodyB.getVelocityAtPoint(d,this.contactPointB),b.subtract(f,c,d),b.dot(this.normalA,f)}},{"../math/vec2":30,"./Equation":22}],22:[function(e,v,l){function k(p,q,r,u){this.minForce=void 0===r?-Number.MAX_VALUE:
r;this.maxForce=void 0===u?Number.MAX_VALUE:u;this.bodyA=p;this.bodyB=q;this.stiffness=k.DEFAULT_STIFFNESS;this.relaxation=k.DEFAULT_RELAXATION;this.G=new b.ARRAY_TYPE(6);for(p=0;6>p;p++)this.G[p]=0;this.epsilon=this.b=this.a=this.offset=0;this.timeStep=1/60;this.needsUpdate=!0;this.relativeVelocity=this.multiplier=0;this.enabled=!0}v.exports=k;var a=e("../math/vec2"),b=e("../utils/Utils");e("../objects/Body");(k.prototype.constructor=k).DEFAULT_STIFFNESS=1E6;k.DEFAULT_RELAXATION=4;k.prototype.update=
function(){var p=this.stiffness,q=this.relaxation,r=this.timeStep;this.a=4/(r*(1+4*q));this.b=4*q/(1+4*q);this.epsilon=4/(r*r*p*(1+4*q));this.needsUpdate=!1};k.prototype.gmult=function(p,q,r,u,x){return p[0]*q[0]+p[1]*q[1]+p[2]*r+p[3]*u[0]+p[4]*u[1]+p[5]*x};k.prototype.computeB=function(p,q,r){var u=this.computeGW();return-this.computeGq()*p-u*q-this.computeGiMf()*r};var c=a.create(),d=a.create();k.prototype.computeGq=function(){var p=this.G,q=this.bodyA,r=this.bodyB;q=(q.position,r.position,q.angle);
return this.gmult(p,c,q,d,r.angle)+this.offset};k.prototype.computeGW=function(){var p=this.bodyA,q=this.bodyB;return this.gmult(this.G,p.velocity,p.angularVelocity,q.velocity,q.angularVelocity)+this.relativeVelocity};k.prototype.computeGWlambda=function(){var p=this.bodyA,q=this.bodyB;return this.gmult(this.G,p.vlambda,p.wlambda,q.vlambda,q.wlambda)};var f=a.create(),g=a.create();k.prototype.computeGiMf=function(){var p=this.bodyA,q=this.bodyB,r=p.angularForce,u=q.force,x=q.angularForce,w=q.invMassSolve,
A=p.invInertiaSolve,C=q.invInertiaSolve,L=this.G;return a.scale(f,p.force,p.invMassSolve),a.multiply(f,p.massMultiplier,f),a.scale(g,u,w),a.multiply(g,q.massMultiplier,g),this.gmult(L,f,r*A,g,x*C)};k.prototype.computeGiMGt=function(){var p=this.bodyA,q=this.bodyB,r=p.invMassSolve,u=q.invMassSolve,x=this.G;return x[0]*x[0]*r*p.massMultiplier[0]+x[1]*x[1]*r*p.massMultiplier[1]+x[2]*x[2]*p.invInertiaSolve+x[3]*x[3]*u*q.massMultiplier[0]+x[4]*x[4]*u*q.massMultiplier[1]+x[5]*x[5]*q.invInertiaSolve};var h=
a.create(),m=a.create(),n=a.create();a.create();a.create();a.create();k.prototype.addToWlambda=function(p){var q=this.bodyA,r=this.bodyB,u=q.invMassSolve,x=r.invMassSolve,w=q.invInertiaSolve,A=r.invInertiaSolve,C=this.G;m[0]=C[0];m[1]=C[1];n[0]=C[3];n[1]=C[4];a.scale(h,m,u*p);a.multiply(h,h,q.massMultiplier);a.add(q.vlambda,q.vlambda,h);q.wlambda+=w*C[2]*p;a.scale(h,n,x*p);a.multiply(h,h,r.massMultiplier);a.add(r.vlambda,r.vlambda,h);r.wlambda+=A*C[5]*p};k.prototype.computeInvC=function(p){return 1/
(this.computeGiMGt()+p)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(e,v,l){function k(c,d,f){b.call(this,c,d,-f,f);this.contactPointA=a.create();this.contactPointB=a.create();this.t=a.create();this.contactEquations=[];this.shapeB=this.shapeA=null;this.frictionCoefficient=.3}var a=e("../math/vec2"),b=e("./Equation");e("../utils/Utils");(((v.exports=k).prototype=new b).constructor=k).prototype.setSlipForce=function(c){this.maxForce=c;this.minForce=-c};k.prototype.getSlipForce=
function(){return this.maxForce};k.prototype.computeB=function(c,d,f){this.bodyA;this.bodyB;c=this.contactPointA;var g=this.contactPointB,h=this.t,m=this.G;return m[0]=-h[0],m[1]=-h[1],m[2]=-a.crossLength(c,h),m[3]=h[0],m[4]=h[1],m[5]=a.crossLength(g,h),-this.computeGW()*d-f*this.computeGiMf()}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(e,v,l){function k(h,m,n){n=n||{};a.call(this,h,m,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=n.angle||0;h=this.G;h[2]=1;h[5]=-1}var a=
e("./Equation"),b=e("../math/vec2");((v.exports=k).prototype=new a).constructor=k;var c=b.create(),d=b.create(),f=b.fromValues(1,0),g=b.fromValues(0,1);k.prototype.computeGq=function(){return b.rotate(c,f,this.bodyA.angle+this.angle),b.rotate(d,g,this.bodyB.angle),b.dot(c,d)}},{"../math/vec2":30,"./Equation":22}],25:[function(e,v,l){function k(b,c){a.call(this,b,c,-Number.MAX_VALUE,Number.MAX_VALUE);this.ratio=this.relativeVelocity=1}var a=e("./Equation");e("../math/vec2");(((v.exports=k).prototype=
new a).constructor=k).prototype.computeB=function(b,c,d){b=this.G;b[2]=-1;b[5]=this.ratio;b=this.computeGiMf();return-this.computeGW()*c-d*b}},{"../math/vec2":30,"./Equation":22}],26:[function(e,v,l){e=function(){};(v.exports=e).prototype={constructor:e,on:function(k,a,b){a.context=b||this;void 0===this._listeners&&(this._listeners={});b=this._listeners;return void 0===b[k]&&(b[k]=[]),-1===b[k].indexOf(a)&&b[k].push(a),this},has:function(k,a){if(void 0===this._listeners)return!1;var b=this._listeners;
if(a){if(void 0!==b[k]&&-1!==b[k].indexOf(a))return!0}else if(void 0!==b[k])return!0;return!1},off:function(k,a){if(void 0===this._listeners)return this;var b=this._listeners;a=b[k].indexOf(a);return-1!==a&&b[k].splice(a,1),this},emit:function(k){if(void 0===this._listeners)return this;var a=this._listeners[k.type];if(void 0!==a){k.target=this;for(var b=0,c=a.length;b<c;b++){var d=a[b];d.call(d.context,k)}}return this}}},{}],27:[function(e,v,l){function k(c,d,f){if(f=f||{},!(c instanceof a&&d instanceof
a))throw Error("First two arguments must be Material instances.");this.id=k.idCounter++;this.materialA=c;this.materialB=d;this.friction=void 0!==f.friction?Number(f.friction):.3;this.restitution=void 0!==f.restitution?Number(f.restitution):0;this.stiffness=void 0!==f.stiffness?Number(f.stiffness):b.DEFAULT_STIFFNESS;this.relaxation=void 0!==f.relaxation?Number(f.relaxation):b.DEFAULT_RELAXATION;this.frictionStiffness=void 0!==f.frictionStiffness?Number(f.frictionStiffness):b.DEFAULT_STIFFNESS;this.frictionRelaxation=
void 0!==f.frictionRelaxation?Number(f.frictionRelaxation):b.DEFAULT_RELAXATION;this.surfaceVelocity=void 0!==f.surfaceVelocity?Number(f.surfaceVelocity):0;this.contactSkinSize=.005}var a=e("./Material"),b=e("../equations/Equation");(v.exports=k).idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(e,v,l){function k(a){this.id=a||k.idCounter++}(v.exports=k).idCounter=0},{}],29:[function(e,v,l){var k={GetArea:function(a){if(6>a.length)return 0;for(var b=a.length-2,c=0,d=0;d<b;d+=
2)c+=(a[d+2]-a[d])*(a[d+1]+a[d+3]);return.5*-(c+(a[0]-a[b])*(a[b+1]+a[1]))},Triangulate:function(a){var b=a.length>>1;if(3>b)return[];for(var c=[],d=[],f=0;f<b;f++)d.push(f);for(f=0;3<b;){var g=d[(f+0)%b],h=d[(f+1)%b],m=d[(f+2)%b],n=a[2*g],p=a[2*g+1],q=a[2*h],r=a[2*h+1],u=a[2*m],x=a[2*m+1],w=!1;if(k._convex(n,p,q,r,u,x)){w=!0;for(var A=0;A<b;A++){var C=d[A];if(C!=g&&C!=h&&C!=m&&k._PointInTriangle(a[2*C],a[2*C+1],n,p,q,r,u,x)){w=!1;break}}}if(w)c.push(g,h,m),d.splice((f+1)%b,1),b--,f=0;else if(f++>
3*b)break}return c.push(d[0],d[1],d[2]),c},_PointInTriangle:function(a,b,c,d,f,g,h,m){h-=c;m-=d;f-=c;g-=d;a-=c;c=b-d;b=h*h+m*m;d=h*f+m*g;h=h*a+m*c;m=f*f+g*g;f=f*a+g*c;g=1/(b*m-d*d);m=(m*h-d*f)*g;h=(b*f-d*h)*g;return 0<=m&&0<=h&&1>m+h},_convex:function(a,b,c,d,f,g){return 0<=(b-d)*(f-c)+(c-a)*(g-d)}};v.exports=k},{}],30:[function(e,v,l){var k=v.exports={},a=e("../utils/Utils");k.crossLength=function(b,c){return b[0]*c[1]-b[1]*c[0]};k.crossVZ=function(b,c,d){return k.rotate(b,c,-Math.PI/2),k.scale(b,
b,d),b};k.crossZV=function(b,c,d){return k.rotate(b,d,Math.PI/2),k.scale(b,b,c),b};k.rotate=function(b,c,d){if(0!==d){var f=Math.cos(d);d=Math.sin(d);var g=c[0];c=c[1];b[0]=f*g-d*c;b[1]=d*g+f*c}else b[0]=c[0],b[1]=c[1]};k.rotate90cw=function(b,c){var d=c[0];b[0]=c[1];b[1]=-d};k.toLocalFrame=function(b,c,d,f){k.copy(b,c);k.sub(b,b,d);k.rotate(b,b,-f)};k.toGlobalFrame=function(b,c,d,f){k.copy(b,c);k.rotate(b,b,f);k.add(b,b,d)};k.vectorToLocalFrame=function(b,c,d){k.rotate(b,c,-d)};k.vectorToGlobalFrame=
function(b,c,d){k.rotate(b,c,d)};k.centroid=function(b,c,d,f){return k.add(b,c,d),k.add(b,b,f),k.scale(b,b,1/3),b};k.create=function(){var b=new a.ARRAY_TYPE(2);return b[0]=0,b[1]=0,b};k.clone=function(b){var c=new a.ARRAY_TYPE(2);return c[0]=b[0],c[1]=b[1],c};k.fromValues=function(b,c){var d=new a.ARRAY_TYPE(2);return d[0]=b,d[1]=c,d};k.copy=function(b,c){return b[0]=c[0],b[1]=c[1],b};k.set=function(b,c,d){return b[0]=c,b[1]=d,b};k.add=function(b,c,d){return b[0]=c[0]+d[0],b[1]=c[1]+d[1],b};k.subtract=
function(b,c,d){return b[0]=c[0]-d[0],b[1]=c[1]-d[1],b};k.sub=k.subtract;k.multiply=function(b,c,d){return b[0]=c[0]*d[0],b[1]=c[1]*d[1],b};k.mul=k.multiply;k.divide=function(b,c,d){return b[0]=c[0]/d[0],b[1]=c[1]/d[1],b};k.div=k.divide;k.scale=function(b,c,d){return b[0]=c[0]*d,b[1]=c[1]*d,b};k.distance=function(b,c){var d=c[0]-b[0];b=c[1]-b[1];return Math.sqrt(d*d+b*b)};k.dist=k.distance;k.squaredDistance=function(b,c){var d=c[0]-b[0];b=c[1]-b[1];return d*d+b*b};k.sqrDist=k.squaredDistance;k.length=
function(b){var c=b[0];b=b[1];return Math.sqrt(c*c+b*b)};k.len=k.length;k.squaredLength=function(b){var c=b[0];b=b[1];return c*c+b*b};k.sqrLen=k.squaredLength;k.negate=function(b,c){return b[0]=-c[0],b[1]=-c[1],b};k.normalize=function(b,c){var d=c[0],f=c[1];d=d*d+f*f;return 0<d&&(d=1/Math.sqrt(d),b[0]=c[0]*d,b[1]=c[1]*d),b};k.dot=function(b,c){return b[0]*c[0]+b[1]*c[1]};k.str=function(b){return"vec2("+b[0]+", "+b[1]+")"};k.lerp=function(b,c,d,f){var g=c[0];c=c[1];return b[0]=g+f*(d[0]-g),b[1]=c+
f*(d[1]-c),b};k.reflect=function(b,c,d){var f=c[0]*d[0]+c[1]*d[1];b[0]=c[0]-2*d[0]*f;b[1]=c[1]-2*d[1]*f};k.getLineSegmentsIntersection=function(b,c,d,f,g){f=k.getLineSegmentsIntersectionFraction(c,d,f,g);return!(0>f)&&(b[0]=c[0]+f*(d[0]-c[0]),b[1]=c[1]+f*(d[1]-c[1]),!0)};k.getLineSegmentsIntersectionFraction=function(b,c,d,f){var g,h,m=c[0]-b[0];c=c[1]-b[1];var n=f[0]-d[0];f=f[1]-d[1];return g=(-c*(b[0]-d[0])+m*(b[1]-d[1]))/(-n*c+m*f),h=(n*(b[1]-d[1])-f*(b[0]-d[0]))/(-n*c+m*f),0<=g&&1>=g&&0<=h&&1>=
h?h:-1}},{"../utils/Utils":57}],31:[function(e,v,l){function k(B){B=B||{};g.call(this);this.id=B.id||++k._idCounter;this.world=null;this.shapes=[];this.mass=B.mass||0;this.invInertiaSolve=this.invMassSolve=this.invInertia=this.inertia=this.invMass=0;this.fixedRotation=!!B.fixedRotation;this.fixedX=!!B.fixedX;this.fixedY=!!B.fixedY;this.massMultiplier=a.create();this.position=a.fromValues(0,0);B.position&&a.copy(this.position,B.position);this.interpolatedPosition=a.fromValues(0,0);this.interpolatedAngle=
0;this.previousPosition=a.fromValues(0,0);this.previousAngle=0;this.velocity=a.fromValues(0,0);B.velocity&&a.copy(this.velocity,B.velocity);this.vlambda=a.fromValues(0,0);this.wlambda=0;this.angle=B.angle||0;this.angularVelocity=B.angularVelocity||0;this.force=a.create();B.force&&a.copy(this.force,B.force);this.angularForce=B.angularForce||0;this.damping="number"==typeof B.damping?B.damping:.1;this.angularDamping="number"==typeof B.angularDamping?B.angularDamping:.1;this.type=k.STATIC;void 0!==B.type?
this.type=B.type:B.mass?this.type=k.DYNAMIC:this.type=k.STATIC;this.boundingRadius=0;this.aabb=new f;this.aabbNeedsUpdate=!0;this.allowSleep=void 0===B.allowSleep||B.allowSleep;this.wantsToSleep=!1;this.sleepState=k.AWAKE;this.sleepSpeedLimit=void 0!==B.sleepSpeedLimit?B.sleepSpeedLimit:.2;this.sleepTimeLimit=void 0!==B.sleepTimeLimit?B.sleepTimeLimit:1;this.gravityScale=void 0!==B.gravityScale?B.gravityScale:1;this.collisionResponse=void 0===B.collisionResponse||B.collisionResponse;this.timeLastSleepy=
this.idleTime=0;this.ccdSpeedThreshold=void 0!==B.ccdSpeedThreshold?B.ccdSpeedThreshold:-1;this.ccdIterations=void 0!==B.ccdIterations?B.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=!1;this.updateMassProperties()}var a=e("../math/vec2"),b=e("poly-decomp"),c=e("../shapes/Convex");l=e("../collision/RaycastResult");var d=e("../collision/Ray"),f=e("../collision/AABB"),g=e("../events/EventEmitter");(((v.exports=k).prototype=new g).constructor=k)._idCounter=0;k.prototype.updateSolveMassProperties=
function(){this.sleepState===k.SLEEPING||this.type===k.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)};k.prototype.setDensity=function(B){this.mass=this.getArea()*B;this.updateMassProperties()};k.prototype.getArea=function(){for(var B=0,I=0;I<this.shapes.length;I++)B+=this.shapes[I].area;return B};k.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var h=new f,m=a.create();k.prototype.updateAABB=
function(){for(var B=this.shapes,I=B.length,X=this.angle,U=0;U!==I;U++){var ia=B[U],la=ia.angle+X;a.rotate(m,ia.position,X);a.add(m,m,this.position);ia.computeAABB(h,m,la);0===U?this.aabb.copy(h):this.aabb.extend(h)}this.aabbNeedsUpdate=!1};k.prototype.updateBoundingRadius=function(){for(var B=this.shapes,I=B.length,X=0,U=0;U!==I;U++){var ia=B[U],la=a.length(ia.position);ia=ia.boundingRadius;X<la+ia&&(X=la+ia)}this.boundingRadius=X};k.prototype.addShape=function(B,I,X){if(B.body)throw Error("A shape can only be added to one body.");
B.body=this;I?a.copy(B.position,I):a.set(B.position,0,0);B.angle=X||0;this.shapes.push(B);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0};k.prototype.removeShape=function(B){var I=this.shapes.indexOf(B);return-1!==I&&(this.shapes.splice(I,1),this.aabbNeedsUpdate=!0,!(B.body=null))};k.prototype.updateMassProperties=function(){if(this.type===k.STATIC||this.type===k.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var B=
this.shapes,I=B.length,X=this.mass/I,U=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var ia=0;ia<I;ia++){var la=B[ia],ma=a.squaredLength(la.position);U+=la.computeMomentOfInertia(X)+X*ma}this.inertia=U;this.invInertia=0<U?1/U:0}this.invMass=1/this.mass;a.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};a.create();k.prototype.applyForce=function(B,I){if(a.add(this.force,this.force,B),I)B=a.crossLength(I,B),this.angularForce+=B};var n=a.create(),p=a.create(),
q=a.create();k.prototype.applyForceLocal=function(B,I){I=I||q;this.vectorToWorldFrame(n,B);this.vectorToWorldFrame(p,I);this.applyForce(n,p)};var r=a.create();k.prototype.applyImpulse=function(B,I){this.type===k.DYNAMIC&&(a.scale(r,B,this.invMass),a.multiply(r,this.massMultiplier,r),a.add(this.velocity,r,this.velocity),I)&&(B=a.crossLength(I,B),B*=this.invInertia,this.angularVelocity+=B)};var u=a.create(),x=a.create(),w=a.create();k.prototype.applyImpulseLocal=function(B,I){I=I||w;this.vectorToWorldFrame(u,
B);this.vectorToWorldFrame(x,I);this.applyImpulse(u,x)};k.prototype.toLocalFrame=function(B,I){a.toLocalFrame(B,I,this.position,this.angle)};k.prototype.toWorldFrame=function(B,I){a.toGlobalFrame(B,I,this.position,this.angle)};k.prototype.vectorToLocalFrame=function(B,I){a.vectorToLocalFrame(B,I,this.angle)};k.prototype.vectorToWorldFrame=function(B,I){a.vectorToGlobalFrame(B,I,this.angle)};k.prototype.fromPolygon=function(B,I){I=I||{};for(var X=this.shapes.length;0<=X;--X)this.removeShape(this.shapes[X]);
var U=new b.Polygon;if(U.vertices=B,U.makeCCW(),"number"==typeof I.removeCollinearPoints&&U.removeCollinearPoints(I.removeCollinearPoints),void 0===I.skipSimpleCheck&&!U.isSimple())return!1;this.concavePath=U.vertices.slice(0);for(X=0;X<this.concavePath.length;X++)B=[0,0],a.copy(B,this.concavePath[X]),this.concavePath[X]=B;I=I.optimalDecomp?U.decomp():U.quickDecomp();U=a.create();for(X=0;X!==I.length;X++){for(var ia=new c({vertices:I[X].vertices}),la=0;la!==ia.vertices.length;la++)B=ia.vertices[la],
a.sub(B,B,ia.centerOfMass);a.scale(U,ia.centerOfMass,1);ia.updateTriangles();ia.updateCenterOfMass();ia.updateBoundingRadius();this.addShape(ia,U)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0};a.fromValues(0,0);var A=a.fromValues(0,0),C=a.fromValues(0,0),L=a.fromValues(0,0);k.prototype.adjustCenterOfMass=function(){var B=0;a.set(C,0,0);for(var I=0;I!==this.shapes.length;I++){var X=this.shapes[I];a.scale(A,X.position,X.area);a.add(C,C,A);B+=X.area}a.scale(L,C,1/B);for(I=0;I!==this.shapes.length;I++)X=
this.shapes[I],a.sub(X.position,X.position,L);a.add(this.position,this.position,L);for(I=0;this.concavePath&&I<this.concavePath.length;I++)a.sub(this.concavePath[I],this.concavePath[I],L);this.updateMassProperties();this.updateBoundingRadius()};k.prototype.setZeroForce=function(){a.set(this.force,0,0);this.angularForce=0};k.prototype.resetConstraintVelocity=function(){a.set(this.vlambda,0,0);this.wlambda=0};k.prototype.addConstraintVelocity=function(){var B=this.velocity;a.add(B,B,this.vlambda);this.angularVelocity+=
this.wlambda};k.prototype.applyDamping=function(B){if(this.type===k.DYNAMIC){var I=this.velocity;a.scale(I,I,Math.pow(1-this.damping,B));this.angularVelocity*=Math.pow(1-this.angularDamping,B)}};k.prototype.wakeUp=function(){var B=this.sleepState;this.sleepState=k.AWAKE;this.idleTime=0;B!==k.AWAKE&&this.emit(k.wakeUpEvent)};k.prototype.sleep=function(){this.sleepState=k.SLEEPING;this.angularForce=this.angularVelocity=0;a.set(this.velocity,0,0);a.set(this.force,0,0);this.emit(k.sleepEvent)};k.prototype.sleepTick=
function(B,I,X){this.allowSleep&&this.type!==k.SLEEPING&&(this.wantsToSleep=!1,this.sleepState,B=a.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),Math.pow(this.sleepSpeedLimit,2)<=B?(this.idleTime=0,this.sleepState=k.AWAKE):(this.idleTime+=X,this.sleepState=k.SLEEPY),this.idleTime>this.sleepTimeLimit&&(I?this.wantsToSleep=!0:this.sleep()))};k.prototype.overlaps=function(B){return this.world.overlapKeeper.bodiesAreOverlapping(this,B)};var M=a.create(),P=a.create();k.prototype.integrate=
function(B){var I=this.invMass,X=this.force,U=this.position,ia=this.velocity;a.copy(this.previousPosition,this.position);this.previousAngle=this.angle;this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*B);a.scale(M,X,B*I);a.multiply(M,this.massMultiplier,M);a.add(ia,M,ia);this.integrateToTimeOfImpact(B)||(a.scale(P,ia,B),a.add(U,U,P),this.fixedRotation||(this.angle+=this.angularVelocity*B));this.aabbNeedsUpdate=!0};var V=new l,aa=new d({mode:d.ALL}),ja=a.create(),W=a.create(),
E=a.create(),F=a.create();k.prototype.integrateToTimeOfImpact=function(B){if(0>this.ccdSpeedThreshold||a.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;a.normalize(ja,this.velocity);a.scale(W,this.velocity,B);a.add(W,W,this.position);a.sub(E,W,this.position);var I;B*=this.angularVelocity;var X=a.length(E),U=1,ia=this;if(V.reset(),aa.callback=function(O){O.body!==ia&&(I=O.body,O.getHitPoint(W,aa),a.sub(E,W,ia.position),U=a.length(E)/X,O.stop())},a.copy(aa.from,this.position),
a.copy(aa.to,W),aa.update(),this.world.raycast(V,aa),!I)return!1;var la=this.angle;a.copy(F,this.position);for(var ma=0,ka=0,pa=0,ta=U;ka<=ta&&ma<this.ccdIterations;)ma++,pa=(ta-ka)/2,a.scale(P,E,U),a.add(this.position,F,P),this.angle=la+B*U,this.updateAABB(),this.aabb.overlaps(I.aabb)&&this.world.narrowphase.bodiesOverlap(this,I)?ka=pa:ta=pa;return U=pa,a.copy(this.position,F),this.angle=la,a.scale(P,E,U),a.add(this.position,this.position,P),this.fixedRotation||(this.angle+=B*U),!0};k.prototype.getVelocityAtPoint=
function(B,I){return a.crossVZ(B,I,this.angularVelocity),a.subtract(B,this.velocity,B),B};k.sleepyEvent={type:"sleepy"};k.sleepEvent={type:"sleep"};k.wakeUpEvent={type:"wakeup"};k.DYNAMIC=1;k.STATIC=2;k.KINEMATIC=4;k.AWAKE=0;k.SLEEPY=1;k.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(e,v,l){function k(r,u,x){x=x||{};b.call(this,r,u,x);this.localAnchorA=a.fromValues(0,
0);this.localAnchorB=a.fromValues(0,0);x.localAnchorA&&a.copy(this.localAnchorA,x.localAnchorA);x.localAnchorB&&a.copy(this.localAnchorB,x.localAnchorB);x.worldAnchorA&&this.setWorldAnchorA(x.worldAnchorA);x.worldAnchorB&&this.setWorldAnchorB(x.worldAnchorB);r=a.create();u=a.create();this.getWorldAnchorA(r);this.getWorldAnchorB(u);r=a.distance(r,u);this.restLength="number"==typeof x.restLength?x.restLength:r}var a=e("../math/vec2"),b=e("./Spring");e("../utils/Utils");(((v.exports=k).prototype=new b).constructor=
k).prototype.setWorldAnchorA=function(r){this.bodyA.toLocalFrame(this.localAnchorA,r)};k.prototype.setWorldAnchorB=function(r){this.bodyB.toLocalFrame(this.localAnchorB,r)};k.prototype.getWorldAnchorA=function(r){this.bodyA.toWorldFrame(r,this.localAnchorA)};k.prototype.getWorldAnchorB=function(r){this.bodyB.toWorldFrame(r,this.localAnchorB)};var c=a.create(),d=a.create(),f=a.create(),g=a.create(),h=a.create(),m=a.create(),n=a.create(),p=a.create(),q=a.create();k.prototype.applyForce=function(){var r=
this.stiffness,u=this.damping,x=this.restLength,w=this.bodyA,A=this.bodyB;this.getWorldAnchorA(h);this.getWorldAnchorB(m);a.sub(n,h,w.position);a.sub(p,m,A.position);a.sub(c,m,h);var C=a.len(c);a.normalize(d,c);a.sub(f,A.velocity,w.velocity);a.crossZV(q,A.angularVelocity,p);a.add(f,f,q);a.crossZV(q,w.angularVelocity,n);a.sub(f,f,q);a.scale(g,d,-r*(C-x)-u*a.dot(f,d));a.sub(w.force,w.force,g);a.add(A.force,A.force,g);r=a.crossLength(n,g);u=a.crossLength(p,g);w.angularForce-=r;A.angularForce+=u}},{"../math/vec2":30,
"../utils/Utils":57,"./Spring":34}],33:[function(e,v,l){function k(b,c,d){d=d||{};a.call(this,b,c,d);this.restAngle="number"==typeof d.restAngle?d.restAngle:c.angle-b.angle}e("../math/vec2");var a=e("./Spring");(((v.exports=k).prototype=new a).constructor=k).prototype.applyForce=function(){var b=this.bodyA,c=this.bodyB,d=-this.stiffness*(c.angle-b.angle-this.restAngle)-this.damping*(c.angularVelocity-b.angularVelocity)*0;b.angularForce-=d;c.angularForce+=d}},{"../math/vec2":30,"./Spring":34}],34:[function(e,
v,l){e("../math/vec2");var k=e("../utils/Utils");(v.exports=function(a,b,c){c=k.defaults(c,{stiffness:100,damping:1});this.stiffness=c.stiffness;this.damping=c.damping;this.bodyA=a;this.bodyB=b}).prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(e,v,l){function k(n,p){this.chassisBody=n;this.wheels=[];this.groundBody=new f({mass:0});this.world=null;var q=this;this.preStepCallback=function(){q.update()}}function a(n,p){p=p||{};this.vehicle=n;this.forwardEquation=
new d(n.chassisBody,n.groundBody);this.sideEquation=new d(n.chassisBody,n.groundBody);this.engineForce=this.steerValue=0;this.setSideFriction(void 0!==p.sideFriction?p.sideFriction:5);this.localForwardVector=b.fromValues(0,1);p.localForwardVector&&b.copy(this.localForwardVector,p.localForwardVector);this.localPosition=b.fromValues(0,0);p.localPosition&&b.copy(this.localPosition,p.localPosition);c.apply(this,n.chassisBody,n.groundBody);this.equations.push(this.forwardEquation,this.sideEquation);this.setBrakeForce(0)}
var b=e("../math/vec2"),c=(e("../utils/Utils"),e("../constraints/Constraint")),d=e("../equations/FrictionEquation"),f=e("../objects/Body");(v.exports=k).prototype.addToWorld=function(n){(this.world=n).addBody(this.groundBody);n.on("preStep",this.preStepCallback);for(var p=0;p<this.wheels.length;p++)n.addConstraint(this.wheels[p])};k.prototype.removeFromWorld=function(){var n=this.world;n.removeBody(this.groundBody);n.off("preStep",this.preStepCallback);for(var p=0;p<this.wheels.length;p++)n.removeConstraint(this.wheels[p]);
this.world=null};k.prototype.addWheel=function(n){n=new a(this,n);return this.wheels.push(n),n};k.prototype.update=function(){for(var n=0;n<this.wheels.length;n++)this.wheels[n].update()};(a.prototype=new c).setBrakeForce=function(n){this.forwardEquation.setSlipForce(n)};a.prototype.setSideFriction=function(n){this.sideEquation.setSlipForce(n)};var g=b.create(),h=b.create();a.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(g,
h),b.dot(g,h)};var m=b.create();a.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector);b.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2);this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t);b.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue);b.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue);this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,
this.localPosition);b.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB);this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition);b.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA);b.normalize(m,this.forwardEquation.t);b.scale(m,m,this.engineForce);this.vehicle.chassisBody.applyForce(m,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,
"../utils/Utils":57}],36:[function(e,v,l){e=v.exports={AABB:e("./collision/AABB"),AngleLockEquation:e("./equations/AngleLockEquation"),Body:e("./objects/Body"),Broadphase:e("./collision/Broadphase"),Capsule:e("./shapes/Capsule"),Circle:e("./shapes/Circle"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),ContactEquationPool:e("./utils/ContactEquationPool"),ContactMaterial:e("./material/ContactMaterial"),Convex:e("./shapes/Convex"),DistanceConstraint:e("./constraints/DistanceConstraint"),
Equation:e("./equations/Equation"),EventEmitter:e("./events/EventEmitter"),FrictionEquation:e("./equations/FrictionEquation"),FrictionEquationPool:e("./utils/FrictionEquationPool"),GearConstraint:e("./constraints/GearConstraint"),GSSolver:e("./solver/GSSolver"),Heightfield:e("./shapes/Heightfield"),Line:e("./shapes/Line"),LockConstraint:e("./constraints/LockConstraint"),Material:e("./material/Material"),Narrowphase:e("./collision/Narrowphase"),NaiveBroadphase:e("./collision/NaiveBroadphase"),Particle:e("./shapes/Particle"),
Plane:e("./shapes/Plane"),Pool:e("./utils/Pool"),RevoluteConstraint:e("./constraints/RevoluteConstraint"),PrismaticConstraint:e("./constraints/PrismaticConstraint"),Ray:e("./collision/Ray"),RaycastResult:e("./collision/RaycastResult"),Box:e("./shapes/Box"),RotationalVelocityEquation:e("./equations/RotationalVelocityEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),Spring:e("./objects/Spring"),TopDownVehicle:e("./objects/TopDownVehicle"),
LinearSpring:e("./objects/LinearSpring"),RotationalSpring:e("./objects/RotationalSpring"),Utils:e("./utils/Utils"),World:e("./world/World"),vec2:e("./math/vec2"),version:e("../package.json").version};Object.defineProperty(e,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,
"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,
"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(e,
v,l){function k(d,f){"number"==typeof d&&"number"==typeof f&&(d={width:d,height:f},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })"));d=d||{};f=this.width=d.width||1;var g=this.height=d.height||1;f=[a.fromValues(-f/2,-g/2),a.fromValues(f/2,-g/2),a.fromValues(f/2,g/2),a.fromValues(-f/2,g/2)];g=[a.fromValues(1,0),a.fromValues(0,1)];d.vertices=f;d.axes=g;d.type=b.BOX;c.call(this,d)}var a=
e("../math/vec2"),b=e("./Shape"),c=e("./Convex");(((v.exports=k).prototype=new c).constructor=k).prototype.computeMomentOfInertia=function(d){var f=this.width,g=this.height;return d*(g*g+f*f)/12};k.prototype.updateBoundingRadius=function(){var d=this.width,f=this.height;this.boundingRadius=Math.sqrt(d*d+f*f)/2};a.create();a.create();a.create();a.create();k.prototype.computeAABB=function(d,f,g){d.setFromPoints(this.vertices,f,g,0)};k.prototype.updateArea=function(){this.area=this.width*this.height}},
{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(e,v,l){function k(n,p){"number"==typeof n&&"number"==typeof p&&(n={length:n,radius:p},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })"));n=n||{};this.length=n.length||1;this.radius=n.radius||1;n.type=a.CAPSULE;a.call(this,n)}var a=e("./Shape"),b=e("../math/vec2");(((v.exports=k).prototype=new a).constructor=k).prototype.computeMomentOfInertia=function(n){var p=
this.radius,q=this.length+p;p*=2;return n*(p*p+q*q)/12};k.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};k.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var c=b.create();k.prototype.computeAABB=function(n,p,q){var r=this.radius;b.set(c,this.length/2,0);0!==q&&b.rotate(c,c,q);b.set(n.upperBound,Math.max(c[0]+r,-c[0]+r),Math.max(c[1]+r,-c[1]+r));b.set(n.lowerBound,Math.min(c[0]-r,-c[0]-r),Math.min(c[1]-
r,-c[1]-r));b.add(n.lowerBound,n.lowerBound,p);b.add(n.upperBound,n.upperBound,p)};var d=b.create(),f=b.create(),g=b.create(),h=b.create(),m=b.fromValues(0,1);k.prototype.raycast=function(n,p,q,r){for(var u=p.from,x=p.to,w=(p.direction,d),A=this.length/2,C=0;2>C;C++){var L=this.radius*(2*C-1);if(b.set(g,-A,L),b.set(h,A,L),b.toGlobalFrame(g,g,q,r),b.toGlobalFrame(h,h,q,r),0<=(M=b.getLineSegmentsIntersectionFraction(u,x,g,h))&&(b.rotate(f,m,r),b.scale(f,f,2*C-1),p.reportIntersection(n,M,f,-1),n.shouldStop(p)))return}L=
Math.pow(this.radius,2)+Math.pow(A,2);for(C=0;2>C;C++){b.set(g,A*(2*C-1),0);b.toGlobalFrame(g,g,q,r);var M,P=Math.pow(x[0]-u[0],2)+Math.pow(x[1]-u[1],2),V=2*((x[0]-u[0])*(u[0]-g[0])+(x[1]-u[1])*(u[1]-g[1]));if(!(0>(M=Math.pow(V,2)-4*P*(Math.pow(u[0]-g[0],2)+Math.pow(u[1]-g[1],2)-Math.pow(this.radius,2)))))if(0===M){if(b.lerp(w,u,x,M),b.squaredDistance(w,q)>L&&(b.sub(f,w,g),b.normalize(f,f),p.reportIntersection(n,M,f,-1),n.shouldStop(p)))break}else{M=Math.sqrt(M);var aa=1/(2*P);P=(-V-M)*aa;V=(-V+M)*
aa;if(0<=P&&1>=P&&(b.lerp(w,u,x,P),b.squaredDistance(w,q)>L&&(b.sub(f,w,g),b.normalize(f,f),p.reportIntersection(n,P,f,-1),n.shouldStop(p))))break;if(0<=V&&1>=V&&(b.lerp(w,u,x,V),b.squaredDistance(w,q)>L&&(b.sub(f,w,g),b.normalize(f,f),p.reportIntersection(n,V,f,-1),n.shouldStop(p))))break}}}},{"../math/vec2":30,"./Shape":45}],39:[function(e,v,l){function k(f){"number"==typeof f&&(f={radius:f},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })"));
f=f||{};this.radius=f.radius||1;f.type=a.CIRCLE;a.call(this,f)}var a=e("./Shape"),b=e("../math/vec2");(((v.exports=k).prototype=new a).constructor=k).prototype.computeMomentOfInertia=function(f){var g=this.radius;return f*g*g/2};k.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};k.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};k.prototype.computeAABB=function(f,g,h){h=this.radius;b.set(f.upperBound,h,h);b.set(f.lowerBound,-h,-h);g&&(b.add(f.lowerBound,
f.lowerBound,g),b.add(f.upperBound,f.upperBound,g))};var c=b.create(),d=b.create();k.prototype.raycast=function(f,g,h,m){m=g.from;var n=g.to,p=Math.pow(n[0]-m[0],2)+Math.pow(n[1]-m[1],2),q=2*((n[0]-m[0])*(m[0]-h[0])+(n[1]-m[1])*(m[1]-h[1])),r=Math.pow(q,2)-4*p*(Math.pow(m[0]-h[0],2)+Math.pow(m[1]-h[1],2)-Math.pow(this.radius,2));if(!(0>r))if(0===r)b.lerp(c,m,n,r),b.sub(d,c,h),b.normalize(d,d),g.reportIntersection(f,r,d,-1);else{r=Math.sqrt(r);var u=1/(2*p);p=(-q-r)*u;q=(-q+r)*u;0<=p&&1>=p&&(b.lerp(c,
m,n,p),b.sub(d,c,h),b.normalize(d,d),g.reportIntersection(f,p,d,-1),f.shouldStop(g))||0<=q&&1>=q&&(b.lerp(c,m,n,q),b.sub(d,c,h),b.normalize(d,d),g.reportIntersection(f,q,d,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(e,v,l){function k(q,r){Array.isArray(q)&&(q={vertices:q,axes:r},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })"));q=q||{};this.vertices=[];var u=void 0!==q.vertices?q.vertices:[];for(r=0;r<u.length;r++){var x=
b.create();b.copy(x,u[r]);this.vertices.push(x)}if(this.axes=[],q.axes)for(r=0;r<q.axes.length;r++)u=b.create(),b.copy(u,q.axes[r]),this.axes.push(u);else for(r=0;r<this.vertices.length;r++){u=this.vertices[r];x=this.vertices[(r+1)%this.vertices.length];var w=b.create();b.sub(w,x,u);b.rotate90cw(w,w);b.normalize(w,w);this.axes.push(w)}if(this.centerOfMass=b.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,q.type=a.CONVEX,
a.call(this,q),this.updateBoundingRadius(),this.updateArea(),0>this.area)throw Error("Convex vertices must be given in conter-clockwise winding.");}var a=e("./Shape"),b=e("../math/vec2"),c=e("../math/polyk");e("poly-decomp");((v.exports=k).prototype=new a).constructor=k;var d=b.create(),f=b.create();k.prototype.projectOntoLocalAxis=function(q,r){for(var u,x=null,w=null,A=(q=d,0);A<this.vertices.length;A++)u=this.vertices[A],u=b.dot(u,q),(null===x||x<u)&&(x=u),(null===w||u<w)&&(w=u);x<w&&(q=w,w=x,
x=q);b.set(r,w,x)};k.prototype.projectOntoWorldAxis=function(q,r,u,x){var w=f;this.projectOntoLocalAxis(q,x);0!==u?b.rotate(w,q,u):w=q;q=b.dot(r,w);b.set(x,x[0]+q,x[1]+q)};k.prototype.updateTriangles=function(){for(var q=[],r=this.triangles.length=0;r<this.vertices.length;r++){var u=this.vertices[r];q.push(u[0],u[1])}q=c.Triangulate(q);for(r=0;r<q.length;r+=3)this.triangles.push([q[r],q[r+1],q[r+2]])};var g=b.create(),h=b.create();b.create();b.create();b.create();b.create();b.create();b.create();
b.create();k.prototype.updateCenterOfMass=function(){var q=this.triangles,r=this.vertices,u=this.centerOfMass;b.set(u,0,0);for(var x=0,w=0;w!==q.length;w++){var A=q[w];var C=r[A[0]];var L=r[A[1]];A=r[A[2]];b.centroid(g,C,L,A);C=k.triangleArea(C,L,A);x+=C;b.scale(h,g,C);b.add(u,u,h)}b.scale(u,u,1/x)};k.prototype.computeMomentOfInertia=function(q){for(var r=0,u=0,x=this.vertices.length,w=x-1,A=0;A<x;w=A,A++){w=this.vertices[w];var C=this.vertices[A],L=Math.abs(b.crossLength(w,C));r+=L*(b.dot(C,C)+b.dot(C,
w)+b.dot(w,w));u+=L}return q/6*(r/u)};k.prototype.updateBoundingRadius=function(){for(var q=this.vertices,r=0,u=0;u!==q.length;u++){var x=b.squaredLength(q[u]);r<x&&(r=x)}this.boundingRadius=Math.sqrt(r)};k.triangleArea=function(q,r,u){return.5*((r[0]-q[0])*(u[1]-q[1])-(u[0]-q[0])*(r[1]-q[1]))};k.prototype.updateArea=function(){this.updateTriangles();this.area=0;for(var q=this.triangles,r=this.vertices,u=0;u!==q.length;u++){var x=q[u];x=k.triangleArea(r[x[0]],r[x[1]],r[x[2]]);this.area+=x}};k.prototype.computeAABB=
function(q,r,u){q.setFromPoints(this.vertices,r,u,0)};var m=b.create(),n=b.create(),p=b.create();k.prototype.raycast=function(q,r,u,x){var w=this.vertices;b.toLocalFrame(m,r.from,u,x);b.toLocalFrame(n,r.to,u,x);u=w.length;for(var A=0;A<u&&!q.shouldStop(r);A++){var C=w[A],L=w[(A+1)%u],M=b.getLineSegmentsIntersectionFraction(m,n,C,L);0<=M&&(b.sub(p,L,C),b.rotate(p,p,-Math.PI/2+x),b.normalize(p,p),r.reportIntersection(q,M,p,A))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],
41:[function(e,v,l){function k(n,p){if(Array.isArray(n)){if(n={heights:n},"object"==typeof p)for(var q in p)n[q]=p[q];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}n=n||{};this.heights=n.heights?n.heights.slice(0):[];this.maxValue=n.maxValue||null;this.minValue=n.minValue||null;this.elementWidth=n.elementWidth||.1;void 0!==n.maxValue&&void 0!==n.minValue||this.updateMaxMinValues();n.type=a.HEIGHTFIELD;a.call(this,
n)}var a=e("./Shape"),b=e("../math/vec2");e("../utils/Utils");(((v.exports=k).prototype=new a).constructor=k).prototype.updateMaxMinValues=function(){for(var n=this.heights,p=n[0],q=n[0],r=0;r!==n.length;r++){var u=n[r];p<u&&(p=u);u<q&&(q=u)}this.maxValue=p;this.minValue=q};k.prototype.computeMomentOfInertia=function(n){return Number.MAX_VALUE};k.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};k.prototype.updateArea=function(){for(var n=this.heights,p=0,q=0;q<n.length-
1;q++)p+=(n[q]+n[q+1])/2*this.elementWidth;this.area=p};var c=[b.create(),b.create(),b.create(),b.create()];k.prototype.computeAABB=function(n,p,q){b.set(c[0],0,this.maxValue);b.set(c[1],this.elementWidth*this.heights.length,this.maxValue);b.set(c[2],this.elementWidth*this.heights.length,this.minValue);b.set(c[3],0,this.minValue);n.setFromPoints(c,p,q)};k.prototype.getLineSegment=function(n,p,q){var r=this.heights,u=this.elementWidth;b.set(n,q*u,r[q]);b.set(p,(q+1)*u,r[q+1])};k.prototype.getSegmentIndex=
function(n){return Math.floor(n[0]/this.elementWidth)};k.prototype.getClampedSegmentIndex=function(n){n=this.getSegmentIndex(n);return Math.min(this.heights.length,Math.max(n,0))};b.create();var d=b.create(),f=b.create(),g=b.create(),h=b.create(),m=b.create();b.fromValues(0,1);k.prototype.raycast=function(n,p,q,r){var u=p.from,x=p.to,w=(p.direction,d);b.toLocalFrame(h,u,q,r);b.toLocalFrame(m,x,q,r);this.getClampedSegmentIndex(h);this.getClampedSegmentIndex(m);for(q=0;q<this.heights.length-1&&!(this.getLineSegment(f,
g,q),u=b.getLineSegmentsIntersectionFraction(h,m,f,g),0<=u&&(b.sub(w,g,f),b.rotate(w,w,r+Math.PI/2),b.normalize(w,w),p.reportIntersection(n,u,w,-1),n.shouldStop(p)));q++);}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(e,v,l){function k(m){"number"==typeof m&&(m={length:m},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })"));m=m||{};this.length=m.length||1;m.type=a.LINE;a.call(this,m)}var a=e("./Shape"),b=
e("../math/vec2");(((v.exports=k).prototype=new a).constructor=k).prototype.computeMomentOfInertia=function(m){return m*Math.pow(this.length,2)/12};k.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var c=[b.create(),b.create()];k.prototype.computeAABB=function(m,n,p){var q=this.length/2;b.set(c[0],-q,0);b.set(c[1],q,0);m.setFromPoints(c,n,p,0)};b.create();var d=b.create(),f=b.create(),g=b.create(),h=b.fromValues(0,1);k.prototype.raycast=function(m,n,p,q){var r=n.from,
u=n.to,x=this.length/2;b.set(f,-x,0);b.set(g,x,0);b.toGlobalFrame(f,f,p,q);b.toGlobalFrame(g,g,p,q);p=b.getLineSegmentsIntersectionFraction(f,g,r,u);0<=p&&(b.rotate(d,h,q),n.reportIntersection(m,p,d,-1))}},{"../math/vec2":30,"./Shape":45}],43:[function(e,v,l){function k(c){(c=c||{}).type=a.PARTICLE;a.call(this,c)}var a=e("./Shape"),b=e("../math/vec2");(((v.exports=k).prototype=new a).constructor=k).prototype.computeMomentOfInertia=function(c){return 0};k.prototype.updateBoundingRadius=function(){this.boundingRadius=
0};k.prototype.computeAABB=function(c,d,f){b.copy(c.lowerBound,d);b.copy(c.upperBound,d)}},{"../math/vec2":30,"./Shape":45}],44:[function(e,v,l){function k(g){(g=g||{}).type=a.PLANE;a.call(this,g)}var a=e("./Shape"),b=e("../math/vec2");e("../utils/Utils");(((v.exports=k).prototype=new a).constructor=k).prototype.computeMomentOfInertia=function(g){return 0};k.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};k.prototype.computeAABB=function(g,h,m){h=m%(2*Math.PI);m=b.set;
var n=g.lowerBound;g=g.upperBound;m(n,-1E7,-1E7);m(g,1E7,1E7);0===h?g[1]=0:h===Math.PI/2?n[0]=0:h===Math.PI?n[1]=0:h===3*Math.PI/2&&(g[0]=0)};k.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var c=b.create(),d=(b.create(),b.create(),b.create()),f=b.create();k.prototype.raycast=function(g,h,m,n){var p=h.from,q=h.to,r=h.direction;b.set(d,0,1);b.rotate(d,d,n);b.sub(f,p,m);n=b.dot(f,d);(b.sub(f,q,m),0<n*b.dot(f,d)||b.squaredDistance(p,q)<n*n)||(q=b.dot(d,r),b.sub(c,p,m),m=-b.dot(d,c)/q/h.length,
h.reportIntersection(g,m,d,-1))}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(e,v,l){function k(b){b=b||{};this.body=null;this.position=a.fromValues(0,0);b.position&&a.copy(this.position,b.position);this.angle=b.angle||0;this.type=b.type||0;this.id=k.idCounter++;this.boundingRadius=0;this.collisionGroup=void 0!==b.collisionGroup?b.collisionGroup:1;this.collisionResponse=void 0===b.collisionResponse||b.collisionResponse;this.collisionMask=void 0!==b.collisionMask?b.collisionMask:
1;this.material=b.material||null;this.area=0;this.sensor=void 0!==b.sensor&&b.sensor;this.type&&this.updateBoundingRadius();this.updateArea()}v.exports=k;var a=e("../math/vec2");k.idCounter=0;k.CIRCLE=1;k.PARTICLE=2;k.PLANE=4;k.CONVEX=8;k.LINE=16;k.BOX=32;k.CAPSULE=64;k.HEIGHTFIELD=128;k.prototype.computeMomentOfInertia=function(b){};k.prototype.updateBoundingRadius=function(){};k.prototype.updateArea=function(){};k.prototype.computeAABB=function(b,c,d){};k.prototype.raycast=function(b,c,d,f){}},
{"../math/vec2":30}],46:[function(e,v,l){function k(f){b.call(this,f,b.GS);f=f||{};this.iterations=f.iterations||10;this.tolerance=f.tolerance||1E-7;this.arrayStep=30;this.lambda=new c.ARRAY_TYPE(this.arrayStep);this.Bs=new c.ARRAY_TYPE(this.arrayStep);this.invCs=new c.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=!1;this.frictionIterations=void 0!==f.frictionIterations?0:f.frictionIterations;this.usedIterations=0}var a=e("../math/vec2"),b=e("./Solver"),c=e("../utils/Utils"),d=e("../equations/FrictionEquation");
(((v.exports=k).prototype=new b).constructor=k).prototype.solve=function(f,g){this.sortEquations();var h,m=this.iterations,n=this.frictionIterations,p=this.equations,q=p.length,r=Math.pow(this.tolerance*q,2),u=g.bodies;g=g.bodies.length;var x=(a.add,a.set,this.useZeroRHS),w=this.lambda;if(this.usedIterations=0,q)for(var A=0;A!==g;A++)u[A].updateSolveMassProperties();w.length<q&&(w=this.lambda=new c.ARRAY_TYPE(q+this.arrayStep),this.Bs=new c.ARRAY_TYPE(q+this.arrayStep),this.invCs=new c.ARRAY_TYPE(q+
this.arrayStep));for(var C=w.length;C--;)w[C]=0;var L;C=this.invCs;var M=this.Bs;w=this.lambda;for(A=0;A!==p.length;A++){var P;((P=p[A]).timeStep!==f||P.needsUpdate)&&(P.timeStep=f,P.update());M[A]=P.computeB(P.a,P.b,f);C[A]=P.computeInvC(P.epsilon)}if(0!==q){for(A=0;A!==g;A++)u[A].resetConstraintVelocity();if(n){for(h=0;h!==n;h++){for(A=L=0;A!==q;A++)P=p[A],P=k.iterateEquation(A,P,P.epsilon,M,C,w,x,f,h),L+=Math.abs(P);if(this.usedIterations++,L*L<=r)break}k.updateMultipliers(p,w,1/f);for(A=0;A!==
q;A++)if(n=p[A],n instanceof d){for(h=P=0;h!==n.contactEquations.length;h++)P+=n.contactEquations[h].multiplier;P*=n.frictionCoefficient/n.contactEquations.length;n.maxForce=P;n.minForce=-P}}for(h=0;h!==m;h++){for(A=L=0;A!==q;A++)P=p[A],P=k.iterateEquation(A,P,P.epsilon,M,C,w,x,f,h),L+=Math.abs(P);if(this.usedIterations++,L*L<=r)break}for(A=0;A!==g;A++)u[A].addConstraintVelocity();k.updateMultipliers(p,w,1/f)}};k.updateMultipliers=function(f,g,h){for(var m=f.length;m--;)f[m].multiplier=g[m]*h};k.iterateEquation=
function(f,g,h,m,n,p,q,r,u){var x=m[f],w=n[f];n=p[f];var A=g.computeGWlambda();m=g.maxForce;u=g.minForce;q&&(x=0);h=w*(x-A-h*n);q=n+h;return q<u*r?h=u*r-n:m*r<q&&(h=m*r-n),p[f]+=h,g.addToWlambda(h),h}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(e,v,l){function k(c,d){c=c||{};a.call(this);this.type=d;this.equations=[];this.equationSortFunction=c.equationSortFunction||!1}e("../utils/Utils");var a=e("../events/EventEmitter");(((v.exports=k).prototype=
new a).constructor=k).prototype.solve=function(c,d){throw Error("Solver.solve should be implemented by subclasses!");};var b={bodies:[]};k.prototype.solveIsland=function(c,d){this.removeAllEquations();d.equations.length&&(this.addEquations(d.equations),b.bodies.length=0,d.getBodies(b.bodies),b.bodies.length&&this.solve(c,b))};k.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)};k.prototype.addEquation=function(c){c.enabled&&this.equations.push(c)};
k.prototype.addEquations=function(c){for(var d=0,f=c.length;d!==f;d++){var g=c[d];g.enabled&&this.equations.push(g)}};k.prototype.removeEquation=function(c){c=this.equations.indexOf(c);-1!==c&&this.equations.splice(c,1)};k.prototype.removeAllEquations=function(){this.equations.length=0};k.GS=1;k.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(e,v,l){function k(){b.apply(this,arguments)}var a=e("../equations/ContactEquation"),b=e("./Pool");(((v.exports=k).prototype=new b).constructor=
k).prototype.create=function(){return new a};k.prototype.destroy=function(c){return c.bodyA=c.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(e,v,l){function k(){b.apply(this,arguments)}var a=e("../equations/FrictionEquation"),b=e("./Pool");(((v.exports=k).prototype=new b).constructor=k).prototype.create=function(){return new a};k.prototype.destroy=function(c){return c.bodyA=c.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(e,v,l){function k(){b.apply(this,
arguments)}var a=e("../world/IslandNode"),b=e("./Pool");(((v.exports=k).prototype=new b).constructor=k).prototype.create=function(){return new a};k.prototype.destroy=function(c){return c.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(e,v,l){function k(){b.apply(this,arguments)}var a=e("../world/Island"),b=e("./Pool");(((v.exports=k).prototype=new b).constructor=k).prototype.create=function(){return new a};k.prototype.destroy=function(c){return c.reset(),this}},{"../world/Island":58,
"./Pool":55}],52:[function(e,v,l){function k(){this.overlappingShapesLastState=new a;this.overlappingShapesCurrentState=new a;this.recordPool=new b({size:16});this.tmpDict=new a;this.tmpArray1=[]}var a=e("./TupleDictionary"),b=(e("./OverlapKeeperRecord"),e("./OverlapKeeperRecordPool"));e("./Utils");(v.exports=k).prototype.tick=function(){for(var c=this.overlappingShapesLastState,d=this.overlappingShapesCurrentState,f=c.keys.length;f--;){var g=c.keys[f],h=c.getByKey(g);d.getByKey(g);h&&this.recordPool.release(h)}c.reset();
c.copy(d);d.reset()};k.prototype.setOverlapping=function(c,d,f,g){this.overlappingShapesLastState;var h=this.overlappingShapesCurrentState;if(!h.get(d.id,g.id)){var m=this.recordPool.get();m.set(c,d,f,g);h.set(d.id,g.id,m)}};k.prototype.getNewOverlaps=function(c){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,c)};k.prototype.getEndOverlaps=function(c){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,c)};k.prototype.bodiesAreOverlapping=
function(c,d){for(var f=this.overlappingShapesCurrentState,g=f.keys.length;g--;){var h=f.data[f.keys[g]];if(h.bodyA===c&&h.bodyB===d||h.bodyA===d&&h.bodyB===c)return!0}return!1};k.prototype.getDiff=function(c,d,f){(f=f||[]).length=0;for(var g=d.keys.length;g--;){var h=d.keys[g],m=d.data[h];if(!m)throw Error("Key "+h+" had no data!");c.data[h]||f.push(m)}return f};k.prototype.isNewOverlap=function(c,d){c=0|c.id;d=0|d.id;var f=this.overlappingShapesCurrentState;return!this.overlappingShapesLastState.get(c,
d)&&!!f.get(c,d)};k.prototype.getNewBodyOverlaps=function(c){this.tmpArray1.length=0;var d=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(d,c)};k.prototype.getEndBodyOverlaps=function(c){this.tmpArray1.length=0;var d=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(d,c)};k.prototype.getBodyDiff=function(c,d){d=d||[];for(var f=this.tmpDict,g=c.length;g--;){var h=c[g];f.set(0|h.bodyA.id,0|h.bodyB.id,h)}for(g=f.keys.length;g--;)(h=f.getByKey(f.keys[g]))&&d.push(h.bodyA,h.bodyB);
return f.reset(),d}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(e,v,l){function k(a,b,c,d){this.shapeA=b;this.shapeB=d;this.bodyA=a;this.bodyB=c}(v.exports=k).prototype.set=function(a,b,c,d){k.call(this,a,b,c,d)}},{}],54:[function(e,v,l){function k(){b.apply(this,arguments)}var a=e("./OverlapKeeperRecord"),b=e("./Pool");(((v.exports=k).prototype=new b).constructor=k).prototype.create=function(){return new a};k.prototype.destroy=function(c){return c.bodyA=
c.bodyB=c.shapeA=c.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(e,v,l){function k(a){a=a||{};this.objects=[];void 0!==a.size&&this.resize(a.size)}(v.exports=k).prototype.resize=function(a){for(var b=this.objects;b.length>a;)b.pop();for(;b.length<a;)b.push(this.create());return this};k.prototype.get=function(){var a=this.objects;return a.length?a.pop():this.create()};k.prototype.release=function(a){return this.destroy(a),this.objects.push(a),this}},{}],56:[function(e,v,
l){function k(){this.data={};this.keys=[]}var a=e("./Utils");(v.exports=k).prototype.getKey=function(b,c){return(0|(b|=0))==(0|(c|=0))?-1:0|((0|c)<(0|b)?b<<16|65535&c:c<<16|65535&b)};k.prototype.getByKey=function(b){return b|=0,this.data[b]};k.prototype.get=function(b,c){return this.data[this.getKey(b,c)]};k.prototype.set=function(b,c,d){if(!d)throw Error("No data!");b=this.getKey(b,c);return this.data[b]||this.keys.push(b),this.data[b]=d,b};k.prototype.reset=function(){for(var b=this.data,c=this.keys,
d=c.length;d--;)delete b[c[d]];c.length=0};k.prototype.copy=function(b){this.reset();a.appendArray(this.keys,b.keys);for(var c=b.keys.length;c--;){var d=b.keys[c];this.data[d]=b.data[d]}}},{"./Utils":57}],57:[function(e,v,l){function k(){}(v.exports=k).appendArray=function(a,b){if(15E4>b.length)a.push.apply(a,b);else for(var c=0,d=b.length;c!==d;++c)a.push(b[c])};k.splice=function(a,b,c){c=c||1;for(var d=a.length-c;b<d;b++)a[b]=a[b+c];a.length=d};k.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:
"undefined"!=typeof Float32Array?Float32Array:Array;k.extend=function(a,b){for(var c in b)a[c]=b[c]};k.defaults=function(a,b){for(var c in a=a||{},b)c in a||(a[c]=b[c]);return a}},{}],58:[function(e,v,l){function k(){this.equations=[];this.bodies=[]}var a=e("../objects/Body");(v.exports=k).prototype.reset=function(){this.equations.length=this.bodies.length=0};var b=[];k.prototype.getBodies=function(c){c=c||[];for(var d=this.equations,f=b.length=0;f!==d.length;f++){var g=d[f];-1===b.indexOf(g.bodyA.id)&&
(c.push(g.bodyA),b.push(g.bodyA.id));-1===b.indexOf(g.bodyB.id)&&(c.push(g.bodyB),b.push(g.bodyB.id))}return c};k.prototype.wantsToSleep=function(){for(var c=0;c<this.bodies.length;c++){var d=this.bodies[c];if(d.type===a.DYNAMIC&&!d.wantsToSleep)return!1}return!0};k.prototype.sleep=function(){for(var c=0;c<this.bodies.length;c++)this.bodies[c].sleep();return!0}},{"../objects/Body":31}],59:[function(e,v,l){function k(d){this.nodePool=new a({size:16});this.islandPool=new b({size:8});this.equations=
[];this.islands=[];this.nodes=[];this.queue=[]}e("../math/vec2");e("./Island");e("./IslandNode");var a=e("./../utils/IslandNodePool"),b=e("./../utils/IslandPool"),c=e("../objects/Body");(v.exports=k).getUnvisitedNode=function(d){for(var f=d.length,g=0;g!==f;g++){var h=d[g];if(!h.visited&&h.body.type===c.DYNAMIC)return h}return!1};k.prototype.visit=function(d,f,g){f.push(d.body);f=d.equations.length;for(var h=0;h!==f;h++){var m=d.equations[h];-1===g.indexOf(m)&&g.push(m)}};k.prototype.bfs=function(d,
f,g){var h=this.queue;h.length=0;h.push(d);d.visited=!0;for(this.visit(d,f,g);h.length;)for(var m=h.pop();d=k.getUnvisitedNode(m.neighbors);)d.visited=!0,this.visit(d,f,g),d.body.type===c.DYNAMIC&&h.push(d)};k.prototype.split=function(d){var f=d.bodies;d=this.nodes;for(var g=this.equations;d.length;)this.nodePool.release(d.pop());for(var h=0;h!==f.length;h++){var m=this.nodePool.get();m.body=f[h];d.push(m)}for(m=0;m!==g.length;m++){var n=g[m],p=(h=f.indexOf(n.bodyA),f.indexOf(n.bodyB));h=d[h];p=d[p];
h.neighbors.push(p);p.neighbors.push(h);h.equations.push(n);p.equations.push(n)}f=this.islands;for(h=0;h<f.length;h++)this.islandPool.release(f[h]);for(f.length=0;g=k.getUnvisitedNode(d);)h=this.islandPool.get(),this.bfs(g,h.bodies,h.equations),f.push(h);return f}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(e,v,l){(v.exports=function(k){this.body=k;this.neighbors=[];this.equations=[];this.visited=
!1}).prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=!1;this.body=null}},{}],61:[function(e,v,l){function k(E){m.apply(this);E=E||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=E.solver||new a;this.narrowphase=new u(this);this.islandManager=new A;this.gravity=b.fromValues(0,-9.78);E.gravity&&b.copy(this.gravity,E.gravity);this.frictionGravity=b.length(this.gravity)||10;this.useFrictionGravityOnZeroGravity=this.useWorldGravityAsFrictionGravity=
!0;this.broadphase=E.broadphase||new r;this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new p;this.defaultContactMaterial=new q(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.solveConstraints=this.applyGravity=this.applyDamping=this.applySpringForces=!0;this.contactMaterials=[];this.accumulator=this.time=0;this.stepping=!1;this.bodiesToBeRemoved=[];this.islandSplit=void 0===E.islandSplit||!!E.islandSplit;this.emitImpactEvent=!0;this._bodyIdCounter=this._constraintIdCounter=
0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=k.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent=
{type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new w}var a=e("../solver/GSSolver"),b=(e("../solver/Solver"),e("../collision/Ray"),e("../math/vec2")),c=e("../shapes/Circle"),d=e("../shapes/Convex"),f=(e("../shapes/Line"),e("../shapes/Plane")),g=e("../shapes/Capsule"),h=e("../shapes/Particle"),m=
e("../events/EventEmitter"),n=e("../objects/Body"),p=(e("../shapes/Shape"),e("../objects/LinearSpring"),e("../material/Material")),q=e("../material/ContactMaterial");l=(e("../constraints/DistanceConstraint"),e("../constraints/Constraint"),e("../constraints/LockConstraint"),e("../constraints/RevoluteConstraint"),e("../constraints/PrismaticConstraint"),e("../constraints/GearConstraint"),e("../../package.json"),e("../collision/Broadphase"),e("../collision/AABB"));var r=e("../collision/SAPBroadphase"),
u=e("../collision/Narrowphase"),x=e("../utils/Utils"),w=e("../utils/OverlapKeeper"),A=e("./IslandManager");e("../objects/RotationalSpring");(((v.exports=k).prototype=Object(m.prototype)).constructor=k).NO_SLEEPING=1;k.BODY_SLEEPING=2;k.ISLAND_SLEEPING=4;k.prototype.addConstraint=function(E){this.constraints.push(E)};k.prototype.addContactMaterial=function(E){this.contactMaterials.push(E)};k.prototype.removeContactMaterial=function(E){E=this.contactMaterials.indexOf(E);-1!==E&&x.splice(this.contactMaterials,
E,1)};k.prototype.getContactMaterial=function(E,F){for(var B=this.contactMaterials,I=0,X=B.length;I!==X;I++){var U=B[I];if(U.materialA.id===E.id&&U.materialB.id===F.id||U.materialA.id===F.id&&U.materialB.id===E.id)return U}return!1};k.prototype.removeConstraint=function(E){E=this.constraints.indexOf(E);-1!==E&&x.splice(this.constraints,E,1)};b.create();b.create();b.create();b.create();b.create();b.create();var C=b.create(),L=b.fromValues(0,0),M=b.fromValues(0,0);b.fromValues(0,0);b.fromValues(0,0);
k.prototype.step=function(E,F,B){if(B=B||10,0===(F=F||0))this.internalStep(E),this.time+=E;else{this.accumulator+=F;for(F=0;this.accumulator>=E&&F<B;)this.internalStep(E),this.time+=E,this.accumulator-=E,F++;E=this.accumulator%E/E;for(B=0;B!==this.bodies.length;B++)F=this.bodies[B],b.lerp(F.interpolatedPosition,F.previousPosition,F.position,E),F.interpolatedAngle=F.previousAngle+E*(F.angle-F.previousAngle)}};var P=[];k.prototype.internalStep=function(E){this.stepping=!0;var F=this.springs.length,
B=this.springs,I=this.bodies,X=this.gravity,U=this.solver,ia=this.bodies.length,la=this.broadphase,ma=this.narrowphase,ka=this.constraints,pa=(b.scale,b.add),ta=(b.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=E,this.useWorldGravityAsFrictionGravity){var O=b.length(this.gravity);0===O&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=O)}if(this.applyGravity)for(O=0;O!==ia;O++){var ua=(ra=I[O]).force;ra.type===n.DYNAMIC&&ra.sleepState!==n.SLEEPING&&(b.scale(C,
X,ra.mass*ra.gravityScale),pa(ua,ua,C))}if(this.applySpringForces)for(O=0;O!==F;O++)B[O].applyForce();if(this.applyDamping)for(O=0;O!==ia;O++){var ra;(ra=I[O]).type===n.DYNAMIC&&ra.applyDamping(E)}F=la.getCollisionPairs(this);X=this.disabledBodyCollisionPairs;for(O=X.length-2;0<=O;O-=2)for(B=F.length-2;0<=B;B-=2)(X[O]===F[B]&&X[O+1]===F[B+1]||X[O+1]===F[B]&&X[O]===F[B+1])&&F.splice(B,2);X=ka.length;for(O=0;O!==X;O++)if(la=ka[O],!la.collideConnected)for(B=F.length-2;0<=B;B-=2)(la.bodyA===F[B]&&la.bodyB===
F[B+1]||la.bodyB===F[B]&&la.bodyA===F[B+1])&&F.splice(B,2);this.postBroadphaseEvent.pairs=F;this.emit(this.postBroadphaseEvent);this.postBroadphaseEvent.pairs=null;ma.reset(this);O=0;for(X=F.length;O!==X;O+=2)for(la=F[O],pa=F[O+1],ra=0,ua=la.shapes.length;ra!==ua;ra++){var xa=la.shapes[ra],Ta=xa.position,Ua=xa.angle;B=0;for(var Va=pa.shapes.length;B!==Va;B++){var Ea=pa.shapes[B],Ma=Ea.position,Ca=Ea.angle,Ba=this.defaultContactMaterial;if(xa.material&&Ea.material){var La=this.getContactMaterial(xa.material,
Ea.material);La&&(Ba=La)}this.runNarrowphase(ma,la,xa,Ta,Ua,pa,Ea,Ma,Ca,Ba,this.frictionGravity)}}for(O=0;O!==ia;O++)(wa=I[O])._wakeUpAfterNarrowphase&&(wa.wakeUp(),wa._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(P);O=this.endContactEvent;for(B=P.length;B--;)wa=P[B],O.shapeA=wa.shapeA,O.shapeB=wa.shapeB,O.bodyA=wa.bodyA,O.bodyB=wa.bodyB,this.emit(O);P.length=0}O=this.preSolveEvent;O.contactEquations=ma.contactEquations;O.frictionEquations=ma.frictionEquations;
this.emit(O);O.contactEquations=O.frictionEquations=null;X=ka.length;for(O=0;O!==X;O++)ka[O].update();if(ma.contactEquations.length||ma.frictionEquations.length||X)if(this.islandSplit){ta.equations.length=0;x.appendArray(ta.equations,ma.contactEquations);x.appendArray(ta.equations,ma.frictionEquations);for(O=0;O!==X;O++)x.appendArray(ta.equations,ka[O].equations);ta.split(this);for(O=0;O!==ta.islands.length;O++)(Fa=ta.islands[O]).equations.length&&U.solveIsland(E,Fa)}else{U.addEquations(ma.contactEquations);
U.addEquations(ma.frictionEquations);for(O=0;O!==X;O++)U.addEquations(ka[O].equations);this.solveConstraints&&U.solve(E,this);U.removeAllEquations()}for(O=0;O!==ia;O++){var wa;I[O].integrate(E)}for(O=0;O!==ia;O++)I[O].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(U=this.impactEvent,O=0;O!==ma.contactEquations.length;O++)ka=ma.contactEquations[O],ka.firstImpact&&(U.bodyA=ka.bodyA,U.bodyB=ka.bodyB,U.shapeA=ka.shapeA,U.shapeB=ka.shapeB,U.contactEquation=ka,this.emit(U));if(this.sleepMode===
k.BODY_SLEEPING)for(O=0;O!==ia;O++)I[O].sleepTick(this.time,!1,E);else if(this.sleepMode===k.ISLAND_SLEEPING&&this.islandSplit){for(O=0;O!==ia;O++)I[O].sleepTick(this.time,!0,E);for(O=0;O<this.islandManager.islands.length;O++){var Fa;(Fa=this.islandManager.islands[O]).wantsToSleep()&&Fa.sleep()}}this.stepping=!1;E=this.bodiesToBeRemoved;for(O=0;O!==E.length;O++)this.removeBody(E[O]);E.length=0;this.emit(this.postStepEvent)};k.prototype.runNarrowphase=function(E,F,B,I,X,U,ia,la,ma,ka,pa){if(0!=(B.collisionGroup&
ia.collisionMask)&&0!=(ia.collisionGroup&B.collisionMask)&&(b.rotate(L,I,F.angle),b.rotate(M,la,U.angle),b.add(L,L,F.position),b.add(M,M,U.position),I=X+F.angle,ma+=U.angle,E.enableFriction=0<ka.friction,E.frictionCoefficient=ka.friction,E.slipForce=ka.friction*pa*(F.type===n.STATIC||F.type===n.KINEMATIC?U.mass:U.type===n.STATIC||U.type===n.KINEMATIC?F.mass:F.mass*U.mass/(F.mass+U.mass)),E.restitution=ka.restitution,E.surfaceVelocity=ka.surfaceVelocity,E.frictionStiffness=ka.frictionStiffness,E.frictionRelaxation=
ka.frictionRelaxation,E.stiffness=ka.stiffness,E.relaxation=ka.relaxation,E.contactSkinSize=ka.contactSkinSize,E.enabledEquations=F.collisionResponse&&U.collisionResponse&&B.collisionResponse&&ia.collisionResponse,ka=E[B.type|ia.type])&&(X=B.sensor||ia.sensor,pa=E.frictionEquations.length,ka=B.type<ia.type?ka.call(E,F,B,L,I,U,ia,M,ma,X):ka.call(E,U,ia,M,ma,F,B,L,I,X),pa=E.frictionEquations.length-pa,ka)){F.allowSleep&&F.type===n.DYNAMIC&&F.sleepState===n.SLEEPING&&U.sleepState===n.AWAKE&&U.type!==
n.STATIC&&(I=b.squaredLength(U.velocity)+Math.pow(U.angularVelocity,2),2*Math.pow(U.sleepSpeedLimit,2)<=I&&(F._wakeUpAfterNarrowphase=!0));U.allowSleep&&U.type===n.DYNAMIC&&U.sleepState===n.SLEEPING&&F.sleepState===n.AWAKE&&F.type!==n.STATIC&&(I=b.squaredLength(F.velocity)+Math.pow(F.angularVelocity,2),2*Math.pow(F.sleepSpeedLimit,2)<=I&&(U._wakeUpAfterNarrowphase=!0));if(this.overlapKeeper.setOverlapping(F,B,U,ia),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(B,ia)){I=this.beginContactEvent;
if(I.shapeA=B,I.shapeB=ia,I.bodyA=F,I.bodyB=U,I.contactEquations.length=0,"number"==typeof ka)for(F=E.contactEquations.length-ka;F<E.contactEquations.length;F++)I.contactEquations.push(E.contactEquations[F]);this.emit(I)}if("number"==typeof ka&&1<pa)for(F=E.frictionEquations.length-pa;F<E.frictionEquations.length;F++)B=E.frictionEquations[F],B.setSlipForce(B.getSlipForce()/pa)}};k.prototype.addSpring=function(E){this.springs.push(E);var F=this.addSpringEvent;F.spring=E;this.emit(F);F.spring=null};
k.prototype.removeSpring=function(E){E=this.springs.indexOf(E);-1!==E&&x.splice(this.springs,E,1)};k.prototype.addBody=function(E){if(-1===this.bodies.indexOf(E)){this.bodies.push(E);var F=(E.world=this).addBodyEvent;F.body=E;this.emit(F);F.body=null}};k.prototype.removeBody=function(E){if(this.stepping)this.bodiesToBeRemoved.push(E);else{E.world=null;var F=this.bodies.indexOf(E);-1!==F&&(x.splice(this.bodies,F,1),(this.removeBodyEvent.body=E).resetConstraintVelocity(),this.emit(this.removeBodyEvent),
this.removeBodyEvent.body=null)}};k.prototype.getBodyById=function(E){for(var F=this.bodies,B=0;B<F.length;B++){var I=F[B];if(I.id===E)return I}return!1};k.prototype.disableBodyCollision=function(E,F){this.disabledBodyCollisionPairs.push(E,F)};k.prototype.enableBodyCollision=function(E,F){for(var B=this.disabledBodyCollisionPairs,I=0;I<B.length;I+=2)if(B[I]===E&&B[I+1]===F||B[I+1]===E&&B[I]===F)return void B.splice(I,2)};k.prototype.clear=function(){this.time=0;this.solver&&this.solver.equations.length&&
this.solver.removeAllEquations();for(var E=this.constraints,F=E.length-1;0<=F;F--)this.removeConstraint(E[F]);E=this.bodies;for(F=E.length-1;0<=F;F--)this.removeBody(E[F]);E=this.springs;for(F=E.length-1;0<=F;F--)this.removeSpring(E[F]);E=this.contactMaterials;for(F=E.length-1;0<=F;F--)this.removeContactMaterial(E[F]);k.apply(this)};var V=b.create(),aa=(b.fromValues(0,0),b.fromValues(0,0));k.prototype.hitTest=function(E,F,B){B=B||0;var I=new n({position:E}),X=new h;I.addShape(X);for(var U=this.narrowphase,
ia=[],la=0,ma=F.length;la!==ma;la++)for(var ka=F[la],pa=0,ta=ka.shapes.length;pa!==ta;pa++){var O=ka.shapes[pa];b.rotate(V,O.position,ka.angle);b.add(V,V,ka.position);var ua=O.angle+ka.angle;(O instanceof c&&U.circleParticle(ka,O,V,ua,I,X,E,0,!0)||O instanceof d&&U.particleConvex(I,X,E,0,ka,O,V,ua,!0)||O instanceof f&&U.particlePlane(I,X,E,0,ka,O,V,ua,!0)||O instanceof g&&U.particleCapsule(I,X,E,0,ka,O,V,ua,!0)||O instanceof h&&b.squaredLength(b.sub(aa,V,E))<B*B)&&ia.push(ka)}return ia};k.prototype.setGlobalStiffness=
function(E){for(var F=this.constraints,B=0;B!==F.length;B++)for(var I=F[B],X=0;X!==I.equations.length;X++){var U=I.equations[X];U.stiffness=E;U.needsUpdate=!0}F=this.contactMaterials;for(B=0;B!==F.length;B++)(I=F[B]).stiffness=I.frictionStiffness=E;(I=this.defaultContactMaterial).stiffness=I.frictionStiffness=E};k.prototype.setGlobalRelaxation=function(E){for(var F=0;F!==this.constraints.length;F++)for(var B=this.constraints[F],I=0;I!==B.equations.length;I++){var X=B.equations[I];X.relaxation=E;X.needsUpdate=
!0}for(F=0;F!==this.contactMaterials.length;F++)(B=this.contactMaterials[F]).relaxation=B.frictionRelaxation=E;(B=this.defaultContactMaterial).relaxation=B.frictionRelaxation=E};var ja=new l,W=[];k.prototype.raycast=function(E,F){return F.getAABB(ja),this.broadphase.aabbQuery(this,ja,W),F.intersectBodies(E,W),W.length=0,E.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,
"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,
"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});
(function(){function t(l,k,a,b,c){var d,f,g=l.createFramebuffer(),h=l.createRenderbuffer(),m=null;return l.activeTexture(l.TEXTURE0+c),l.bindFramebuffer(l.FRAMEBUFFER,g),l.bindRenderbuffer(l.RENDERBUFFER,h),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,this.renderBuffer),f=l.createTexture(),l.bindTexture(l.TEXTURE_2D,f),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,
l.TEXTURE_MAG_FILTER,b===e.scaleModes.LINEAR?l.LINEAR:l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,b===e.scaleModes.LINEAR?l.LINEAR:l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,a,0,l.RGBA,l.UNSIGNED_BYTE,null),m=f,l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,m,0),(d=l.checkFramebufferStatus(l.FRAMEBUFFER))!==l.FRAMEBUFFER_COMPLETE&&console.error("Incomplete GL framebuffer. ",v[d]),g.width=k,g.height=a,g.targetTexture=m,g.renderBuffer=h,g}var e=e||{};e.DisplayObject=
function(){this.position=new e.Point(0,0);this.scale=new e.Point(1,1);this.pivot=new e.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.renderable=!1;this.parent=null;this.worldAlpha=1;this.worldTransform=new Phaser.Matrix;this.worldPosition=new e.Point(0,0);this.worldScale=new e.Point(1,1);this.worldRotation=0;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new e.Rectangle(0,0,0,0);this._mask=this._currentBounds=null;this._cacheIsDirty=this._cacheAsBitmap=!1};
e.DisplayObject.prototype={constructor:e.DisplayObject,destroy:function(){if(this.children){for(var l=this.children.length;l--;)this.children[l].destroy();this.children=[]}this.filterArea=this.worldTransform=this.parent=this.hitArea=null;this.renderable=!1;this._mask=this._currentBounds=this._bounds=null;this._destroyCachedSprite();this._destroyTintedTexture()},updateTransform:function(l){if(!l&&!this.parent&&!this.game)return this;var k=this.parent;l?k=l:this.parent||(k=this.game.world);var a,b,
c,d,f,g;l=k.worldTransform;var h=this.worldTransform;this.rotation%Phaser.Math.PI2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),a=this._cr*this.scale.x,b=this._sr*this.scale.x,c=-this._sr*this.scale.y,d=this._cr*this.scale.y,f=this.position.x,g=this.position.y,(this.pivot.x||this.pivot.y)&&(f-=this.pivot.x*a+this.pivot.y*c,g-=this.pivot.x*b+this.pivot.y*d),h.a=a*l.a+b*l.c,h.b=a*l.b+b*l.d,h.c=c*l.a+d*l.c,h.d=
c*l.b+d*l.d):(a=this.scale.x,d=this.scale.y,f=this.position.x-this.pivot.x*a,g=this.position.y-this.pivot.y*d,h.a=a*l.a,h.b=a*l.b,h.c=d*l.c,h.d=d*l.d);h.tx=f*l.a+g*l.c+l.tx;h.ty=f*l.b+g*l.d+l.ty;a=h.a;b=h.b;c=h.c;f=a*(d=h.d)-b*c;a||b?(c=Math.sqrt(a*a+b*b),this.worldRotation=0<b?Math.acos(a/c):-Math.acos(a/c),this.worldScale.x=c,this.worldScale.y=f/c):c||d?(a=Math.sqrt(c*c+d*d),this.worldRotation=Phaser.Math.HALF_PI-(0<d?Math.acos(-c/a):-Math.acos(c/a)),this.worldScale.x=f/a,this.worldScale.y=a):(this.worldScale.x=
0,this.worldScale.y=0);return this.worldAlpha=this.alpha*k.worldAlpha,this.worldPosition.x=h.tx,this.worldPosition.y=h.ty,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,h,l),this},preUpdate:function(){},generateTexture:function(l,k,a){var b=this.getLocalBounds();l=new Phaser.RenderTexture(this.game,0|b.width,0|b.height,a,k,l);return e.DisplayObject._tempMatrix.tx=-b.x,e.DisplayObject._tempMatrix.ty=-b.y,l.render(this,e.DisplayObject._tempMatrix),
l},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(l){return this.updateTransform(),this.worldTransform.apply(l)},toLocal:function(l,k){return k&&(l=k.toGlobal(l)),this.updateTransform(),this.worldTransform.applyInverse(l)},_renderCachedSprite:function(l){this._cachedSprite.worldAlpha=this.worldAlpha;l.gl?e.Sprite.prototype._renderWebGL.call(this._cachedSprite,l):e.Sprite.prototype._renderCanvas.call(this._cachedSprite,l)},_generateCachedSprite:function(){this._cacheAsBitmap=
!1;var l=this.getLocalBounds();if(l.width=Math.max(1,Math.ceil(l.width)),l.height=Math.max(1,Math.ceil(l.height)),this.updateTransform(),this._cachedSprite)this._cachedSprite.texture.resize(l.width,l.height);else{var k=0;this.texture&&this.texture.baseTexture&&e._enableMultiTextureToggle&&(k=this.texture.baseTexture.textureIndex);k=new Phaser.RenderTexture(this.game,l.width,l.height,void 0,void 0,void 0,void 0,k);this._cachedSprite=new e.Sprite(k);this._cachedSprite.worldTransform=this.worldTransform}k=
this._filters;this._filters=null;this._cachedSprite.filters=k;e.DisplayObject._tempMatrix.tx=-l.x;e.DisplayObject._tempMatrix.ty=-l.y;this._cachedSprite.texture.render(this,e.DisplayObject._tempMatrix,!0);this._cachedSprite.anchor.x=-l.x/l.width;this._cachedSprite.anchor.y=-l.y/l.height;this._filters=k;this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},_destroyTintedTexture:function(){this.tintedTexture&&(Phaser.CanvasPool.removeByCanvas(this.tintedTexture),
this.tintedTexture=null)}};e.DisplayObject.prototype.displayObjectUpdateTransform=e.DisplayObject.prototype.updateTransform;Object.defineProperties(e.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(l){this.position.x=l}},y:{get:function(){return this.position.y},set:function(l){this.position.y=l}},worldVisible:{get:function(){if(this.visible){var l=this.parent;if(!l)return this.visible;do{if(!l.visible)return!1;l=l.parent}while(l);return!0}return!1}},mask:{get:function(){return this._mask},
set:function(l){this._mask&&(this._mask.isMask=!1);(this._mask=l)&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(l){if(Array.isArray(l)){for(var k=[],a=0;a<l.length;a++)for(var b=l[a].passes,c=0;c<b.length;c++)k.push(b[c]);this._filterBlock={target:this,filterPasses:k}}this._filters=l;this.blendMode&&this.blendMode===e.blendModes.MULTIPLY&&(this.blendMode=e.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(l){this._cacheAsBitmap!==
l&&(l?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=l)}}});e.DisplayObjectContainer=function(){e.DisplayObject.call(this);this.children=[];this.ignoreChildInput=!1};e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype);e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer;e.DisplayObjectContainer.prototype.addChild=function(l){return this.addChildAt(l,this.children.length)};e.DisplayObjectContainer.prototype.addChildAt=function(l,
k){if(0<=k&&k<=this.children.length)return l.parent&&l.parent.removeChild(l),(l.parent=this).children.splice(k,0,l),l;throw Error(l+"addChildAt: The index "+k+" supplied is out of bounds "+this.children.length);};e.DisplayObjectContainer.prototype.swapChildren=function(l,k){if(l!==k){var a=this.getChildIndex(l),b=this.getChildIndex(k);if(0>a||0>b)throw Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[a]=k;this.children[b]=l}};e.DisplayObjectContainer.prototype.getChildIndex=
function(l){l=this.children.indexOf(l);if(-1===l)throw Error("The supplied DisplayObject must be a child of the caller");return l};e.DisplayObjectContainer.prototype.setChildIndex=function(l,k){if(0>k||k>=this.children.length)throw Error("The supplied index is out of bounds");var a=this.getChildIndex(l);this.children.splice(a,1);this.children.splice(k,0,l)};e.DisplayObjectContainer.prototype.getChildAt=function(l){if(0>l||l>=this.children.length)throw Error("getChildAt: Supplied index "+l+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");
return this.children[l]};e.DisplayObjectContainer.prototype.removeChild=function(l){l=this.children.indexOf(l);if(-1!==l)return this.removeChildAt(l)};e.DisplayObjectContainer.prototype.removeChildAt=function(l){var k=this.getChildAt(l);return k&&(k.parent=void 0,this.children.splice(l,1)),k};e.DisplayObjectContainer.prototype.bringChildToTop=function(l){if(l.parent===this)return this.setChildIndex(l,this.children.length-1)};e.DisplayObjectContainer.prototype.sendChildToBack=function(l){if(l.parent===
this)return this.setChildIndex(l,0)};e.DisplayObjectContainer.prototype.removeChildren=function(l,k){void 0===l&&(l=0);void 0===k&&(k=this.children.length);var a=k-l;if(0<a&&a<=k){l=this.children.splice(l,a);for(k=0;k<l.length;k++)l[k].parent=void 0;return l}if(0===a&&0===this.children.length)return[];throw Error("removeChildren: Range Error, numeric values are outside the acceptable range");};e.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),
!this._cacheAsBitmap))for(var l=0;l<this.children.length;l++)this.children[l].updateTransform()};e.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=e.DisplayObjectContainer.prototype.updateTransform;e.DisplayObjectContainer.prototype.getBounds=function(l){var k,a=l&&l instanceof e.DisplayObject,b=!0;if(a?b=l instanceof e.DisplayObjectContainer&&l.contains(this):l=this,a){var c=l.worldTransform;l.worldTransform=Phaser.identityMatrix;for(k=0;k<l.children.length;k++)l.children[k].updateTransform()}var d,
f,g,h=1/0,m=1/0,n=-1/0,p=-1/0,q=!1;for(k=0;k<this.children.length;k++)this.children[k].visible&&(q=!0,h=h<(d=this.children[k].getBounds()).x?h:d.x,m=m<d.y?m:d.y,n=(f=d.width+d.x)<n?n:f,p=(g=d.height+d.y)<p?p:g);d=this._bounds;if(!q){var r=(d=new e.Rectangle).x;p=d.width+d.x;var u=d.y;k=d.height+d.y;g=this.worldTransform;n=g.a;q=g.b;var x=g.c;f=g.d;var w=g.tx,A=g.ty;g=n*r+x*k+w;var C=f*k+q*r+A,L=n*r+x*u+w;r=f*u+q*r+A;var M=n*p+x*u+w;u=f*u+q*p+A;h=M<(h=L<(h=g<(h=n=n*p+x*k+w)?g:h)?L:h)?M:h;m=u<(m=r<
(m=C<(m=p=f*k+q*p+A)?C:m)?r:m)?u:m;n=(n=(n=n<g?g:n)<L?L:n)<M?M:n;p=(p=(p=p<C?C:p)<r?r:p)<u?u:p}if(d.x=h,d.y=m,d.width=n-h,d.height=p-m,a)for(l.worldTransform=c,k=0;k<l.children.length;k++)l.children[k].updateTransform();b||(l=l.getBounds(),d.x-=l.x,d.y-=l.y);return d};e.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)};e.DisplayObjectContainer.prototype.contains=function(l){return!!l&&(l===this||this.contains(l.parent))};e.DisplayObjectContainer.prototype._renderWebGL=
function(l){var k;if(this.visible&&!(0>=this.alpha))if(this._cacheAsBitmap)this._renderCachedSprite(l);else if(this._mask||this._filters){this._filters&&(l.spriteBatch.flush(),l.filterManager.pushFilter(this._filterBlock));this._mask&&(l.spriteBatch.stop(),l.maskManager.pushMask(this.mask,l),l.spriteBatch.start());for(k=0;k<this.children.length;k++)this.children[k]._renderWebGL(l);l.spriteBatch.stop();this._mask&&l.maskManager.popMask(this._mask,l);this._filters&&l.filterManager.popFilter();l.spriteBatch.start()}else for(k=
0;k<this.children.length;k++)this.children[k]._renderWebGL(l)};e.DisplayObjectContainer.prototype._renderCanvas=function(l){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(l);else{this._mask&&l.maskManager.pushMask(this._mask,l);for(var k=0;k<this.children.length;k++)this.children[k]._renderCanvas(l);this._mask&&l.maskManager.popMask(l)}};Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},
set:function(l){var k=this.getLocalBounds().width;this.scale.x=0!==k?l/k:1;this._width=l}});Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(l){var k=this.getLocalBounds().height;this.scale.y=0!==k?l/k:1;this._height=l}});e.Sprite=function(l){e.DisplayObjectContainer.call(this);this.anchor=new e.Point(e.Sprite.defaultAnchor.x,e.Sprite.defaultAnchor.y);this.texture=l||e.Texture.emptyTexture;this._height=
this._width=0;this.tint=16777215;this.cachedTint=-1;this.tintedTexture=null;this.blendMode=e.blendModes.NORMAL;this.shader=null;this.exists=!0;this.texture.baseTexture.hasLoaded&&this.onTextureUpdate();this.renderable=!0};e.Sprite.defaultAnchor={x:0,y:0};e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Sprite.prototype.constructor=e.Sprite;Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(l){this.scale.x=
l/this.texture.frame.width;this._width=l}});Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(l){this.scale.y=l/this.texture.frame.height;this._height=l}});e.Sprite.prototype.setTexture=function(l,k){k&&this.texture.baseTexture.destroy();this.texture.baseTexture.skipRender=!1;this.texture=l;this.texture.valid=!0;this.cachedTint=-1};e.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);
this._height&&(this.scale.y=this._height/this.texture.frame.height)};e.Sprite.prototype.getBounds=function(l){var k=this.texture.frame.width,a=this.texture.frame.height,b=k*(1-this.anchor.x);k*=-this.anchor.x;var c=a*(1-this.anchor.y),d=a*-this.anchor.y;a=l||this.worldTransform;var f=a.a,g=a.b,h=a.c;l=a.d;var m=a.tx,n=a.ty;a=-1/0;var p=-1/0,q=1/0,r=1/0;if(0===g&&0===h)0>f&&(f*=-1,a=b,b=-k,k=-a),0>l&&(l*=-1,a=c,c=-d,d=-a),q=f*k+m,a=f*b+m,r=l*d+n,p=l*c+n;else{var u=f*k+h*d+m,x=l*d+g*k+n,w=f*b+h*d+m;
d=l*d+g*b+n;var A=f*b+h*c+m;b=l*c+g*b+n;f=f*k+h*c+m;k=l*c+g*k+n;q=f<(q=A<(q=w<(q=u<q?u:q)?w:q)?A:q)?f:q;r=k<(r=b<(r=d<(r=x<r?x:r)?d:r)?b:r)?k:r;a=(a=(a=(a=a<u?u:a)<w?w:a)<A?A:a)<f?f:a;p=(p=(p=(p=p<x?x:p)<d?d:p)<b?b:p)<k?k:p}k=this._bounds;return k.x=q,k.width=a-q,k.y=r,k.height=p-r,this._currentBounds=k};e.Sprite.prototype.getLocalBounds=function(){var l=this.worldTransform;this.worldTransform=Phaser.identityMatrix;for(var k=0;k<this.children.length;k++)this.children[k].updateTransform();var a=this.getBounds();
this.worldTransform=l;for(k=0;k<this.children.length;k++)this.children[k].updateTransform();return a};e.Sprite.prototype._renderWebGL=function(l,k){if(this.visible&&!(0>=this.alpha)&&this.renderable){var a=this.worldTransform;if(k&&(a=k),this._mask||this._filters){a=l.spriteBatch;this._filters&&(a.flush(),l.filterManager.pushFilter(this._filterBlock));this._mask&&(a.stop(),l.maskManager.pushMask(this.mask,l),a.start());a.render(this);for(k=0;k<this.children.length;k++)this.children[k]._renderWebGL(l);
a.stop();this._mask&&l.maskManager.popMask(this._mask,l);this._filters&&l.filterManager.popFilter();a.start()}else for(l.spriteBatch.render(this),k=0;k<this.children.length;k++)this.children[k]._renderWebGL(l,a)}};e.Sprite.prototype._renderCanvas=function(l,k){if(!(!this.visible||0===this.alpha||!this.renderable||1>this.texture.crop.width||1>this.texture.crop.height)){var a=this.worldTransform;if(k&&(a=k),this.blendMode!==l.currentBlendMode&&(l.currentBlendMode=this.blendMode,l.context.globalCompositeOperation=
e.blendModesCanvas[l.currentBlendMode]),this._mask&&l.maskManager.pushMask(this._mask,l),this.texture.valid){k=this.texture.baseTexture.resolution/l.resolution;l.context.globalAlpha=this.worldAlpha;l.smoothProperty&&l.scaleMode!==this.texture.baseTexture.scaleMode&&(l.scaleMode=this.texture.baseTexture.scaleMode,l.context[l.smoothProperty]=l.scaleMode===e.scaleModes.LINEAR);var b=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,c=
this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,d=a.tx*l.resolution+l.shakeX,f=a.ty*l.resolution+l.shakeY,g=this.texture.crop.width,h=this.texture.crop.height;if(this.texture.rotated){var m=a.a,n=a.b,p=a.c,q=a.d,r=g;d=a.c*h+d;f=a.d*h+f;a.a=6.123233995736766E-17*m-p;a.b=6.123233995736766E-17*n-q;a.c=m+6.123233995736766E-17*p;a.d=n+6.123233995736766E-17*q;g=h;h=r}if(l.roundPixels?(l.context.setTransform(a.a,a.b,a.c,a.d,0|d,0|f),b|=
0,c|=0):l.context.setTransform(a.a,a.b,a.c,a.d,d,f),b/=k,c/=k,h|=0,(g|=0)&&h){16777215!==this.tint?((this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),l.context.drawImage(this.tintedTexture,0,0,g,h,b,c,g/k,h/k)):l.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,g,h,b,c,g/k,h/k);for(a=0;a<this.children.length;a++)this.children[a]._renderCanvas(l);
this._mask&&l.maskManager.popMask(l)}}else{for(a=0;a<this.children.length;a++)this.children[a]._renderCanvas(l);this._mask&&l.maskManager.popMask(l)}}};e.initDefaultShaders=function(){};e.CompileVertexShader=function(l,k){return e._CompileShader(l,k,l.VERTEX_SHADER)};e.CompileFragmentShader=function(l,k){return e._CompileShader(l,k,l.FRAGMENT_SHADER)};e._CompileShader=function(l,k,a){var b=k;Array.isArray(k)&&(b=k.join("\n"));k=l.createShader(a);return l.shaderSource(k,b),l.compileShader(k),l.getShaderParameter(k,
l.COMPILE_STATUS)?k:(window.console.log(l.getShaderInfoLog(k)),null)};e.compileProgram=function(l,k,a){a=e.CompileFragmentShader(l,a);k=e.CompileVertexShader(l,k);var b=l.createProgram();return l.attachShader(b,k),l.attachShader(b,a),l.linkProgram(b),l.getProgramParameter(b,l.LINK_STATUS)||(window.console.log(l.getProgramInfoLog(b)),window.console.log("Could not initialise shaders")),b};e.PixiShader=function(l){this._UID=Phaser._UID++;this.gl=l;this.fragmentSrc=this.program=null;this.textureCount=
0;this.dirty=this.firstRun=!0;this.attributes=[];this.init()};e.PixiShader.prototype.constructor=e.PixiShader;e.PixiShader.prototype.initMultitexShader=function(){var l=this.gl;this.MAX_TEXTURES=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS);for(var k="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",a=1;a<this.MAX_TEXTURES;++a)k+="\tif (vTextureIndex == "+a+".0) {gl_FragColor = texture2D(uSamplerArray["+a+"], vTextureCoord) * vColor;return;}\n";
this.fragmentSrc=["// PixiShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",k,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}",
"   if(isnan(vTextureIndex)) { gl_FragColor = RED;return;}","}"];k=e.compileProgram(l,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);l.useProgram(k);this.uSamplerArray=l.getUniformLocation(k,"uSamplerArray[0]");this.projectionVector=l.getUniformLocation(k,"projectionVector");this.offsetVector=l.getUniformLocation(k,"offsetVector");this.dimensions=l.getUniformLocation(k,"dimensions");this.aVertexPosition=l.getAttribLocation(k,"aVertexPosition");this.aTextureCoord=l.getAttribLocation(k,
"aTextureCoord");this.colorAttribute=l.getAttribLocation(k,"aColor");this.aTextureIndex=l.getAttribLocation(k,"aTextureIndex");a=[];var b=l.createTexture();l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,b);l.texImage2D(l.TEXTURE_2D,0,l.RGB,1,1,0,l.RGB,l.UNSIGNED_BYTE,null);for(var c=0;c<this.MAX_TEXTURES;++c)l.activeTexture(l.TEXTURE0+c),l.bindTexture(l.TEXTURE_2D,b),a.push(c);for(var d in l.activeTexture(l.TEXTURE0),l.uniform1iv(this.uSamplerArray,a),-1===this.colorAttribute&&(this.colorAttribute=
2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.uniforms)this.uniforms[d].uniformLocation=l.getUniformLocation(k,d);this.initUniforms();this.program=k};e.PixiShader.prototype.initDefaultShader=function(){null===this.fragmentSrc&&(this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;",
"}"]);var l=this.gl,k=e.compileProgram(l,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc),a;for(a in l.useProgram(k),this.uSampler=l.getUniformLocation(k,"uSampler"),this.projectionVector=l.getUniformLocation(k,"projectionVector"),this.offsetVector=l.getUniformLocation(k,"offsetVector"),this.dimensions=l.getUniformLocation(k,"dimensions"),this.aVertexPosition=l.getAttribLocation(k,"aVertexPosition"),this.aTextureCoord=l.getAttribLocation(k,"aTextureCoord"),this.colorAttribute=l.getAttribLocation(k,
"aColor"),this.aTextureIndex=l.getAttribLocation(k,"aTextureIndex"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.uniforms)this.uniforms[a].uniformLocation=l.getUniformLocation(k,a);this.initUniforms();this.program=k};e.PixiShader.prototype.init=function(l){e._enableMultiTextureToggle&&!l?this.initMultitexShader():this.initDefaultShader()};e.PixiShader.prototype.initUniforms=function(){this.textureCount=
1;var l,k=this.gl,a;for(a in this.uniforms){var b=(l=this.uniforms[a]).type;"sampler2D"===b?(l._init=!1,null!==l.value&&this.initSampler2D(l)):"mat2"===b||"mat3"===b||"mat4"===b?(l.glMatrix=!0,l.glValueLength=1,"mat2"===b?l.glFunc=k.uniformMatrix2fv:"mat3"===b?l.glFunc=k.uniformMatrix3fv:"mat4"===b&&(l.glFunc=k.uniformMatrix4fv)):(l.glFunc=k["uniform"+b],l.glValueLength="2f"===b||"2i"===b?2:"3f"===b||"3i"===b?3:"4f"===b||"4i"===b?4:1)}};e.PixiShader.prototype.initSampler2D=function(l){if(l.value&&
l.value.baseTexture&&l.value.baseTexture.hasLoaded){var k=this.gl;if(k.activeTexture(k.TEXTURE0+this.textureCount),k.bindTexture(k.TEXTURE_2D,l.value.baseTexture._glTextures[k.id]),l.textureData){var a=l.textureData,b=a.magFilter?a.magFilter:k.LINEAR,c=a.minFilter?a.minFilter:k.LINEAR,d=a.wrapS?a.wrapS:k.CLAMP_TO_EDGE,f=a.wrapT?a.wrapT:k.CLAMP_TO_EDGE,g=a.luminance?k.LUMINANCE:k.RGBA;(a.repeat&&(d=k.REPEAT,f=k.REPEAT),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,!!a.flipY),a.width)?k.texImage2D(k.TEXTURE_2D,
0,g,a.width?a.width:512,a.height?a.height:2,a.border?a.border:0,g,k.UNSIGNED_BYTE,null):k.texImage2D(k.TEXTURE_2D,0,g,k.RGBA,k.UNSIGNED_BYTE,l.value.baseTexture.source);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,b);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,c);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,d);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,f)}k.uniform1i(l.uniformLocation,this.textureCount);l._init=!0;this.textureCount++}};e.PixiShader.prototype.syncUniforms=function(){var l;
this.textureCount=1;var k=this.gl,a;for(a in this.uniforms)1===(l=this.uniforms[a]).glValueLength?!0===l.glMatrix?l.glFunc.call(k,l.uniformLocation,l.transpose,l.value):l.glFunc.call(k,l.uniformLocation,l.value):2===l.glValueLength?l.glFunc.call(k,l.uniformLocation,l.value.x,l.value.y):3===l.glValueLength?l.glFunc.call(k,l.uniformLocation,l.value.x,l.value.y,l.value.z):4===l.glValueLength?l.glFunc.call(k,l.uniformLocation,l.value.x,l.value.y,l.value.z,l.value.w):"sampler2D"===l.type&&(l._init?(k.activeTexture(k["TEXTURE"+
this.textureCount]),l.value.baseTexture._dirty[k.id]?e.instances[k.id].updateTexture(l.value.baseTexture):k.bindTexture(k.TEXTURE_2D,l.value.baseTexture._glTextures[k.id]),k.uniform1i(l.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(l))};e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};e.PixiShader.defaultVertexSrc=["// PixiShader Vertex Shader","// With multi-texture rendering","attribute vec2 aVertexPosition;",
"attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   if (aTextureIndex > 0.0) gl_Position = vec4(0.0);","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);",
"   vTextureIndex = aTextureIndex;","}"];e.PixiFastShader=function(l){if(this._UID=Phaser._UID++,this.gl=l,this.program=null,e._enableMultiTextureToggle){l=this.gl;this.MAX_TEXTURES=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS);l="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n";for(var k=1;k<this.MAX_TEXTURES;++k)l+="\tif (vTextureIndex == "+k+".0) { gl_FragColor = texture2D(uSamplerArray["+k+"], vTextureCoord) * vColor;return;}\n";this.fragmentSrc=
["// PixiFastShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",l,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}",
"}"]}else this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"];this.vertexSrc=["// PixiFastShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;",
"attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);",
"   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","   vColor = aColor;","}"];this.textureCount=0;this.init()};e.PixiFastShader.prototype.constructor=e.PixiFastShader;e.PixiFastShader.prototype.init=function(){var l=this.gl,k=e.compileProgram(l,this.vertexSrc,this.fragmentSrc);if(l.useProgram(k),this.uSampler=e._enableMultiTextureToggle?l.getUniformLocation(k,"uSamplerArray[0]"):l.getUniformLocation(k,"uSampler"),e._enableMultiTextureToggle){var a=[],b=l.createTexture();l.activeTexture(l.TEXTURE0);
l.bindTexture(l.TEXTURE_2D,b);l.texImage2D(l.TEXTURE_2D,0,l.RGB,1,1,0,l.RGB,l.UNSIGNED_BYTE,null);for(var c=0;c<this.MAX_TEXTURES;++c)l.activeTexture(l.TEXTURE0+c),l.bindTexture(l.TEXTURE_2D,b),a.push(c);l.activeTexture(l.TEXTURE0);l.uniform1iv(this.uSampler,a)}this.projectionVector=l.getUniformLocation(k,"projectionVector");this.offsetVector=l.getUniformLocation(k,"offsetVector");this.dimensions=l.getUniformLocation(k,"dimensions");this.uMatrix=l.getUniformLocation(k,"uMatrix");this.aVertexPosition=
l.getAttribLocation(k,"aVertexPosition");this.aPositionCoord=l.getAttribLocation(k,"aPositionCoord");this.aScale=l.getAttribLocation(k,"aScale");this.aRotation=l.getAttribLocation(k,"aRotation");this.aTextureCoord=l.getAttribLocation(k,"aTextureCoord");this.colorAttribute=l.getAttribLocation(k,"aColor");this.aTextureIndex=l.getAttribLocation(k,"aTextureIndex");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,
this.colorAttribute,this.aTextureIndex];this.program=k};e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};e.StripShader=function(l){if(this._UID=Phaser._UID++,this.gl=l,this.program=null,e._enableMultiTextureToggle){l=this.gl;this.MAX_TEXTURES=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS);l="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord);return;}\n";for(var k=1;k<this.MAX_TEXTURES;++k)l+=
"\tif (vTextureIndex == "+k+".0) { gl_FragColor = texture2D(uSamplerArray["+k+"], vTextureCoord) ;return;}\n";this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);",
"void main(void) {",l,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","}"];this.vertexSrc=["//StripShader Vertex Shader.","attribute vec2 aVertexPosition;",
"attribute vec2 aTextureCoord;","attribute float aTextureIndex;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vTextureIndex;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;",
"}"];this.init()};e.StripShader.prototype.constructor=e.StripShader;e.StripShader.prototype.init=function(){var l=this.gl,k=e.compileProgram(l,this.vertexSrc,this.fragmentSrc);if(l.useProgram(k),this.uSampler=e._enableMultiTextureToggle?l.getUniformLocation(k,"uSamplerArray[0]"):l.getUniformLocation(k,"uSampler"),e._enableMultiTextureToggle){var a=[],b=l.createTexture();l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,b);l.texImage2D(l.TEXTURE_2D,0,l.RGB,1,1,0,l.RGB,l.UNSIGNED_BYTE,null);for(var c=
0;c<this.MAX_TEXTURES;++c)l.activeTexture(l.TEXTURE0+c),l.bindTexture(l.TEXTURE_2D,b),a.push(c);l.activeTexture(l.TEXTURE0);l.uniform1iv(this.uSampler,a)}this.projectionVector=l.getUniformLocation(k,"projectionVector");this.offsetVector=l.getUniformLocation(k,"offsetVector");this.colorAttribute=l.getAttribLocation(k,"aColor");this.aTextureIndex=l.getAttribLocation(k,"aTextureIndex");this.aVertexPosition=l.getAttribLocation(k,"aVertexPosition");this.aTextureCoord=l.getAttribLocation(k,"aTextureCoord");
this.attributes=[this.aVertexPosition,this.aTextureCoord,this.aTextureIndex];this.translationMatrix=l.getUniformLocation(k,"translationMatrix");this.alpha=l.getUniformLocation(k,"alpha");this.program=k};e.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};e.PrimitiveShader=function(l){this._UID=Phaser._UID++;this.gl=l;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;",
"}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);",
"}"];this.init()};e.PrimitiveShader.prototype.constructor=e.PrimitiveShader;e.PrimitiveShader.prototype.init=function(){var l=this.gl,k=e.compileProgram(l,this.vertexSrc,this.fragmentSrc);l.useProgram(k);this.projectionVector=l.getUniformLocation(k,"projectionVector");this.offsetVector=l.getUniformLocation(k,"offsetVector");this.tintColor=l.getUniformLocation(k,"tint");this.flipY=l.getUniformLocation(k,"flipY");this.aVertexPosition=l.getAttribLocation(k,"aVertexPosition");this.colorAttribute=l.getAttribLocation(k,
"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=l.getUniformLocation(k,"translationMatrix");this.alpha=l.getUniformLocation(k,"alpha");this.program=k};e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attributes=this.gl=this.uniforms=null};e.ComplexPrimitiveShader=function(l){this._UID=Phaser._UID++;this.gl=l;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;",
"}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);",
"}"];this.init()};e.ComplexPrimitiveShader.prototype.constructor=e.ComplexPrimitiveShader;e.ComplexPrimitiveShader.prototype.init=function(){var l=this.gl,k=e.compileProgram(l,this.vertexSrc,this.fragmentSrc);l.useProgram(k);this.projectionVector=l.getUniformLocation(k,"projectionVector");this.offsetVector=l.getUniformLocation(k,"offsetVector");this.tintColor=l.getUniformLocation(k,"tint");this.color=l.getUniformLocation(k,"color");this.flipY=l.getUniformLocation(k,"flipY");this.aVertexPosition=l.getAttribLocation(k,
"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=l.getUniformLocation(k,"translationMatrix");this.alpha=l.getUniformLocation(k,"alpha");this.program=k};e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.attribute=this.gl=this.uniforms=null};e.glContexts=[];e.instances=[];e._enableMultiTextureToggle=!1;e.WebGLRenderer=function(l,k){this.game=l;this.extensions={};this.type=Phaser.WEBGL;this.resolution=l.resolution;
this.transparent=l.transparent;this.autoResize=!1;this.preserveDrawingBuffer=l.preserveDrawingBuffer;this.clearBeforeRender=l.clearBeforeRender;this.powerPreference=l.powerPreference;this.width=l.width;this.height=l.height;this.view=l.canvas;this._contextOptions={alpha:this.transparent,antialias:l.antialias,failIfMajorPerformanceCaveat:k.failIfMajorPerformanceCaveat,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer,
powerPreference:l.powerPreference};this.projection=new e.Point;this.offset=new e.Point;this.shaderManager=new e.WebGLShaderManager;this.spriteBatch=new e.WebGLSpriteBatch(l);this.maskManager=new e.WebGLMaskManager;this.filterManager=new e.WebGLFilterManager;this.stencilManager=new e.WebGLStencilManager;this.blendModeManager=new e.WebGLBlendModeManager;this.renderSession={};this.currentBatchedTextures=[];this.renderSession.game=this.game;this.renderSession.gl=this.gl;this.renderSession.drawCount=0;
this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;(this.renderSession.renderer=this).renderSession.resolution=this.resolution;this.renderSession.roundPixels=k.roundPixels||!1;this.renderSession.maxTextureAvailableSpace=null;this.initContext();
this.mapBlendModes()};e.WebGLRenderer.prototype.constructor=e.WebGLRenderer;e.WebGLRenderer.prototype.initContext=function(){var l=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(!(this.gl=l))throw Error("This browser does not support webGL. Try using the canvas renderer");this.maxTextures=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=this.gl.getParameter(l.MAX_TEXTURE_SIZE);this.glContextId=l.id=e.WebGLRenderer.glContextId++;
e.glContexts[this.glContextId]=l;e.instances[this.glContextId]=this;l.disable(l.DEPTH_TEST);l.disable(l.CULL_FACE);l.enable(l.BLEND);this.shaderManager.setContext(l);this.spriteBatch.setContext(l);this.maskManager.setContext(l);this.filterManager.setContext(l);this.blendModeManager.setContext(l);this.stencilManager.setContext(l);this.renderSession.gl=this.gl;this.resize(this.width,this.height);this.extensions.compression={};var k=l.getExtension("WEBGL_compressed_texture_etc1")||l.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),
a=l.getExtension("WEBGL_compressed_texture_pvrtc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");l=l.getExtension("WEBGL_compressed_texture_s3tc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");k&&(this.extensions.compression.ETC1=k);a&&(this.extensions.compression.PVRTC=a);l&&(this.extensions.compression.S3TC=l)};e.WebGLRenderer.prototype.setTexturePriority=function(l){if(e._enableMultiTextureToggle){var k=function(h){return--h,h|=h>>1,h|=h>>2,h|=h>>4,h|=h>>8,h|=h>>16,++h},a=
this.gl,b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),c=a.getParameter(a.MAX_TEXTURE_SIZE);a=this.game.cache._cache.image;for(var d=null,f=0;f<this.currentBatchedTextures.length;f++)(d=this.currentBatchedTextures[f])in a?a[d].base.textureIndex=0:console.warn('setTexturePriority: There is no image "%s" in the image cache.',d);c-=k(Math.max(this.width,this.height));for(f=this.currentBatchedTextures.length=0;f<l.length;++f)if((d=l[f])in a){var g=a[d].base;0>=(c-=k(Math.max(g.width,g.height)))?(g.textureIndex=
0,console.warn('setTexturePriority: Image "%s" was given textureIndex=0 because there is no available texture space (%s).',d,c)):g.textureIndex=1+f%(b-1);this.currentBatchedTextures.push(d)}else console.warn('setTexturePriority: There is no image "%s" in the image cache.',d);return this.renderSession.maxTextureAvailableSpace=c,this.currentBatchedTextures}console.warn("setTexturePriority error: Multi Texture support hasn't been enabled in the Phaser Game Config.")};e.WebGLRenderer.prototype.render=
function(l){if(!this.contextLost){var k=this.gl;k.viewport(0,0,this.width,this.height);k.bindFramebuffer(k.FRAMEBUFFER,null);this.game.clearBeforeRender&&(k.clearColor(l._bgColor.r,l._bgColor.g,l._bgColor.b,l._bgColor.a),k.clear(k.COLOR_BUFFER_BIT));this.offset.x=this.game.camera._shake.x;this.offset.y=this.game.camera._shake.y;this.renderDisplayObject(l,this.projection)}};e.WebGLRenderer.prototype.postRender=function(){this.gl.flush()};e.WebGLRenderer.prototype.renderDisplayObject=function(l,k,a,
b){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=a?-1:1;this.renderSession.projection=k;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,a);l._renderWebGL(this.renderSession,b);this.spriteBatch.end()};e.WebGLRenderer.prototype.resize=function(l,k){this.width=l*this.resolution;this.height=k*this.resolution;this.view.width=this.width;this.view.height=
this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};e.WebGLRenderer.prototype.updateCompressedTexture=function(l){if(!l.hasLoaded)return!1;var k=this.gl,a=l.source;return l._glTextures[k.id]||(l._glTextures[k.id]=k.createTexture()),k.activeTexture(k.TEXTURE0+l.textureIndex),
k.bindTexture(k.TEXTURE_2D,l._glTextures[k.id]),k.compressedTexImage2D(k.TEXTURE_2D,0,a.glExtensionFormat,a.width,a.height,0,a.textureData),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,l.scaleMode===e.scaleModes.LINEAR?k.LINEAR:k.NEAREST),l.mipmap&&Phaser.Math.isPowerOfTwo(l.width,l.height)?(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,l.scaleMode===e.scaleModes.LINEAR?k.LINEAR_MIPMAP_LINEAR:k.NEAREST_MIPMAP_NEAREST),k.generateMipmap(k.TEXTURE_2D)):k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,
l.scaleMode===e.scaleModes.LINEAR?k.LINEAR:k.NEAREST),l._powerOf2?(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT)):(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE)),!(l._dirty[k.id]=!1)};e.WebGLRenderer.prototype.updateTexture=function(l){if(!l.hasLoaded||!l.source)return!1;if(l.source.compressionAlgorithm)return this.updateCompressedTexture(l);var k=this.gl;
return l._glTextures[k.id]||(l._glTextures[k.id]=k.createTexture()),k.activeTexture(k.TEXTURE0+l.textureIndex),k.bindTexture(k.TEXTURE_2D,l._glTextures[k.id]),k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.premultipliedAlpha),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,l.source),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,l.scaleMode===e.scaleModes.LINEAR?k.LINEAR:k.NEAREST),l.mipmap&&Phaser.Math.isPowerOfTwo(l.width,l.height)?(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,
l.scaleMode===e.scaleModes.LINEAR?k.LINEAR_MIPMAP_LINEAR:k.NEAREST_MIPMAP_NEAREST),k.generateMipmap(k.TEXTURE_2D)):k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,l.scaleMode===e.scaleModes.LINEAR?k.LINEAR:k.NEAREST),l._powerOf2?(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT)):(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE)),!(l._dirty[k.id]=!1)};e.WebGLRenderer.prototype.destroy=
function(){this.offset=this.projection=e.glContexts[this.glContextId]=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.renderSession=this.gl=this.filterManager=this.maskManager=this.spriteBatch=this.shaderManager=null;Phaser.CanvasPool.remove(this);e.instances[this.glContextId]=null;e.WebGLRenderer.glContextId--};e.WebGLRenderer.prototype.mapBlendModes=function(){var l=this.gl;if(!e.blendModesWebGL){var k=[],a=e.blendModes;k[a.NORMAL]=
[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.ADD]=[l.SRC_ALPHA,l.DST_ALPHA];k[a.MULTIPLY]=[l.DST_COLOR,l.ONE_MINUS_SRC_ALPHA];k[a.SCREEN]=[l.SRC_ALPHA,l.ONE];k[a.OVERLAY]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.DARKEN]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.LIGHTEN]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.COLOR_DODGE]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.COLOR_BURN]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.HARD_LIGHT]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.SOFT_LIGHT]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.DIFFERENCE]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];
k[a.EXCLUSION]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.HUE]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.SATURATION]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.COLOR]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];k[a.LUMINOSITY]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL=k}};e.WebGLRenderer.prototype.getMaxTextureUnit=function(){var l=this.gl;return l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS)};e.enableMultiTexture=function(){e._enableMultiTextureToggle=!0};e.WebGLRenderer.glContextId=0;e.WebGLRenderer.textureArray=[];e.WebGLBlendModeManager=
function(){this.currentBlendMode=99999};e.WebGLBlendModeManager.prototype.constructor=e.WebGLBlendModeManager;e.WebGLBlendModeManager.prototype.setContext=function(l){this.gl=l};e.WebGLBlendModeManager.prototype.setBlendMode=function(l){if(this.currentBlendMode===l)return!1;this.currentBlendMode=l;l=e.blendModesWebGL[this.currentBlendMode];return l&&this.gl.blendFunc(l[0],l[1]),!0};e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};e.WebGLMaskManager=function(){};e.WebGLMaskManager.prototype.constructor=
e.WebGLMaskManager;e.WebGLMaskManager.prototype.setContext=function(l){this.gl=l};e.WebGLMaskManager.prototype.pushMask=function(l,k){var a=k.gl;l.dirty&&e.WebGLGraphics.updateGraphics(l,a);void 0!==l._webGL[a.id]&&void 0!==l._webGL[a.id].data&&0!==l._webGL[a.id].data.length&&k.stencilManager.pushStencil(l,l._webGL[a.id].data[0],k)};e.WebGLMaskManager.prototype.popMask=function(l,k){var a=this.gl;void 0!==l._webGL[a.id]&&void 0!==l._webGL[a.id].data&&0!==l._webGL[a.id].data.length&&k.stencilManager.popStencil(l,
l._webGL[a.id].data[0],k)};e.WebGLMaskManager.prototype.destroy=function(){this.gl=null};e.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=!0;this.count=0};e.WebGLStencilManager.prototype.setContext=function(l){this.gl=l};e.WebGLStencilManager.prototype.pushStencil=function(l,k,a){var b=this.gl;this.bindGraphics(l,k,a);0===this.stencilStack.length&&(b.enable(b.STENCIL_TEST),b.clear(b.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(k);l=this.count;b.colorMask(!1,
!1,!1,!1);b.stencilFunc(b.ALWAYS,0,255);b.stencilOp(b.KEEP,b.KEEP,b.INVERT);1===k.mode?(b.drawElements(b.TRIANGLE_FAN,k.indices.length-4,b.UNSIGNED_SHORT,0),this.reverse?(b.stencilFunc(b.EQUAL,255-l,255),b.stencilOp(b.KEEP,b.KEEP,b.DECR)):(b.stencilFunc(b.EQUAL,l,255),b.stencilOp(b.KEEP,b.KEEP,b.INCR)),b.drawElements(b.TRIANGLE_FAN,4,b.UNSIGNED_SHORT,2*(k.indices.length-4)),this.reverse?b.stencilFunc(b.EQUAL,255-(l+1),255):b.stencilFunc(b.EQUAL,l+1,255),this.reverse=!this.reverse):(this.reverse?(b.stencilFunc(b.EQUAL,
l,255),b.stencilOp(b.KEEP,b.KEEP,b.INCR)):(b.stencilFunc(b.EQUAL,255-l,255),b.stencilOp(b.KEEP,b.KEEP,b.DECR)),b.drawElements(b.TRIANGLE_STRIP,k.indices.length,b.UNSIGNED_SHORT,0),this.reverse?b.stencilFunc(b.EQUAL,l+1,255):b.stencilFunc(b.EQUAL,255-(l+1),255));b.colorMask(!0,!0,!0,!0);b.stencilOp(b.KEEP,b.KEEP,b.KEEP);this.count++};e.WebGLStencilManager.prototype.bindGraphics=function(l,k,a){this._currentGraphics=l;var b,c=this.gl,d=a.projection,f=a.offset;1===k.mode?(b=a.shaderManager.complexPrimitiveShader,
a.shaderManager.setShader(b),c.uniform1f(b.flipY,a.flipY),c.uniformMatrix3fv(b.translationMatrix,!1,l.worldTransform.toArray(!0)),c.uniform2f(b.projectionVector,d.x,-d.y),c.uniform2f(b.offsetVector,-f.x,-f.y),c.uniform3fv(b.tintColor,Phaser.Color.hexToRGBArray(l.tint)),c.uniform3fv(b.color,k.color),c.uniform1f(b.alpha,l.worldAlpha*k.alpha),c.bindBuffer(c.ARRAY_BUFFER,k.buffer),c.vertexAttribPointer(b.aVertexPosition,2,c.FLOAT,!1,8,0)):(b=a.shaderManager.primitiveShader,a.shaderManager.setShader(b),
c.uniformMatrix3fv(b.translationMatrix,!1,l.worldTransform.toArray(!0)),c.uniform1f(b.flipY,a.flipY),c.uniform2f(b.projectionVector,d.x,-d.y),c.uniform2f(b.offsetVector,-f.x,-f.y),c.uniform3fv(b.tintColor,Phaser.Color.hexToRGBArray(l.tint)),c.uniform1f(b.alpha,l.worldAlpha),c.bindBuffer(c.ARRAY_BUFFER,k.buffer),c.vertexAttribPointer(b.aVertexPosition,2,c.FLOAT,!1,24,0),c.vertexAttribPointer(b.colorAttribute,4,c.FLOAT,!1,24,8));c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,k.indexBuffer)};e.WebGLStencilManager.prototype.popStencil=
function(l,k,a){var b=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)b.disable(b.STENCIL_TEST);else{var c=this.count;this.bindGraphics(l,k,a);b.colorMask(!1,!1,!1,!1);1===k.mode?(this.reverse=!this.reverse,this.reverse?(b.stencilFunc(b.EQUAL,255-(c+1),255),b.stencilOp(b.KEEP,b.KEEP,b.INCR)):(b.stencilFunc(b.EQUAL,c+1,255),b.stencilOp(b.KEEP,b.KEEP,b.DECR)),b.drawElements(b.TRIANGLE_FAN,4,b.UNSIGNED_SHORT,2*(k.indices.length-4)),b.stencilFunc(b.ALWAYS,0,255),b.stencilOp(b.KEEP,
b.KEEP,b.INVERT),b.drawElements(b.TRIANGLE_FAN,k.indices.length-4,b.UNSIGNED_SHORT,0)):(this.reverse?(b.stencilFunc(b.EQUAL,c+1,255),b.stencilOp(b.KEEP,b.KEEP,b.DECR)):(b.stencilFunc(b.EQUAL,255-(c+1),255),b.stencilOp(b.KEEP,b.KEEP,b.INCR)),b.drawElements(b.TRIANGLE_STRIP,k.indices.length,b.UNSIGNED_SHORT,0));this.reverse?b.stencilFunc(b.EQUAL,c,255):b.stencilFunc(b.EQUAL,255-c,255);b.colorMask(!0,!0,!0,!0);b.stencilOp(b.KEEP,b.KEEP,b.KEEP)}};e.WebGLStencilManager.prototype.destroy=function(){this.gl=
this.stencilStack=null};e.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var l=0;l<this.maxAttibs;l++)this.attribState[l]=!1;this.stack=[]};e.WebGLShaderManager.prototype.constructor=e.WebGLShaderManager;e.WebGLShaderManager.prototype.setContext=function(l){this.gl=l;this.primitiveShader=new e.PrimitiveShader(l);this.complexPrimitiveShader=new e.ComplexPrimitiveShader(l);this.defaultShader=new e.PixiShader(l);this.fastShader=new e.PixiFastShader(l);
this.stripShader=new e.StripShader(l);this.creatureShader=e.CreatureShader?new e.CreatureShader(l):null;this.setShader(this.defaultShader)};e.WebGLShaderManager.prototype.setAttribs=function(l){var k;for(k=0;k<this.tempAttribState.length;k++)this.tempAttribState[k]=!1;for(k=0;k<l.length;k++)this.tempAttribState[l[k]]=!0;l=this.gl;for(k=0;k<this.attribState.length;k++)this.attribState[k]!==this.tempAttribState[k]&&(this.attribState[k]=this.tempAttribState[k],this.tempAttribState[k]?l.enableVertexAttribArray(k):
l.disableVertexAttribArray(k))};e.WebGLShaderManager.prototype.setShader=function(l){return this._currentId!==l._UID&&(this._currentId=l._UID,this.currentShader=l,this.gl.useProgram(l.program),this.setAttribs(l.attributes),!0)};e.WebGLShaderManager.prototype.destroy=function(){this.tempAttribState=this.attribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.creatureShader&&this.creatureShader.destroy();
this.gl=null};e.WebGLSpriteBatch=function(l){this.game=l;this.vertSize=5;this.size=2E3;this.vertexSize=24;l=6*this.size;this.vertices=new ArrayBuffer(this.vertexSize*this.size*4);this.positions=new Float32Array(this.vertices);this.colors=new Uint32Array(this.vertices);this.indices=new Uint16Array(l);for(var k=this.lastIndexCount=0,a=0;k<l;k+=6,a+=4)this.indices[k+0]=a+0,this.indices[k+1]=a+1,this.indices[k+2]=a+2,this.indices[k+3]=a+0,this.indices[k+4]=a+2,this.indices[k+5]=a+3;this.drawing=!1;this.currentBatchSize=
0;this.currentBaseTexture=null;this.dirty=!0;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=null};e.WebGLSpriteBatch.prototype.setContext=function(l){if(this.MAX_TEXTURES=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS),this.gl=l,e._enableMultiTextureToggle){for(var k="\tif (vTextureIndex == 0.0) {gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",a=1;a<this.MAX_TEXTURES;++a)k+="\tif (vTextureIndex == "+a+".0) {gl_FragColor = texture2D(uSamplerArray["+
a+"], vTextureCoord) * vColor;return;}\n";this.defaultShader=new Phaser.Filter(this.game,void 0,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","void main(void) {",k,"\tgl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;","}"])}else this.defaultShader=new Phaser.Filter(this.game,void 0,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;",
"varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"]);this.vertexBuffer=l.createBuffer();this.indexBuffer=l.createBuffer();l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer);l.bufferData(l.ELEMENT_ARRAY_BUFFER,this.indices,l.STATIC_DRAW);l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer);l.bufferData(l.ARRAY_BUFFER,this.vertices,l.DYNAMIC_DRAW);this.currentBlendMode=
99999;k=new e.PixiShader(l);k.fragmentSrc=this.defaultShader.fragmentSrc;k.uniforms={};k.init();this.defaultShader.shaders[l.id]=k};e.WebGLSpriteBatch.prototype.begin=function(l){this.renderSession=l;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};e.WebGLSpriteBatch.prototype.end=function(){this.flush()};e.WebGLSpriteBatch.prototype.render=function(l,k){var a=l.texture;if(e._enableMultiTextureToggle){var b=a.baseTexture,c=this.gl;e.WebGLRenderer.textureArray[b.textureIndex]!=
b&&(this.flush(),c.activeTexture(c.TEXTURE0+b.textureIndex),c.bindTexture(c.TEXTURE_2D,b._glTextures[c.id]),e.WebGLRenderer.textureArray[b.textureIndex]=b)}var d=l.worldTransform;k&&(d=k);this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=a.baseTexture);if(k=a._uvs){c=l.anchor.x;var f=l.anchor.y;if(a.trim){var g=a.trim;b=(c=g.x-c*g.width)+a.crop.width;g=(f=g.y-f*g.height)+a.crop.height}else b=a.frame.width*(1-c),c=a.frame.width*-c,g=a.frame.height*(1-f),f=a.frame.height*-f;var h=
this.currentBatchSize*this.vertexSize,m=a.baseTexture.resolution,n=a.baseTexture.textureIndex,p=d.a/m,q=d.b/m,r=d.c/m,u=d.d/m;m=d.tx;var x=d.ty,w=a.crop.height;if(a.rotated){r=d.a;u=d.b;var A=d.c,C=d.d,L=c,M=b;m=d.c*w+m;x=d.d*w+x;p=6.123233995736766E-17*r-A;q=6.123233995736766E-17*u-C;r+=6.123233995736766E-17*A;u+=6.123233995736766E-17*C;a._updateUvsInverted();b=g;c=f;g=M;f=L}a=this.colors;d=this.positions;w=l.tint;w=(w>>16)+(65280&w)+((255&w)<<16)+(255*l.worldAlpha<<24);this.renderSession.roundPixels?
(d[h++]=p*c+r*f+m|0,d[h++]=u*f+q*c+x|0,d[h++]=k.x0,d[h++]=k.y0,a[h++]=w,d[h++]=n,d[h++]=p*b+r*f+m|0,d[h++]=u*f+q*b+x|0,d[h++]=k.x1,d[h++]=k.y1,a[h++]=w,d[h++]=n,d[h++]=p*b+r*g+m|0,d[h++]=u*g+q*b+x|0,d[h++]=k.x2,d[h++]=k.y2,a[h++]=w,d[h++]=n,d[h++]=p*c+r*g+m|0,d[h++]=u*g+q*c+x|0):(d[h++]=p*c+r*f+m,d[h++]=u*f+q*c+x,d[h++]=k.x0,d[h++]=k.y0,a[h++]=w,d[h++]=n,d[h++]=p*b+r*f+m,d[h++]=u*f+q*b+x,d[h++]=k.x1,d[h++]=k.y1,a[h++]=w,d[h++]=n,d[h++]=p*b+r*g+m,d[h++]=u*g+q*b+x,d[h++]=k.x2,d[h++]=k.y2,a[h++]=w,d[h++]=
n,d[h++]=p*c+r*g+m,d[h++]=u*g+q*c+x);d[h++]=k.x3;d[h++]=k.y3;a[h++]=w;d[h++]=n;this.sprites[this.currentBatchSize++]=l}};e.WebGLSpriteBatch.prototype.renderTilingSprite=function(l){var k=l.tilingTexture,a=l.texture.baseTexture.textureIndex;if(e._enableMultiTextureToggle){var b=k.baseTexture,c=this.gl;e.WebGLRenderer.textureArray[a]!=b&&(this.flush(),c.activeTexture(c.TEXTURE0+a),c.bindTexture(c.TEXTURE_2D,b._glTextures[c.id]),e.WebGLRenderer.textureArray[a]=b)}this.currentBatchSize>=this.size&&(this.flush(),
this.currentBaseTexture=k.baseTexture);l._uvs||(l._uvs=new e.TextureUvs);b=l._uvs;var d=k.baseTexture.width,f=k.baseTexture.height;l.tilePosition.x%=d*l.tileScaleOffset.x;l.tilePosition.y%=f*l.tileScaleOffset.y;c=l.tilePosition.x/(d*l.tileScaleOffset.x);var g=l.tilePosition.y/(f*l.tileScaleOffset.y);d=l.width/d/(l.tileScale.x*l.tileScaleOffset.x);f=l.height/f/(l.tileScale.y*l.tileScaleOffset.y);b.x0=0-c;b.y0=0-g;b.x1=1*d-c;b.y1=0-g;b.x2=1*d-c;b.y2=1*f-g;b.x3=0-c;b.y3=1*f-g;c=l.tint;c=(c>>16)+(65280&
c)+((255&c)<<16)+(255*l.worldAlpha<<24);g=this.positions;f=this.colors;var h=l.width,m=l.height,n=l.anchor.x,p=l.anchor.y;d=h*(1-n);h*=-n;n=m*(1-p);m*=-p;p=this.currentBatchSize*this.vertexSize;var q=k.baseTexture.resolution,r=l.worldTransform;k=r.a/q;var u=r.b/q,x=r.c/q;q=r.d/q;var w=r.tx;r=r.ty;g[p++]=k*h+x*m+w;g[p++]=q*m+u*h+r;g[p++]=b.x0;g[p++]=b.y0;f[p++]=c;g[p++]=a;g[p++]=k*d+x*m+w;g[p++]=q*m+u*d+r;g[p++]=b.x1;g[p++]=b.y1;f[p++]=c;g[p++]=a;g[p++]=k*d+x*n+w;g[p++]=q*n+u*d+r;g[p++]=b.x2;g[p++]=
b.y2;f[p++]=c;g[p++]=a;g[p++]=k*h+x*n+w;g[p++]=q*n+u*h+r;g[p++]=b.x3;g[p++]=b.y3;f[p++]=c;g[p++]=a;this.sprites[this.currentBatchSize++]=l};e.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var l,k,a=this.gl;if(this.dirty){this.dirty=!1;var b=this.defaultShader.shaders[a.id];a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.vertexSize;a.vertexAttribPointer(b.aVertexPosition,2,a.FLOAT,
!1,c,0);a.vertexAttribPointer(b.aTextureCoord,2,a.FLOAT,!1,c,8);a.vertexAttribPointer(b.colorAttribute,4,a.UNSIGNED_BYTE,!0,c,16);a.vertexAttribPointer(b.aTextureIndex,1,a.FLOAT,!1,c,20)}this.currentBatchSize>.5*this.size?a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices):(a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),c=this.positions.subarray(0,this.currentBatchSize*this.vertexSize),a.bufferSubData(a.ARRAY_BUFFER,0,c));for(var d,f=c=0,g=null,h=this.renderSession.blendModeManager.currentBlendMode,m=
null,n,p,q=0,r=this.currentBatchSize;q<r;q++){var u=(d=this.sprites[q]).tilingTexture?d.tilingTexture.baseTexture:d.texture.baseTexture;n=h!==(l=d.blendMode);p=m!==(k=d.shader||this.defaultShader);var x=u.skipRender;if(x&&0<d.children.length&&(x=!1),(!e._enableMultiTextureToggle&&g!==u&&!x||n||p)&&(this.renderBatch(g,c,f),f=q,c=0,g=u,n&&(h=l,this.renderSession.blendModeManager.setBlendMode(h)),p))(b=(m=k).shaders[a.id])||((b=new e.PixiShader(a)).fragmentSrc=m.fragmentSrc,b.uniforms=m.uniforms,b.init(),
m.shaders[a.id]=b),this.renderSession.shaderManager.setShader(b),b.dirty&&b.syncUniforms(),u=this.renderSession.projection,a.uniform2f(b.projectionVector,u.x,u.y),u=this.renderSession.offset,a.uniform2f(b.offsetVector,u.x,u.y);c++}this.renderBatch(g,c,f);this.currentBatchSize=0}};e.WebGLSpriteBatch.prototype.renderBatch=function(l,k,a){if(0!==k){var b=this.gl;if(l._dirty[b.id]){if(!this.renderSession.renderer.updateTexture(l))return}else b.bindTexture(b.TEXTURE_2D,l._glTextures[b.id]);b.drawElements(b.TRIANGLES,
6*k,b.UNSIGNED_SHORT,12*a);this.renderSession.drawCount++}};e.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=!0};e.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};e.WebGLSpriteBatch.prototype.destroy=function(){this.indices=this.vertices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.gl=this.currentBaseTexture=null};e.WebGLFastSpriteBatch=function(l){this.vertSize=11;this.size=this.maxSize=6E3;var k=6*this.maxSize;this.vertices=
new Float32Array(4*this.size*this.vertSize);this.indices=new Uint16Array(k);this.indexBuffer=this.vertexBuffer=null;for(var a=this.lastIndexCount=0,b=0;a<k;a+=6,b+=4)this.indices[a+0]=b+0,this.indices[a+1]=b+1,this.indices[a+2]=b+2,this.indices[a+3]=b+0,this.indices[a+4]=b+2,this.indices[a+5]=b+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.matrix=this.shader=this.renderSession=null;this.setContext(l)};e.WebGLFastSpriteBatch.prototype.constructor=
e.WebGLFastSpriteBatch;e.WebGLFastSpriteBatch.prototype.setContext=function(l){this.gl=l;this.vertexBuffer=l.createBuffer();this.indexBuffer=l.createBuffer();l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer);l.bufferData(l.ELEMENT_ARRAY_BUFFER,this.indices,l.STATIC_DRAW);l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer);l.bufferData(l.ARRAY_BUFFER,this.vertices,l.DYNAMIC_DRAW)};e.WebGLFastSpriteBatch.prototype.begin=function(l,k){this.renderSession=k;this.shader=this.renderSession.shaderManager.fastShader;
this.matrix=l.worldTransform.toArray(!0);this.start()};e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.render=function(l){l=l.children;var k=l[0];if(k.texture._uvs){this.currentBaseTexture=k.texture.baseTexture;k.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(k.blendMode));k=this.currentBaseTexture.textureIndex;var a=this.gl;a.activeTexture(a.TEXTURE0+k);a.bindTexture(a.TEXTURE_2D,
this.currentBaseTexture._glTextures[a.id]);e.WebGLRenderer.textureArray[k]=this.currentBaseTexture;k=0;for(a=l.length;k<a;k++)this.renderSprite(l[k]);this.flush()}};e.WebGLFastSpriteBatch.prototype.renderSprite=function(l){var k=l.texture.baseTexture,a=this.gl,b=l.texture.baseTexture.textureIndex;if((e.WebGLRenderer.textureArray[b]==k||!k._glTextures[a.id]||l.texture.baseTexture.skipRender||(this.flush(),a.activeTexture(a.TEXTURE0+b),a.bindTexture(a.TEXTURE_2D,k._glTextures[a.id]),e.WebGLRenderer.textureArray[b]=
k,l.texture._uvs))&&l.visible){var c,d,f=this.vertices;if(k=l.texture._uvs,c=l.texture.frame.width,d=l.texture.frame.height,l.texture.trim){var g=l.texture.trim;a=(c=g.x-l.anchor.x*g.width)+l.texture.crop.width;g=(d=g.y-l.anchor.y*g.height)+l.texture.crop.height}else a=c*(1-l.anchor.x),c*=-l.anchor.x,g=d*(1-l.anchor.y),d*=-l.anchor.y;var h=4*this.currentBatchSize*this.vertSize;f[h++]=c;f[h++]=d;f[h++]=l.position.x;f[h++]=l.position.y;f[h++]=l.scale.x;f[h++]=l.scale.y;f[h++]=l.rotation;f[h++]=k.x0;
f[h++]=k.y1;f[h++]=l.alpha;f[h++]=b;f[h++]=a;f[h++]=d;f[h++]=l.position.x;f[h++]=l.position.y;f[h++]=l.scale.x;f[h++]=l.scale.y;f[h++]=l.rotation;f[h++]=k.x1;f[h++]=k.y1;f[h++]=l.alpha;f[h++]=b;f[h++]=a;f[h++]=g;f[h++]=l.position.x;f[h++]=l.position.y;f[h++]=l.scale.x;f[h++]=l.scale.y;f[h++]=l.rotation;f[h++]=k.x2;f[h++]=k.y2;f[h++]=l.alpha;f[h++]=b;f[h++]=c;f[h++]=g;f[h++]=l.position.x;f[h++]=l.position.y;f[h++]=l.scale.x;f[h++]=l.scale.y;f[h++]=l.rotation;f[h++]=k.x3;f[h++]=k.y3;f[h++]=l.alpha;
f[h++]=b;this.currentBatchSize++;this.currentBatchSize>=this.size&&this.flush()}};e.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var l=this.gl;if(this.currentBaseTexture._glTextures[l.id]){if(this.currentBatchSize>.5*this.size)l.bufferSubData(l.ARRAY_BUFFER,0,this.vertices);else{var k=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);l.bufferSubData(l.ARRAY_BUFFER,0,k)}l.drawElements(l.TRIANGLES,6*this.currentBatchSize,l.UNSIGNED_SHORT,0);this.currentBatchSize=
0;this.renderSession.drawCount++}else this.renderSession.renderer.updateTexture(this.currentBaseTexture,l)}};e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.start=function(){var l=this.gl;l.activeTexture(l.TEXTURE0);l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var k=this.renderSession.projection;l.uniform2f(this.shader.projectionVector,k.x,k.y);l.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);
k=4*this.vertSize;l.vertexAttribPointer(this.shader.aVertexPosition,2,l.FLOAT,!1,k,0);l.vertexAttribPointer(this.shader.aPositionCoord,2,l.FLOAT,!1,k,8);l.vertexAttribPointer(this.shader.aScale,2,l.FLOAT,!1,k,16);l.vertexAttribPointer(this.shader.aRotation,1,l.FLOAT,!1,k,24);l.vertexAttribPointer(this.shader.aTextureCoord,2,l.FLOAT,!1,k,28);l.vertexAttribPointer(this.shader.colorAttribute,1,l.FLOAT,!1,k,36);l.vertexAttribPointer(this.shader.aTextureIndex,1,l.FLOAT,!1,k,40)};e.WebGLFilterManager=function(){this.filterStack=
[];this.offsetY=this.offsetX=0};e.WebGLFilterManager.prototype.constructor=e.WebGLFilterManager;e.WebGLFilterManager.prototype.setContext=function(l){this.gl=l;this.texturePool=[];this.initShaderBuffers()};e.WebGLFilterManager.prototype.begin=function(l,k){this.renderSession=l;this.defaultShader=l.shaderManager.defaultShader;l=this.renderSession.projection;this.width=2*l.x;this.height=2*-l.y;this.buffer=k};e.WebGLFilterManager.prototype.pushFilter=function(l){var k=this.gl,a=this.renderSession.projection,
b=this.renderSession.offset;l._filterArea=l.target.filterArea||l.target.getBounds();l._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new e.WebGLStencilManager;this.renderSession.stencilManager.setContext(k);k.disable(k.STENCIL_TEST);this.filterStack.push(l);var c=l.filterPasses[0];this.offsetX+=l._filterArea.x;this.offsetY+=l._filterArea.y;var d=this.texturePool.pop();d?d.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):
d=new e.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);k.bindTexture(k.TEXTURE_2D,d.texture);var f=l._filterArea;c=c.padding;f.x-=c;f.y-=c;f.width+=2*c;f.height+=2*c;0>f.x&&(f.x=0);f.width>this.width&&(f.width=this.width);0>f.y&&(f.y=0);f.height>this.height&&(f.height=this.height);k.bindFramebuffer(k.FRAMEBUFFER,d.frameBuffer);k.viewport(0,0,f.width*this.renderSession.resolution,f.height*this.renderSession.resolution);a.x=f.width/2;a.y=-f.height/
2;b.x=-f.x;b.y=-f.y;k.colorMask(!0,!0,!0,!0);k.clearColor(0,0,0,0);k.clear(k.COLOR_BUFFER_BIT);l._glFilterTexture=d};e.WebGLFilterManager.prototype.popFilter=function(){var l=this.gl,k=this.filterStack.pop(),a=k._filterArea,b=k._glFilterTexture,c=this.renderSession.projection,d=this.renderSession.offset;if(1<k.filterPasses.length){l.viewport(0,0,a.width*this.renderSession.resolution,a.height*this.renderSession.resolution);l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=
a.height;this.vertexArray[2]=a.width;this.vertexArray[3]=a.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=a.width;this.vertexArray[7]=0;l.bufferSubData(l.ARRAY_BUFFER,0,this.vertexArray);l.bindBuffer(l.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=a.width/this.width;this.uvArray[5]=a.height/this.height;this.uvArray[6]=a.width/this.width;this.uvArray[7]=a.height/this.height;l.bufferSubData(l.ARRAY_BUFFER,0,this.uvArray);var f=this.texturePool.pop();f||=new e.FilterTexture(this.gl,
this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);f.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);l.bindFramebuffer(l.FRAMEBUFFER,f.frameBuffer);l.clear(l.COLOR_BUFFER_BIT);l.disable(l.BLEND);for(var g=0;g<k.filterPasses.length-1;g++){var h=k.filterPasses[g];l.bindFramebuffer(l.FRAMEBUFFER,f.frameBuffer);l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,b.texture);this.applyFilterPass(h,a,a.width,a.height);h=b;b=f;
f=h}l.enable(l.BLEND);this.texturePool.push(f)}f=k.filterPasses[k.filterPasses.length-1];this.offsetX-=a.x;this.offsetY-=a.y;g=this.width;h=this.height;var m=0,n=0,p=this.buffer;0===this.filterStack.length?l.colorMask(!0,!0,!0,!0):(p=this.filterStack[this.filterStack.length-1],g=(a=p._filterArea).width,h=a.height,m=a.x,n=a.y,p=p._glFilterTexture.frameBuffer);c.x=g/2;c.y=-h/2;d.x=m;d.y=n;c=(a=k._filterArea).x-m;d=a.y-n;l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=c;this.vertexArray[1]=
d+a.height;this.vertexArray[2]=c+a.width;this.vertexArray[3]=d+a.height;this.vertexArray[4]=c;this.vertexArray[5]=d;this.vertexArray[6]=c+a.width;this.vertexArray[7]=d;l.bufferSubData(l.ARRAY_BUFFER,0,this.vertexArray);l.bindBuffer(l.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=a.width/this.width;this.uvArray[5]=a.height/this.height;this.uvArray[6]=a.width/this.width;this.uvArray[7]=a.height/this.height;l.bufferSubData(l.ARRAY_BUFFER,0,this.uvArray);l.viewport(0,0,g*this.renderSession.resolution,h*
this.renderSession.resolution);l.bindFramebuffer(l.FRAMEBUFFER,p);l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,b.texture);this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy();this.renderSession.stencilManager=k._previous_stencil_mgr;k._previous_stencil_mgr=null;0<this.renderSession.stencilManager.count?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST);this.applyFilterPass(f,a,g,h);this.texturePool.push(b);k._glFilterTexture=null};e.WebGLFilterManager.prototype.applyFilterPass=
function(l,k,a,b){k=this.gl;var c=l.shaders[k.id];c||((c=new e.PixiShader(k)).fragmentSrc=l.fragmentSrc,c.uniforms=l.uniforms,c.init(!0),l.shaders[k.id]=c);this.renderSession.shaderManager.setShader(c);k.uniform2f(c.projectionVector,a/2,-b/2);k.uniform2f(c.offsetVector,0,0);l.uniforms.dimensions&&(l.uniforms.dimensions.value[0]=this.width,l.uniforms.dimensions.value[1]=this.height,l.uniforms.dimensions.value[2]=this.vertexArray[0],l.uniforms.dimensions.value[3]=this.vertexArray[5]);c.syncUniforms();
k.bindBuffer(k.ARRAY_BUFFER,this.vertexBuffer);k.vertexAttribPointer(c.aVertexPosition,2,k.FLOAT,!1,0,0);k.bindBuffer(k.ARRAY_BUFFER,this.uvBuffer);k.vertexAttribPointer(c.aTextureCoord,2,k.FLOAT,!1,0,0);k.bindBuffer(k.ARRAY_BUFFER,this.colorBuffer);k.vertexAttribPointer(c.colorAttribute,2,k.FLOAT,!1,0,0);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,this.indexBuffer);k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0);this.renderSession.drawCount++};e.WebGLFilterManager.prototype.initShaderBuffers=function(){var l=
this.gl;this.vertexBuffer=l.createBuffer();this.uvBuffer=l.createBuffer();this.colorBuffer=l.createBuffer();this.indexBuffer=l.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer);l.bufferData(l.ARRAY_BUFFER,this.vertexArray,l.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);l.bindBuffer(l.ARRAY_BUFFER,this.uvBuffer);l.bufferData(l.ARRAY_BUFFER,this.uvArray,l.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,
1,16777215,1,16777215]);l.bindBuffer(l.ARRAY_BUFFER,this.colorBuffer);l.bufferData(l.ARRAY_BUFFER,this.colorArray,l.STATIC_DRAW);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer);l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),l.STATIC_DRAW)};e.WebGLFilterManager.prototype.destroy=function(){var l=this.gl;this.filterStack=null;for(var k=this.offsetY=this.offsetX=0;k<this.texturePool.length;k++)this.texturePool[k].destroy();this.texturePool=null;l.deleteBuffer(this.vertexBuffer);
l.deleteBuffer(this.uvBuffer);l.deleteBuffer(this.colorBuffer);l.deleteBuffer(this.indexBuffer)};var v={36054:"Incomplete attachment",36055:"Missing attachment",36057:"Incomplete dimensions",36061:"Framebuffer unsupported"};return e.FilterTexture=function(l,k,a,b,c){this.gl=l;this.frameBuffer=t(l,k,a,b||e.scaleModes.DEFAULT,"number"==typeof c?c:0);this.texture=this.frameBuffer.targetTexture;this.width=k;this.height=a;this.renderBuffer=this.frameBuffer.renderBuffer},e.FilterTexture.prototype.constructor=
e.FilterTexture,e.FilterTexture.prototype.clear=function(){var l=this.gl;l.clearColor(0,0,0,0);l.clear(l.COLOR_BUFFER_BIT)},e.FilterTexture.prototype.resize=function(l,k){if(this.width!==l||this.height!==k){this.width=l;this.height=k;var a=this.gl;a.bindTexture(a.TEXTURE_2D,this.texture);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,l,k,0,a.RGBA,a.UNSIGNED_BYTE,null);a.bindRenderbuffer(a.RENDERBUFFER,this.renderBuffer);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,l,k)}},e.FilterTexture.prototype.destroy=
function(){var l=this.gl;l.deleteFramebuffer(this.frameBuffer);l.deleteTexture(this.texture);this.texture=this.frameBuffer=null},e.CanvasBuffer=function(l,k){this.width=l;this.height=k;this.canvas=Phaser.CanvasPool.create(this,this.width,this.height);this.context=this.canvas.getContext("2d");this.canvas.width=l;this.canvas.height=k},e.CanvasBuffer.prototype.constructor=e.CanvasBuffer,e.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,
this.height)},e.CanvasBuffer.prototype.resize=function(l,k){this.width=this.canvas.width=l;this.height=this.canvas.height=k},e.CanvasBuffer.prototype.destroy=function(){Phaser.CanvasPool.remove(this)},e.CanvasMaskManager=function(){},e.CanvasMaskManager.prototype.constructor=e.CanvasMaskManager,e.CanvasMaskManager.prototype.pushMask=function(l,k){var a=k.context;a.save();var b=l.alpha,c=l.worldTransform;k=k.resolution;a.setTransform(c.a*k,c.b*k,c.c*k,c.d*k,c.tx*k,c.ty*k);e.CanvasGraphics.renderGraphicsMask(l,
a);a.clip();l.worldAlpha=b},e.CanvasMaskManager.prototype.popMask=function(l){l.context.restore()},e.CanvasTinter=function(){},e.CanvasTinter.getTintedTexture=function(l,k){var a=l.tintedTexture||Phaser.CanvasPool.create(this);return e.CanvasTinter.tintMethod(l.texture,k,a),a},e.CanvasTinter.tintWithMultiply=function(l,k,a){var b=a.getContext("2d"),c=l.crop,d=c.width,f=c.height;l.rotated&&(d=f,f=c.width);a.width===d&&a.height===f||(a.width=d,a.height=f);b.clearRect(0,0,d,f);b.fillStyle="#"+("00000"+
(0|k).toString(16)).substr(-6);b.fillRect(0,0,d,f);b.globalCompositeOperation="multiply";b.drawImage(l.baseTexture.source,c.x,c.y,d,f,0,0,d,f);b.globalCompositeOperation="destination-atop";b.drawImage(l.baseTexture.source,c.x,c.y,d,f,0,0,d,f)},e.CanvasTinter.tintWithPerPixel=function(l,k,a){var b=a.getContext("2d"),c=l.crop,d=c.width,f=c.height;l.rotated&&(d=f,f=c.width);a.width===d&&a.height===f||(a.width=d,a.height=f);b.globalCompositeOperation="copy";b.drawImage(l.baseTexture.source,c.x,c.y,d,
f,0,0,d,f);a=Phaser.Color.hexToRGBArray(k);l=a[0];k=a[1];a=a[2];d=b.getImageData(0,0,d,f);f=d.data;for(c=0;c<f.length;c+=4)if(f[c+0]*=l,f[c+1]*=k,f[c+2]*=a,!e.CanvasTinter.canHandleAlpha){var g=f[c+3];f[c+0]/=255/g;f[c+1]/=255/g;f[c+2]/=255/g}b.putImageData(d,0,0)},e.CanvasRenderer=function(l,k){if(this.game=l,this.type=Phaser.CANVAS,this.resolution=l.resolution,this.clearBeforeRender=l.clearBeforeRender,this.transparent=l.transparent,this.autoResize=!1,this.width=l.width*this.resolution,this.height=
l.height*this.resolution,this.view=l.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),!this.context)throw Error("Failed to create a Canvas 2d context.");this.refresh=!0;this.count=0;this.maskManager=new e.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:k.roundPixels||!1};this.mapBlendModes();this.resize(this.width,this.height)},e.CanvasRenderer.prototype.constructor=
e.CanvasRenderer,e.CanvasRenderer.prototype.render=function(l){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=0;this.renderSession.shakeX=this.game.camera._shake.x;this.renderSession.shakeY=this.game.camera._shake.y;this.context.globalCompositeOperation="source-over";navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,
this.height):l._bgColor&&(this.context.fillStyle=l._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height)));this.renderDisplayObject(l)},e.CanvasRenderer.prototype.postRender=function(){},e.CanvasRenderer.prototype.setTexturePriority=function(){},e.CanvasRenderer.prototype.destroy=function(l){void 0===l&&(l=!0);l&&this.view.parent&&this.view.parent.removeChild(this.view);this.renderSession=this.maskManager=this.context=this.view=null},e.CanvasRenderer.prototype.resize=function(l,k){this.width=
l*this.resolution;this.height=k*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px");this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===e.scaleModes.LINEAR)},e.CanvasRenderer.prototype.renderDisplayObject=function(l,k,a){this.renderSession.context=k||this.context;this.renderSession.resolution=
this.resolution;l._renderCanvas(this.renderSession,a)},e.CanvasRenderer.prototype.mapBlendModes=function(){if(!e.blendModesCanvas){var l=[],k=e.blendModes,a=this.game.device.canUseMultiply;l[k.NORMAL]="source-over";l[k.ADD]="lighter";l[k.MULTIPLY]=a?"multiply":"source-over";l[k.SCREEN]=a?"screen":"source-over";l[k.OVERLAY]=a?"overlay":"source-over";l[k.DARKEN]=a?"darken":"source-over";l[k.LIGHTEN]=a?"lighten":"source-over";l[k.COLOR_DODGE]=a?"color-dodge":"source-over";l[k.COLOR_BURN]=a?"color-burn":
"source-over";l[k.HARD_LIGHT]=a?"hard-light":"source-over";l[k.SOFT_LIGHT]=a?"soft-light":"source-over";l[k.DIFFERENCE]=a?"difference":"source-over";l[k.EXCLUSION]=a?"exclusion":"source-over";l[k.HUE]=a?"hue":"source-over";l[k.SATURATION]=a?"saturation":"source-over";l[k.COLOR]=a?"color":"source-over";l[k.LUMINOSITY]=a?"luminosity":"source-over";e.blendModesCanvas=l}},e.BaseTexture=function(l,k,a){this.resolution=a||1;this.height=this.width=100;this.scaleMode=k||e.scaleModes.DEFAULT;this.hasLoaded=
!1;this.source=l;this.premultipliedAlpha=!0;this._glTextures=[];this.mipmap=!1;this.textureIndex=0;this._dirty=[!0,!0,!0,!0];l&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},e.BaseTexture.prototype.constructor=e.BaseTexture,e.BaseTexture.prototype.forceLoaded=function(l,k){this.hasLoaded=
!0;this.width=l;this.height=k;this.dirty()},e.BaseTexture.prototype.destroy=function(){this.source&&Phaser.CanvasPool.removeByCanvas(this.source);this.source=null;this.unloadFromGPU()},e.BaseTexture.prototype.dirty=function(){for(var l=0;l<this._glTextures.length;l++)this._dirty[l]=!0},e.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var l=this._glTextures.length-1;0<=l;l--){var k=this._glTextures[l],a=e.glContexts[l];a&&k&&a.deleteTexture(k)}this._glTextures.length=0;this.dirty()},
e.BaseTexture.fromCanvas=function(l,k,a){return 0===l.width&&(l.width=1),0===l.height&&(l.height=1),a=a||1,new e.BaseTexture(l,k,a)},e.TextureSilentFail=!1,e.Texture=function(l,k,a,b){this.noFrame=!1;k||(this.noFrame=!0,k=new e.Rectangle(0,0,1,1));l instanceof e.Texture&&(l=l.baseTexture);this.baseTexture=l;this.frame=k;this.trim=b;this.requiresReTint=this.requiresUpdate=this.isTiling=this.valid=!1;this._uvs=null;this.height=this.width=0;this.crop=a||new e.Rectangle(0,0,1,1);this.rotated=!1;l.hasLoaded&&
(this.noFrame&&(k=new e.Rectangle(0,0,l.width,l.height)),this.setFrame(k))},e.Texture.prototype.constructor=e.Texture,e.Texture.prototype.onBaseTextureLoaded=function(){var l=this.baseTexture;this.noFrame&&(this.frame=new e.Rectangle(0,0,l.width,l.height));this.setFrame(this.frame)},e.Texture.prototype.destroy=function(l){l&&this.baseTexture.destroy();this.valid=!1},e.Texture.prototype.setFrame=function(l){if(this.noFrame=!1,this.frame=l,this.width=l.width,this.height=l.height,this.crop.x=l.x,this.crop.y=
l.y,this.crop.width=l.width,this.crop.height=l.height,this.trim||!(l.x+l.width>this.baseTexture.width||l.y+l.height>this.baseTexture.height))this.valid=l&&l.width&&l.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs();else{if(!e.TextureSilentFail)throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+
this);this.valid=!1}},e.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new e.TextureUvs);var l=this.crop,k=this.baseTexture.width,a=this.baseTexture.height;this._uvs.x0=l.x/k;this._uvs.y0=l.y/a;this._uvs.x1=(l.x+l.width)/k;this._uvs.y1=l.y/a;this._uvs.x2=(l.x+l.width)/k;this._uvs.y2=(l.y+l.height)/a;this._uvs.x3=l.x/k;this._uvs.y3=(l.y+l.height)/a},e.Texture.prototype._updateUvsInverted=function(){this._uvs||(this._uvs=new e.TextureUvs);var l=this.crop,k=this.baseTexture.width,a=this.baseTexture.height;
this._uvs.x0=l.x/k;this._uvs.y0=l.y/a;this._uvs.x1=(l.x+l.height)/k;this._uvs.y1=l.y/a;this._uvs.x2=(l.x+l.height)/k;this._uvs.y2=(l.y+l.width)/a;this._uvs.x3=l.x/k;this._uvs.y3=(l.y+l.width)/a},e.Texture.fromCanvas=function(l,k){l=e.BaseTexture.fromCanvas(l,k);return new e.Texture(l)},e.TextureUvs=function(){this.y3=this.x3=this.y2=this.x2=this.y1=this.x1=this.y0=this.x0=0},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.PIXI=e):"undefined"!=
typeof define&&define.amd?define("PIXI",this.PIXI=e):this.PIXI=e,e}).call(this);
(function(){var t,e=e||{VERSION:"2.20.0",AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGL_MULTI:4,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,
LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,
COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{},_UID:0,_ID:0};if("undefined"!=typeof AudioBufferSourceNode&&(AudioBufferSourceNode.prototype.start||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),AudioBufferSourceNode.prototype.stop||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff)),Math.trunc||(Math.trunc=function(a){return 0>a?Math.ceil(a):Math.floor(a)}),Function.prototype.bind||(Function.prototype.bind=
(t=Array.prototype.slice,function(a){function b(){var f=d.concat(t.call(arguments));c.apply(this instanceof b?this:a,f)}var c=this,d=t.call(arguments,1);if("function"!=typeof c)throw new TypeError;return b.prototype=function h(g){if(g&&(h.prototype=g),!(this instanceof h))return new h}(c.prototype),b})),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.forEach||(Array.prototype.forEach=function(a){if(null==this)throw new TypeError;
var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=2<=arguments.length?arguments[1]:void 0,f=0;f<c;f++)f in b&&a.call(d,b[f],f,b)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var v=function(a){window[a]=function(b){if("number"==typeof b){Array.call(this,b);this.length=b;for(var c=0;c<this.length;c++)this[c]=0}else for(Array.call(this,b.length),this.length=b.length,c=0;c<this.length;c++)this[c]=b[c]};window[a].prototype=[];window[a].constructor=
window[a]};v("Float32Array");v("Uint32Array");v("Uint16Array");v("Int16Array");v("ArrayBuffer")}for(var l in window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),Object.assign||(Object.assign=function(a,b){if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=Object.prototype.hasOwnProperty,f=1;f<arguments.length;f++){var g=arguments[f];if(null!=g)for(var h in g)d.call(g,
h)&&(c[h]=g[h])}return c}),e.Utils={defaults:function(a,b){for(var c=Object.keys(b),d=0,f=c.length;d<f;d++){var g=c[d];void 0===a[g]&&(a[g]=b[g])}return a},reverseString:function(a){return a.split("").reverse().join("")},getProperty:function(a,b){var c=b.split(".");switch(c.length){case 1:return a[b];case 2:return a[c[0]][c[1]];case 3:return a[c[0]][c[1]][c[2]];case 4:return a[c[0]][c[1]][c[2]][c[3]];default:return this._getProperty(a,b)}},setProperties:function(a,b){for(var c in b)this.setProperty(a,
c,b[c]);return a},setProperty:function(a,b,c){var d=b.split(".");switch(d.length){case 1:a[b]=c;break;case 2:a[d[0]][d[1]]=c;break;case 3:a[d[0]][d[1]][d[2]]=c;break;case 4:a[d[0]][d[1]][d[2]][d[3]]=c;break;default:this._setProperty(a,b,c)}},_getProperty:function(a,b){b=b.split(".");for(var c=b.length,d=0;d<c;){if(null==a)return;a=a[b[d]];d++}return a},_setProperty:function(a,b,c){var d=b.split("."),f=d.length,g=0,h=a,m=d[0];if(1===f)a[b]=c;else{for(;g<f-1;)h=h[m],m=d[++g];h[m]=c}return a},chanceRoll:function(a){return void 0===
a&&(a=50),0<a&&100*Math.random()<=a},randomChoice:function(a,b){return.5>Math.random()?a:b},parseDimension:function(a,b){var c=0;return"string"==typeof a?"%"===a.substr(-1)?(c=parseInt(a,10)/100,0===b?window.innerWidth*c:window.innerHeight*c):parseInt(a,10):a},pad:function(a,b,c,d){void 0===b&&(b=0);void 0===c&&(c=" ");void 0===d&&(d=3);if(b+1>=(a=a.toString()).length)switch(d){case 1:a=Array(b+1-a.length).join(c)+a;break;case 3:d=Math.ceil((b-=a.length)/2);a=Array(b-d+1).join(c)+a+Array(d+1).join(c);
break;default:a+=Array(b+1-a.length).join(c)}return a},isPlainObject:function(a){if("object"!=typeof a||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},extend:function(){var a,b,c,d,f,g=arguments[0]||{},h=1,m=arguments.length,n=!1;"boolean"==typeof g&&(n=g,g=arguments[1]||{},h=2);for(m===h&&(g=this,--h);h<m;h++)if(null!=(a=arguments[h]))for(b in a){var p=g[b];g!==(c=a[b])&&(n&&c&&(e.Utils.isPlainObject(c)||
(d=Array.isArray(c)))?(f=d?(d=!1,p&&Array.isArray(p)?p:[]):p&&e.Utils.isPlainObject(p)?p:{},g[b]=e.Utils.extend(n,f,c)):void 0!==c&&(g[b]=c))}return g},mixinPrototype:function(a,b,c){void 0===c&&(c=!1);for(var d=Object.keys(b),f=0;f<d.length;f++){var g=d[f],h=b[g];!c&&g in a||(!h||"function"!=typeof h.get&&"function"!=typeof h.set?a[g]=h:"function"==typeof h.clone?a[g]=h.clone():Object.defineProperty(a,g,h))}},mixin:function(a,b){if(!a||"object"!=typeof a)return b;for(var c in a){var d=a[c];if(!d.childNodes&&
!d.cloneNode){var f=typeof a[c];a[c]&&"object"===f?typeof b[c]===f?b[c]=e.Utils.mixin(a[c],b[c]):b[c]=e.Utils.mixin(a[c],new d.constructor):b[c]=a[c]}}return b}},e.Circle=function(a,b,c){c=c||0;this.x=a||0;this.y=b||0;this._diameter=c;(this._radius=0)<c&&(this._radius=.5*c);this.type=e.CIRCLE},e.Circle.prototype={circumference:function(){return Math.PI*this._radius*2},random:function(a){void 0===a&&(a=new e.Point);var b=2*Math.PI*Math.random(),c=Math.random()+Math.random();c=1<c?2-c:c;var d=c*Math.sin(b);
return a.x=this.x+c*Math.cos(b)*this.radius,a.y=this.y+d*this.radius,a},getBounds:function(){return new e.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(a,b,c){return this.x=a,this.y=b,this._diameter=c,this._radius=.5*c,this},copyFrom:function(a){return this.setTo(a.x,a.y,a.diameter)},copyTo:function(a){return a.x=this.x,a.y=this.y,a.diameter=this._diameter,a},distance:function(a,b){a=e.Math.distance(this.x,this.y,a.x,a.y);return b?Math.round(a):a},clone:function(a){return null==
a?a=new e.Circle(this.x,this.y,this.diameter):a.setTo(this.x,this.y,this.diameter),a},contains:function(a,b){return e.Circle.contains(this,a,b)},circumferencePoint:function(a,b,c){return e.Circle.circumferencePoint(this,a,b,c)},sample:function(a,b,c,d,f){a||=60;null==b&&(b=0);null==c&&(c=e.Math.PI2);f||=[];for(var g=0;g<a;)this.circumferencePoint(e.Math.linear(b,c,g/a),d,f[g]||(f[g]=new e.Point)),g+=1;return f},offset:function(a,b){return this.x+=a,this.y+=b,this},offsetPoint:function(a){return this.offset(a.x,
a.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},e.Circle.prototype.constructor=e.Circle,Object.defineProperty(e.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(a){0<a&&(this._diameter=a,this._radius=.5*a)}}),Object.defineProperty(e.Circle.prototype,"radius",{get:function(){return this._radius},set:function(a){0<a&&(this._radius=a,this._diameter=2*a)}}),Object.defineProperty(e.Circle.prototype,
"left",{get:function(){return this.x-this._radius},set:function(a){a>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-a}}),Object.defineProperty(e.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(a){a<this.x?(this._radius=0,this._diameter=0):this.radius=a-this.x}}),Object.defineProperty(e.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(a){a>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-a}}),Object.defineProperty(e.Circle.prototype,
"bottom",{get:function(){return this.y+this._radius},set:function(a){a<this.y?(this._radius=0,this._diameter=0):this.radius=a-this.y}}),Object.defineProperty(e.Circle.prototype,"area",{get:function(){return 0<this._radius?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(e.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(a){!0===a&&this.setTo(0,0,0)}}),e.Circle.contains=function(a,b,c){return 0<a.radius&&b>=a.left&&b<=a.right&&c>=a.top&&c<=a.bottom&&(a.x-
b)*(a.x-b)+(a.y-c)*(a.y-c)<=a.radius*a.radius},e.Circle.equals=function(a,b){return a.x===b.x&&a.y===b.y&&a.diameter===b.diameter},e.Circle.intersects=function(a,b){return e.Math.distance(a.x,a.y,b.x,b.y)<=a.radius+b.radius},e.Circle.circumferencePoint=function(a,b,c,d){return void 0===c&&(c=!1),void 0===d&&(d=new e.Point),!0===c&&(b=e.Math.degToRad(b)),d.x=a.x+a.radius*Math.cos(b),d.y=a.y+a.radius*Math.sin(b),d},e.Circle.intersectsRectangle=function(a,b){var c=Math.abs(a.x-b.x-b.halfWidth);if(b.halfWidth+
a.radius<c)return!1;var d=Math.abs(a.y-b.y-b.halfHeight);if(b.halfHeight+a.radius<d)return!1;if(c<=b.halfWidth||d<=b.halfHeight)return!0;c-=b.halfWidth;b=d-b.halfHeight;return c*c+b*b<=a.radius*a.radius},e.Circle.intersectsLine=function(a,b,c){var d=a.x,f=a.y,g=(b.end.y-b.start.y)/(b.end.x-b.start.x),h=b.end.y-g*b.end.x,m=a.radius,n=a.radius,p=h+g*d;a=(d*n*n-g*m*m*(h-f)+m*n*Math.sqrt(m*m*g*g+n*n-p*p-f*f+2*p*f))/(m*m*g*g+n*n);d=(d*n*n-g*m*m*(h-f)-m*n*Math.sqrt(m*m*g*g+n*n-p*p-f*f+2*p*f))/(m*m*g*g+
n*n);f=g*d+h;g=new e.Point(a,g*a+h);h=new e.Point(d,f);a=b.pointOnSegment(g.x,g.y,.01);b=b.pointOnSegment(h.x,h.y,.01);return a&&b?!c||[g,h]:a?!c||[g]:b?!c||[h]:!!c&&[]},PIXI.Circle=e.Circle,e.Ellipse=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0;this.type=e.ELLIPSE},e.Ellipse.prototype={setTo:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},getBounds:function(){return new e.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},
copyFrom:function(a){return this.setTo(a.x,a.y,a.width,a.height)},copyTo:function(a){return a.x=this.x,a.y=this.y,a.width=this.width,a.height=this.height,a},clone:function(a){return null==a?a=new e.Ellipse(this.x,this.y,this.width,this.height):a.setTo(this.x,this.y,this.width,this.height),a},contains:function(a,b){return e.Ellipse.contains(this,a,b)},random:function(a){void 0===a&&(a=new e.Point);var b=Math.random()*Math.PI*2,c=Math.sqrt(Math.random());return a.x=this.centerX+.5*c*Math.cos(b)*this.width,
a.y=this.centerY+.5*c*Math.sin(b)*this.height,a},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},e.Ellipse.prototype.constructor=e.Ellipse,Object.defineProperty(e.Ellipse.prototype,"left",{get:function(){return this.x},set:function(a){this.x=a}}),Object.defineProperty(e.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(a){a<this.x?this.width=0:this.width=a-this.x}}),Object.defineProperty(e.Ellipse.prototype,
"top",{get:function(){return this.y},set:function(a){this.y=a}}),Object.defineProperty(e.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){a<this.y?this.height=0:this.height=a-this.y}}),Object.defineProperty(e.Ellipse.prototype,"centerX",{get:function(){return this.x+.5*this.width}}),Object.defineProperty(e.Ellipse.prototype,"centerY",{get:function(){return this.y+.5*this.height}}),Object.defineProperty(e.Ellipse.prototype,"empty",{get:function(){return 0===this.width||
0===this.height},set:function(a){!0===a&&this.setTo(0,0,0,0)}}),e.Ellipse.contains=function(a,b,c){if(0>=a.width||0>=a.height)return!1;b=(b-a.x)/a.width-.5;a=(c-a.y)/a.height-.5;return.25>b*b+a*a},e.Ellipse.intersectsLine=function(a,b,c){var d=a.x,f=a.y,g=(b.end.y-b.start.y)/(b.end.x-b.start.x),h=b.end.y-g*b.end.x,m=a.width/2,n=a.height/2,p=h+g*d;a=(d*n*n-g*m*m*(h-f)+m*n*Math.sqrt(m*m*g*g+n*n-p*p-f*f+2*p*f))/(m*m*g*g+n*n);d=(d*n*n-g*m*m*(h-f)-m*n*Math.sqrt(m*m*g*g+n*n-p*p-f*f+2*p*f))/(m*m*g*g+n*n);
f=g*d+h;g=new e.Point(a,g*a+h);h=new e.Point(d,f);a=b.pointOnSegment(g.x,g.y,.01);b=b.pointOnSegment(h.x,h.y,.01);return a&&b?!c||[g,h]:a?!c||[g]:b?!c||[h]:!!c&&[]},PIXI.Ellipse=e.Ellipse,e.Line=function(a,b,c,d){c=c||0;d=d||0;this.start=new e.Point(a||0,b||0);this.end=new e.Point(c,d);this.type=e.LINE},e.Line.prototype={setTo:function(a,b,c,d){return this.start.setTo(a,b),this.end.setTo(c,d),this},fromPoints:function(a,b){return this.setTo(a.x,a.y,b.x,b.y),this},fromSprite:function(a,b,c){return void 0===
c&&(c=!1),c?this.setTo(a.centerX,a.centerY,b.centerX,b.centerY):this.fromPoints(a,b)},fromAngle:function(a,b,c,d){return this.start.setTo(a,b),this.end.setTo(a+Math.cos(c)*d,b+Math.sin(c)*d),this},rotate:function(a,b){var c=(this.start.x+this.end.x)/2,d=(this.start.y+this.end.y)/2;return this.start.rotate(c,d,a,b),this.end.rotate(c,d,a,b),this},rotateAround:function(a,b,c,d){return this.start.rotate(a,b,c,d),this.end.rotate(a,b,c,d),this},intersects:function(a,b,c){return e.Line.intersectsPoints(this.start,
this.end,a.start,a.end,b,c)},reflect:function(a){return e.Line.reflect(this,a)},midPoint:function(a){return void 0===a&&(a=new e.Point),a.x=(this.start.x+this.end.x)/2,a.y=(this.start.y+this.end.y)/2,a},centerOn:function(a,b){a-=(this.start.x+this.end.x)/2;b-=(this.start.y+this.end.y)/2;this.start.add(a,b);this.end.add(a,b)},pointOnLine:function(a,b,c){return e.Math.fuzzyEqual((a-this.start.x)*(this.end.y-this.start.y),(this.end.x-this.start.x)*(b-this.start.y),c||0)},pointOnSegment:function(a,b,
c){var d=Math.min(this.start.x,this.end.x),f=Math.max(this.start.x,this.end.x),g=Math.min(this.start.y,this.end.y),h=Math.max(this.start.y,this.end.y);return this.pointOnLine(a,b,c)&&d<=a&&a<=f&&g<=b&&b<=h},random:function(a){void 0===a&&(a=new e.Point);var b=Math.random();return a.x=this.start.x+b*(this.end.x-this.start.x),a.y=this.start.y+b*(this.end.y-this.start.y),a},coordinatesOnLine:function(a,b){void 0===a&&(a=1);void 0===b&&(b=[]);var c=Math.round(this.start.x),d=Math.round(this.start.y),
f=Math.round(this.end.x),g=Math.round(this.end.y),h=Math.abs(f-c),m=Math.abs(g-d),n=c<f?1:-1,p=d<g?1:-1,q=h-m;b.push([c,d]);for(var r=1;c!==f||d!==g;){var u=q<<1;-m<u&&(q-=m,c+=n);u<h&&(q+=h,d+=p);0==r%a&&b.push([c,d]);r++}return b},clone:function(a){return null==a?a=new e.Line(this.start.x,this.start.y,this.end.x,this.end.y):a.setTo(this.start.x,this.start.y,this.end.x,this.end.y),a}},Object.defineProperty(e.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-
this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(e.Line.prototype,"angle",{get:function(){return e.Point.angle(this.end,this.start)}}),Object.defineProperty(e.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(e.Line.prototype,"perpSlope",{get:function(){return-(this.end.x-this.start.x)/(this.end.y-this.start.y)}}),Object.defineProperty(e.Line.prototype,"x",{get:function(){return Math.min(this.start.x,
this.end.x)}}),Object.defineProperty(e.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(e.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(e.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(e.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(e.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,
this.end.y)}}),Object.defineProperty(e.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(e.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),Object.defineProperty(e.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}}),Object.defineProperty(e.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}}),Object.defineProperty(e.Line.prototype,"normalAngle",
{get:function(){return e.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}}),e.Line.intersectsPoints=function(a,b,c,d,f,g){void 0===f&&(f=!0);void 0===g&&(g=new e.Point);var h=b.y-a.y,m=d.y-c.y,n=a.x-b.x,p=c.x-d.x,q=b.x*a.y-a.x*b.y,r=d.x*c.y-c.x*d.y,u=h*p-m*n;return 0===u?null:(g.x=(n*r-p*q)/u,g.y=(m*q-h*r)/u,f)?(f=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y),d=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/f,a=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/f,0<=d&&1>=d&&0<=a&&1>=a?g:null):g},e.Line.intersects=
function(a,b,c,d){return e.Line.intersectsPoints(a.start,a.end,b.start,b.end,c,d)},e.Line.intersectsRectangle=function(a,b){if(0===a.length||b.empty)return!1;var c=a.start.x,d=a.start.y,f=a.end.x;a=a.end.y;var g=b.x,h=b.y,m=b.right;b=b.bottom;var n=0;if(g<=c&&c<=m&&h<=d&&d<=b||g<=f&&f<=m&&h<=a&&a<=b)return!0;if(c<g&&g<=f){if(h<(n=d+(a-d)*(g-c)/(f-c))&&n<=b)return!0}else if(m<c&&f<=m&&h<=(n=d+(a-d)*(m-c)/(f-c))&&n<=b)return!0;if(d<h&&h<=a){if(g<=(n=c+(f-c)*(h-d)/(a-d))&&n<=m)return!0}else if(b<d&&
a<=b&&g<=(n=c+(f-c)*(b-d)/(a-d))&&n<=m)return!0;return!1},e.Line.intersectionWithRectangle=function(a,b,c){var d=e.Line.intersectionWithRectangle;c||=new e.Point;d.edges||(d.edges=[new e.Line,new e.Line,new e.Line,new e.Line]);d.edgeIntersection||(d.edgeIntersection=new e.Point);var f=d.edges;d=d.edgeIntersection.set(0);var g=b.x,h=b.y,m=b.right,n=b.bottom;b=1/0;f[0].setTo(g,h,m,h);f[1].setTo(g,n,m,n);f[2].setTo(g,h,g,n);f[3].setTo(m,h,m,n);for(h=0;g=f[h];h++)if(a.intersects(g,!0,d)){var p=a.start.distance(d);
p<b&&(b=p,c.copyFrom(d))}return null!=p?c:null},e.Line.reflect=function(a,b){return 2*b.normalAngle-3.141592653589793-a.angle},e.Matrix=function(a,b,c,d,f,g){null==a&&(a=1);null==b&&(b=0);null==c&&(c=0);null==d&&(d=1);null==f&&(f=0);null==g&&(g=0);this.a=a;this.b=b;this.c=c;this.d=d;this.tx=f;this.ty=g;this.type=e.MATRIX},e.Matrix.prototype={fromArray:function(a){return this.setTo(a[0],a[1],a[3],a[4],a[2],a[5])},setTo:function(a,b,c,d,f,g){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=f,this.ty=
g,this},clone:function(a){return null==a?a=new e.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(a.a=this.a,a.b=this.b,a.c=this.c,a.d=this.d,a.tx=this.tx,a.ty=this.ty),a},copyTo:function(a){return a.copyFrom(this),a},copyFrom:function(a){return this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.tx=a.tx,this.ty=a.ty,this},toArray:function(a,b){return void 0===b&&(b=new Float32Array(9)),a?(b[0]=this.a,b[1]=this.b,b[2]=0,b[3]=this.c,b[4]=this.d,b[5]=0,b[6]=this.tx,b[7]=this.ty):(b[0]=this.a,b[1]=
this.c,b[2]=this.tx,b[3]=this.b,b[4]=this.d,b[5]=this.ty,b[6]=0,b[7]=0),b[8]=1,b},apply:function(a,b){return void 0===b&&(b=new e.Point),b.x=this.a*a.x+this.c*a.y+this.tx,b.y=this.b*a.x+this.d*a.y+this.ty,b},applyInverse:function(a,b){void 0===b&&(b=new e.Point);var c=1/(this.a*this.d+this.c*-this.b),d=a.x;a=a.y;return b.x=this.d*c*d+-this.c*c*a+(this.ty*this.c-this.tx*this.d)*c,b.y=this.a*c*a+-this.b*c*d+(-this.ty*this.a+this.tx*this.b)*c,b},translate:function(a,b){return this.tx+=a,this.ty+=b,this},
scale:function(a,b){return this.a*=a,this.d*=b,this.c*=a,this.b*=b,this.tx*=a,this.ty*=b,this},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.a,d=this.c,f=this.tx;return this.a=c*b-this.b*a,this.b=c*a+this.b*b,this.c=d*b-this.d*a,this.d=d*a+this.d*b,this.tx=f*b-this.ty*a,this.ty=f*a+this.ty*b,this},append:function(a){var b=this.a,c=this.b,d=this.c,f=this.d;return this.a=a.a*b+a.b*d,this.b=a.a*c+a.b*f,this.c=a.c*b+a.d*d,this.d=a.c*c+a.d*f,this.tx=a.tx*b+a.ty*d+this.tx,this.ty=a.tx*c+
a.ty*f+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}},e.identityMatrix=new e.Matrix,e.Point=function(a,b){this.x=a||0;this.y=b||0;this.type=e.POINT},e.Point.prototype={copyFrom:function(a){return this.setTo(a.x,a.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(a,b){return e.Point.set(this,a,b)},set:function(a,b){return e.Point.set(this,a,b)},setToPolar:function(a,b,c){return null==b&&(b=1),c&&(a=e.Math.degToRad(a)),this.setTo(Math.cos(a)*b,Math.sin(a)*b)},
add:function(a,b){return this.x+=a,this.y+=b,this},subtract:function(a,b){return this.x-=a,this.y-=b,this},multiply:function(a,b){return this.x*=a,this.y*=b,this},divide:function(a,b){return this.x/=a,this.y/=b,this},clampX:function(a,b){return this.x=e.Math.clamp(this.x,a,b),this},clampY:function(a,b){return this.y=e.Math.clamp(this.y,a,b),this},clamp:function(a,b){return this.x=e.Math.clamp(this.x,a,b),this.y=e.Math.clamp(this.y,a,b),this},clip:function(a){var b=a.left,c=a.top,d=a.right;a=a.bottom;
return this.x<b?this.x=b:this.x>d&&(this.x=d),this.y<c?this.y=c:this.y>a&&(this.y=a),this},clone:function(a){return null==a?a=new e.Point(this.x,this.y):a.setTo(this.x,this.y),a},copyTo:function(a){return a.x=this.x,a.y=this.y,a},distance:function(a,b){return e.Point.distance(this,a,b)},equals:function(a){return a.x===this.x&&a.y===this.y},equalsXY:function(a,b){return this.x===a&&this.y===b},fuzzyEquals:function(a,b){return e.Point.fuzzyEquals(this,a,b)},fuzzyEqualsXY:function(a,b,c){return e.Point.fuzzyEqualsXY(this,
a,b,c)},angle:function(a,b){return this.angleXY(a.x,a.y,b)},angleXY:function(a,b,c){a=Math.atan2(b-this.y,a-this.x);return c?e.Math.radToDeg(a):a},atan:function(a){var b=Math.atan2(this.y,this.x);return a?e.Math.radToDeg(b):b},rotate:function(a,b,c,d,f){return e.Point.rotate(this,a,b,c,d,f)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(a){return this.normalize().multiply(a,a)},normalize:function(){if(!this.isZero()){var a=
this.getMagnitude();this.x/=a;this.y/=a}return this},limit:function(a){return this.getMagnitudeSq()>a*a&&this.setMagnitude(a),this},expand:function(a){return this.getMagnitudeSq()<a*a&&this.setMagnitude(a),this},isZero:function(){return 0===this.x&&0===this.y},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*
this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},round:function(){return this.setTo(Math.round(this.x),Math.round(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},e.Point.prototype.constructor=e.Point,e.Point.add=function(a,b,c){return void 0===c&&(c=new e.Point),c.x=a.x+b.x,c.y=a.y+b.y,c},e.Point.subtract=function(a,b,c){return void 0===c&&(c=new e.Point),
c.x=a.x-b.x,c.y=a.y-b.y,c},e.Point.multiply=function(a,b,c){return void 0===c&&(c=new e.Point),c.x=a.x*b.x,c.y=a.y*b.y,c},e.Point.divide=function(a,b,c){return void 0===c&&(c=new e.Point),c.x=a.x/b.x,c.y=a.y/b.y,c},e.Point.equals=function(a,b){return a.x===b.x&&a.y===b.y},e.Point.equalsXY=function(a,b,c){return a.x===b&&a.y===c},e.Point.fuzzyEquals=function(a,b,c){return e.Math.fuzzyEqual(a.x,b.x,c)&&e.Math.fuzzyEqual(a.y,b.y,c)},e.Point.fuzzyEqualsXY=function(a,b,c,d){return e.Math.fuzzyEqual(a.x,
b,d)&&e.Math.fuzzyEqual(a.y,c,d)},e.Point.angle=function(a,b){return Math.atan2(a.y-b.y,a.x-b.x)},e.Point.negative=function(a,b){return void 0===b&&(b=new e.Point),b.setTo(-a.x,-a.y)},e.Point.multiplyAdd=function(a,b,c,d){return void 0===d&&(d=new e.Point),d.setTo((a.x+b.x)*c,(a.y+b.y)*c)},e.Point.interpolate=function(a,b,c,d){return void 0===d&&(d=new e.Point),d.setTo(a.x+(b.x-a.x)*c,a.y+(b.y-a.y)*c)},e.Point.perp=function(a,b){return void 0===b&&(b=new e.Point),b.setTo(-a.y,a.x)},e.Point.rperp=
function(a,b){return void 0===b&&(b=new e.Point),b.setTo(a.y,-a.x)},e.Point.distance=function(a,b,c){a=e.Math.distance(a.x,a.y,b.x,b.y);return c?Math.round(a):a},e.Point.project=function(a,b,c){void 0===c&&(c=new e.Point);a=a.dot(b)/b.getMagnitudeSq();return 0!==a&&c.setTo(a*b.x,a*b.y),c},e.Point.projectUnit=function(a,b,c){void 0===c&&(c=new e.Point);a=a.dot(b);return 0!==a&&c.setTo(a*b.x,a*b.y),c},e.Point.normalRightHand=function(a,b){return void 0===b&&(b=new e.Point),b.setTo(-1*a.y,a.x)},e.Point.normalize=
function(a,b){void 0===b&&(b=new e.Point);var c=a.getMagnitude();return 0!==c&&b.setTo(a.x/c,a.y/c),b},e.Point.rotate=function(a,b,c,d,f,g){(f&&(d=e.Math.degToRad(d)),void 0===g)?(a.subtract(b,c),g=Math.sin(d),d=Math.cos(d),f=g*a.x+d*a.y,a.x=d*a.x-g*a.y+b,a.y=f+c):(d+=Math.atan2(a.y-c,a.x-b),a.x=b+g*Math.cos(d),a.y=c+g*Math.sin(d));return a},e.Point.centroid=function(a,b){if(void 0===b&&(b=new e.Point),"[object Array]"!==Object.prototype.toString.call(a))throw Error("Phaser.Point. Parameter 'points' must be an array");
var c=a.length;if(1>c)throw Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===c)return b.copyFrom(a[0]),b;for(var d=0;d<c;d++)e.Point.add(b,a[d],b);return b.divide(c,c),b},e.Point.parse=function(a,b,c){b=b||"x";c=c||"y";var d=new e.Point;return a[b]&&(d.x=parseFloat(a[b])),a[c]&&(d.y=parseFloat(a[c])),d},e.Point.trunc=function(a){return a.x=e.Math.trunc(a.x),a.y=e.Math.trunc(a.y),a},e.Point.isPoint=function(a){return null!=a&&"number"==typeof a.x&&"number"==typeof a.y},e.Point.set=
function(a,b,c){return a.x=b||0,a.y=c||(0!==c?a.x:0),a},e.Point.sortClockwise=function(a,b){b||=this.centroid(a);var c=b.x,d=b.y;return a.sort(function(f,g){if(0<=f.x-c&&0>g.x-c)return-1;if(0>f.x-c&&0<=g.x-c)return 1;if(0==f.x-c&&0==g.x-c)return 0<=f.y-d||0<=g.y-d?f.y>g.y?1:-1:g.y>f.y?1:-1;var h=(f.x-c)*-(g.y-d)-(g.x-c)*-(f.y-d);return 0>h?-1:0<h?1:(g.x-c)*(g.x-c)+(g.y-d)*(g.y-d)<(f.x-c)*(f.x-c)+(f.y-d)*(f.y-d)?-1:1})},PIXI.Point=e.Point,e.Polygon=function(){this.area=0;this._points=[];0<arguments.length&&
this.setTo.apply(this,arguments);this.closed=!0;this.flattened=!1;this.type=e.POLYGON},e.Polygon.prototype={toNumberArray:function(a){void 0===a&&(a=[]);for(var b=0;b<this._points.length;b++)"number"==typeof this._points[b]?(a.push(this._points[b]),a.push(this._points[b+1]),b++):(a.push(this._points[b].x),a.push(this._points[b].y));return a},flatten:function(){return this._points=this.toNumberArray(),this.flattened=!0,this},clone:function(a){var b=this._points.slice();return null==a?a=new e.Polygon(b):
a.setTo(b),a},contains:function(a,b){var c=!1;if(this.flattened)for(var d=-2,f=this._points.length-2;(d+=2)<this._points.length;f=d){var g=this._points[d],h=this._points[d+1],m=this._points[f];f=this._points[f+1];(h<=b&&b<f||f<=b&&b<h)&&a<(m-g)*(b-h)/(f-h)+g&&(c=!c)}else for(d=-1,f=this._points.length-1;++d<this._points.length;f=d)g=this._points[d].x,h=this._points[d].y,m=this._points[f].x,f=this._points[f].y,(h<=b&&b<f||f<=b&&b<h)&&a<(m-g)*(b-h)/(f-h)+g&&(c=!c);return c},setTo:function(a){if(this.area=
0,this._points=[],0<arguments.length){Array.isArray(a)||(a=Array.prototype.slice.call(arguments));for(var b=Number.MAX_VALUE,c=0,d=a.length;c<d;c++){if("number"==typeof a[c]){var f=new PIXI.Point(a[c],a[c+1]);c++}else f=Array.isArray(a[c])?new PIXI.Point(a[c][0],a[c][1]):new PIXI.Point(a[c].x,a[c].y);this._points.push(f);f.y<b&&(b=f.y)}this.calculateArea(b)}return this},calculateArea:function(a){for(var b,c,d,f=0,g=this._points.length;f<g;f++)b=this._points[f],c=f===g-1?this._points[0]:this._points[f+
1],d=(b.y-a+(c.y-a))/2,b=b.x-c.x,this.area+=d*b;return this.area}},e.Polygon.prototype.constructor=e.Polygon,Object.defineProperty(e.Polygon.prototype,"points",{get:function(){return this._points}}),PIXI.Polygon=e.Polygon,e.Rectangle=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0;this.type=e.RECTANGLE},e.Rectangle.prototype={offset:function(a,b){return this.x+=a,this.y+=b,this},offsetPoint:function(a){return this.offset(a.x,a.y)},setTo:function(a,b,c,d){return this.x=a,
this.y=b,this.width=c,this.height=d,this},scale:function(a,b){return void 0===b&&(b=a),this.width*=a,this.height*=b,this},centerOn:function(a,b){return this.centerX=a,this.centerY=b,this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x);
this.y=Math.ceil(this.y);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height)},copyFrom:function(a){return this.setTo(a.x,a.y,a.width,a.height)},copyFromBounds:function(a){return this.setTo(a.left,a.top,a.width,a.height)},copyTo:function(a){return a.x=this.x,a.y=this.y,a.width=this.width,a.height=this.height,a},inflate:function(a,b){return e.Rectangle.inflate(this,a,b)},size:function(a){return e.Rectangle.size(this,a)},resize:function(a,b){return this.width=a,this.height=b,this},clone:function(a){return e.Rectangle.clone(this,
a)},contains:function(a,b){return e.Rectangle.contains(this,a,b)},containsRect:function(a){return e.Rectangle.containsRect(a,this)},equals:function(a){return e.Rectangle.equals(this,a)},intersection:function(a,b){return e.Rectangle.intersection(this,a,b)},intersects:function(a){return e.Rectangle.intersects(this,a)},intersectsRaw:function(a,b,c,d,f){return e.Rectangle.intersectsRaw(this,a,b,c,d,f)},union:function(a,b){return e.Rectangle.union(this,a,b)},random:function(a){return void 0===a&&(a=new e.Point),
a.x=this.randomX,a.y=this.randomY,a},getPoint:function(a,b){switch(void 0===b&&(b=new e.Point),a){default:case e.TOP_LEFT:return b.set(this.x,this.y);case e.TOP_CENTER:return b.set(this.centerX,this.y);case e.TOP_RIGHT:return b.set(this.right,this.y);case e.LEFT_CENTER:return b.set(this.x,this.centerY);case e.CENTER:return b.set(this.centerX,this.centerY);case e.RIGHT_CENTER:return b.set(this.right,this.centerY);case e.BOTTOM_LEFT:return b.set(this.x,this.bottom);case e.BOTTOM_CENTER:return b.set(this.centerX,
this.bottom);case e.BOTTOM_RIGHT:return b.set(this.right,this.bottom)}},sides:function(a,b,c,d){arguments.length||(a=new e.Line,b=new e.Line,c=new e.Line,d=new e.Line);var f=this.x,g=this.y,h=this.right,m=this.bottom;return a.setTo(f,g,h,g),b.setTo(h,g,h,m),c.setTo(f,m,h,m),d.setTo(f,g,f,m),arguments.length?null:[a,b,c,d]},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(e.Rectangle.prototype,
"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(e.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(e.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){a<=this.y?this.height=0:this.height=a-this.y}}),Object.defineProperty(e.Rectangle.prototype,"bottomLeft",{get:function(){return new e.Point(this.x,this.bottom)},set:function(a){this.x=a.x;this.bottom=a.y}}),Object.defineProperty(e.Rectangle.prototype,
"bottomRight",{get:function(){return new e.Point(this.right,this.bottom)},set:function(a){this.right=a.x;this.bottom=a.y}}),Object.defineProperty(e.Rectangle.prototype,"left",{get:function(){return this.x},set:function(a){a>=this.right?this.width=0:this.width=this.right-a;this.x=a}}),Object.defineProperty(e.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(a){a<=this.x?this.width=0:this.width=a-this.x}}),Object.defineProperty(e.Rectangle.prototype,"volume",{get:function(){return this.width*
this.height}}),Object.defineProperty(e.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(e.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(a){this.x=a-this.halfWidth}}),Object.defineProperty(e.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(a){this.y=a-this.halfHeight}}),Object.defineProperty(e.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*
this.width}}),Object.defineProperty(e.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(e.Rectangle.prototype,"top",{get:function(){return this.y},set:function(a){a>=this.bottom?(this.height=0,this.y=a):this.height=this.bottom-a}}),Object.defineProperty(e.Rectangle.prototype,"topLeft",{get:function(){return new e.Point(this.x,this.y)},set:function(a){this.x=a.x;this.y=a.y}}),Object.defineProperty(e.Rectangle.prototype,"topRight",{get:function(){return new e.Point(this.x+
this.width,this.y)},set:function(a){this.right=a.x;this.y=a.y}}),Object.defineProperty(e.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(a){!0===a&&this.setTo(0,0,0,0)}}),e.Rectangle.prototype.constructor=e.Rectangle,e.Rectangle.inflate=function(a,b,c){return a.x-=b,a.width+=2*b,a.y-=c,a.height+=2*c,a},e.Rectangle.inflatePoint=function(a,b){return e.Rectangle.inflate(a,b.x,b.y)},e.Rectangle.size=function(a,b){return null==b?b=new e.Point(a.width,a.height):
b.setTo(a.width,a.height),b},e.Rectangle.clone=function(a,b){return null==b?b=new e.Rectangle(a.x,a.y,a.width,a.height):b.setTo(a.x,a.y,a.width,a.height),b},e.Rectangle.createFromBounds=function(a,b){return null==b&&(b=new e.Rectangle(a.x,a.y,a.width,a.height)),b.copyFromBounds(a)},e.Rectangle.contains=function(a,b,c){return!(0>=a.width||0>=a.height)&&b>=a.x&&b<a.right&&c>=a.y&&c<a.bottom},e.Rectangle.containsRaw=function(a,b,c,d,f,g){return a<=f&&f<a+c&&b<=g&&g<b+d},e.Rectangle.containsPoint=function(a,
b){return e.Rectangle.contains(a,b.x,b.y)},e.Rectangle.containsRect=function(a,b){return!(a.volume>b.volume)&&a.x>=b.x&&a.y>=b.y&&a.right<b.right&&a.bottom<b.bottom},e.Rectangle.equals=function(a,b){return a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height},e.Rectangle.sameDimensions=function(a,b){return a.width===b.width&&a.height===b.height},e.Rectangle.intersection=function(a,b,c){return void 0===c&&(c=new e.Rectangle),e.Rectangle.intersects(a,b)&&(c.x=Math.max(a.x,b.x),c.y=Math.max(a.y,
b.y),c.width=Math.min(a.right,b.right)-c.x,c.height=Math.min(a.bottom,b.bottom)-c.y),c},e.Rectangle.intersects=function(a,b){return!(0>=a.width||0>=a.height||0>=b.width||0>=b.height)&&!(a.right<b.x||a.bottom<b.y||a.x>b.right||a.y>b.bottom)},e.Rectangle.intersectsRaw=function(a,b,c,d,f,g){return void 0===g&&(g=0),!(b>a.right+g||c<a.left-g||d>a.bottom+g||f<a.top-g)},e.Rectangle.union=function(a,b,c){return void 0===c&&(c=new e.Rectangle),c.setTo(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.max(a.right,
b.right)-Math.min(a.left,b.left),Math.max(a.bottom,b.bottom)-Math.min(a.top,b.top))},e.Rectangle.aabb=function(a,b){void 0===b&&(b=new e.Rectangle);var c=Number.NEGATIVE_INFINITY,d=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,g=Number.POSITIVE_INFINITY;return a.forEach(function(h){h.x>c&&(c=h.x);h.x<d&&(d=h.x);h.y>f&&(f=h.y);h.y<g&&(g=h.y)}),b.setTo(d,g,c-d,f-g),b},PIXI.Rectangle=e.Rectangle,e.EmptyRectangle=new e.Rectangle(0,0,0,0),e.RoundedRectangle=function(a,b,c,d,f){void 0===a&&(a=0);
void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d=0);void 0===f&&(f=20);this.x=a;this.y=b;this.width=c;this.height=d;this.radius=f||20;this.type=e.ROUNDEDRECTANGLE},e.RoundedRectangle.prototype={clone:function(){return new e.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(a,b){if(0>=this.width||0>=this.height)return!1;var c=this.x;return c<=a&&a<=c+this.width&&(a=this.y,a<=b&&b<=a+this.height)?!0:!1}},e.RoundedRectangle.prototype.constructor=e.RoundedRectangle,
PIXI.RoundedRectangle=e.RoundedRectangle,e.Camera=function(a,b,c,d,f,g){this.game=a;this.world=a.world;this.id=0;this.view=new e.Rectangle(c,d,f,g);this.bounds=new e.Rectangle(c,d,f,g);this.deadzone=null;this.roundPx=this.visible=!0;this.atLimit={x:!1,y:!1};this.scale=this.displayObject=this.target=null;this.totalInView=0;this.lerp=new e.Point(1,1);this.onShakeComplete=new e.Signal;this.onFlashComplete=new e.Signal;this.onFadeComplete=new e.Signal;this.fx=null;this._targetPosition=new e.Point;this._edge=
0;this._position=new e.Point;this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0};this._fxType=this._fxDuration=0;this._fixedView=new e.Rectangle},e.Camera.FOLLOW_LOCKON=0,e.Camera.FOLLOW_PLATFORMER=1,e.Camera.FOLLOW_TOPDOWN=2,e.Camera.FOLLOW_TOPDOWN_TIGHT=3,e.Camera.SHAKE_BOTH=4,e.Camera.SHAKE_HORIZONTAL=5,e.Camera.SHAKE_VERTICAL=6,e.Camera.ENABLE_FX=!0,e.Camera.FLASH=0,e.Camera.FADE_OUT=1,e.Camera.FADE_IN=2,e.Camera.prototype={boot:function(){this.displayObject=
this.game.world;this.scale=this.game.world.scale;this.game.camera=this;e.Graphics&&e.Camera.ENABLE_FX&&(this.fx=new e.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(a,b,c,d){switch(void 0===b&&(b=e.Camera.FOLLOW_LOCKON),void 0===c&&(c=1),void 0===d&&(d=1),this.target=a,this.lerp.set(c,d),b){case e.Camera.FOLLOW_PLATFORMER:a=this.width/8;b=this.height/3;this.deadzone=new e.Rectangle((this.width-a)/2,(this.height-b)/2-.25*b,a,b);break;
case e.Camera.FOLLOW_TOPDOWN:a=Math.max(this.width,this.height)/4;this.deadzone=new e.Rectangle((this.width-a)/2,(this.height-a)/2,a,a);break;case e.Camera.FOLLOW_TOPDOWN_TIGHT:a=Math.max(this.width,this.height)/8;this.deadzone=new e.Rectangle((this.width-a)/2,(this.height-a)/2,a,a);break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(a){this.setPosition(Math.round(a.x-this.view.halfWidth),Math.round(a.y-this.view.halfHeight))},focusOnXY:function(a,b){this.setPosition(Math.round(a-
this.view.halfWidth),Math.round(b-this.view.halfHeight))},shake:function(a,b,c,d,f){return void 0===a&&(a=.05),void 0===b&&(b=500),void 0===c&&(c=!0),void 0===d&&(d=e.Camera.SHAKE_BOTH),void 0===f&&(f=!0),!(!c&&0<this._shake.duration)&&(this._shake.intensity=a,this._shake.duration=b,this._shake.shakeBounds=f,this._shake.x=0,this._shake.y=0,this._shake.horizontal=d===e.Camera.SHAKE_BOTH||d===e.Camera.SHAKE_HORIZONTAL,this._shake.vertical=d===e.Camera.SHAKE_BOTH||d===e.Camera.SHAKE_VERTICAL,!0)},flash:function(a,
b,c,d){return void 0===a&&(a=16777215),void 0===b&&(b=500),void 0===c&&(c=!1),void 0===d&&(d=1),!(!this.fx||!c&&0<this._fxDuration)&&(this.fx.clear(),this.fx.beginFill(a,d),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=1,this._fxDuration=b,!(this._fxType=0))},fade:function(a,b,c,d){return this.fadeEffect(a,b,c,d,e.Camera.FADE_OUT)},fadeIn:function(a,b,c,d){return this.fadeEffect(a,b,c,d,e.Camera.FADE_IN)},fadeEffect:function(a,b,c,d,f){if(void 0===a&&(a=0),void 0===
b&&(b=500),void 0===c&&(c=!1),void 0===d&&(d=1),!this.fx||!c&&0<this._fxDuration)return!1;if(this.fx.clear(),this.fx.beginFill(a,d),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),1>f||2<f)throw Error("Wrong `type` argument");return this.fx.alpha=f===e.Camera.FADE_IN?1:0,this._fxDuration=b,this._fxType=f,!0},update:function(){0<this._fxDuration&&this.updateFX();0<this._shake.duration&&this.updateShake();this.bounds&&this.checkBounds();this.roundPx&&(this.view.floor(),this._shake.x=
Math.floor(this._shake.x),this._shake.y=Math.floor(this._shake.y));this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateFX:function(){this._fxType===e.Camera.FLASH?(this.fx.alpha-=this.game.time.delta/this._fxDuration,0>=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):this._fxType===e.Camera.FADE_IN?(this.fx.alpha-=this.game.time.delta/this._fxDuration,0>=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=0,this.onFadeComplete.dispatch())):
(this.fx.alpha+=this.game.time.delta/this._fxDuration,1<=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.delta;0>=this._shake.duration?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=this.game.rnd.frac()*this._shake.intensity*
this.view.height*2-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x;this._targetPosition.y=this.view.y+this.target.worldPosition.y;this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-
this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-
this.view.halfHeight,this.lerp.y));this.bounds&&this.checkBounds();this.roundPx&&this.view.floor();this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1;this.atLimit.y=!1;var a=this.view.right+this._shake.x,b=this.view.y+this._shake.y,c=this.view.bottom+this._shake.y;this.view.x+this._shake.x<=this.bounds.x*this.scale.x?(this.atLimit.x=!0,
this.view.x=this.bounds.x*this.scale.x,this._shake.shakeBounds||(this._shake.x=0)):a>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,this._shake.shakeBounds||(this._shake.x=0));b<=this.bounds.top*this.scale.y?(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,this._shake.shakeBounds||(this._shake.y=0)):c>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,this._shake.shakeBounds||
(this._shake.y=0))},setPosition:function(a,b){this.view.x=a;this.view.y=b;this.bounds&&this.checkBounds()},setSize:function(a,b){this.view.width=a;this.view.height=b},reset:function(){this.target=null;this.view.x=0;this.view.y=0;this._shake.duration=0;this._shake.x=0;this._shake.y=0;this.resetFX()},resetFX:function(){this.fx&&(this.fx.clear(),this.fx.alpha=0);this._fxDuration=0}},e.Camera.prototype.constructor=e.Camera,Object.defineProperty(e.Camera.prototype,"x",{get:function(){return this.view.x},
set:function(a){this.view.x=a;this.bounds&&this.checkBounds()}}),Object.defineProperty(e.Camera.prototype,"y",{get:function(){return this.view.y},set:function(a){this.view.y=a;this.bounds&&this.checkBounds()}}),Object.defineProperty(e.Camera.prototype,"position",{get:function(){return this._position.set(this.view.x,this.view.y),this._position},set:function(a){void 0!==a.x&&(this.view.x=a.x);void 0!==a.y&&(this.view.y=a.y);this.bounds&&this.checkBounds()}}),Object.defineProperty(e.Camera.prototype,
"width",{get:function(){return this.view.width},set:function(a){this.view.width=a}}),Object.defineProperty(e.Camera.prototype,"height",{get:function(){return this.view.height},set:function(a){this.view.height=a}}),Object.defineProperty(e.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(a){this._shake.intensity=a}}),Object.defineProperty(e.Camera.prototype,"fixedView",{get:function(){return this._fixedView.setTo(0,0,this.view.width,this.view.height),this._fixedView}}),
Object.defineProperty(e.Camera.prototype,"centerX",{get:function(){return this.x+.5*this.width}}),Object.defineProperty(e.Camera.prototype,"centerY",{get:function(){return this.y+.5*this.height}}),e.State=function(){this.game=null;this.key="";this.rnd=this.physics=this.particles=this.world=this.tweens=this.time=this.state=this.stage=this.scale=this.sound=this.math=this.load=this.input=this.cache=this.camera=this.make=this.add=null},e.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},
loadRender:function(){},create:function(){},update:function(){},postUpdate:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}},e.State.prototype.constructor=e.State,e.StateManager=function(a,b){this.game=a;this.states={};(this._pendingState=null)!=b&&(this._pendingState=b);this._created=this._clearCache=this._clearWorld=!1;this._args=[];this.current="";this.onStateChange=new e.Signal;this.onShutDownCallback=
this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onLoadRenderCallback=this.onLoadUpdateCallback=this.onPreRenderCallback=this.onResizeCallback=this.onRenderCallback=this.onUpdateCallback=this.onCreateCallback=this.onPreloadCallback=this.onInitCallback=null},e.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,
!0)},add:function(a,b,c){var d;return void 0===c&&(c=!1),b instanceof e.State?d=b:"object"==typeof b?(d=b).game=this.game:"function"==typeof b&&(d=new b(this.game)),this.states[a]=d,c&&(this.game.isBooted?this.start(a):this._pendingState=a),d},remove:function(a){this.current===a&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=
null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null);delete this.states[a]},start:function(a,b,c){void 0===b&&(b=!0);void 0===c&&(c=!1);this.checkState(a)&&(this._pendingState=a,this._clearWorld=b,this._clearCache=c,3<arguments.length&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(a,b){void 0===a&&(a=!0);void 0===b&&(b=!1);this._pendingState=this.current;
this._clearWorld=a;this._clearCache=b;2<arguments.length&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){this._pendingState&&this.game.isBooted&&(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.current===this._pendingState)&&(this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?
this.loadComplete():this.game.load.start()):this.loadComplete())},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},
checkState:function(a){var b=this.states[a];return b?!!(b.preload||b.create||b.update||b.render)||(console.warn("Invalid Phaser State object given. Must contain at least one of the required functions: preload, create, update or render"),!1):(console.warn("Phaser.StateManager - No state found with the key: "+a),!1)},link:function(a){var b=this.states[a];b.game=this.game;b.add=this.game.add;b.make=this.game.make;b.camera=this.game.camera;b.cache=this.game.cache;b.input=this.game.input;b.load=this.game.load;
b.math=this.game.math;b.sound=this.game.sound;b.scale=this.game.scale;b.state=this;b.stage=this.game.stage;b.time=this.game.time;b.tweens=this.game.tweens;b.world=this.game.world;b.particles=this.game.particles;b.rnd=this.game.rnd;b.physics=this.game.physics;b.key=a},unlink:function(a){(a=this.states[a])&&(a.game=null,a.add=null,a.make=null,a.camera=null,a.cache=null,a.input=null,a.load=null,a.math=null,a.sound=null,a.scale=null,a.state=null,a.stage=null,a.time=null,a.tweens=null,a.world=null,a.particles=
null,a.rnd=null,a.physics=null)},setCurrentState:function(a){var b=this.current,c=this.states[a];this.callbackContext=c;this.link(a);this.onInitCallback=c.init||this.dummy;this.onPreloadCallback=c.preload||null;this.onLoadRenderCallback=c.loadRender||null;this.onLoadUpdateCallback=c.loadUpdate||null;this.onCreateCallback=c.create||null;this.onUpdateCallback=c.update||null;this.onPostUpdateCallback=c.postUpdate||null;this.onPreRenderCallback=c.preRender||null;this.onRenderCallback=c.render||null;this.onResizeCallback=
c.resize||null;this.onPausedCallback=c.paused||null;this.onResumedCallback=c.resumed||null;this.onPauseUpdateCallback=c.pauseUpdate||null;this.onShutDownCallback=c.shutdown||this.dummy;""!==this.current&&this.game.physics.reset();this.current=a;this._created=!1;this.onStateChange.dispatch(this.current,b);this.onInitCallback.apply(this.callbackContext,this._args);a===this._pendingState&&(this._args=[]);this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===
this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},loadUpdate:function(){!1===this._created&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?
this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},postUpdate:function(){this._created&&this.onPostUpdateCallback&&this.onPostUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,
this.game)},preRender:function(){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game)},resize:function(a,b){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,a,b)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===e.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,
this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearCache=this._clearWorld=!0;this.clearCurrentState();this.game=this.onPauseUpdateCallback=this.onResumedCallback=this.onPausedCallback=this.onRenderCallback=this.onPostUpdateCallback=this.onUpdateCallback=this.onCreateCallback=this.onLoadUpdateCallback=this.onLoadRenderCallback=this.onPreloadCallback=this.onShutDownCallback=this.onInitCallback=this.callbackContext=null;
this.states={};this._pendingState=null;this.current=""}},e.StateManager.prototype.constructor=e.StateManager,Object.defineProperty(e.StateManager.prototype,"created",{get:function(){return this._created}}),e.Signal=function(){},e.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(a,b){if("function"!=typeof a)throw Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",
b));},_registerListener:function(a,b,c,d,f){var g=this._indexOfListener(a,c);if(-1!==g){if((a=this._bindings[g]).isOnce()!==b)throw Error("You cannot add"+(b?"":"Once")+"() then add"+(b?"Once":"")+"() the same listener without removing the relationship first.");}else a=new e.SignalBinding(this,a,b,c,d,f),this._addBinding(a);return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(a){this._bindings||(this._bindings=[]);for(var b=this._bindings.length;b--,this._bindings[b]&&
a._priority<=this._bindings[b]._priority;);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if((c=this._bindings[d])._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(3<arguments.length)for(var f=3;f<arguments.length;f++)d.push(arguments[f]);return this._registerListener(a,!1,b,c,
d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(3<arguments.length)for(var f=3;f<arguments.length;f++)d.push(arguments[f]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");b=this._indexOfListener(a,b);return-1!==b&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),
this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&(this._bindings||this.memorize)){var a=Array.prototype.slice.call(arguments);this.memorize&&(this._prevParams=a);var b=this._bindings?this._bindings.length:0;if(b){var c=this._bindings.slice();for(this._shouldPropagate=!0;c[--b]&&this._shouldPropagate&&!1!==c[b].execute(a););
}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll();this._bindings=null;this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(e.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),e.Signal.prototype.constructor=e.Signal,e.SignalBinding=
function(a,b,c,d,f,g){this._listener=b;c&&(this._isOnce=!0);null!=d&&(this.context=d);this._signal=a;f&&(this._priority=f);g&&g.length&&(this._args=g)},e.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?
this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},e.SignalBinding.prototype.constructor=e.SignalBinding,
e.Filter=function(a,b,c){this.game=a;this.type=e.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.prevPoint=new e.Point;a=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[a.getFullYear(),a.getMonth(),a.getDate(),3600*a.getHours()+60*a.getMinutes()+a.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},
iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},b)for(var d in b)this.uniforms[d]=b[d];"string"==typeof c&&(c=c.split("\n"));this.fragmentSrc=c||[]},e.Filter.prototype={init:function(){},setResolution:function(a,b){this.uniforms.resolution.value.x=a;this.uniforms.resolution.value.y=b},update:function(a){if(a){var b=a.x/this.game.width;a=1-a.y/this.game.height;
b===this.prevPoint.x&&a===this.prevPoint.y||(this.uniforms.mouse.value.x=b.toFixed(2),this.uniforms.mouse.value.y=a.toFixed(2),this.prevPoint.set(b,a))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(a,b,c,d,f,g){void 0===f&&(f=0);void 0===g&&(g=0);null!=c?this.width=c:c=this.width;null!=d?this.height=d:d=this.height;a=this.game.add.image(a,b,e.Cache.DEFAULT);return a.width=c,a.height=d,a.anchor.set(f,g),a.filters=[this],a},syncUniforms:function(){for(var a=0;a<
this.shaders.length;a++)this.shaders[a].dirty=!0},destroy:function(){this.passes.length=0;this.shaders.length=0;this.fragmentSrc.length=0;this.prevPoint=this.uniforms=this.game=null}},e.Filter.prototype.constructor=e.Filter,Object.defineProperty(e.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(a){this.uniforms.resolution.value.x=a}}),Object.defineProperty(e.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(a){this.uniforms.resolution.value.y=
a}}),e.Plugin=function(a,b){void 0===b&&(b=null);this.game=a;this.parent=b;this.hasPostRender=this.hasRender=this.hasPostUpdate=this.hasUpdate=this.hasPreUpdate=this.visible=this.active=!1},e.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.parent=this.game=null;this.visible=this.active=!1}},e.Plugin.prototype.constructor=e.Plugin,e.PluginManager=function(a){this.game=a;this.plugins=[];this._i=this._len=0},e.PluginManager.prototype=
{add:function(a){var b=Array.prototype.slice.call(arguments,1),c=!1;return"function"==typeof a?a=new a(this.game,this):(a.game=this.game,a.parent=this),"function"==typeof a.preUpdate&&(c=a.hasPreUpdate=!0),"function"==typeof a.update&&(c=a.hasUpdate=!0),"function"==typeof a.postUpdate&&(c=a.hasPostUpdate=!0),"function"==typeof a.render&&(c=a.hasRender=!0),"function"==typeof a.postRender&&(c=a.hasPostRender=!0),c?((a.hasPreUpdate||a.hasUpdate||a.hasPostUpdate)&&(a.active=!0),(a.hasRender||a.hasPostRender)&&
(a.visible=!0),this._len=this.plugins.push(a),"function"==typeof a.init&&a.init.apply(a,b),a):null},remove:function(a,b){void 0===b&&(b=!0);for(this._i=this._len;this._i--;)if(this.plugins[this._i]===a)return b&&a.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this._len=this.plugins.length=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&
this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=
this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll();this.game=null}},e.PluginManager.prototype.constructor=e.PluginManager,e.Stage=function(a){this.game=a;PIXI.DisplayObjectContainer.call(this);this.name="_stage_root";this.disableVisibilityChange=!1;this.exists=!0;this.worldTransform=new e.Matrix;(this.stage=this).currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._bgColor=
{r:0,g:0,b:0,a:0,color:0,rgba:"#000000"};this.game.transparent||(this._bgColor.a=1);a.config&&this.parseConfig(a.config)},e.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),e.Stage.prototype.constructor=e.Stage,e.Stage.prototype.parseConfig=function(a){a.disableVisibilityChange&&(this.disableVisibilityChange=a.disableVisibilityChange);a.backgroundColor&&this.setBackgroundColor(a.backgroundColor)},e.Stage.prototype.boot=function(){e.DOM.getOffset(this.game.canvas,this.offset);e.Canvas.setUserSelect(this.game.canvas,
"none");e.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()},e.Stage.prototype.preUpdate=function(){for(var a=this.currentRenderOrderID=0;a<this.children.length;){var b=this.children[a];b.preUpdate();this===b.parent&&a++}},e.Stage.prototype.update=function(){for(var a=this.children.length;a--;)this.children[a].update()},e.Stage.prototype.postUpdate=function(){this.game.camera.update();this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());
for(var a=0;a<this.children.length;a++)this.children[a].postUpdate();this.updateTransform()},e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0;a<this.children.length;a++)this.children[a].updateTransform()},e.Stage.prototype.checkVisibility=function(){void 0!==document.hidden?this._hiddenVar="visibilitychange":void 0!==document.webkitHidden?this._hiddenVar="webkitvisibilitychange":void 0!==document.mozHidden?this._hiddenVar="mozvisibilitychange":void 0!==document.msHidden?
this._hiddenVar="msvisibilitychange":this._hiddenVar=null;var a=this;this._onChange=function(b){return a.visibilityChange(b)};this._onChangePause=function(){return a._onChange({type:"pause"})};this._onChangeResume=function(){return a._onChange({type:"resume"})};this._onClick=function(b){void 0===document.hasFocus||document.hasFocus()||a.visibilityChange(b)};this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1);window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=
this._onChange;window.onpageshow=this._onChange;window.addEventListener("click",this._onClick);this.game.device.cocoonJSApp&&CocoonJS.App&&(CocoonJS.App.onSuspended&&CocoonJS.App.onSuspended.addEventListener(this._onChangePause),CocoonJS.App.onActivated&&CocoonJS.App.onActivated.addEventListener(this._onChangeResume),CocoonJS.App.on&&(CocoonJS.App.on("activated",this._onChangeResume),CocoonJS.App.on("suspended",this._onChangePause)))},e.Stage.prototype.visibilityChange=function(a){switch(a.type){case "blur":case "pagehide":return void this.game.focusLoss(a);
case "click":case "focus":case "pageshow":return void this.game.focusGain(a)}this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===a.type?this.game.gamePaused(a):this.game.gameResumed(a))},e.Stage.prototype.setBackgroundColor=function(a){this.game.transparent||(e.Color.valueToColor(a,this._bgColor),e.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)},e.Stage.prototype.destroy=
function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1);window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null;window.removeEventListener("click",this._onClick)},e.Stage.prototype.add=function(a,b,c){return a.parent===this||(a.body&&a.parent&&a.parent.hash&&a.parent.removeFromHash(a),void 0===c?this.addChild(a):this.addChildAt(a,c)),a},Object.defineProperty(e.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},
set:function(a){this.setBackgroundColor(a)}}),Object.defineProperty(e.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(a){PIXI.scaleModes.DEFAULT=a?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}}),e.Group=function(a,b,c,d,f,g){void 0===d&&(d=!1);void 0===f&&(f=!1);void 0===g&&(g=e.Physics.ARCADE);this.game=a;void 0===b&&(b=a.world);this.name=c||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);d?(this.game.stage.addChild(this),
this.z=this.game.stage.children.length):b&&(b.addChild(this),this.z=b.children.length);this.physicsType=this.type=e.GROUP;this.exists=this.alive=!0;this.pendingDestroy=this.ignoreDestroy=!1;this.classType=e.Sprite;this.cursor=null;this.updateOnlyExistingChildren=this.inputEnableChildren=!1;this.onChildInputDown=new e.Signal;this.onChildInputUp=new e.Signal;this.onChildInputOver=new e.Signal;this.onChildInputOut=new e.Signal;this.enableBody=f;this.enableBodyDebug=!1;this.physicsBodyType=g;this.physicsSortDirection=
null;this.onDestroy=new e.Signal;this.cursorIndex=0;this.fixedToCamera=!1;this.cameraOffset=new e.Point;this.hash=[];this._sortProperty="z"},e.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),e.Group.prototype.constructor=e.Group,e.Group.RETURN_NONE=0,e.Group.RETURN_TOTAL=1,e.Group.RETURN_CHILD=2,e.Group.RETURN_ALL=3,e.Group.SORT_ASCENDING=-1,e.Group.SORT_DESCENDING=1,e.Group.prototype.add=function(a,b,c){return void 0===b&&(b=!1),a.parent===this||(a.body&&a.parent&&a.parent.hash&&
a.parent.removeFromHash(a),void 0===c?(a.z=this.children.length,this.addChild(a)):(this.addChildAt(a,c),this.updateZ()),this.enableBody&&a.hasOwnProperty("body")&&null===a.body?this.game.physics.enable(a,this.physicsBodyType):a.body&&this.addToHash(a),!this.inputEnableChildren||a.input&&!a.inputEnabled||(a.inputEnabled=!0),!b&&a.events&&a.events.onAddedToGroup$dispatch(a,this),null===this.cursor&&(this.cursor=a)),a},e.Group.prototype.addAt=function(a,b,c){return this.add(a,c,b)},e.Group.prototype.addToHash=
function(a){return a.parent===this&&-1===this.hash.indexOf(a)?(this.hash.push(a),!0):!1},e.Group.prototype.removeFromHash=function(a){return a&&(a=this.hash.indexOf(a),-1!==a)?(this.hash.splice(a,1),!0):!1},e.Group.prototype.addMultiple=function(a,b){if(a instanceof e.Group)a.moveAll(this,b);else if(Array.isArray(a))for(var c=0;c<a.length;c++)this.add(a[c],b);return a},e.Group.prototype.getAt=function(a){return 0>a||a>=this.children.length?-1:this.getChildAt(a)},e.Group.prototype.create=function(a,
b,c,d,f,g){void 0===f&&(f=!0);a=new this.classType(this.game,a,b,c,d);return a.exists=f,a.visible=f,a.alive=f,this.add(a,!1,g)},e.Group.prototype.createMultiple=function(a,b,c,d,f,g){void 0===c&&(c=0);void 0===d&&(d=!1);Array.isArray(b)||(b=[b]);Array.isArray(c)||(c=[c]);var h=this,m=[];return b.forEach(function(n){c.forEach(function(p){for(var q=0;q<a;q++){var r=h.create(0,0,n,p,d);f&&f.call(g||r,r,q);m.push(r)}})}),m},e.Group.prototype.updateZ=function(){for(var a=this.children.length;a--;)this.children[a].z=
a},e.Group.prototype.align=function(a,b,c,d,f,g){if(void 0===f&&(f=e.TOP_LEFT),void 0===g&&(g=0),0===this.children.length||g>this.children.length||-1===a&&-1===b)return!1;for(var h=new e.Rectangle(0,0,c,d),m=a*c,n=b*d;g<this.children.length;g++){var p=this.children[g];if(p.alignIn)if(p.alignIn(h,f),-1===a)h.y+=d,h.y===n&&(h.x+=c,h.y=0);else if(-1===b)h.x+=c,h.x===m&&(h.x=0,h.y+=d);else if(h.x+=c,h.x===m&&(h.x=0,h.y+=d,h.y===n))break}return!0},e.Group.prototype.resetCursor=function(a){if(void 0===
a&&(a=0),a>this.children.length-1&&(a=0),this.cursor)return this.cursorIndex=a,this.cursor=this.children[this.cursorIndex],this.cursor},e.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor},e.Group.prototype.previous=function(){if(this.cursor)return 0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],
this.cursor},e.Group.prototype.swap=function(a,b){this.swapChildren(a,b);this.updateZ()},e.Group.prototype.bringToTop=function(a){return a.parent===this&&this.getIndex(a)<this.children.length&&(this.remove(a,!1,!0),this.add(a,!0)),a},e.Group.prototype.bringChildToTop=e.Group.prototype.bringToTop,e.Group.prototype.sendToBack=function(a){return a.parent===this&&0<this.getIndex(a)&&(this.remove(a,!1,!0),this.addAt(a,0,!0)),a},e.Group.prototype.sendChildToBack=e.Group.prototype.sendToBack,e.Group.prototype.moveUp=
function(a){if(a.parent===this&&this.getIndex(a)<this.children.length-1){var b=this.getIndex(a);(b=this.getAt(b+1))&&this.swap(a,b)}return a},e.Group.prototype.moveDown=function(a){if(a.parent===this&&0<this.getIndex(a)){var b=this.getIndex(a);(b=this.getAt(b-1))&&this.swap(a,b)}return a},e.Group.prototype.xy=function(a,b,c){if(0>a||a>this.children.length)return-1;this.getChildAt(a).x=b;this.getChildAt(a).y=c},e.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()},e.Group.prototype.getIndex=
function(a){return this.children.indexOf(a)},e.Group.prototype.getByName=function(a){return this.getFirst("name",a)},e.Group.prototype.replace=function(a,b){var c=this.getIndex(a);if(-1!==c)return b.parent&&(b.parent instanceof e.Group?b.parent.remove(b):b.parent.removeChild(b)),this.remove(a),this.addAt(b,c),a},e.Group.prototype.hasProperty=function(a,b){var c=b.length;return 1===c&&b[0]in a||2===c&&b[0]in a&&b[1]in a[b[0]]||3===c&&b[0]in a&&b[1]in a[b[0]]&&b[2]in a[b[0]][b[1]]||4===c&&b[0]in a&&
b[1]in a[b[0]]&&b[2]in a[b[0]][b[1]]&&b[3]in a[b[0]][b[1]][b[2]]},e.Group.prototype.setProperty=function(a,b,c,d,f){if(void 0===f&&(f=!1),d=d||0,!this.hasProperty(a,b)&&(!f||0<d))return!1;f=b.length;return 1===f?0===d?a[b[0]]=c:1===d?a[b[0]]+=c:2===d?a[b[0]]-=c:3===d?a[b[0]]*=c:4===d&&(a[b[0]]/=c):2===f?0===d?a[b[0]][b[1]]=c:1===d?a[b[0]][b[1]]+=c:2===d?a[b[0]][b[1]]-=c:3===d?a[b[0]][b[1]]*=c:4===d&&(a[b[0]][b[1]]/=c):3===f?0===d?a[b[0]][b[1]][b[2]]=c:1===d?a[b[0]][b[1]][b[2]]+=c:2===d?a[b[0]][b[1]][b[2]]-=
c:3===d?a[b[0]][b[1]][b[2]]*=c:4===d&&(a[b[0]][b[1]][b[2]]/=c):4===f&&(0===d?a[b[0]][b[1]][b[2]][b[3]]=c:1===d?a[b[0]][b[1]][b[2]][b[3]]+=c:2===d?a[b[0]][b[1]][b[2]][b[3]]-=c:3===d?a[b[0]][b[1]][b[2]][b[3]]*=c:4===d&&(a[b[0]][b[1]][b[2]][b[3]]/=c)),!0},e.Group.prototype.checkProperty=function(a,b,c,d){if(void 0===d&&(d=!1),this!==a.parent)return!1;a=e.Utils.getProperty(a,b);return!(void 0===a&&d||a!==c)},e.Group.prototype.set=function(a,b,c,d,f,g,h){if(void 0===h&&(h=!1),b=b.split("."),void 0===d&&
(d=!1),void 0===f&&(f=!1),(!1===d||d&&a.alive)&&(!1===f||f&&a.visible))return this.setProperty(a,b,c,g,h)},e.Group.prototype.setAll=function(a,b,c,d,f,g){void 0===c&&(c=!1);void 0===d&&(d=!1);void 0===g&&(g=!1);a=a.split(".");f=f||0;for(var h=this.children.length,m=0;m<h;m++){var n=this.children[m];c&&!n.alive||d&&!n.visible||this.setProperty(n,a,b,f,g)}},e.Group.prototype.setAllChildren=function(a,b,c,d,f,g){void 0===c&&(c=!1);void 0===d&&(d=!1);void 0===g&&(g=!1);f=f||0;for(var h=this.children.length,
m=0;m<h;m++){var n=this.children[m];c&&!n.alive||d&&!n.visible||(n instanceof e.Group?n.setAllChildren(a,b,c,d,f,g):this.setProperty(n,a.split("."),b,f,g))}},e.Group.prototype.checkAll=function(a,b,c,d,f){void 0===c&&(c=!1);void 0===d&&(d=!1);void 0===f&&(f=!1);for(var g=0;g<this.children.length;g++){var h=this.children[g];if(!(c&&!h.alive||d&&!h.visible||this.checkProperty(h,a,b,f)))return!1}return!0},e.Group.prototype.checkAny=function(a,b,c,d){void 0===c&&(c=!1);void 0===d&&(d=!1);for(var f=0;f<
this.children.length;f++){var g=this.children[f];if(!(c&&!g.alive||d&&!g.visible)&&this.checkProperty(g,a,b))return!0}return!1},e.Group.prototype.addAll=function(a,b,c,d){this.setAll(a,b,c,d,1)},e.Group.prototype.subAll=function(a,b,c,d){this.setAll(a,b,c,d,2)},e.Group.prototype.multiplyAll=function(a,b,c,d){this.setAll(a,b,c,d,3)},e.Group.prototype.divideAll=function(a,b,c,d){this.setAll(a,b,c,d,4)},e.Group.prototype.kill=function(){this.visible=this.exists=this.alive=!1},e.Group.prototype.killAll=
function(){this.callAllExists("kill",!0)},e.Group.prototype.revive=function(){this.visible=this.exists=this.alive=!0},e.Group.prototype.reviveAll=function(){this.callAllExists("revive",!1)},e.Group.prototype.resetAll=function(a,b,c,d,f){this.forEach(this.resetChild,this,f,a,b,c,d)},e.Group.prototype.callAllExists=function(a,b){if(2<arguments.length){var c=[];for(var d=2;d<arguments.length;d++)c.push(arguments[d])}for(d=0;d<this.children.length;d++){var f=this.children[d];f.exists===b&&f[a]&&f[a].apply(f,
c)}},e.Group.prototype.callbackFromArray=function(a,b,c){if(1===c){if(a[b[0]])return a[b[0]]}else if(2===c){if(a[b[0]][b[1]])return a[b[0]][b[1]]}else if(3===c){if(a[b[0]][b[1]][b[2]])return a[b[0]][b[1]][b[2]]}else if(4===c){if(a[b[0]][b[1]][b[2]][b[3]])return a[b[0]][b[1]][b[2]][b[3]]}else if(a[b])return a[b];return!1},e.Group.prototype.callAll=function(a,b){if(void 0!==a){var c=(a=a.split(".")).length;if(null==b||""===b)b=null;else if("string"==typeof b)var d=(b=b.split(".")).length;if(2<arguments.length){var f=
[];for(var g=2;g<arguments.length;g++)f.push(arguments[g])}var h=null;for(g=0;g<this.children.length;g++){var m=this.children[g];var n=this.callbackFromArray(m,a,c);b&&n?(h=this.callbackFromArray(m,b,d),n.apply(h,f)):n&&n.apply(m,f)}}},e.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return!(this.renderOrderID=-1);for(var a=0;a<this.children.length;){var b=this.children[a];b.preUpdate();this===b.parent&&a++}return!0},e.Group.prototype.update=
function(){for(var a=this.children.length;a--;){var b=this.children.length;b<=a&&(a=b-1);b=this.children[a];this.updateOnlyExistingChildren&&!b.exists||b.update()}},e.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var a=0;a<this.children.length;a++)this.children[a].postUpdate()},e.Group.prototype.filter=function(a,b){for(var c=
-1,d=this.children.length,f=[];++c<d;){var g=this.children[c];b&&!g.exists||a(g,c,this.children)&&f.push(g)}return new e.ArraySet(f)},e.Group.prototype.forEach=function(a,b,c){if(void 0===c&&(c=!1),3>=arguments.length)for(var d=0;d<this.children.length;d++){var f=this.children[d];c&&!f.exists||a.call(b,f)}else{var g=[null];for(d=3;d<arguments.length;d++)g.push(arguments[d]);for(d=0;d<this.children.length;d++)f=this.children[d],c&&!f.exists||(g[0]=f,a.apply(b,g))}},e.Group.prototype.forEachExists=
function(a,b){if(2<arguments.length){var c=[null];for(var d=2;d<arguments.length;d++)c.push(arguments[d])}this.iterate("exists",!0,e.Group.RETURN_TOTAL,a,b,c)},e.Group.prototype.forEachAlive=function(a,b){if(2<arguments.length){var c=[null];for(var d=2;d<arguments.length;d++)c.push(arguments[d])}this.iterate("alive",!0,e.Group.RETURN_TOTAL,a,b,c)},e.Group.prototype.forEachDead=function(a,b){if(2<arguments.length){var c=[null];for(var d=2;d<arguments.length;d++)c.push(arguments[d])}this.iterate("alive",
!1,e.Group.RETURN_TOTAL,a,b,c)},e.Group.prototype.sort=function(a,b){2>this.children.length||(void 0===a&&(a="z"),void 0===b&&(b=e.Group.SORT_ASCENDING),this._sortProperty=a,b===e.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())},e.Group.prototype.customSort=function(a,b){2>this.children.length||(this.children.sort(a.bind(b)),this.updateZ())},e.Group.prototype.ascendingSortHandler=function(a,b){return a[this._sortProperty]<
b[this._sortProperty]?-1:a[this._sortProperty]>b[this._sortProperty]?1:a.z<b.z?-1:1},e.Group.prototype.descendingSortHandler=function(a,b){return a[this._sortProperty]<b[this._sortProperty]?1:a[this._sortProperty]>b[this._sortProperty]?-1:0},e.Group.prototype.iterate=function(a,b,c,d,f,g){if(0===this.children.length){if(c===e.Group.RETURN_TOTAL)return 0;if(c===e.Group.RETURN_ALL)return[]}var h=0;if(c===e.Group.RETURN_ALL)var m=[];for(var n=0;n<this.children.length;n++)if(this.children[n][a]===b){if(h++,
d&&(g?(g[0]=this.children[n],d.apply(f,g)):d.call(f,this.children[n])),c===e.Group.RETURN_CHILD)return this.children[n];c===e.Group.RETURN_ALL&&m.push(this.children[n])}return c===e.Group.RETURN_TOTAL?h:c===e.Group.RETURN_ALL?m:null},e.Group.prototype.getFirst=function(a,b){return this.iterate(a,b,e.Group.RETURN_CHILD)},e.Group.prototype.getFirstExists=function(a,b,c,d,f,g){void 0===b&&(b=!1);"boolean"!=typeof a&&(a=!0);a=this.getFirst("exists",a);return null===a&&b?this.create(c,d,f,g):this.resetChild(a,
c,d,f,g)},e.Group.prototype.getFirstAlive=function(a,b,c,d,f){void 0===a&&(a=!1);var g=this.getFirst("alive",!0);return null===g&&a?this.create(b,c,d,f):this.resetChild(g,b,c,d,f)},e.Group.prototype.getFirstDead=function(a,b,c,d,f){void 0===a&&(a=!1);var g=this.getFirst("alive",!1);return null===g&&a?this.create(b,c,d,f):this.resetChild(g,b,c,d,f)},e.Group.prototype.resetChild=function(a,b,c,d,f){return null===a?null:(void 0===b&&(b=null),void 0===c&&(c=null),null!==b&&null!==c&&a.reset(b,c),void 0!==
d&&a.loadTexture(d,f),a)},e.Group.prototype.getTop=function(){if(0<this.children.length)return this.children[this.children.length-1]},e.Group.prototype.getBottom=function(){if(0<this.children.length)return this.children[0]},e.Group.prototype.getClosestTo=function(a,b,c){for(var d=Number.MAX_VALUE,f=0,g=null,h=0;h<this.children.length;h++){var m=this.children[h];m.exists&&(f=Math.abs(e.Point.distance(a,m)))<d&&(!b||b.call(c,m,f))&&(d=f,g=m)}return g},e.Group.prototype.getFurthestFrom=function(a,b,
c){for(var d=0,f=0,g=null,h=0;h<this.children.length;h++){var m=this.children[h];m.exists&&d<(f=Math.abs(e.Point.distance(a,m)))&&(!b||b.call(c,m,f))&&(d=f,g=m)}return g},e.Group.prototype.count=function(a,b){return this.iterate(a,b,e.Group.RETURN_TOTAL)},e.Group.prototype.countLiving=function(){return this.count("alive",!0)},e.Group.prototype.countDead=function(){return this.count("alive",!1)},e.Group.prototype.getRandom=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=this.children.length),
0===b?null:e.ArrayUtils.getRandomItem(this.children,a,b)},e.Group.prototype.getRandomExists=function(a,b){a=this.getAll("exists",!0,a,b);return this.game.rnd.pick(a)},e.Group.prototype.getAll=function(a,b,c,d){void 0===c&&(c=0);void 0===d&&(d=this.children.length);for(var f=[];c<d;c++){var g=this.children[c];a?g[a]===b&&f.push(g):f.push(g)}return f},e.Group.prototype.remove=function(a,b,c){if(void 0===b&&(b=!1),void 0===c&&(c=!1),0===this.children.length||-1===this.children.indexOf(a))return!1;c||
!a.events||a.destroyPhase||a.events.onRemovedFromGroup$dispatch(a,this);c=this.removeChild(a);return this.removeFromHash(a),this.updateZ(),this.cursor===a&&this.next(),b&&c&&c.destroy(!0),!0},e.Group.prototype.moveAll=function(a,b){if(void 0===b&&(b=!1),0<this.children.length&&a instanceof e.Group){for(;a.add(this.children[0],b),0<this.children.length;);this.hash=[];this.cursor=null}return a},e.Group.prototype.removeAll=function(a,b,c){if(void 0===a&&(a=!1),void 0===b&&(b=!1),void 0===c&&(c=!1),0!==
this.children.length){do{!b&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var d=this.removeChild(this.children[0]);this.removeFromHash(d);a&&d&&d.destroy(!0,c)}while(0<this.children.length);this.hash=[];this.cursor=null}},e.Group.prototype.removeBetween=function(a,b,c,d){if(void 0===b&&(b=this.children.length-1),void 0===c&&(c=!1),void 0===d&&(d=!1),0!==this.children.length){if(b<a||0>a||b>this.children.length)return!1;for(;a<=b;){!d&&this.children[b].events&&
this.children[b].events.onRemovedFromGroup$dispatch(this.children[b],this);var f=this.removeChild(this.children[b]);this.removeFromHash(f);c&&f&&f.destroy(!0);this.cursor===this.children[b]&&(this.cursor=null);b--}this.updateZ()}},e.Group.prototype.scatter=function(a,b){null==a&&(a=this.game.world.bounds);this.forEach(function(c){c.position.set(a.randomX,a.randomY)},null,b)},e.Group.prototype.shuffle=function(){e.ArrayUtils.shuffle(this.children);this.updateZ()},e.Group.prototype.destroy=function(a,
b){null===this.game||this.ignoreDestroy||(void 0===a&&(a=!0),void 0===b&&(b=!1),this.onDestroy.dispatch(this,a,b),this.removeAll(a),this.cursor=null,this.filters=null,this.pendingDestroy=!1,b||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(e.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,e.Group.RETURN_TOTAL)}}),Object.defineProperty(e.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(e.Group.prototype,
"angle",{get:function(){return e.Math.radToDeg(this.rotation)},set:function(a){this.rotation=e.Math.degToRad(a)}}),Object.defineProperty(e.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(a){var b=this.getBounds(this.parent);this.x=a+(this.x-b.x)-b.halfWidth}}),Object.defineProperty(e.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(a){var b=this.getBounds(this.parent);this.y=a+(this.y-b.y)-b.halfHeight}}),
Object.defineProperty(e.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(a){var b=this.getBounds(this.parent);this.x=a+(this.x-b.x)}}),Object.defineProperty(e.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(a){var b=this.getBounds(this.parent);this.x=a+(this.x-b.x)-b.width}}),Object.defineProperty(e.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(a){var b=this.getBounds(this.parent);
this.y=a+(this.y-b.y)}}),Object.defineProperty(e.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(a){var b=this.getBounds(this.parent);this.y=a+(this.y-b.y)-b.height}}),e.World=function(a){e.Group.call(this,a,null,"__world",!1);this.bounds=new e.Rectangle(0,0,a.width,a.height);this.camera=null;this._definedSize=!1;this._width=a.width;this._height=a.height;this.game.state.onStateChange.add(this.stateChange,this)},e.World.prototype=Object.create(e.Group.prototype),
e.World.prototype.constructor=e.World,e.World.prototype.boot=function(){this.camera=new e.Camera(this.game,0,0,0,this.game.width,this.game.height);this.game.stage.addChild(this);this.camera.boot()},e.World.prototype.stateChange=function(){this.y=this.x=0;this.camera.reset()},e.World.prototype.setBounds=function(a,b,c,d){this._definedSize=!0;this._width=c;this._height=d;this.bounds.setTo(a,b,c,d);this.x=a;this.y=b;this.camera.bounds&&this.camera.bounds.setTo(a,b,Math.max(c,this.game.width),Math.max(d,
this.game.height));this.game.physics.setBoundsToWorld()},e.World.prototype.resize=function(a,b){this._definedSize&&(a<this._width&&(a=this._width),b<this._height&&(b=this._height));this.bounds.width=a;this.bounds.height=b;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()},e.World.prototype.shutdown=function(){this.destroy(!0,!0)},e.World.prototype.wrap=function(a,b,c,d,f){void 0===b&&(b=0);void 0===c&&(c=!1);void 0===d&&(d=!0);void 0===f&&(f=!0);c?(a.getBounds(),d&&(a.x+a._currentBounds.width<
this.bounds.x?a.x=this.bounds.right:a.x>this.bounds.right&&(a.x=this.bounds.left)),f&&(a.y+a._currentBounds.height<this.bounds.top?a.y=this.bounds.bottom:a.y>this.bounds.bottom&&(a.y=this.bounds.top))):(d&&a.x+b<this.bounds.x?a.x=this.bounds.right+b:d&&a.x-b>this.bounds.right&&(a.x=this.bounds.left-b),f&&a.y+b<this.bounds.top?a.y=this.bounds.bottom+b:f&&a.y-b>this.bounds.bottom&&(a.y=this.bounds.top-b))},e.World.prototype.wrapAll=function(a,b,c,d,f,g){a.forEach(this.wrap,this,b,c,d,f,g)},Object.defineProperty(e.World.prototype,
"width",{get:function(){return this.bounds.width},set:function(a){a<this.game.width&&(a=this.game.width);this._width=this.bounds.width=a;this._definedSize=!0}}),Object.defineProperty(e.World.prototype,"height",{get:function(){return this.bounds.height},set:function(a){a<this.game.height&&(a=this.game.height);this._height=this.bounds.height=a;this._definedSize=!0}}),Object.defineProperty(e.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}}),Object.defineProperty(e.World.prototype,
"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}}),Object.defineProperty(e.World.prototype,"randomX",{get:function(){return 0>this.bounds.x?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}}),Object.defineProperty(e.World.prototype,"randomY",{get:function(){return 0>this.bounds.y?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,
this.bounds.height)}}),e.Game=function(a,b,c,d,f,g,h,m){return this.id=e._ID++,this.config=null,this.physicsConfig=m,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.multiTexture=!1,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=e.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=
null,this.math=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=e.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.pendingDestroy=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=new e.Signal,this.onResume=new e.Signal,this.onBlur=new e.Signal,this.onFocus=new e.Signal,this.onBoot=
new e.Signal,this.onDestroy=new e.Signal,this._paused=!1,this._codePaused=!1,this._focusGained=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this.rendersThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new e.Signal,this.forceSingleUpdate=!0,this.forceSingleRender=!1,this.dropFrames=!1,this.powerPreference="default",this._nextFpsNotification=0,1===arguments.length&&"object"==typeof a?this.parseConfig(a):(this.config={enableDebug:!0},void 0!==
a&&(this._width=a),void 0!==b&&(this._height=b),void 0!==c&&(this.renderType=c),void 0!==d&&(this.parent=d),void 0!==g&&(this.transparent=g),void 0!==h&&(this.antialias=h),this.rnd=new e.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new e.StateManager(this,f)),this.device.whenReady(this.boot,this),this},e.Game.prototype={parseConfig:function(a){void 0===(this.config=a).enableDebug&&(this.config.enableDebug=!0);a.width&&(this._width=a.width);a.height&&(this._height=a.height);
a.renderer&&(this.renderType=a.renderer);a.parent&&(this.parent=a.parent);void 0!==a.transparent&&(this.transparent=a.transparent);void 0!==a.antialias&&(this.antialias=a.antialias);void 0!==a.clearBeforeRender&&(this.clearBeforeRender=a.clearBeforeRender);void 0!==a.multiTexture&&(this.multiTexture=a.multiTexture);a.resolution&&(this.resolution=a.resolution);void 0!==a.preserveDrawingBuffer&&(this.preserveDrawingBuffer=a.preserveDrawingBuffer);void 0!==a.powerPreference&&(this.powerPreference=a.powerPreference);
a.physicsConfig&&(this.physicsConfig=a.physicsConfig);var b=[(Date.now()*Math.random()).toString()];a.seed&&(b=a.seed);this.rnd=new e.RandomDataGenerator(b);b=null;a.state&&(b=a.state);this.state=new e.StateManager(this,b)},boot:function(){if(!this.isBooted){if(this.isBooted=!0,this.math=e.Math,this.scale=new e.ScaleManager(this,this._width,this._height),this.stage=new e.Stage(this),this.setUpRenderer(),this.world=new e.World(this),this.add=new e.GameObjectFactory(this),this.make=new e.GameObjectCreator(this),
this.cache=new e.Cache(this),this.load=new e.Loader(this),this.time=new e.Time(this),this.tweens=new e.TweenManager(this),this.input=new e.Input(this),this.sound=new e.SoundManager(this),this.physics=new e.Physics(this,this.physicsConfig),this.particles=new e.Particles(this),this.create=new e.Create(this),this.plugins=new e.PluginManager(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(this.config),this.sound.boot(),this.state.boot(),this.config.enableDebug)this.debug=
new e.Utils.Debug(this),this.debug.boot();else{var a=function(){};this.debug={preUpdate:a,update:a,reset:a,destroy:a,isDisabled:!0}}this.showDebugHeader();this.config&&this.config.forceSetTimeOut?this.raf=new e.RequestAnimationFrame(this,this.config.forceSetTimeOut):this.raf=new e.RequestAnimationFrame(this,!1);this._kickstart=!0;this.focusWindow();this.onBoot.dispatch(this);this.config.disableStart||(this.cache.isReady?(this.raf.start(),this.isRunning=!0):this.cache.onReady.addOnce(function(){this.isBooted&&
(this.raf.start(),this.isRunning=!0)},this))}},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var a=e.VERSION,b="Canvas",c="HTML Audio",d=1;if(this.renderType===e.WEBGL?(b="WebGL",d++):this.renderType===e.HEADLESS&&(b="Headless"),this.device.webAudio&&(c="WebAudio",d++),this.device.ie)console.log("Phaser v"+a+" | Pixi.js | "+b+" | "+c+" | http://phaser.io");else{a=["%c %c %c Phaser CE v"+a+" | Pixi.js | "+b+" | "+c+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665",
"background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"];for(b=0;3>b;b++)b<d?a.push("color: #ff2424; background: #fff"):a.push("color: #959595; background: #fff");console.log.apply(console,a)}this.debug.isDisabled||console.log("`game.debug` is enabled. Disable it in production")}},setUpRenderer:function(){if(!this.device.canvas)throw Error("Phaser.Game - Cannot create Canvas 2d context, aborting.");if(this.config.canvas?
this.canvas=this.config.canvas:this.canvas=e.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.config.crisp&&e.Canvas.setImageRenderingCrisp(this.canvas),this.renderType===e.WEBGL||this.renderType===e.WEBGL_MULTI||this.renderType===e.AUTO&&this.device.webGL){(this.multiTexture||this.renderType===e.WEBGL_MULTI)&&(PIXI.enableMultiTexture(),this.multiTexture=
!0);try{this.renderer=new PIXI.WebGLRenderer(this,this.config),this.renderType=e.WEBGL,this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1)}catch(a){if(this.renderer=null,this.multiTexture=!1,PIXI._enableMultiTextureToggle=!1,this.renderType===e.WEBGL)throw a;}}this.renderer||(this.renderer=new PIXI.CanvasRenderer(this,this.config),this.context=this.renderer.context,
this.renderType===e.AUTO&&(this.renderType=e.CANVAS));this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===e.CANVAS);this.renderType!==e.HEADLESS&&(this.stage.smoothed=this.antialias,e.Canvas.addToDOM(this.canvas,this.parent,!1),e.Canvas.setTouchAction(this.canvas))},contextLost:function(a){a.preventDefault();this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext();this.cache.clearGLTextures();this.renderer.contextLost=!1},update:function(a){if(this.pendingDestroy)this.destroy();
else if(this.isBooted){if(this.time.update(a),this._kickstart)return this.updateLogic(this.time.desiredFpsMult),this.updateRender(),void(this._kickstart=!1);if(this._focusGained)this._focusGained=!1;else if(a=this.time.elapsed,!(0>=a)){if(a>this.time.deltaMax){if(this.dropFrames)return;a=this.time.deltaMax}if(this.forceSingleUpdate)this.rendersThisFrame=this.updatesThisFrame=1,this.updateLogic(.001*a/this.time.slowMotion),this.updateRender();else if(2<this._spiraling)this.rendersThisFrame=this.updatesThisFrame=
0,this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1E4,this.fpsProblemNotifier.dispatch()),this._spiraling=this._deltaTime=0;else{var b=0,c=1E3*this.time.desiredFpsMult;this._deltaTime+=a;this.updatesThisFrame=Math.floor(this._deltaTime/c);for(this.rendersThisFrame=this.forceSingleRender?1:Math.min(1,this.updatesThisFrame);this._deltaTime>=c;)this._deltaTime-=c,this.currentUpdateID=b,this.updateLogic(this.time.desiredFpsMult/this.time.slowMotion),this.time.refresh(),
b++;b>this._lastCount?this._spiraling++:b<this._lastCount&&(this._spiraling=0);this._lastCount=b;0<this.rendersThisFrame&&this.updateRender()}}}},updateLogic:function(a){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(a),this.debug.preUpdate(),this.input.pauseUpdate()):(this.stepping&&(this.pendingStep=!0),this.time.preUpdate(a),this.scale.preUpdate(),this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(a),this.plugins.preUpdate(a),
this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.plugins.update(),this.stage.postUpdate(),this.state.postUpdate(),this.plugins.postUpdate());this.stage.updateTransform()},updateRender:function(){this.lockRender||this.renderType===e.HEADLESS||(this.time.preRender(),this.state.preRender(),this.renderer.render(this.stage),this.plugins.render(),this.state.render(),this.plugins.postRender(),this.renderer.postRender())},
enableStep:function(){this.stepping=!0;this.pendingStep=!1;this.stepCount=0},disableStep:function(){this.pendingStep=this.stepping=!1},step:function(){this.pendingStep=!1;this.stepCount++},destroy:function(){this.isBooted?(this.onDestroy.dispatch(this),this.fpsProblemNotifier.dispose(),this.onBlur.dispose(),this.onBoot.dispose(),this.onDestroy.dispose(),this.onFocus.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.raf.stop(),this.debug.destroy(),this.state.destroy(),this.sound.destroy(),
this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.plugins.destroy(),this.tweens.destroy(),this.renderer.destroy(!1),e.Canvas.removeFromDOM(this.canvas),this.add=null,this.cache=null,this.camera=null,this.canvas=null,this.create=null,this.debug=null,this.fpsProblemNotifier=null,this.input=null,this.load=null,this.make=null,this.onBlur=null,this.onBoot=null,this.onDestroy=null,this.onFocus=null,this.onPause=null,this.onResume=null,this.particles=null,this.physics=
null,this.plugins=null,this.raf=null,this.renderer=null,this.scale=null,this.sound=null,this.stage=null,this.state=null,this.time=null,this.tweens=null,this.world=null,this.isBooted=!1,this.isRunning=!1,this.pendingDestroy=!1):this.pendingDestroy=!0},gamePaused:function(a){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.gamePaused(),this.onPause.dispatch(a),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(a){this._paused&&!this._codePaused&&(this._paused=
!1,this.time.gameResumed(),this.input.reset(),this.sound.gameResumed(),this.onResume.dispatch(a),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(a){this.onBlur.dispatch(a);this.stage.disableVisibilityChange||this.gamePaused(a)},focusGain:function(a){this._focusGained=!0;this.focusWindow();this.onFocus.dispatch(a);this.stage.disableVisibilityChange||this.gameResumed(a)},focusWindow:function(){window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&
window.focus()}},e.Game.prototype.constructor=e.Game,Object.defineProperty(e.Game.prototype,"paused",{get:function(){return this._paused},set:function(a){!0===a?(!1===this._paused&&(this._paused=!0,this.sound.muteOnPause&&this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),e.Input=function(a){this.game=a;this.hitContext=
this.hitCanvas=null;this.moveCallbacks=[];this.customCandidateHandlerContext=this.customCandidateHandler=null;this.pollRate=0;this.enabled=!0;this.multiInputOverride=e.Input.MOUSE_TOUCH_COMBINE;this.scale=this.circle=this.speed=this.position=null;this.maxPointers=-1;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2E3;this.justReleasedRate=this.justPressedRate=200;this.recordPointerHistory=!1;this.recordLimit=this.recordRate=100;this.touchLockCallbacks=[];this.pointer10=this.pointer9=this.pointer8=
this.pointer7=this.pointer6=this.pointer5=this.pointer4=this.pointer3=this.pointer2=this.pointer1=null;this.pointers=[];this.gamepad=this.mspointer=this.touch=this.keyboard=this.mouse=this.mousePointer=this.activePointer=null;this.resetLocked=!1;this.onHold=this.onTap=this.onUp=this.onDown=null;this.minPriorityID=0;this.interactiveItems=new e.ArraySet;this._localPoint=new e.Point;this._pollCounter=0;this._oldPosition=null;this._y=this._x=0},e.Input.MOUSE_OVERRIDES_TOUCH=0,e.Input.TOUCH_OVERRIDES_MOUSE=
1,e.Input.MOUSE_TOUCH_COMBINE=2,e.Input.MAX_POINTERS=10,e.Input.prototype={boot:function(a){"maxPointers"in a&&(this.maxPointers=a.maxPointers);this.mousePointer=new e.Pointer(this.game,0,e.PointerMode.CURSOR);this.addPointer();this.addPointer();this.mouse=new e.Mouse(this.game);this.touch=new e.Touch(this.game);this.mspointer=new e.MSPointer(this.game);this.mouseWheel=new e.MouseWheel(this.game);this.pointerLock=new e.PointerLock(this.game);e.Keyboard&&(this.keyboard=new e.Keyboard(this.game));e.Gamepad&&
(this.gamepad=new e.Gamepad(this.game));this.onDown=new e.Signal;this.onUp=new e.Signal;this.onTap=new e.Signal;this.onHold=new e.Signal;this.scale=new e.Point(1,1);this.speed=new e.Point;this.position=new e.Point;this._oldPosition=new e.Point;this.circle=new e.Circle(0,0,45);this.activePointer=this.mousePointer;this.hitCanvas=e.CanvasPool.create(this,1,1);this.hitContext=this.hitCanvas.getContext("2d");this.game.device.mspointer&&!1!==a.mspointer?this.mspointer.start():this.game.device.touch&&!1!==
a.touch&&this.touch.start();this.mspointer.active||!1===a.mouse||this.mouse.start();(this.mousePointer.active=!0)===a.mouseWheel&&this.mouseWheel.start();!1!==a.pointerLock&&this.pointerLock.start();this.keyboard&&!1!==a.keyboard&&this.keyboard.start();var b=this;this._onClickTrampoline=function(c){b.onClickTrampoline(c)};this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop();this.mouseWheel.stop();this.touch.stop();this.mspointer.stop();this.pointerLock.stop();
this.keyboard&&this.keyboard.stop();this.gamepad&&this.gamepad.stop();this.moveCallbacks=[];e.CanvasPool.remove(this);this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(a,b){this.customCandidateHandler=a;this.customCandidateHandlerContext=b},addMoveCallback:function(a,b){this.moveCallbacks.push({callback:a,context:b})},addTouchLockCallback:function(a,b,c){void 0===c&&(c=!1);this.touchLockCallbacks.push({callback:a,context:b,onEnd:c})},removeTouchLockCallback:function(a,
b){for(var c=this.touchLockCallbacks.length;c--;)if(this.touchLockCallbacks[c].callback===a&&this.touchLockCallbacks[c].context===b)return this.touchLockCallbacks.splice(c,1),!0;return!1},executeTouchLockCallbacks:function(a,b){for(var c=this.touchLockCallbacks.length;c--;){var d=this.touchLockCallbacks[c];d.onEnd===a&&d.callback.call(d.context,this,b)&&this.touchLockCallbacks.splice(c,1)}},deleteMoveCallback:function(a,b){for(var c=this.moveCallbacks.length;c--;)if(this.moveCallbacks[c].callback===
a&&this.moveCallbacks[c].context===b)return void this.moveCallbacks.splice(c,1)},addPointer:function(){if(this.pointers.length>=e.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: Maximum limit of "+e.Input.MAX_POINTERS+" pointers reached."),null;var a=this.pointers.length+1,b=new e.Pointer(this.game,a,e.PointerMode.CONTACT);return this.pointers.push(b),this["pointer"+a]=b},update:function(){if(this.keyboard&&this.keyboard.update(),0<this.pollRate&&this._pollCounter<this.pollRate)this._pollCounter++;
else{this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var a=0;a<this.pointers.length;a++)this.pointers[a].update();this._pollCounter=0}},pauseUpdate:function(){this.gamepad&&this.gamepad.active&&this.gamepad.update()},reset:function(a){if(this.game.isBooted&&!this.resetLocked){void 0===a&&(a=!1);this.mousePointer.reset();
this.keyboard&&this.keyboard.reset(a);for(var b=0;b<this.pointers.length;b++)this.pointers[b].reset();"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="");a&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new e.Signal,this.onUp=new e.Signal,this.onTap=new e.Signal,this.onHold=new e.Signal,this.moveCallbacks=[]);this._pollCounter=0}},resetSpeed:function(a,b){this._oldPosition.setTo(a,b);this.speed.setTo(0,0)},startPointer:function(a){if(0<=
this.maxPointers&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(a);if(!this.pointer2.active)return this.pointer2.start(a);for(var b=2;b<this.pointers.length;b++){var c=this.pointers[b];if(!c.active)return c.start(a)}return null},updatePointer:function(a){if(this.pointer1.active&&this.pointer1.identifier===a.identifier)return this.pointer1.move(a);if(this.pointer2.active&&this.pointer2.identifier===a.identifier)return this.pointer2.move(a);
for(var b=2;b<this.pointers.length;b++){var c=this.pointers[b];if(c.active&&c.identifier===a.identifier)return c.move(a)}return null},stopPointer:function(a){if(this.pointer1.active&&this.pointer1.identifier===a.identifier)return this.pointer1.stop(a);if(this.pointer2.active&&this.pointer2.identifier===a.identifier)return this.pointer2.stop(a);for(var b=2;b<this.pointers.length;b++){var c=this.pointers[b];if(c.active&&c.identifier===a.identifier)return c.stop(a)}return null},countActivePointers:function(a){void 0===
a&&(a=this.pointers.length);for(var b=a,c=0;c<this.pointers.length&&0<b;c++)this.pointers[c].active&&b--;return a-b},getPointer:function(a){void 0===a&&(a=!1);for(var b=0;b<this.pointers.length;b++){var c=this.pointers[b];if(c.active===a)return c}return null},getPointerFromIdentifier:function(a){for(var b=0;b<this.pointers.length;b++){var c=this.pointers[b];if(c.identifier===a)return c}return null},getPointerFromId:function(a){for(var b=0;b<this.pointers.length;b++){var c=this.pointers[b];if(c.pointerId===
a)return c}return null},getLocalPosition:function(a,b,c){void 0===c&&(c=new e.Point);a=a.worldTransform;var d=1/(a.a*a.d+a.c*-a.b);return c.setTo(a.d*d*b.x+-a.c*d*b.y+(a.ty*a.c-a.tx*a.d)*d,a.a*d*b.y+-a.b*d*b.x+(-a.ty*a.a+a.tx*a.b)*d)},hitTest:function(a,b,c){if(!a.worldVisible)return!1;if(this.getLocalPosition(a,b,this._localPoint),c.copyFrom(this._localPoint),a.hitArea&&a.hitArea.contains)return a.hitArea.contains(this._localPoint.x,this._localPoint.y);if(e.Creature&&a instanceof e.Creature){var d=
Math.abs(a.width),f=Math.abs(a.height),g=a.x-d*a.anchorX;if(this.game.camera.x+b.x>=g&&this.game.camera.x+b.x<g+d&&(d=a.y-f*a.anchorY,this.game.camera.y+b.y>=d&&this.game.camera.y+b.y<d+f))return!0}else if(a instanceof e.TileSprite){if(d=a.width,f=a.height,g=-d*a.anchor.x,this._localPoint.x>=g&&this._localPoint.x<g+d&&(d=-f*a.anchor.y,this._localPoint.y>=d&&this._localPoint.y<d+f))return!0}else if(a instanceof PIXI.Sprite){if(d=a.texture.frame.width/a.texture.baseTexture.resolution,f=a.texture.frame.height/
a.texture.baseTexture.resolution,g=-d*a.anchor.x,this._localPoint.x>=g&&this._localPoint.x<g+d&&(d=-f*a.anchor.y,this._localPoint.y>=d&&this._localPoint.y<d+f))return!0}else if(a instanceof e.Graphics)for(f=0;f<a.graphicsData.length;f++)if(d=a.graphicsData[f],d.fill&&d.shape&&d.shape.contains(this._localPoint.x,this._localPoint.y))return!0;for(f=0;f<a.children.length;f++)if(this.hitTest(a.children[f],b,c))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()},
callAll:function(a,b){for(var c=this.interactiveItems.list,d=c.length;d--;){var f=c[d];f&&f.enabled&&f[a](b)}}},e.Input.prototype.constructor=e.Input,Object.defineProperty(e.Input.prototype,"x",{get:function(){return this._x},set:function(a){this._x=Math.floor(a)}}),Object.defineProperty(e.Input.prototype,"y",{get:function(){return this._y},set:function(a){this._y=Math.floor(a)}}),Object.defineProperty(e.Input.prototype,"pollLocked",{get:function(){return 0<this.pollRate&&this._pollCounter<this.pollRate}}),
Object.defineProperty(e.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(e.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(e.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(e.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),e.Mouse=function(a){this.game=a;this.input=
a.input;this.callbackContext=this.game;this.mouseOverCallback=this.mouseOutCallback=this.mouseUpCallback=this.mouseDownCallback=null;this.active=this.capture=!1;this.enabled=!0;this.stopOnGameOut=!1;this._onMouseOver=this._onMouseOut=this._onMouseUp=this._onMouseMove=this._onMouseDown=this.event=null},e.Mouse.NO_BUTTON=-1,e.Mouse.LEFT_BUTTON=0,e.Mouse.MIDDLE_BUTTON=1,e.Mouse.RIGHT_BUTTON=2,e.Mouse.BACK_BUTTON=3,e.Mouse.FORWARD_BUTTON=4,e.Mouse.prototype={start:function(){var a=this.game.device;if(a.isAndroidStockBrowser()&&
this.input.touch.active||null!==this._onMouseDown)return!1;var b=this;this._onMouseDown=function(d){return b.onMouseDown(d)};this._onMouseMove=function(d){return b.onMouseMove(d)};this._onMouseUp=function(d){return b.onMouseUp(d)};this._onMouseUpGlobal=function(d){return b.onMouseUpGlobal(d)};this._onMouseOutGlobal=function(d){return b.onMouseOutGlobal(d)};this._onMouseOut=function(d){return b.onMouseOut(d)};this._onMouseOver=function(d){return b.onMouseOver(d)};var c=this.game.canvas;return c.addEventListener("mousedown",
this._onMouseDown,!0),c.addEventListener("mousemove",this._onMouseMove,!0),c.addEventListener("mouseup",this._onMouseUp,!0),a.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),c.addEventListener("mouseover",this._onMouseOver,!0),c.addEventListener("mouseout",this._onMouseOut,!0)),this.active=!0},onMouseDown:function(a){this.event=a;this.capture&&a.preventDefault();this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,
a);this.input.enabled&&this.enabled&&(a.identifier=0,this.input.mousePointer.start(a))},onMouseMove:function(a){this.event=a;this.capture&&a.preventDefault();this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=0,this.input.mousePointer.move(a))},onMouseUp:function(a){this.event=a;this.capture&&a.preventDefault();this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=
0,this.input.mousePointer.stop(a))},onMouseUpGlobal:function(a){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,a),a.identifier=0,this.input.mousePointer.stop(a))},onMouseOutGlobal:function(a){this.event=a;this.capture&&a.preventDefault();this.input.mousePointer.withinGame=!1;this.input.enabled&&this.enabled&&(this.input.mousePointer.stop(a),this.input.mousePointer.resetButtons())},onMouseOut:function(a){this.event=a;this.capture&&a.preventDefault();
this.input.mousePointer.withinGame=!1;this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(this.input.mousePointer.updateButtons(a),this.stopOnGameOut&&(a.identifier=0,this.input.mousePointer.stop(a),this.input.callAll("_pointerOutHandler",this.input.mousePointer)))},onMouseOver:function(a){this.event=a;this.capture&&a.preventDefault();this.input.mousePointer.withinGame=!0;this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,
a);this.input.enabled&&this.enabled&&this.input.mousePointer.updateButtons(a)},stop:function(){var a=this.game.canvas;a.removeEventListener("mousedown",this._onMouseDown,!0);a.removeEventListener("mousemove",this._onMouseMove,!0);a.removeEventListener("mouseup",this._onMouseUp,!0);a.removeEventListener("mouseover",this._onMouseOver,!0);a.removeEventListener("mouseout",this._onMouseOut,!0);window.removeEventListener("mouseup",this._onMouseUpGlobal,!0);window.removeEventListener("mouseout",this._onMouseOutGlobal,
!0);this.active=!1}},e.Mouse.prototype.constructor=e.Mouse,e.MouseWheel=function(a){this.game=a;this.input=a.input;this.element=a.canvas;this.preventDefault=!0;this.active=!1;this.callback=null;this.callbackContext=a;this.delta=0;this.wheelEventName=a.device.wheelEvent;this.boundOnWheelHandler=this.onWheelHandler.bind(this);this.eventProxy=null},e.MouseWheel.UP=1,e.MouseWheel.DOWN=-1,e.MouseWheel.prototype.start=function(){return!(!this.wheelEventName||this.active)&&(this.element.addEventListener(this.wheelEventName,
this.boundOnWheelHandler,!0),"mousewheel"===this.wheelEventName?this.eventProxy=new e.WheelEventProxy(-.025,1):"DOMMouseScroll"===this.wheelEventName&&(this.eventProxy=new e.WheelEventProxy(1,1)),this.active=!0)},e.MouseWheel.prototype.stop=function(){this.active&&(this.element.removeEventListener(this.wheelEventName,this.boundOnWheelHandler,!0),this.active=!1)},e.MouseWheel.prototype.onWheelHandler=function(a){this.eventProxy&&(a=this.eventProxy.bindEvent(a));this.preventDefault&&a.preventDefault();
this.delta=e.Math.clamp(-a.deltaY,-1,1);this.callback&&this.callback.call(this.callbackContext,a)},e.MSPointer=function(a){this.game=a;this.input=a.input;this.callbackContext=this.game;this.pointerCancelCallback=this.pointerOverCallback=this.pointerOutCallback=this.pointerUpCallback=this.pointerMoveCallback=this.pointerDownCallback=null;this.capture=!1;this.event=null;this.active=!1;this.enabled=!0;this.stopOnGameOut=!1;this._onMSPointerOver=this._onMSPointerOut=this._onMSPointerUpGlobal=this._onMSPointerUp=
this._onMSPointerMove=this._onMSPointerDown=null},e.MSPointer.prototype={start:function(){if(!this.game.device.mspointer||null!==this._onMSPointerDown)return!1;var a=this;this._onMSPointerDown=function(c){return a.onPointerDown(c)};this._onMSPointerMove=function(c){return a.onPointerMove(c)};this._onMSPointerUp=function(c){return a.onPointerUp(c)};this._onMSPointerUpGlobal=function(c){return a.onPointerUpGlobal(c)};this._onMSPointerOut=function(c){return a.onPointerOut(c)};this._onMSPointerOver=function(c){return a.onPointerOver(c)};
this._onMSPointerCancel=function(c){return a.onPointerCancel(c)};var b=this.game.canvas;return b.addEventListener("MSPointerDown",this._onMSPointerDown,!1),b.addEventListener("MSPointerMove",this._onMSPointerMove,!1),b.addEventListener("MSPointerUp",this._onMSPointerUp,!1),b.addEventListener("MSPointerCancel",this._onMSPointerCancel,!1),b.addEventListener("pointerdown",this._onMSPointerDown,!1),b.addEventListener("pointermove",this._onMSPointerMove,!1),b.addEventListener("pointerup",this._onMSPointerUp,
!1),b.addEventListener("pointercancel",this._onMSPointerCancel,!1),b.style["-ms-content-zooming"]="none",b.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),b.addEventListener("MSPointerOver",this._onMSPointerOver,!0),b.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),b.addEventListener("pointerover",this._onMSPointerOver,!0),b.addEventListener("pointerout",
this._onMSPointerOut,!0)),this.active=!0},onPointerDown:function(a){this.game.input.executeTouchLockCallbacks(!1,a);this.event=a;this.capture&&a.preventDefault();this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=a.pointerId,this.isMousePointerEvent(a)?this.input.mousePointer.start(a):this.input.startPointer(a))},onPointerMove:function(a){this.event=a;this.capture&&a.preventDefault();this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,
a);this.input.enabled&&this.enabled&&(a.identifier=a.pointerId,this.isMousePointerEvent(a)?this.input.mousePointer.move(a):this.input.updatePointer(a))},onPointerUp:function(a){this.game.input.executeTouchLockCallbacks(!0,a);this.event=a;this.capture&&a.preventDefault();this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&(a.identifier=a.pointerId,this.isMousePointerEvent(a)?this.input.mousePointer.stop(a):this.input.stopPointer(a))},onPointerUpGlobal:function(a){if(a.identifier=
a.pointerId,this.isMousePointerEvent(a)&&!this.input.mousePointer.withinGame)this.onPointerUp(a);else{var b=this.input.getPointerFromIdentifier(a.identifier);b&&b.withinGame&&this.onPointerUp(a)}},onPointerOut:function(a){this.event=a;this.capture&&a.preventDefault();a.identifier=a.pointerId;var b=this.getPointerFromEvent(a);b&&(b.withinGame=!1);this.pointerOutCallback&&this.pointerOutCallback.call(this.callbackContext,a);this.input.enabled&&this.enabled&&this.stopOnGameOut&&(a.identifier=0,b||=this.input.mousePointer,
b.stop(a),this.input.callAll("_pointerOutHandler",b))},onPointerOver:function(a){this.event=a;this.capture&&a.preventDefault();a.identifier=a.pointerId;var b=this.getPointerFromEvent(a);b&&(b.withinGame=!0);this.pointerOverCallback&&this.pointerOverCallback.call(this.callbackContext,a)},onPointerCancel:function(a){this.event=a;this.pointerCancelCallback&&this.pointerCancelCallback.call(this.callbackContext,a);this.game.input.enabled&&this.enabled&&(a.identifier=a.pointerId,this.isMousePointerEvent(a)?
this.input.mousePointer.stop(a):this.input.stopPointer(a))},stop:function(){var a=this.game.canvas;a.removeEventListener("MSPointerDown",this._onMSPointerDown,!1);a.removeEventListener("MSPointerMove",this._onMSPointerMove,!1);a.removeEventListener("MSPointerUp",this._onMSPointerUp,!1);a.removeEventListener("pointerdown",this._onMSPointerDown,!1);a.removeEventListener("pointermove",this._onMSPointerMove,!1);a.removeEventListener("pointerup",this._onMSPointerUp,!1);window.removeEventListener("MSPointerUp",
this._onMSPointerUpGlobal,!0);a.removeEventListener("MSPointerOver",this._onMSPointerOver,!0);a.removeEventListener("MSPointerOut",this._onMSPointerOut,!0);window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0);a.removeEventListener("pointerover",this._onMSPointerOver,!0);a.removeEventListener("pointerout",this._onMSPointerOut,!0);this.active=!1},isMousePointerEvent:function(a){return"mouse"===a.pointerType||4===a.pointerType},getPointerFromEvent:function(a){return this.isMousePointerEvent(a)?
this.input.mousePointer:this.input.getPointerFromIdentifier(a.identifier)}},e.MSPointer.prototype.constructor=e.MSPointer,e.DeviceButton=function(a,b){this.parent=a;this.game=a.game;this.event=null;this.isDown=!1;this.isUp=!0;this.repeats=this.timeUp=this.timeDown=0;this.ctrlKey=this.shiftKey=this.altKey=!1;this.value=0;this.buttonCode=b;this.onDown=new e.Signal;this.onUp=new e.Signal;this.onFloat=new e.Signal},e.DeviceButton.prototype={start:function(a,b){this.isDown||(this.isDown=!0,this.isUp=!1,
this.timeDown=this.game.time.time,this.repeats=0,this.event=a,this.value=b,a&&(this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.ctrlKey=a.ctrlKey),this.onDown.dispatch(this,b))},stop:function(a,b){this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=a,this.value=b,a&&(this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.ctrlKey=a.ctrlKey),this.onUp.dispatch(this,b))},startStop:function(a,b,c){a?this.start(b,c):this.stop(b,c)},padFloat:function(a){this.isUp=this.isDown=
!1;this.value=a;this.onFloat.dispatch(this,a)},justPressed:function(a){return a=a||250,this.isDown&&this.timeDown+a>this.game.time.time},justReleased:function(a){return a=a||250,this.isUp&&this.timeUp+a>this.game.time.time},reset:function(){this.isDown=!1;this.isUp=!0;this.timeDown=this.game.time.time;this.repeats=0;this.ctrlKey=this.shiftKey=this.altKey=!1},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.game=this.parent=null}},e.DeviceButton.prototype.constructor=
e.DeviceButton,Object.defineProperty(e.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),e.Pointer=function(a,b,c){this.game=a;this.id=b;this.type=e.POINTER;this.exists=!0;this.identifier=0;this.pointerId=null;this.pointerMode=c||e.PointerMode.CURSOR|e.PointerMode.CONTACT;this.button=this.target=null;this.leftButton=new e.DeviceButton(this,e.Pointer.LEFT_BUTTON);this.middleButton=new e.DeviceButton(this,e.Pointer.MIDDLE_BUTTON);this.rightButton=
new e.DeviceButton(this,e.Pointer.RIGHT_BUTTON);this.backButton=new e.DeviceButton(this,e.Pointer.BACK_BUTTON);this.forwardButton=new e.DeviceButton(this,e.Pointer.FORWARD_BUTTON);this.eraserButton=new e.DeviceButton(this,e.Pointer.ERASER_BUTTON);this._holdSent=!1;this._history=[];this._nextDrop=0;this.withinGame=this._stateReset=!1;this.screenY=this.screenX=this.pageY=this.pageX=this.clientY=this.clientX=-1;this.movementY=this.movementX=this.rawMovementY=this.rawMovementX=0;this.y=this.x=-1;this.isMouse=
0===b;this.isDown=!1;this.isUp=!0;this.totalTouches=this.previousTapTime=this.timeUp=this.timeDown=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.interactiveCandidates=[];this.dirty=this.active=!1;this.position=new e.Point;this.positionDown=new e.Point;this.positionUp=new e.Point;this.circle=new e.Circle(0,0,44);this._trampolineTargetObject=this._clickTrampolines=null},e.Pointer.NO_BUTTON=0,e.Pointer.LEFT_BUTTON=1,e.Pointer.RIGHT_BUTTON=2,e.Pointer.MIDDLE_BUTTON=4,e.Pointer.BACK_BUTTON=
8,e.Pointer.FORWARD_BUTTON=16,e.Pointer.ERASER_BUTTON=32,e.Pointer.prototype={resetButtons:function(){this.isDown=!1;this.isUp=!0;this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(a,b){switch(a){case e.Mouse.LEFT_BUTTON:this.leftButton.start(b);break;case e.Mouse.RIGHT_BUTTON:this.rightButton.start(b);break;case e.Mouse.MIDDLE_BUTTON:this.middleButton.start(b);
break;case e.Mouse.BACK_BUTTON:this.backButton.start(b);break;case e.Mouse.FORWARD_BUTTON:this.forwardButton.start(b)}},processButtonsUp:function(a,b){switch(a){case e.Mouse.LEFT_BUTTON:this.leftButton.stop(b);break;case e.Mouse.RIGHT_BUTTON:this.rightButton.stop(b);break;case e.Mouse.MIDDLE_BUTTON:this.middleButton.stop(b);break;case e.Mouse.BACK_BUTTON:this.backButton.stop(b);break;case e.Mouse.FORWARD_BUTTON:this.forwardButton.stop(b)}},processButtonsUpDown:function(a,b){var c=b.type.toLowerCase().substr(-4),
d="down"===c;c="move"===c;void 0!==a?(d&&1===a&&b.ctrlKey&&(a=2),this.leftButton.startStop(e.Pointer.LEFT_BUTTON&a,b),this.rightButton.startStop(e.Pointer.RIGHT_BUTTON&a,b),this.middleButton.startStop(e.Pointer.MIDDLE_BUTTON&a,b),this.backButton.startStop(e.Pointer.BACK_BUTTON&a,b),this.forwardButton.startStop(e.Pointer.FORWARD_BUTTON&a,b),this.eraserButton.startStop(e.Pointer.ERASER_BUTTON&a,b)):void 0!==b.button?d&&b.ctrlKey&&0===b.button?this.rightButton.start(b):d?this.processButtonsDown(b.button,
b):c||this.processButtonsUp(b.button,b):d?b.ctrlKey?this.rightButton.start(b):this.leftButton.start(b):(this.leftButton.stop(b),this.rightButton.stop(b))},updateButtons:function(a){this.button=a.button;this.processButtonsUpDown(a.buttons,a);this.isUp=!0;this.isDown=!1;(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)&&(this.isUp=!1,this.isDown=!0)},start:function(a){var b=this.game.input;return a.pointerId&&
(this.pointerId=a.pointerId),this.identifier=a.identifier,this.target=a.target,this.isMouse?this.updateButtons(a):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(a,!0),this.positionDown.setTo(this.x,this.y),(b.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||b.multiInputOverride===
e.Input.MOUSE_TOUCH_COMBINE||b.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&0===b.totalActivePointers)&&(b.x=this.x,b.y=this.y,b.position.setTo(this.x,this.y),b.onDown.dispatch(this,a),b.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){var a=this.game.input;this.active&&(this.dirty&&(0<a.interactiveItems.total&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=
a.holdRate&&((a.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||a.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||a.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&0===a.totalActivePointers)&&a.onHold.dispatch(this),this._holdSent=!0),a.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+a.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>a.recordLimit&&this._history.shift()))},move:function(a,b){var c=this.game.input;
if(!c.pollLocked){void 0===b&&(b=!1);void 0!==a.button&&(this.button=a.button);this.isMouse&&this.updateButtons(a);this.clientX=a.clientX;this.clientY=a.clientY;this.pageX=a.pageX;this.pageY=a.pageY;this.screenX=a.screenX;this.screenY=a.screenY;this.isMouse&&c.pointerLock.locked&&!b&&(this.rawMovementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,this.rawMovementY=a.movementY||a.mozMovementY||a.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY);this.x=(this.pageX-
this.game.scale.offset.x)*c.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*c.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;(c.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||c.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||c.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&0===c.totalActivePointers)&&(c.activePointer=this,c.x=this.x,c.y=this.y,c.position.setTo(c.x,c.y),c.circle.x=c.x,c.circle.y=c.y);this.withinGame=this.game.scale.bounds.contains(this.pageX,
this.pageY);for(var d=c.moveCallbacks.length;d--;)c.moveCallbacks[d].callback.call(c.moveCallbacks[d].context,this,this.x,this.y,b,a);return null===this.targetObject||this.game.paused&&!this.targetObject.noPause||!0!==this.targetObject.isDragged?0<c.interactiveItems.total&&this.processInteractiveObjects(b):!1===this.targetObject.update(this)&&(this.targetObject=null),this}},processInteractiveObjects:function(a){var b=0,c=-1,d=null,f=this.game.input.interactiveItems.first;for(this.interactiveCandidates=
[];f;)f.checked=!1,!f.validForInput(c,b,!1)||this.game.paused&&!f.sprite.noPause||(f.checked=!0,(a&&f.checkPointerDown(this,!0)||!a&&f.checkPointerOver(this,!0))&&(b=f.sprite.renderOrderID,c=f.priorityID,d=f,this.interactiveCandidates.push(f))),f=this.game.input.interactiveItems.next;for(f=this.game.input.interactiveItems.first;f;)!f.checked&&f.validForInput(c,b,!0)&&(a&&f.checkPointerDown(this,!1)||!a&&f.checkPointerOver(this,!1))&&(b=f.sprite.renderOrderID,c=f.priorityID,d=f,this.interactiveCandidates.push(f)),
f=this.game.input.interactiveItems.next;return this.game.input.customCandidateHandler&&(d=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,d)),this.swapTarget(d,!1),null!==this.targetObject},swapTarget:function(a,b){void 0===b&&(b=!1);null===a?this.targetObject&&(this.targetObject._pointerOutHandler(this,b),this.targetObject=null):null===this.targetObject?(this.targetObject=a)._pointerOverHandler(this,b):this.targetObject===
a?!1===a.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,b),this.targetObject=a,this.targetObject._pointerOverHandler(this,b))},leave:function(a){this.withinGame=!1;this.move(a,!1)},stop:function(a){var b=this.game.input;if(!this._stateReset||!this.withinGame){if(this.timeUp=this.game.time.time,(b.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||b.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||b.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&0===b.totalActivePointers)&&
(b.onUp.dispatch(this,a),0<=this.duration&&this.duration<=b.tapRate))b.onTap.dispatch(this,this.timeUp-this.previousTapTime<b.doubleTapRate,a),this.previousTapTime=this.timeUp;return this.isMouse?this.updateButtons(a):(this.isDown=!1,this.isUp=!0),0<this.id&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(a.pageX,a.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===this.isMouse&&b.currentPointers--,b.callAll("_releasedHandler",this),this._clickTrampolines&&
(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this}a.preventDefault()},justPressed:function(a){return a=a||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+a>this.game.time.time},justReleased:function(a){return a=a||this.game.input.justReleasedRate,this.isUp&&this.timeUp+a>this.game.time.time},addClickTrampoline:function(a,b,c,d){if(this.isDown){for(var f=this._clickTrampolines=this._clickTrampolines||[],g=0;g<f.length;g++)if(f[g].name===a){f.splice(g,1);break}f.push({name:a,
targetObject:this.targetObject,callback:b,callbackContext:c,callbackArgs:d})}},processClickTrampolines:function(){var a=this._clickTrampolines;if(a){for(var b=0;b<a.length;b++){var c=a[b];c.targetObject===this._trampolineTargetObject&&c.callback.apply(c.callbackContext,c.callbackArgs)}this._trampolineTargetObject=this._clickTrampolines=null}},reset:function(){!1===this.isMouse&&(this.active=!1);this.identifier=this.pointerId=null;this.dirty=!1;this.totalTouches=0;this._holdSent=!1;this._history.length=
0;this._stateReset=!0;this.resetButtons();this.targetObject&&this.targetObject._releasedHandler(this);this.targetObject=null},resetMovement:function(){this.movementY=this.movementX=0}},e.Pointer.prototype.constructor=e.Pointer,Object.defineProperty(e.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(e.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(e.Pointer.prototype,
"worldY",{get:function(){return this.game.world.camera.y+this.y}}),e.PointerMode={CURSOR:1,CONTACT:2},e.PointerModes={},e.PointerModes[e.PointerMode.CURSOR]="CURSOR",e.PointerModes[e.PointerMode.CONTACT]="CONTACT",e.Touch=function(a){this.game=a;this.active=!1;this.enabled=!0;this.callbackContext=this.game;this.touchCancelCallback=this.touchLeaveCallback=this.touchEnterCallback=this.touchEndCallback=this.touchMoveCallback=this.touchStartCallback=null;this.preventDefault=!0;this._onTouchMove=this._onTouchCancel=
this._onTouchLeave=this._onTouchEnter=this._onTouchEnd=this._onTouchStart=this.event=null},e.Touch.prototype={start:function(){if(!this.game.device.touch||null!==this._onTouchStart)return!1;var a=this;return this._onTouchStart=function(b){return a.onTouchStart(b)},this._onTouchMove=function(b){return a.onTouchMove(b)},this._onTouchEnd=function(b){return a.onTouchEnd(b)},this._onTouchEnter=function(b){return a.onTouchEnter(b)},this._onTouchLeave=function(b){return a.onTouchLeave(b)},this._onTouchCancel=
function(b){return a.onTouchCancel(b)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)),this.active=!0},consumeDocumentTouches:function(){this._documentTouchMove=
function(a){a.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(a){if(this.game.input.executeTouchLockCallbacks(!1,a),this.event=a,this.game.input.enabled&&this.enabled){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,a);this.preventDefault&&a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)this.game.input.startPointer(a.changedTouches[b])}},onTouchCancel:function(a){if(this.event=a,this.touchCancelCallback&&
this.touchCancelCallback.call(this.callbackContext,a),this.game.input.enabled&&this.enabled){this.preventDefault&&a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)this.game.input.stopPointer(a.changedTouches[b])}},onTouchEnter:function(a){this.event=a;this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,a);this.game.input.enabled&&this.enabled&&this.preventDefault&&a.preventDefault()},onTouchLeave:function(a){this.event=a;this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,
a);this.preventDefault&&a.preventDefault()},onTouchMove:function(a){this.event=a;this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,a);this.preventDefault&&a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)this.game.input.updatePointer(a.changedTouches[b])},onTouchEnd:function(a){this.game.input.executeTouchLockCallbacks(!0,a);this.event=a;this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,a);this.preventDefault&&a.preventDefault();for(var b=0;b<
a.changedTouches.length;b++)this.game.input.stopPointer(a.changedTouches[b])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",
this._onTouchCancel),this.active=!1)}},e.Touch.prototype.constructor=e.Touch,e.InputHandler=function(a){this.sprite=a;this.game=a.game;this.checked=this.enabled=!1;this.priorityID=0;this.isDragged=this._setHandCursor=this.useHandCursor=!1;this.allowVerticalDrag=this.allowHorizontalDrag=!0;this.bringToTop=!1;this.snapOffset=null;this.snapOnRelease=this.snapOnDrag=!1;this.snapOffsetY=this.snapOffsetX=this.snapY=this.snapX=0;this.pixelPerfectClick=this.pixelPerfectOver=!1;this.pixelPerfectAlpha=255;
this.draggable=!1;this.boundsSprite=this.boundsRect=null;this.scaleLayer=!1;this.dragOffset=new e.Point;this.dragStopBlocksInputUp=this.dragFromCenter=!1;this.dragStartPoint=new e.Point;this.dragTimeThreshold=this.dragDistanceThreshold=0;this.downPoint=new e.Point;this.snapPoint=new e.Point;this._dragPoint=new e.Point;this._wasEnabled=this._dragDistancePass=this._dragTimePass=this._pendingDrag=this._dragPhase=!1;this._tempPoint=new e.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,
camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},e.InputHandler.prototype={start:function(a,b){if(a=a||0,void 0===b&&(b=!1),!1===this.enabled){this.game.input.interactiveItems.add(this);this.useHandCursor=b;this.priorityID=a;for(a=0;10>a;a++)this._pointerData[a]={id:a,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new e.Point;this._wasEnabled=
this.enabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var a=0;10>a;a++)this._pointerData[a]={id:a,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,
timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(a,b,c){return void 0===c&&(c=!0),!(!this.enabled||0===
this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput)&&!(!c&&(this.pixelPerfectClick||this.pixelPerfectOver))&&(this.priorityID>a||this.priorityID===a&&this.sprite.renderOrderID>b)},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(a){return a=a||0,this._pointerData[a].x},pointerY:function(a){return a=a||0,this._pointerData[a].y},pointerDown:function(a){return a=
a||0,this._pointerData[a].isDown},pointerUp:function(a){return a=a||0,this._pointerData[a].isUp},pointerTimeDown:function(a){return a=a||0,this._pointerData[a].timeDown},pointerTimeUp:function(a){return a=a||0,this._pointerData[a].timeUp},pointerOver:function(a){if(!this.enabled)return!1;if(void 0!==a)return this._pointerData[a].isOver;for(a=0;10>a;a++)if(this._pointerData[a].isOver)return!0;return!1},pointerOut:function(a){if(!this.enabled)return!1;if(void 0!==a)return this._pointerData[a].isOut;
for(a=0;10>a;a++)if(this._pointerData[a].isOut)return!0},pointerTimeOver:function(a){return a=a||0,this._pointerData[a].timeOver},pointerTimeOut:function(a){return a=a||0,this._pointerData[a].timeOut},pointerDragged:function(a){return a=a||0,this._pointerData[a].isDragged},checkPointerDown:function(a,b){return!!(a.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,
a,this._tempPoint)&&(void 0===b&&(b=!1),!(!b&&this.pixelPerfectClick)||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPointerOver:function(a,b){return!!(this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,a,this._tempPoint)&&(void 0===b&&(b=!1),!(!b&&this.pixelPerfectOver)||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPixel:function(a,
b,c){if(this.sprite.texture.baseTexture.source){null===a&&null===b&&(this.game.input.getLocalPosition(this.sprite,c,this._tempPoint),a=this._tempPoint.x,b=this._tempPoint.y);if(0!==this.sprite.anchor.x&&(a-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(b-=-this.sprite.texture.frame.height*this.sprite.anchor.y),a+=this.sprite.texture.frame.x,b+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(a-=this.sprite.texture.trim.x,b-=this.sprite.texture.trim.y,a<this.sprite.texture.crop.x||
a>this.sprite.texture.crop.right||b<this.sprite.texture.crop.y||b>this.sprite.texture.crop.bottom))return this._dx=a,this._dy=b,!1;if(this._dx=a,this._dy=b,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,a,b,1,1,0,0,1,1),this.game.input.hitContext.getImageData(0,0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(a){if(null!==this.sprite&&void 0!==this.sprite.parent)return this.enabled&&this.sprite.visible&&
this.sprite.parent.visible?this._pendingDrag?(this._dragDistancePass||(this._dragDistancePass=e.Math.distance(a.x,a.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(a),!0):this.draggable&&this._draggedPointerID===a.id?this.updateDrag(a,!1):this._pointerData[a.id].isOver?this.checkPointerOver(a)?(this._pointerData[a.id].x=a.x-this.sprite.x,this._pointerData[a.id].y=a.y-this.sprite.y,!0):(this._pointerOutHandler(a),!1):void 0:
(this._pointerOutHandler(a),!1)},_pointerOverHandler:function(a,b){if(null!==this.sprite){var c=this._pointerData[a.id];if(!1===c.isOver||a.dirty){var d=!1===c.isOver;c.isOver=!0;c.isOut=!1;c.timeOver=this.game.time.time;c.x=a.x-this.sprite.x;c.y=a.y-this.sprite.y;this.useHandCursor&&!1===c.isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0);!b&&d&&this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,a);this.sprite.parent&&this.sprite.parent.onChildInputOver&&
this.sprite.parent.onChildInputOver.dispatch(this.sprite,a)}}},_pointerOutHandler:function(a,b){if(null!==this.sprite){var c=this._pointerData[a.id];c.isOver=!1;c.isOut=!0;c.timeOut=this.game.time.time;this.useHandCursor&&!1===c.isDragged&&(this.game.canvas.style.cursor="",this._setHandCursor=!1);!b&&this.sprite&&this.sprite.events&&(this.sprite.events.onInputOut$dispatch(this.sprite,a),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputOut&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,
a))}},_touchedHandler:function(a){if(null!==this.sprite){var b=this._pointerData[a.id];b.isDown||!b.isOver||this.pixelPerfectClick&&!this.checkPixel(null,null,a)||(b.isDown=!0,b.isUp=!1,b.timeDown=this.game.time.time,this.downPoint.set(a.x,a.y),a.dirty=!0,this.sprite&&this.sprite.events&&(this.sprite.events.onInputDown$dispatch(this.sprite,a),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputDown&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,a),null===this.sprite))||(this.draggable&&
!1===this.isDragged&&(0===this.dragTimeThreshold&&0===this.dragDistanceThreshold?this.startDrag(a):(this._pendingDrag=!0,this._dragDistancePass=0===this.dragDistanceThreshold,0<this.dragTimeThreshold?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,a)):this._dragTimePass=!0)),this.bringToTop&&this.sprite.bringToTop())}},dragTimeElapsed:function(a){this._dragTimePass=!0;this._pendingDrag&&this.sprite&&this._dragDistancePass&&this.startDrag(a)},_releasedHandler:function(a){if(null!==
this.sprite){var b=this._pointerData[a.id];if(b.isDown&&a.isUp){b.isDown=!1;b.isUp=!0;b.timeUp=this.game.time.time;b.downDuration=b.timeUp-b.timeDown;var c=this.checkPointerOver(a);this.sprite&&this.sprite.events&&(this.dragStopBlocksInputUp&&(!this.dragStopBlocksInputUp||this.draggable&&this.isDragged&&this._draggedPointerID===a.id)||this.sprite.events.onInputUp$dispatch(this.sprite,a,c),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputUp&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,
a,c),c&&=this.checkPointerOver(a));!(b.isOver=c)&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1);a.dirty=!0;this._pendingDrag=!1;this.draggable&&this.isDragged&&this._draggedPointerID===a.id&&this.stopDrag(a)}}},updateDrag:function(a,b){var c=this.game.camera,d=this.dragOffset,f=this._dragPoint,g=this._pointerData[a.id],h=this.snapPoint,m=this.sprite;if(void 0===b&&(b=!1),a.isUp)return this.stopDrag(a),!1;var n=this.globalToLocal(a);if(m.fixedToCamera){var p=
c.scale.x*n.x+f.x+d.x;d=c.scale.y*n.y+f.y+d.y}else p=n.x+f.x+d.x,d=n.y+f.y+d.y;m.fixedToCamera?(n=m.cameraOffset,f=n.x,g=n.y,this.allowHorizontalDrag&&(n.x=p-c.x),this.allowVerticalDrag&&(n.y=d-c.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(n.x=Math.round((n.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,n.y=Math.round((n.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,
h.set(n.x,n.y)),c=n.x-f,g=n.y-g):(n=c.x-g.camX,c=c.y-g.camY,f=m.x,g=m.y,this.allowHorizontalDrag&&(m.x=p+n),this.allowVerticalDrag&&(m.y=d+c),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(m.x=Math.round((m.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,m.y=Math.round((m.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,h.set(m.x,m.y)),c=m.x-f,g=m.y-g);return this.sprite.events.onDragUpdate.dispatch(m,
a,p,d,h,b,c,g),!0},justOver:function(a,b){return a=a||0,b=b||500,this._pointerData[a].isOver&&this.overDuration(a)<b},justOut:function(a,b){return a=a||0,b=b||500,this._pointerData[a].isOut&&this.game.time.time-this._pointerData[a].timeOut<b},justPressed:function(a,b){return a=a||0,b=b||500,this._pointerData[a].isDown&&this.downDuration(a)<b},justReleased:function(a,b){return a=a||0,b=b||500,this._pointerData[a].isUp&&this.game.time.time-this._pointerData[a].timeUp<b},overDuration:function(a){return a=
a||0,this._pointerData[a].isOver?this.game.time.time-this._pointerData[a].timeOver:-1},downDuration:function(a){return a=a||0,this._pointerData[a].isDown?this.game.time.time-this._pointerData[a].timeDown:-1},enableDrag:function(a,b,c,d,f,g){void 0===a&&(a=!1);void 0===b&&(b=!1);void 0===c&&(c=!1);void 0===d&&(d=255);void 0===f&&(f=null);void 0===g&&(g=null);this._dragPoint=new e.Point;this.draggable=!0;this.bringToTop=b;this.dragOffset=new e.Point;this.dragFromCenter=a;this.pixelPerfectClick=c;this.pixelPerfectAlpha=
d;f&&(this.boundsRect=f);g&&(this.boundsSprite=g)},disableDrag:function(){if(this._pointerData)for(var a=0;10>a;a++)this._pointerData[a].isDragged=!1;this.isDragged=this.draggable=!1;this._draggedPointerID=-1;this._pendingDrag=!1},startDrag:function(a){var b=this.sprite.x,c=this.sprite.y,d=this.globalToLocal(a);if(this.isDragged=!0,this._draggedPointerID=a.id,this._pointerData[a.id].camX=this.game.camera.x,this._pointerData[a.id].camY=this.game.camera.y,this._pointerData[a.id].isDragged=!0,this.sprite.fixedToCamera){if(this.dragFromCenter){var f=
this.sprite.getBounds();f=this.globalToLocal(new e.Point(f.centerX,f.centerY));this.sprite.cameraOffset.x=d.x+(this.sprite.cameraOffset.x-f.x);this.sprite.cameraOffset.y=d.y+(this.sprite.cameraOffset.y-f.y)}this._dragPoint.setTo(this.sprite.cameraOffset.x-a.x,this.sprite.cameraOffset.y-a.y)}else this.dragFromCenter&&(f=this.sprite.getBounds(),f=this.globalToLocal(new e.Point(f.centerX,f.centerY)),this.sprite.x=d.x+(this.sprite.x-f.x),this.sprite.y=d.y+(this.sprite.y-f.y)),this._dragPoint.setTo(this.sprite.x-
d.x,this.sprite.y-d.y);this.updateDrag(a,!0);this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop());this.dragStartPoint.set(b,c);this.sprite.events.onDragStart$dispatch(this.sprite,a,b,c);this._pendingDrag=!1},globalToLocalX:function(a){return this.scaleLayer&&(a-=this.game.scale.grid.boundsFluid.x,a*=this.game.scale.grid.scaleFluidInversed.x),a},globalToLocalY:function(a){return this.scaleLayer&&(a-=this.game.scale.grid.boundsFluid.y,a*=this.game.scale.grid.scaleFluidInversed.y),a},globalToLocal:function(a){return this.sprite.parent?
this.game.input.getLocalPosition(this.sprite.parent,{x:a.x,y:a.y}):a},stopDrag:function(a){this.isDragged=!1;this._draggedPointerID=-1;this._pendingDrag=this._dragPhase=this._pointerData[a.id].isDragged=!1;this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*
this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY));this.sprite.events.onDragStop$dispatch(this.sprite,a);!1===this.checkPointerOver(a)&&this._pointerOutHandler(a)},setDragLock:function(a,b){void 0===a&&(a=!0);void 0===b&&(b=!0);this.allowHorizontalDrag=a;this.allowVerticalDrag=
b},enableSnap:function(a,b,c,d,f,g){void 0===c&&(c=!0);void 0===d&&(d=!1);void 0===f&&(f=0);void 0===g&&(g=0);this.snapX=a;this.snapY=b;this.snapOffsetX=f;this.snapOffsetY=g;this.snapOnDrag=c;this.snapOnRelease=d},disableSnap:function(){this.snapOnRelease=this.snapOnDrag=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=
this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<
this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&
(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+
this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},e.InputHandler.prototype.constructor=e.InputHandler,e.PointerLock=function(a){this.game=a;this.input=a.input;this.element=a.canvas;this.locked=
this.active=!1;this.onChange=new e.Signal;this.onError=new e.Signal;this.boundOnChangeHandler=this.onChangeHandler.bind(this);this.boundOnErrorHandler=this.onErrorHandler.bind(this);a=a.device;this.pointerLockElement=a.pointerLockElement;this.pointerlockchange=a.pointerlockchange;this.pointerlockerror=a.pointerlockerror},e.PointerLock.prototype.start=function(){return!(!this.game.device.pointerLock||this.active)&&(this.element.requestPointerLock||(this.element.requestPointerLock=this.element.mozRequestPointerLock||
this.element.webkitRequestPointerLock),document.exitPointerLock||(document.exitPointerLock=document.mozExitPointerLock||document.webkitExitPointerLock),document.addEventListener(this.pointerlockchange,this.boundOnChangeHandler,!0),document.addEventListener(this.pointerlockerror,this.boundOnErrorHandler,!0),this.active=!0)},e.PointerLock.prototype.stop=function(){this.active&&(document.removeEventListener(this.pointerlockchange,this.boundOnChangeHandler,!0),document.removeEventListener(this.pointerlockerror,
this.boundOnErrorHandler,!0),this.active=!1)},e.PointerLock.prototype.request=function(){this.active&&!this.locked&&this.element.requestPointerLock()},e.PointerLock.prototype.exit=function(){document.exitPointerLock()},e.PointerLock.prototype.onChangeHandler=function(a){this.locked=document[this.pointerLockElement]===this.element;this.onChange.dispatch(this.locked,a)},e.PointerLock.prototype.onErrorHandler=function(a){this.onError.dispatch(a)},e.Gamepad=function(a){this.game=a;this._gamepadIndexMap=
{};this._rawPads=[];this._active=!1;this.enabled=!0;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this._gamepaddisconnected=this._ongamepadconnected=this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=(this.callbackContext=this).onConnectCallback=null;this._gamepads=[new e.SinglePad(a,
this),new e.SinglePad(a,this),new e.SinglePad(a,this),new e.SinglePad(a,this)]},e.Gamepad.prototype={addCallbacks:function(a,b){void 0!==b&&(this.onConnectCallback="function"==typeof b.onConnect?b.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof b.onDisconnect?b.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof b.onDown?b.onDown:this.onDownCallback,this.onUpCallback="function"==typeof b.onUp?b.onUp:this.onUpCallback,this.onAxisCallback="function"==
typeof b.onAxis?b.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof b.onFloat?b.onFloat:this.onFloatCallback,this.callbackContext=a)},start:function(){if(!this._active){this._active=!0;var a=this;this._onGamepadConnected=function(b){return a.onGamepadConnected(b)};this._onGamepadDisconnected=function(b){return a.onGamepadDisconnected(b)};window.addEventListener("gamepadconnected",this._onGamepadConnected,!1);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,
!1)}},onGamepadConnected:function(a){a=a.gamepad;this._rawPads.push(a);this._gamepads[a.index].connect(a)},onGamepadDisconnected:function(a){a=a.gamepad;for(var b in this._rawPads)this._rawPads[b].index===a.index&&this._rawPads.splice(b,1);this._gamepads[a.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(this._active){if(navigator.getGamepads)var a=navigator.getGamepads();
else navigator.webkitGetGamepads?a=navigator.webkitGetGamepads():navigator.webkitGamepads&&(a=navigator.webkitGamepads());if(a){for(var b=!(this._rawPads=[]),c=0;c<a.length&&(typeof a[c]!==this._prevRawGamepadTypes[c]&&(b=!0,this._prevRawGamepadTypes[c]=typeof a[c]),a[c]&&this._rawPads.push(a[c]),3!==c);c++);for(a=0;a<this._gamepads.length;a++)this._gamepads[a]._rawPad=this._rawPads[a];if(b){a={};c={};for(var d=0;d<this._gamepads.length;d++)if((b=this._gamepads[d]).connected)for(var f=0;f<this._rawPads.length;f++)this._rawPads[f].index===
b.index&&(a[b.index]=!0,c[d]=!0);for(d=0;d<this._gamepads.length;d++)if(b=this._gamepads[d],!c[d])for(1>this._rawPads.length&&b.disconnect(),f=0;f<this._rawPads.length&&!c[d];f++){var g=this._rawPads[f];g?a[g.index]?b.disconnect():(b.connect(g),a[g.index]=!0,c[d]=!0):b.disconnect()}}}}},setDeadZones:function(a){for(var b=0;b<this._gamepads.length;b++)this._gamepads[b].deadZone=a},stop:function(){this._active=!1;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",
this._onGamepadDisconnected)},reset:function(){this.update();for(var a=0;a<this._gamepads.length;a++)this._gamepads[a].reset()},justPressed:function(a,b){for(var c=0;c<this._gamepads.length;c++)if(!0===this._gamepads[c].justPressed(a,b))return!0;return!1},justReleased:function(a,b){for(var c=0;c<this._gamepads.length;c++)if(!0===this._gamepads[c].justReleased(a,b))return!0;return!1},isDown:function(a){for(var b=0;b<this._gamepads.length;b++)if(!0===this._gamepads[b].isDown(a))return!0;return!1},destroy:function(){this.stop();
for(var a=0;a<this._gamepads.length;a++)this._gamepads[a].destroy()}},e.Gamepad.prototype.constructor=e.Gamepad,Object.defineProperty(e.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(e.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(e.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(e.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),
Object.defineProperty(e.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(e.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(e.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),e.Gamepad.BUTTON_0=0,e.Gamepad.BUTTON_1=1,e.Gamepad.BUTTON_2=2,e.Gamepad.BUTTON_3=3,e.Gamepad.BUTTON_4=4,e.Gamepad.BUTTON_5=5,e.Gamepad.BUTTON_6=6,e.Gamepad.BUTTON_7=7,e.Gamepad.BUTTON_8=8,e.Gamepad.BUTTON_9=9,e.Gamepad.BUTTON_10=
10,e.Gamepad.BUTTON_11=11,e.Gamepad.BUTTON_12=12,e.Gamepad.BUTTON_13=13,e.Gamepad.BUTTON_14=14,e.Gamepad.BUTTON_15=15,e.Gamepad.AXIS_0=0,e.Gamepad.AXIS_1=1,e.Gamepad.AXIS_2=2,e.Gamepad.AXIS_3=3,e.Gamepad.AXIS_4=4,e.Gamepad.AXIS_5=5,e.Gamepad.AXIS_6=6,e.Gamepad.AXIS_7=7,e.Gamepad.AXIS_8=8,e.Gamepad.AXIS_9=9,e.Gamepad.XBOX360_A=0,e.Gamepad.XBOX360_B=1,e.Gamepad.XBOX360_X=2,e.Gamepad.XBOX360_Y=3,e.Gamepad.XBOX360_LEFT_BUMPER=4,e.Gamepad.XBOX360_RIGHT_BUMPER=5,e.Gamepad.XBOX360_LEFT_TRIGGER=6,e.Gamepad.XBOX360_RIGHT_TRIGGER=
7,e.Gamepad.XBOX360_BACK=8,e.Gamepad.XBOX360_START=9,e.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,e.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,e.Gamepad.XBOX360_DPAD_LEFT=14,e.Gamepad.XBOX360_DPAD_RIGHT=15,e.Gamepad.XBOX360_DPAD_UP=12,e.Gamepad.XBOX360_DPAD_DOWN=13,e.Gamepad.XBOX360_STICK_LEFT_X=0,e.Gamepad.XBOX360_STICK_LEFT_Y=1,e.Gamepad.XBOX360_STICK_RIGHT_X=2,e.Gamepad.XBOX360_STICK_RIGHT_Y=3,e.Gamepad.PS3XC_X=0,e.Gamepad.PS3XC_CIRCLE=1,e.Gamepad.PS3XC_SQUARE=2,e.Gamepad.PS3XC_TRIANGLE=3,e.Gamepad.PS3XC_L1=
4,e.Gamepad.PS3XC_R1=5,e.Gamepad.PS3XC_L2=6,e.Gamepad.PS3XC_R2=7,e.Gamepad.PS3XC_SELECT=8,e.Gamepad.PS3XC_START=9,e.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,e.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,e.Gamepad.PS3XC_DPAD_UP=12,e.Gamepad.PS3XC_DPAD_DOWN=13,e.Gamepad.PS3XC_DPAD_LEFT=14,e.Gamepad.PS3XC_DPAD_RIGHT=15,e.Gamepad.PS3XC_STICK_LEFT_X=0,e.Gamepad.PS3XC_STICK_LEFT_Y=1,e.Gamepad.PS3XC_STICK_RIGHT_X=2,e.Gamepad.PS3XC_STICK_RIGHT_Y=3,e.SinglePad=function(a,b){this.game=a;this.index=null;this.connected=!1;
this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=(this.callbackContext=this).onConnectCallback=null;this.deadZone=.26;this._padParent=b;this._prevTimestamp=this._rawPad=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0},e.SinglePad.prototype={addCallbacks:function(a,b){void 0!==b&&(this.onConnectCallback="function"==typeof b.onConnect?b.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof b.onDisconnect?
b.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof b.onDown?b.onDown:this.onDownCallback,this.onUpCallback="function"==typeof b.onUp?b.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof b.onAxis?b.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof b.onFloat?b.onFloat:this.onFloatCallback,this.callbackContext=a)},getButton:function(a){return this._buttons[a]?this._buttons[a]:null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&
this.game.input.gamepad.enabled&&this._rawPad&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var a=0;a<this._buttonsLen;a++){var b=isNaN(this._rawPad.buttons[a])?this._rawPad.buttons[a].value:this._rawPad.buttons[a];b!==this._buttons[a].value&&(1===b?this.processButtonDown(a,b):0===b?this.processButtonUp(a,b):this.processButtonFloat(a,b))}for(a=0;a<this._axesLen;a++)b=this._rawPad.axes[a],0<b&&b>this.deadZone||0>b&&b<-this.deadZone?this.processAxisChange(a,b):this.processAxisChange(a,
0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(a){var b=!this.connected;this.connected=!0;this.index=a.index;this._rawPad=a;this._buttons=[];this._buttonsLen=a.buttons.length;this._axes=[];this._axesLen=a.axes.length;for(var c=0;c<this._axesLen;c++)this._axes[c]=a.axes[c];for(var d in a.buttons)d=parseInt(d,10),this._buttons[d]=new e.DeviceButton(this,d);b&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index);b&&this.onConnectCallback&&
this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var a=this.connected,b=this.index;this.connected=!1;this.index=null;this._rawPad=void 0;for(var c=0;c<this._buttonsLen;c++)this._buttons[c].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;a&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,b);a&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=
void 0;for(var a=0;a<this._buttonsLen;a++)this._buttons[a].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onFloatCallback=this.onAxisCallback=this.onUpCallback=this.onDownCallback=this.onDisconnectCallback=this.onConnectCallback=null},processAxisChange:function(a,b){this._axes[a]!==b&&(this._axes[a]=b,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,a,b),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,
this,a,b))},processButtonDown:function(a,b){this._buttons[a]&&this._buttons[a].start(null,b);this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,a,b,this.index);this.onDownCallback&&this.onDownCallback.call(this.callbackContext,a,b)},processButtonUp:function(a,b){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,a,b,this.index);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,a,b);this._buttons[a]&&
this._buttons[a].stop(null,b)},processButtonFloat:function(a,b){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,a,b,this.index);this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,a,b);this._buttons[a]&&this._buttons[a].padFloat(b)},axis:function(a){return!!this._axes[a]&&this._axes[a]},isDown:function(a){return!!this._buttons[a]&&this._buttons[a].isDown},isUp:function(a){return!!this._buttons[a]&&this._buttons[a].isUp},justReleased:function(a,
b){if(this._buttons[a])return this._buttons[a].justReleased(b)},justPressed:function(a,b){if(this._buttons[a])return this._buttons[a].justPressed(b)},buttonValue:function(a){return this._buttons[a]?this._buttons[a].value:null},reset:function(){for(var a=0;a<this._axes.length;a++)this._axes[a]=0}},e.SinglePad.prototype.constructor=e.SinglePad,e.Key=function(a,b){this.game=a;this._enabled=!0;this.event=null;this.isDown=!1;this.isUp=!0;this.shiftKey=this.ctrlKey=this.altKey=!1;this.duration=this.timeDown=
0;this.durationUp=this.timeUp=-2500;this.repeats=0;this.keyCode=b;this.onDown=new e.Signal;this.onHoldContext=this.onHoldCallback=null;this.onUp=new e.Signal;this._justUp=this._justDown=!1},e.Key.prototype={update:function(){this._enabled&&(this.isDown?(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this)):this.durationUp=this.game.time.time-this.timeUp)},processKeyDown:function(a){this._enabled&&(this.event=a,this.isDown||
(this.altKey=a.altKey,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.durationUp=this.game.time.time-this.timeUp,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(a){this._enabled&&(this.event=a,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this.durationUp=0,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(a){void 0===
a&&(a=!0);this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.time;this.duration=0;this.durationUp=-2500;this._enabled=!0;this._justUp=this._justDown=!1;a&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(a){return void 0===a&&(a=50),this.isDown&&this.duration<a},upDuration:function(a){return void 0===a&&(a=50),!this.isDown&&this.game.time.time-this.timeUp<a},justPressed:function(){return this.isDown&&0===this.duration},justReleased:function(){return!this.isDown&&
0===this.durationUp}},Object.defineProperty(e.Key.prototype,"justDown",{get:function(){var a=this._justDown;return this._justDown=!1,a}}),Object.defineProperty(e.Key.prototype,"justUp",{get:function(){var a=this._justUp;return this._justUp=!1,a}}),Object.defineProperty(e.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(a){(a=!!a)!==this._enabled&&(a||this.reset(!1),this._enabled=a)}}),e.Key.prototype.constructor=e.Key,e.Keyboard=function(a){this.game=a;this.active=!1;this.enabled=
!0;this.pressEvent=this.event=null;this.onUpCallback=this.onPressCallback=(this.callbackContext=this).onDownCallback=null;this._keys=[];this._capture=[];this._onKeyUp=this._onKeyPress=this._onKeyDown=null;this._k=this._i=0},e.Keyboard.prototype={addCallbacks:function(a,b,c,d){this.callbackContext=a;null!=b&&(this.onDownCallback=b);null!=c&&(this.onUpCallback=c);null!=d&&(this.onPressCallback=d)},removeCallbacks:function(){this.onPressCallback=this.onUpCallback=(this.callbackContext=this).onDownCallback=
null},addKey:function(a){return this._keys[a]||(this._keys[a]=new e.Key(this.game,a),this.addKeyCapture(a)),this._keys[a]},addKeys:function(a){var b={},c;for(c in a)b[c]=this.addKey(a[c]);return b},removeKey:function(a){this._keys[a]&&(this._keys[a]=null,this.removeKeyCapture(a))},createCursorKeys:function(){return this.addKeys({up:e.KeyCode.UP,down:e.KeyCode.DOWN,left:e.KeyCode.LEFT,right:e.KeyCode.RIGHT})},start:function(){if(this.game.device.cocoonJS||this.active)return!1;var a=this;return this._onKeyDown=
function(b){return a.processKeyDown(b)},this._onKeyUp=function(b){return a.processKeyUp(b)},this._onKeyPress=function(b){return a.processKeyPress(b)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1),this.active=!0},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);
this._onKeyPress=this._onKeyUp=this._onKeyDown=null;this.active=!1},destroy:function(){this.stop();this.clearCaptures();this._i=this._keys.length=0},addKeyCapture:function(a){if("object"==typeof a)for(var b in a)this._capture[a[b]]=!0;else this._capture[a]=!0},removeKeyCapture:function(a){delete this._capture[a]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(a){if(this.event=
a,this.game.input.enabled&&this.enabled){var b=a.keyCode;this._capture[b]&&a.preventDefault();this._keys[b]||(this._keys[b]=new e.Key(this.game,b));this._keys[b].processKeyDown(a);this._k=b;this.onDownCallback&&this.onDownCallback.call(this.callbackContext,a)}},processKeyPress:function(a){this.pressEvent=a;this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(a.charCode),a)},processKeyUp:function(a){if(this.event=a,this.game.input.enabled&&
this.enabled){var b=a.keyCode;this._capture[b]&&a.preventDefault();this._keys[b]||(this._keys[b]=new e.Key(this.game,b));this._keys[b].processKeyUp(a);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,a)}},reset:function(a){void 0===a&&(a=!0);this.event=null;for(var b=this._keys.length;b--;)this._keys[b]&&this._keys[b].reset(a)},downDuration:function(a,b){return this._keys[a]?this._keys[a].downDuration(b):null},upDuration:function(a,b){return this._keys[a]?this._keys[a].upDuration(b):
null},justPressed:function(a){return this._keys[a]?this._keys[a].justPressed():null},justReleased:function(a){return this._keys[a]?this._keys[a].justReleased():null},isDown:function(a){return this._keys[a]?this._keys[a].isDown:null}},Object.defineProperty(e.Keyboard.prototype,"lastChar",{get:function(){return this.event&&32===this.event.charCode?"":this.pressEvent?String.fromCharCode(this.pressEvent.charCode):null}}),Object.defineProperty(e.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),
e.Keyboard.prototype.constructor=e.Keyboard,e.KeyCode={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,
F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},e.KeyCode)e.KeyCode.hasOwnProperty(l)&&
!l.match(/[a-z]/)&&(e.Keyboard[l]=e.KeyCode[l]);for(var k in e.Component=function(){},e.Component.Angle=function(){},e.Component.Angle.prototype={angle:{get:function(){return e.Math.wrapAngle(e.Math.radToDeg(this.rotation))},set:function(a){this.rotation=e.Math.degToRad(e.Math.wrapAngle(a))}}},e.Component.Animation=function(){},e.Component.Animation.prototype={play:function(a,b,c,d){if(this.animations)return this.animations.play(a,b,c,d)}},e.Component.AutoCull=function(){},e.Component.AutoCull.prototype=
{autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},e.Component.Bounds=function(){},e.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+.5*this.width},
set:function(a){this.x=a+this.offsetX-.5*this.width}},centerY:{get:function(){return this.y-this.offsetY+.5*this.height},set:function(a){this.y=a+this.offsetY-.5*this.height}},left:{get:function(){return this.x-this.offsetX},set:function(a){this.x=a+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(a){this.x=a-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(a){this.y=a+this.offsetY}},bottom:{get:function(){return this.y+
this.height-this.offsetY},set:function(a){this.y=a-this.height+this.offsetY}},alignIn:function(a,b,c,d){switch(void 0===c&&(c=0),void 0===d&&(d=0),b){default:case e.TOP_LEFT:this.left=a.left-c;this.top=a.top-d;break;case e.TOP_CENTER:this.centerX=a.centerX+c;this.top=a.top-d;break;case e.TOP_RIGHT:this.right=a.right+c;this.top=a.top-d;break;case e.LEFT_CENTER:this.left=a.left-c;this.centerY=a.centerY+d;break;case e.CENTER:this.centerX=a.centerX+c;this.centerY=a.centerY+d;break;case e.RIGHT_CENTER:this.right=
a.right+c;this.centerY=a.centerY+d;break;case e.BOTTOM_LEFT:this.left=a.left-c;this.bottom=a.bottom+d;break;case e.BOTTOM_CENTER:this.centerX=a.centerX+c;this.bottom=a.bottom+d;break;case e.BOTTOM_RIGHT:this.right=a.right+c,this.bottom=a.bottom+d}return this},alignTo:function(a,b,c,d){switch(void 0===c&&(c=0),void 0===d&&(d=0),b){default:case e.TOP_LEFT:this.left=a.left-c;this.bottom=a.top-d;break;case e.TOP_CENTER:this.centerX=a.centerX+c;this.bottom=a.top-d;break;case e.TOP_RIGHT:this.right=a.right+
c;this.bottom=a.top-d;break;case e.LEFT_TOP:this.right=a.left-c;this.top=a.top-d;break;case e.LEFT_CENTER:this.right=a.left-c;this.centerY=a.centerY+d;break;case e.LEFT_BOTTOM:this.right=a.left-c;this.bottom=a.bottom+d;break;case e.RIGHT_TOP:this.left=a.right+c;this.top=a.top-d;break;case e.RIGHT_CENTER:this.left=a.right+c;this.centerY=a.centerY+d;break;case e.RIGHT_BOTTOM:this.left=a.right+c;this.bottom=a.bottom+d;break;case e.BOTTOM_LEFT:this.left=a.left-c;this.top=a.bottom+d;break;case e.BOTTOM_CENTER:this.centerX=
a.centerX+c;this.top=a.bottom+d;break;case e.BOTTOM_RIGHT:this.right=a.right+c,this.top=a.bottom+d}return this}},e.Group.prototype.alignIn=e.Component.Bounds.prototype.alignIn,e.Group.prototype.alignTo=e.Component.Bounds.prototype.alignTo,e.Component.BringToTop=function(){},e.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringChildToTop&&this.parent.bringChildToTop(this),this},e.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendChildToBack&&
this.parent.sendChildToBack(this),this},e.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},e.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},e.Component.Core=function(){},e.Component.Core.install=function(a){e.Utils.mixinPrototype(this,e.Component.Core.prototype);this.components={};for(var b=0;b<a.length;b++){var c=a[b],d=!1;"Destroy"===c&&(d=!0);e.Utils.mixinPrototype(this,e.Component[c].prototype,
d);this.components[c]=!0}},e.Component.Core.init=function(a,b,c,d,f){this.game=a;this.key=d;this.data={};this.position.set(b,c);this.world=new e.Point(b,c);this.previousPosition=new e.Point(b,c);this.events=new e.Events(this);this._bounds=new e.Rectangle;this.components.PhysicsBody&&(this.body=this.body);this.components.Animation&&(this.animations=new e.AnimationManager(this));this.components.LoadTexture&&null!==d&&this.loadTexture(d,f);this.components.FixedToCamera&&(this.cameraOffset=new e.Point(b,
c))},e.Component.Core.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.exists&&this.parent.exists?(this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate(),this.preUpdateChildren(),!0):!(this.renderOrderID=
-1))},e.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(a){a?(this._exists=!0,this.body&&this.body.type===e.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===e.Physics.P2JS&&this.body.removeFromWorld(),this.visible=
!1)}},preUpdateChildren:function(){for(var a=0;a<this.children.length;){var b=this.children[a];b.preUpdate();this===b.parent&&a++}},update:function(){},postUpdate:function(){this.customRender&&this.key.render();this.components.PhysicsBody&&e.Component.PhysicsBody.postUpdate.call(this);this.components.FixedToCamera&&e.Component.FixedToCamera.postUpdate.call(this);for(var a=0;a<this.children.length;a++)this.children[a].postUpdate()}},e.Component.Crop=function(){},e.Component.Crop.prototype={cropRect:null,
_crop:null,crop:function(a,b){void 0===b&&(b=!1);a?(b&&null!==this.cropRect?this.cropRect.setTo(a.x,a.y,a.width,a.height):b&&null===this.cropRect?this.cropRect=new e.Rectangle(a.x,a.y,a.width,a.height):this.cropRect=a,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){var a=this.texture.crop.x,b=this.texture.crop.y,c=this.texture.crop.width,d=this.texture.crop.height;this._crop=e.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=
this._frame.x;this._crop.y+=this._frame.y;var f=Math.max(this._frame.x,this._crop.x),g=Math.max(this._frame.y,this._crop.y),h=Math.min(this._frame.right,this._crop.right)-f,m=Math.min(this._frame.bottom,this._crop.bottom)-g;this.texture.crop.x=f;this.texture.crop.y=g;this.texture.crop.width=h;this.texture.crop.height=m;this.texture.frame.width=Math.min(h,this.cropRect.width);this.texture.frame.height=Math.min(m,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=
this.texture.frame.height;this.texture._updateUvs();16777215===this.tint||a===f&&b===g&&c===h&&d===m||(this.texture.requiresReTint=!0)}}},e.Component.Delta=function(){},e.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},e.Component.Destroy=function(){},e.Component.Destroy.prototype={destroyPhase:!1,destroy:function(a,
b){if(null!==this.game&&!this.destroyPhase){void 0===a&&(a=!0);void 0===b&&(b=!1);this.destroyPhase=!0;this.events&&this.events.onDestroy$dispatch(this);this.parent&&(this.parent instanceof e.Group?this.parent.remove(this):this.parent.removeChild(this));this.input&&this.input.destroy();this.animations&&this.animations.destroy();this.body&&this.body.destroy();this.events&&this.events.destroy();this.game.tweens.removeFrom(this);var c=this.children.length;if(a)for(;c--;)this.children[c].destroy(a);else for(;c--;)this.removeChild(this.children[c]);
this._crop&&(this._crop=null,this.cropRect=null);this._frame&&(this._frame=null);e.Video&&this.key instanceof e.Video&&this.key.onChangeSource.remove(this.resizeFrame,this);e.BitmapText&&this._glyphs&&(this._glyphs=[]);this.visible=this.exists=this.alive=!1;this.game=this.mask=this.filters=null;this.data={};this.renderable=!1;this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null);this._mask=this._currentBounds=this._bounds=this.filterArea=this.worldTransform=this.stage=
this.parent=this.hitArea=null;this._destroyCachedSprite();this._destroyTintedTexture();b&&this.texture.destroy(!0);this.pendingDestroy=this.destroyPhase=!1}}},e.Events=function(a){this.parent=a},e.Events.prototype={destroy:function(){this._parent=null;this._onDestroy&&this._onDestroy.dispose();this._onAddedToGroup&&this._onAddedToGroup.dispose();this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose();this._onKilled&&this._onKilled.dispose();this._onRevived&&this._onRevived.dispose();this._onEnterBounds&&
this._onEnterBounds.dispose();this._onOutOfBounds&&this._onOutOfBounds.dispose();this._onInputOver&&this._onInputOver.dispose();this._onInputOut&&this._onInputOut.dispose();this._onInputDown&&this._onInputDown.dispose();this._onInputUp&&this._onInputUp.dispose();this._onDragStart&&this._onDragStart.dispose();this._onDragUpdate&&this._onDragUpdate.dispose();this._onDragStop&&this._onDragStop.dispose();this._onAnimationStart&&this._onAnimationStart.dispose();this._onAnimationComplete&&this._onAnimationComplete.dispose();
this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},e.Events.prototype.constructor=e.Events,e.Events.prototype)e.Events.prototype.hasOwnProperty(k)&&0===k.indexOf("on")&&null===e.Events.prototype[k]&&
function(a,b){Object.defineProperty(e.Events.prototype,a,{get:function(){return this[b]||(this[b]=new e.Signal)}});e.Events.prototype[a+"$dispatch"]=function(){return this[b]?this[b].dispatch.apply(this[b],arguments):null}}(k,"_"+k);e.Component.FixedToCamera=function(){};e.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};
e.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(a){a?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new e.Point};e.Component.Health=function(){};e.Component.Health.prototype={health:1,maxHealth:100,damage:function(a){return this.alive&&(this.health-=a,0>=this.health&&this.kill()),this},setHealth:function(a){return this.health=a,this.health>this.maxHealth&&(this.health=
this.maxHealth),this},heal:function(a){return this.alive&&(this.health+=a,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}};e.Component.InCamera=function(){};e.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};e.Component.InputEnabled=function(){};e.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(a){a?null===this.input?(this.input=new e.InputHandler(this),
this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}};e.Component.InWorld=function(){};e.Component.InWorld.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(this.autoCull||this.checkWorldBounds){if(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;
else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1}return!0};e.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,
outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};e.Component.LifeSpan=function(){};e.Component.LifeSpan.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):!(0<this.lifespan&&(this.lifespan-=this.game.time.delta,0>=this.lifespan))||(this.kill(),!1)};e.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(a){return void 0===a&&(a=100),this.alive=!0,this.exists=!0,this.visible=!0,"function"==
typeof this.setHealth&&this.setHealth(a),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}};e.Component.LoadTexture=function(){};e.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(a,b,c){b=a===e.PENDING_ATLAS?(a=b,0):b||0;(c||void 0===c)&&this.animations&&this.animations.stop();this.key=a;this.customRender=!1;var d=this.game.cache,f=!0;c=
this.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR;e.RenderTexture&&a instanceof e.RenderTexture?(this.key=a.key,this.setTexture(a)):e.BitmapData&&a instanceof e.BitmapData?(this.customRender=!0,this.setTexture(a.texture),f=d.hasFrameData(a.key,e.Cache.BITMAPDATA)?!this.animations.loadFrameData(d.getFrameData(a.key,e.Cache.BITMAPDATA),b):!this.animations.loadFrameData(a.frameData,0)):e.Video&&a instanceof e.Video?(this.customRender=!0,b=a.texture.valid,this.setTexture(a.texture),this.setFrame(a.texture.frame.clone()),
a.onChangeSource.add(this.resizeFrame,this),this.texture.valid=b):e.Tilemap&&a instanceof e.TilemapLayer?this.setTexture(PIXI.Texture.fromCanvas(a.canvas)):a instanceof PIXI.Texture?(c=a.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,this.setTexture(a)):(f=d.getImage(a,!0),this.key=f.key,this.setTexture(new PIXI.Texture(f.base)),this.texture.baseTexture.skipRender="__default"===a,f=!this.animations.loadFrameData(f.frameData,b));f&&(this._frame=e.Rectangle.clone(this.texture.frame));c||(this.texture.baseTexture.scaleMode=
1)},setFrame:function(a){this._frame=a;this.texture.frame.x=a.x;this.texture.frame.y=a.y;this.texture.frame.width=a.width;this.texture.frame.height=a.height;this.texture.crop.x=a.x;this.texture.crop.y=a.y;this.texture.crop.width=a.width;this.texture.crop.height=a.height;a.trimmed?(this.texture.trim?(this.texture.trim.x=a.spriteSourceSizeX,this.texture.trim.y=a.spriteSourceSizeY,this.texture.trim.width=a.sourceSizeW,this.texture.trim.height=a.sourceSizeH):this.texture.trim={x:a.spriteSourceSizeX,y:a.spriteSourceSizeY,
width:a.sourceSizeW,height:a.sourceSizeH},this.texture.width=a.sourceSizeW,this.texture.height=a.sourceSizeH,this.texture.frame.width=a.sourceSizeW,this.texture.frame.height=a.sourceSizeH):!a.trimmed&&this.texture.trim&&(this.texture.trim=null);a.rotated&&(this.texture.rotated=!0);this.cropRect&&this.updateCrop();this.texture.requiresReTint=!0;this.texture._updateUvs();this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(a,b,c){this.texture.frame.resize(b,c);this.texture.setFrame(this.texture.frame)},
resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(a){this.animations.frame=a}},frameName:{get:function(){return this.animations.frameName},set:function(a){this.animations.frameName=a}}};e.Component.Overlap=function(){};e.Component.Overlap.prototype={overlap:function(a){return e.Rectangle.intersects(this.getBounds(),a.getBounds())}};e.Component.PhysicsBody=function(){};e.Component.PhysicsBody.preUpdate=function(){return this.pendingDestroy?
(this.destroy(),!1):this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,this.preUpdateChildren(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!(!this._exists||!this.parent.exists)||
!(this.renderOrderID=-1))};e.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()};e.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(a){this.position.x=a;this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(a){this.position.y=a;this.body&&!this.body.dirty&&(this.body._reset=!0)}}};e.Component.Reset=function(){};e.Component.Reset.prototype.reset=function(a,
b,c){return void 0===c&&(c=1),this.world.set(a,b),this.position.set(a,b),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=c),this.components.PhysicsBody&&this.body&&this.body.reset(a,b,!1,!1),this};e.Component.ScaleMinMax=function(){};e.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(a){this.scaleMin&&
(a.a<this.scaleMin.x&&(a.a=this.scaleMin.x),a.d<this.scaleMin.y&&(a.d=this.scaleMin.y));this.scaleMax&&(a.a>this.scaleMax.x&&(a.a=this.scaleMax.x),a.d>this.scaleMax.y&&(a.d=this.scaleMax.y))},setScaleMinMax:function(a,b,c,d){void 0===b?b=c=d=a:void 0===c&&(c=d=b,b=a);null===a?this.scaleMin=null:this.scaleMin?this.scaleMin.set(a,b):this.scaleMin=new e.Point(a,b);null===c?this.scaleMax=null:this.scaleMax?this.scaleMax.set(c,d):this.scaleMax=new e.Point(c,d);null===this.scaleMin?this.transformCallback=
null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}};e.Component.Smoothed=function(){};e.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(a){a?this.texture&&0!==this.texture.baseTexture.scaleMode&&(this.texture.baseTexture.scaleMode=0,this.texture.baseTexture.dirty()):this.texture&&1!==this.texture.baseTexture.scaleMode&&(this.texture.baseTexture.scaleMode=1,this.texture.baseTexture.dirty())}}};e.GameObjectFactory=
function(a){this.game=a;this.world=this.game.world};e.GameObjectFactory.prototype={existing:function(a){return this.world.add(a)},weapon:function(a,b,c,d,f){var g=this.game.plugins.add(e.Weapon);return f&&(g.bulletClass=f),g.createBullets(a,b,c,d),g},image:function(a,b,c,d,f){return void 0===f&&(f=this.world),f.add(new e.Image(this.game,a,b,c,d))},sprite:function(a,b,c,d,f){return void 0===f&&(f=this.world),f.add(new e.Sprite(this.game,a,b,c,d))},creature:function(a,b,c,d,f,g,h){void 0===f&&(f=this.world);
a=new e.Creature(this.game,a,b,c,d,g,h);return f.add(a),a},tween:function(a){return this.game.tweens.create(a)},group:function(a,b,c,d,f){return new e.Group(this.game,a,b,c,d,f)},physicsGroup:function(a,b,c,d){return new e.Group(this.game,b,c,d,!0,a)},spriteBatch:function(a,b,c){return void 0===a&&(a=null),void 0===b&&(b="group"),void 0===c&&(c=!1),new e.SpriteBatch(this.game,a,b,c)},audio:function(a,b,c,d){return this.game.sound.add(a,b,c,d)},sound:function(a,b,c,d){return this.game.sound.add(a,
b,c,d)},audioSprite:function(a){return this.game.sound.addSprite(a)},tileSprite:function(a,b,c,d,f,g,h){return void 0===h&&(h=this.world),h.add(new e.TileSprite(this.game,a,b,c,d,f,g))},rope:function(a,b,c,d,f,g){return void 0===g&&(g=this.world),g.add(new e.Rope(this.game,a,b,c,d,f))},text:function(a,b,c,d,f){return void 0===f&&(f=this.world),f.add(new e.Text(this.game,a,b,c,d))},button:function(a,b,c,d,f,g,h,m,n,p){return void 0===p&&(p=this.world),p.add(new e.Button(this.game,a,b,c,d,f,g,h,m,n))},
graphics:function(a,b,c){return void 0===c&&(c=this.world),c.add(new e.Graphics(this.game,a,b))},emitter:function(a,b,c){return this.game.particles.add(new e.Particles.Arcade.Emitter(this.game,a,b,c))},retroFont:function(a,b,c,d,f,g,h,m,n){return new e.RetroFont(this.game,a,b,c,d,f,g,h,m,n)},bitmapText:function(a,b,c,d,f,g){return void 0===g&&(g=this.world),g.add(new e.BitmapText(this.game,a,b,c,d,f))},tilemap:function(a,b,c,d,f){return new e.Tilemap(this.game,a,b,c,d,f)},renderTexture:function(a,
b,c,d){void 0!==c&&""!==c||(c=this.game.rnd.uuid());void 0===d&&(d=!1);a=new e.RenderTexture(this.game,a,b,c);return d&&this.game.cache.addRenderTexture(c,a),a},video:function(a,b){return new e.Video(this.game,a,b)},bitmapData:function(a,b,c,d){void 0===d&&(d=!1);void 0!==c&&""!==c||(c=this.game.rnd.uuid());a=new e.BitmapData(this.game,c,a,b);return d&&this.game.cache.addBitmapData(c,a),a},filter:function(a){var b=Array.prototype.slice.call(arguments,1);return(a=new e.Filter[a](this.game)).init.apply(a,
b),a},plugin:function(){return this.game.plugins.add.apply(this.game.plugins,arguments)}};e.GameObjectFactory.prototype.constructor=e.GameObjectFactory;e.GameObjectCreator=function(a){this.game=a;this.world=this.game.world};e.GameObjectCreator.prototype={image:function(a,b,c,d){return new e.Image(this.game,a,b,c,d)},sprite:function(a,b,c,d){return new e.Sprite(this.game,a,b,c,d)},tween:function(a){return new e.Tween(a,this.game,this.game.tweens)},group:function(a,b,c,d,f){return new e.Group(this.game,
a||null,b,c,d,f)},spriteBatch:function(a,b,c){return void 0===b&&(b="group"),void 0===c&&(c=!1),new e.SpriteBatch(this.game,a,b,c)},audio:function(a,b,c,d){return this.game.sound.add(a,b,c,d)},audioSprite:function(a){return this.game.sound.addSprite(a)},sound:function(a,b,c,d){return this.game.sound.add(a,b,c,d)},tileSprite:function(a,b,c,d,f,g){return new e.TileSprite(this.game,a,b,c,d,f,g)},rope:function(a,b,c,d,f){return new e.Rope(this.game,a,b,c,d,f)},text:function(a,b,c,d){return new e.Text(this.game,
a,b,c,d)},button:function(a,b,c,d,f,g,h,m,n){return new e.Button(this.game,a,b,c,d,f,g,h,m,n)},graphics:function(a,b){return new e.Graphics(this.game,a,b)},emitter:function(a,b,c){return new e.Particles.Arcade.Emitter(this.game,a,b,c)},retroFont:function(a,b,c,d,f,g,h,m,n){return new e.RetroFont(this.game,a,b,c,d,f,g,h,m,n)},bitmapText:function(a,b,c,d,f,g){return new e.BitmapText(this.game,a,b,c,d,f,g)},tilemap:function(a,b,c,d,f){return new e.Tilemap(this.game,a,b,c,d,f)},renderTexture:function(a,
b,c,d){void 0!==c&&""!==c||(c=this.game.rnd.uuid());void 0===d&&(d=!1);a=new e.RenderTexture(this.game,a,b,c);return d&&this.game.cache.addRenderTexture(c,a),a},bitmapData:function(a,b,c,d){void 0===d&&(d=!1);void 0!==c&&""!==c||(c=this.game.rnd.uuid());a=new e.BitmapData(this.game,c,a,b);return d&&this.game.cache.addBitmapData(c,a),a},filter:function(a){var b=Array.prototype.slice.call(arguments,1);return(a=new e.Filter[a](this.game)).init.apply(a,b),a}};e.GameObjectCreator.prototype.constructor=
e.GameObjectCreator;e.Sprite=function(a,b,c,d,f){b=b||0;c=c||0;d=d||null;f=f||null;this.physicsType=this.type=e.SPRITE;PIXI.Sprite.call(this,e.Cache.DEFAULT);e.Component.Core.init.call(this,a,b,c,d,f)};e.Sprite.prototype=Object.create(PIXI.Sprite.prototype);e.Sprite.prototype.constructor=e.Sprite;e.Component.Core.install.call(e.Sprite.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Delta Destroy FixedToCamera Health InCamera InputEnabled InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset ScaleMinMax Smoothed".split(" "));
e.Sprite.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate;e.Sprite.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate;e.Sprite.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate;e.Sprite.prototype.preUpdateCore=e.Component.Core.preUpdate;e.Sprite.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()};e.Image=function(a,b,c,d,f){b=b||0;c=c||0;d=d||null;f=f||null;this.type=e.IMAGE;PIXI.Sprite.call(this,
e.Cache.DEFAULT);e.Component.Core.init.call(this,a,b,c,d,f)};e.Image.prototype=Object.create(PIXI.Sprite.prototype);e.Image.prototype.constructor=e.Image;e.Component.Core.install.call(e.Image.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Destroy FixedToCamera InputEnabled LifeSpan LoadTexture Overlap Reset ScaleMinMax Smoothed".split(" "));e.Image.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate;e.Image.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate;e.Image.prototype.preUpdateCore=
e.Component.Core.preUpdate;e.Image.prototype.preUpdate=function(){return!(!this.preUpdateInWorld()||!this.preUpdateLifeSpan())&&this.preUpdateCore()};e.Button=function(a,b,c,d,f,g,h,m,n,p){f=f||null;g=g||this;e.Image.call(this,a,b||0,c||0,d||null,m);this.type=e.BUTTON;this.physicsType=e.SPRITE;this.onUpSound=this.onDownSound=this.onOutSound=this.onOverSound=this._onUpFrame=this._onDownFrame=this._onOutFrame=this._onOverFrame=null;this.onUpSoundMarker=this.onDownSoundMarker=this.onOutSoundMarker=this.onOverSoundMarker=
"";this.onInputOver=new e.Signal;this.onInputOut=new e.Signal;this.onInputDown=new e.Signal;this.onInputUp=new e.Signal;this.onOverMouseOnly=!0;this.justReleasedPreventsOver=e.PointerMode.CONTACT;this.forceOut=this.freezeFrames=!1;this.inputEnabled=!0;this.input.start(0,!0);this.input.useHandCursor=!0;this.setFrames(h,m,n,p);null!==f&&this.onInputUp.add(f,g);this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,
this);this.events.onInputUp.add(this.onInputUpHandler,this)};e.Button.prototype=Object.create(e.Image.prototype);e.Button.prototype.constructor=e.Button;return e.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},e.Button.prototype.setStateFrame=function(a,b,c){var d="_on"+a+"Frame";null!==b?(this[d]=b,c&&this.changeStateFrame(a)):this[d]=null},e.Button.prototype.changeStateFrame=function(a){if(this.freezeFrames)return!1;a=this["_on"+a+"Frame"];return"string"==typeof a?(this.frameName=
a,!0):"number"==typeof a&&(this.frame=a,!0)},e.Button.prototype.setFrames=function(a,b,c,d){this.setStateFrame("Over",a,this.input.pointerOver());this.setStateFrame("Out",b,!this.input.pointerOver());this.setStateFrame("Down",c,this.input.pointerDown());this.setStateFrame("Up",d,this.input.pointerUp())},e.Button.prototype.setStateSound=function(a,b,c){var d="on"+a+"Sound";a="on"+a+"SoundMarker";b instanceof e.Sound||b instanceof e.AudioSprite?(this[d]=b,this[a]="string"==typeof c?c:""):(this[d]=null,
this[a]="")},e.Button.prototype.playStateSound=function(a){var b=this["on"+a+"Sound"];return b?(b.play(this["on"+a+"SoundMarker"]),!0):!1},e.Button.prototype.setSounds=function(a,b,c,d,f,g,h,m){this.setStateSound("Over",a,b);this.setStateSound("Out",f,g);this.setStateSound("Down",c,d);this.setStateSound("Up",h,m)},e.Button.prototype.setOverSound=function(a,b){this.setStateSound("Over",a,b)},e.Button.prototype.setOutSound=function(a,b){this.setStateSound("Out",a,b)},e.Button.prototype.setDownSound=
function(a,b){this.setStateSound("Down",a,b)},e.Button.prototype.setUpSound=function(a,b){this.setStateSound("Up",a,b)},e.Button.prototype.onInputOverHandler=function(a,b){b.justReleased()&&(this.justReleasedPreventsOver&b.pointerMode)===b.pointerMode||(this.changeStateFrame("Over"),this.onOverMouseOnly&&!b.isMouse||(this.playStateSound("Over"),this.onInputOver&&this.onInputOver.dispatch(this,b)))},e.Button.prototype.onInputOutHandler=function(a,b){this.changeStateFrame("Out");this.playStateSound("Out");
this.onInputOut&&this.onInputOut.dispatch(this,b)},e.Button.prototype.onInputDownHandler=function(a,b){this.changeStateFrame("Down");this.playStateSound("Down");this.onInputDown&&this.onInputDown.dispatch(this,b)},e.Button.prototype.onInputUpHandler=function(a,b,c){(this.playStateSound("Up"),this.onInputUp&&this.onInputUp.dispatch(this,b,c),this.freezeFrames)||(!0===this.forceOut||(this.forceOut&b.pointerMode)===b.pointerMode?this.changeStateFrame("Out"):this.changeStateFrame("Up")||(c?this.changeStateFrame("Over"):
this.changeStateFrame("Out")))},e.SpriteBatch=function(a,b,c,d){null==b&&(b=a.world);e.Group.call(this,a,b,c,d);this.type=e.SPRITEBATCH;this.fastSpriteBatch=null;this.ready=!1},e.SpriteBatch.prototype=Object.create(e.Group.prototype),e.SpriteBatch.prototype.constructor=e.SpriteBatch,e.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||!this.children.length||(this.ready||(this.fastSpriteBatch=new PIXI.WebGLFastSpriteBatch(a.gl),this.ready=!0),this.fastSpriteBatch.gl!==a.gl&&
this.fastSpriteBatch.setContext(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())},e.SpriteBatch.prototype._renderCanvas=function(a){if(this.visible&&!(0>=this.alpha)&&this.children.length){var b=a.context;b.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(var c=this.worldTransform,d=!0,f=0;f<this.children.length;f++){var g=this.children[f];if(g.visible){var h=
g.texture,m=h.frame;if(b.globalAlpha=this.worldAlpha*g.alpha,0==g.rotation%(2*Math.PI))d&&(b.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty),d=!1),b.drawImage(h.baseTexture.source,m.x,m.y,m.width,m.height,g.anchor.x*-m.width*g.scale.x+g.position.x+.5+a.shakeX|0,g.anchor.y*-m.height*g.scale.y+g.position.y+.5+a.shakeY|0,m.width*g.scale.x,m.height*g.scale.y);else{d||=!0;g.displayObjectUpdateTransform();var n=g.worldTransform,p=n.tx*a.resolution+a.shakeX,q=n.ty*a.resolution+a.shakeY;a.roundPixels?b.setTransform(n.a,
n.b,n.c,n.d,0|p,0|q):b.setTransform(n.a,n.b,n.c,n.d,p,q);b.drawImage(h.baseTexture.source,m.x,m.y,m.width,m.height,g.anchor.x*-m.width+.5|0,g.anchor.y*-m.height+.5|0,m.width,m.height)}}}}},e.BitmapData=function(a,b,c,d,f){void 0!==c&&0!==c||(c=256);void 0!==d&&0!==d||(d=256);void 0===f&&(f=!1);this.game=a;this.key=b;this.width=c;this.height=d;this.canvas=e.Canvas.create(this,c,d,null,f);this.ctx=this.context=this.canvas.getContext("2d",{alpha:!0});this.smoothProperty=a.renderType===e.CANVAS?a.renderer.renderSession.smoothProperty:
e.Canvas.getSmoothingPrefix(this.context);this.imageData=this.context.getImageData(0,0,c,d);this.data=null;this.imageData&&(this.data=this.imageData.data);this.pixels=null;this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data);this.baseTexture=new PIXI.BaseTexture(this.canvas,null,this.game.resolution);
this.texture=new PIXI.Texture(this.baseTexture);this.frameData=new e.FrameData;this.textureFrame=this.frameData.addFrame(new e.Frame(0,0,0,c,d,"bitmapData"));this.texture.frame=this.textureFrame;this.type=e.BITMAPDATA;this.dirty=this.disableTextureUpload=!1;this.cls=this.clear;this._image=null;this._pos=new e.Point;this._size=new e.Point;this._scale=new e.Point;this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new e.Point;this._tempB=this._tempG=this._tempR=0;this._circle=new e.Circle;this._swapCanvas=
void 0},e.BitmapData.prototype={move:function(a,b,c){return 0!==a&&this.moveH(a,c),0!==b&&this.moveV(b,c),this},moveH:function(a,b){void 0===b&&(b=!0);void 0===this._swapCanvas&&(this._swapCanvas=e.CanvasPool.create(this,this.width,this.height));var c=this._swapCanvas.getContext("2d"),d=this.height,f=this.canvas;if(c.clearRect(0,0,this.width,this.height),0>a){a=Math.abs(a);var g=this.width-a;b&&c.drawImage(f,0,0,a,d,g,0,a,d);c.drawImage(f,a,0,g,d,0,0,g,d)}else g=this.width-a,b&&c.drawImage(f,g,0,
a,d,0,0,a,d),c.drawImage(f,0,0,g,d,a,0,g,d);return this.clear(),this.copy(this._swapCanvas)},moveV:function(a,b){void 0===b&&(b=!0);void 0===this._swapCanvas&&(this._swapCanvas=e.CanvasPool.create(this,this.width,this.height));var c=this._swapCanvas.getContext("2d"),d=this.width,f=this.canvas;if(c.clearRect(0,0,this.width,this.height),0>a){a=Math.abs(a);var g=this.height-a;b&&c.drawImage(f,0,0,d,a,0,g,d,a);c.drawImage(f,0,a,d,g,0,0,d,g)}else g=this.height-a,b&&c.drawImage(f,0,g,d,a,0,0,d,a),c.drawImage(f,
0,0,d,g,0,a,d,g);return this.clear(),this.copy(this._swapCanvas)},add:function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)a[b].loadTexture&&a[b].loadTexture(this);else a.loadTexture(this);return this},load:function(a){if("string"==typeof a&&(a=this.game.cache.getImage(a)),a)return this.resize(a.width,a.height),this.cls(),this.draw(a),this.update(),this},clear:function(a,b,c,d){return void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=this.width),void 0===d&&(d=this.height),this.context.clearRect(a,
b,c,d),this.dirty=!0,this},fill:function(a,b,c,d){return void 0===d&&(d=1),this.context.fillStyle="rgba("+a+","+b+","+c+","+d+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},getBase64:function(a,b){return this.canvas.toDataURL(a,b)},getImage:function(a,b,c,d){var f=new Image;return c&&(f.onload=c),d&&(f.onerror=d),f.src=this.getBase64(a,b),f},generateTexture:function(a,b,c){var d=this.game.cache,f=new Image;if(b&&(f.onload=function(){var h=d.addImage(a,"",f);h=new PIXI.Texture(h.base);
b.call(c||null,h);f.onload=null}),f.src=this.getBase64(),b)return null;var g=d.addImage(a,"",f);return new PIXI.Texture(g.base)},resize:function(a,b){return a===this.width&&b===this.height||(this.width=a,this.height=b,this.canvas.width=a,this.canvas.height=b,void 0!==this._swapCanvas&&(this._swapCanvas.width=a,this._swapCanvas.height=b),this.baseTexture.width=a,this.baseTexture.height=b,this.textureFrame.width=a,this.textureFrame.height=b,this.texture.width=a,this.texture.height=b,this.texture.crop.width=
a,this.texture.crop.height=b,this.update(),this.dirty=!0),this},update:function(a,b,c,d){return void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=Math.max(1,this.width)),void 0===d&&(d=Math.max(1,this.height)),this.imageData=this.context.getImageData(a,b,c,d),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):
this.pixels=this.imageData.data,this},processPixelRGB:function(a,b,c,d,f,g){void 0===c&&(c=0);void 0===d&&(d=0);void 0===f&&(f=this.width);void 0===g&&(g=this.height);f=c+f;g=d+g;for(var h=e.Color.createColor(),m={r:0,g:0,b:0,a:0},n=!1;d<g;d++)for(var p=c;p<f;p++)e.Color.unpackPixel(this.getPixel32(p,d),h),!1!==(m=a.call(b,h,p,d))&&null!=m&&(this.setPixel32(p,d,m.r,m.g,m.b,m.a,!1),n=!0);return n&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(a,b,c,d,f,g){void 0===
c&&(c=0);void 0===d&&(d=0);void 0===f&&(f=this.width);void 0===g&&(g=this.height);f=c+f;g=d+g;for(var h=0,m=!1,n=d;n<g;n++)for(var p=c;p<f;p++)d=this.getPixel32(p,n),(h=a.call(b,d,p,n))!==d&&(this.pixels[n*this.width+p]=h,m=!0);return m&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(a,b,c,d,f,g,h,m,n){var p=0,q=0,r=this.width,u=this.height;a=e.Color.packPixel(a,b,c,d);void 0!==n&&n instanceof e.Rectangle&&(p=n.x,q=n.y,r=n.width,u=n.height);for(n=0;n<u;n++)for(b=
0;b<r;b++)this.getPixel32(p+b,q+n)===a&&this.setPixel32(p+b,q+n,f,g,h,m,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(a,b,c,d){var f=a||0===a,g=b||0===b,h=c||0===c;if(f||g||h){void 0===d&&(d=new e.Rectangle(0,0,this.width,this.height));for(var m=e.Color.createColor(),n=d.y;n<d.bottom;n++)for(var p=d.x;p<d.right;p++)e.Color.unpackPixel(this.getPixel32(p,n),m,!0),f&&(m.h=a),g&&(m.s=b),h&&(m.l=c),e.Color.HSLtoRGB(m.h,m.s,m.l,m),this.setPixel32(p,n,m.r,m.g,
m.b,m.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(a,b,c,d){if(null==a&&(a=!1),null==b&&(b=!1),null==c&&(c=!1),a||b||c){void 0===d&&(d=new e.Rectangle(0,0,this.width,this.height));for(var f=e.Color.createColor(),g=d.y;g<d.bottom;g++)for(var h=d.x;h<d.right;h++)e.Color.unpackPixel(this.getPixel32(h,g),f,!0),a&&(f.h=this.game.math.wrap(f.h+a,0,1)),b&&(f.s=this.game.math.clamp(f.s+b,0,1)),c&&(f.l=this.game.math.clamp(f.l+c,0,1)),e.Color.HSLtoRGB(f.h,
f.s,f.l,f),this.setPixel32(h,g,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(a,b,c,d,f,g,h){return void 0===h&&(h=!0),0<=a&&a<=this.width&&0<=b&&b<=this.height&&(e.Device.LITTLE_ENDIAN?this.pixels[b*this.width+a]=g<<24|f<<16|d<<8|c:this.pixels[b*this.width+a]=c<<24|d<<16|f<<8|g,h&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(a,b,c,d,f,g){return this.setPixel32(a,b,c,d,f,255,g)},getPixel:function(a,
b,c){c||=e.Color.createColor();a=~~(a+b*this.width);return a*=4,c.r=this.data[a],c.g=this.data[++a],c.b=this.data[++a],c.a=this.data[++a],c},getPixel32:function(a,b){if(0<=a&&a<=this.width&&0<=b&&b<=this.height)return this.pixels[b*this.width+a]},getPixelRGB:function(a,b,c,d,f){return e.Color.unpackPixel(this.getPixel32(a,b),c,d,f)},getPixels:function(a){return this.context.getImageData(a.x,a.y,a.width,a.height)},getFirstPixel:function(a){void 0===a&&(a=0);var b=e.Color.createColor(),c=0,d=0,f=1,
g=!1;for(1===a?(f=-1,d=this.height):3===a&&(f=-1,c=this.width);e.Color.unpackPixel(this.getPixel32(c,d),b),0===a||1===a?++c===this.width&&(c=0,((d+=f)>=this.height||0>=d)&&(g=!0)):2!==a&&3!==a||++d===this.height&&(d=0,((c+=f)>=this.width||0>=c)&&(g=!0)),0===b.a&&!g;);return b.x=c,b.y=d,b},getBounds:function(a){return void 0===a&&(a=new e.Rectangle),a.x=this.getFirstPixel(2).x,a.x===this.width?a.setTo(0,0,0,0):(a.y=this.getFirstPixel(0).y,a.width=this.getFirstPixel(3).x-a.x+1,a.height=this.getFirstPixel(1).y-
a.y+1,a)},addToWorld:function(a,b,c,d,f,g){f=f||1;g=g||1;a=this.game.add.image(a,b,this);return a.anchor.set(c,d),a.scale.set(f,g),a},copy:function(a,b,c,d,f,g,h,m,n,p,q,r,u,x,w,A,C){if(null==a&&(a=this),a instanceof e.RenderTexture&&(a=a.getCanvas()),(this._image=a)instanceof e.Sprite||a instanceof e.Image||a instanceof e.Text||a instanceof PIXI.Sprite)this._pos.set(a.texture.crop.x,a.texture.crop.y),this._size.set(a.texture.crop.width,a.texture.crop.height),this._scale.set(a.scale.x,a.scale.y),
this._anchor.set(a.anchor.x,a.anchor.y),this._rotate=a.rotation,this._alpha.current=a.alpha,a.texture instanceof e.RenderTexture?this._image=a.texture.getCanvas():this._image=a.texture.baseTexture.source,null==g&&(g=a.x),null==h&&(h=a.y),a.texture.trim&&(g+=a.texture.trim.x-a.anchor.x*a.texture.trim.width,h+=a.texture.trim.y-a.anchor.y*a.texture.trim.height),16777215!==a.tint&&(a.cachedTint!==a.tint&&(a.cachedTint=a.tint,a.tintedTexture=PIXI.CanvasTinter.getTintedTexture(a,a.tint)),this._image=a.tintedTexture,
this._pos.set(0));else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,a instanceof e.BitmapData)this._image=a.canvas;else if("string"==typeof a){if(null===(a=this.game.cache.getImage(a)))return this;this._image=a}this._size.set(this._image.width,this._image.height)}if(null==b&&(b=0),null==c&&(c=0),d&&(this._size.x=d),f&&(this._size.y=f),null==g&&(g=b),null==h&&(h=c),null==m&&(m=this._size.x),null==n&&(n=this._size.y),"number"==typeof p&&(this._rotate=
p),"number"==typeof q&&(this._anchor.x=q),"number"==typeof r&&(this._anchor.y=r),"number"==typeof u&&(this._scale.x=u),"number"==typeof x&&(this._scale.y=x),"number"==typeof w&&(this._alpha.current=w),void 0===A&&(A=null),void 0===C&&(C=!1),0>=this._alpha.current||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y)return this;a=this.context;return this._alpha.prev=a.globalAlpha,a.save(),a.globalAlpha=this._alpha.current,A&&(this.op=A),C&&(g|=0,h|=0),a.translate(g,h),a.scale(this._scale.x,
this._scale.y),a.rotate(this._rotate),a.drawImage(this._image,this._pos.x+b,this._pos.y+c,this._size.x,this._size.y,-m*this._anchor.x,-n*this._anchor.y,m,n),a.restore(),a.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyTransform:function(a,b,c){if(void 0===b&&(b=null),void 0===c&&(c=!1),!a.hasOwnProperty("worldTransform")||!a.worldVisible||0===a.worldAlpha)return this;var d=a.worldTransform;if(this._pos.set(a.texture.crop.x,a.texture.crop.y),this._size.set(a.texture.crop.width,a.texture.crop.height),
0===d.a||0===d.d||0===this._size.x||0===this._size.y)return this;a.texture instanceof e.RenderTexture?this._image=a.texture.getCanvas():this._image=a.texture.baseTexture.source;var f=d.tx,g=d.ty;a.texture.trim&&(f+=a.texture.trim.x-a.anchor.x*a.texture.trim.width,g+=a.texture.trim.y-a.anchor.y*a.texture.trim.height);16777215!==a.tint&&(a.cachedTint!==a.tint&&(a.cachedTint=a.tint,a.tintedTexture=PIXI.CanvasTinter.getTintedTexture(a,a.tint)),this._image=a.tintedTexture,this._pos.set(0));c&&(f|=0,g|=
0);c=this.context;return this._alpha.prev=c.globalAlpha,c.save(),c.globalAlpha=this._alpha.current,b&&(this.op=b),c[this.smoothProperty]=a.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,c.setTransform(d.a,d.b,d.c,d.d,f,g),c.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*a.anchor.x,-this._size.y*a.anchor.y,this._size.x,this._size.y),c.restore(),c.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(a,b,c,d,f,g,h){return this.copy(a,b.x,b.y,
b.width,b.height,c,d,b.width,b.height,0,0,0,1,1,f,g,h)},draw:function(a,b,c,d,f,g,h){return this.copy(a,null,null,null,null,b,c,d,f,null,null,null,null,null,null,g,h)},drawGroup:function(a,b,c){return 0<a.total&&a.forEachExists(this.drawGroupProxy,this,b,c),this},drawGroupProxy:function(a,b,c){if(a.hasOwnProperty("texture")&&this.copyTransform(a,b,c),a.type===e.GROUP&&a.exists)this.drawGroup(a,b,c);else if(a.hasOwnProperty("children")&&0<a.children.length)for(var d=0;d<a.children.length;d++)a.children[d].exists&&
this.copyTransform(a.children[d],b,c)},drawFull:function(a,b,c){if(!1===a.worldVisible||0===a.worldAlpha||a.hasOwnProperty("exists")&&!1===a.exists)return this;if(a.type!==e.GROUP&&a.type!==e.EMITTER&&a.type!==e.BITMAPTEXT)if(a.type===e.GRAPHICS){var d=a.getBounds();this.ctx.save();this.ctx.translate(d.x,d.y);PIXI.CanvasGraphics.renderGraphics(a,this.ctx);this.ctx.restore()}else this.copy(a,null,null,null,null,a.worldPosition.x,a.worldPosition.y,null,null,a.worldRotation,null,null,a.worldScale.x,
a.worldScale.y,a.worldAlpha,b,c);if(a.children)for(d=0;d<a.children.length;d++)this.drawFull(a.children[d],b,c);return this},shadow:function(a,b,c,d){var f=this.context;return null==a?f.shadowColor="rgba(0,0,0,0)":(f.shadowColor=a,f.shadowBlur=0===b?0:b||5,f.shadowOffsetX=0===c?0:c||10,f.shadowOffsetY=0===d?0:d||10),this},alphaMask:function(a,b,c,d){return null==d?this.draw(b).blendSourceAtop():this.draw(b,d.x,d.y,d.width,d.height).blendSourceAtop(),null==c?this.draw(a).blendReset():this.draw(a,c.x,
c.y,c.width,c.height).blendReset(),this},extract:function(a,b,c,d,f,g,h,m,n){return void 0===f&&(f=255),void 0===g&&(g=!1),void 0===h&&(h=b),void 0===m&&(m=c),void 0===n&&(n=d),g&&a.resize(this.width,this.height),this.processPixelRGB(function(p,q,r){return p.r===b&&p.g===c&&p.b===d&&a.setPixel32(q,r,h,m,n,f,!1),!1},this),a.context.putImageData(a.imageData,0,0),a.dirty=!0,a},rect:function(a,b,c,d,f){return void 0!==f&&(this.context.fillStyle=f),this.context.fillRect(a,b,c,d),this},text:function(a,
b,c,d,f,g){void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d="14px Courier");void 0===f&&(f="rgb(255,255,255)");void 0===g&&(g=!0);var h=this.context,m=h.font;return h.font=d,g&&(h.fillStyle="rgb(0,0,0)",h.fillText(a,b+1,c+1)),h.fillStyle=f,h.fillText(a,b,c),h.font=m,this},circle:function(a,b,c,d){var f=this.context;return void 0!==d&&(f.fillStyle=d),f.beginPath(),f.arc(a,b,c,0,2*Math.PI,!1),f.closePath(),f.fill(),this},line:function(a,b,c,d,f,g){void 0===f&&(f="#fff");void 0===g&&(g=1);var h=this.context;
return h.beginPath(),h.moveTo(a,b),h.lineTo(c,d),h.lineWidth=g,h.strokeStyle=f,h.stroke(),h.closePath(),this},polygon:function(a,b,c,d){void 0===d&&(d="#fff");void 0===c&&(c=0);var f=this.context;b&&(f.fillStyle=b);c&&(f.lineWidth=c,f.strokeStyle=d);f.beginPath();f.moveTo(a[0].x,a[0].y);d=1;for(var g=a.length;d<g;d++){var h=a[d];f.lineTo(h.x,h.y)}return f.closePath(),b&&f.fill(),c&&f.stroke(),this},textureLine:function(a,b,c){if(void 0===c&&(c="repeat-x"),"string"!=typeof b||(b=this.game.cache.getImage(b))){var d=
a.length;"no-repeat"===c&&d>b.width&&(d=b.width);var f=this.context;return f.fillStyle=f.createPattern(b,c),this._circle=new e.Circle(a.start.x,a.start.y,b.height),this._circle.circumferencePoint(a.angle-1.5707963267948966,!1,this._pos),f.save(),f.translate(this._pos.x,this._pos.y),f.rotate(a.angle),f.fillRect(0,0,d,b.height),f.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.frameData.destroy();
this.texture.destroy(!0);e.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op=
"destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op=
"color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op=
"luminosity",this},copyBitmapData:function(a,b,c){a.update();for(var d,f=0;f<a.height;f++){d=(c+f)*this.width+b;for(var g=0;g<a.width;g++)this.pixels[d+g]=a.pixels[f*a.width+g]}return this}},Object.defineProperty(e.BitmapData.prototype,"smoothed",{get:function(){return e.Canvas.getSmoothingEnabled(this.context)},set:function(a){e.Canvas.setSmoothingEnabled(this.context,a)}}),Object.defineProperty(e.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(a){this.context.globalCompositeOperation=
a}}),e.BitmapData.getTransform=function(a,b,c,d,f,g){return"number"!=typeof a&&(a=0),"number"!=typeof b&&(b=0),"number"!=typeof c&&(c=1),"number"!=typeof d&&(d=1),"number"!=typeof f&&(f=0),"number"!=typeof g&&(g=0),{sx:c,sy:d,scaleX:c,scaleY:d,skewX:f,skewY:g,translateX:a,translateY:b,tx:a,ty:b}},e.BitmapData.prototype.constructor=e.BitmapData,e.EarCut={},e.EarCut.Triangulate=function(a,b,c){c=c||2;var d,f,g,h=b&&b.length,m=h?b[0]*c:a.length,n=e.EarCut.linkedList(a,0,m,c,!0),p=[];if(!n)return p;if(h&&
(n=e.EarCut.eliminateHoles(a,b,n,c)),a.length>80*c){var q=b=a[0];var r=d=a[1];for(h=c;h<m;h+=c)(f=a[h])<q&&(q=f),(g=a[h+1])<r&&(r=g),b<f&&(b=f),d<g&&(d=g);d=Math.max(b-q,d-r)}return e.EarCut.earcutLinked(n,p,c,q,r,d),p},e.EarCut.linkedList=function(a,b,c,d,f){var g,h=0;var m=b;for(g=c-d;m<c;m+=d)h+=(a[g]-a[m])*(a[m+1]+a[g+1]),g=m;if(f===0<h)for(m=b;m<c;m+=d)var n=e.EarCut.insertNode(m,a[m],a[m+1],n);else for(m=c-d;b<=m;m-=d)n=e.EarCut.insertNode(m,a[m],a[m+1],n);return n},e.EarCut.filterPoints=function(a,
b){if(!a)return a;b||=a;var c=a;do if(a=!1,c.steiner||!e.EarCut.equals(c,c.next)&&0!==e.EarCut.area(c.prev,c,c.next))c=c.next;else{if(e.EarCut.removeNode(c),(c=b=c.prev)===c.next)return null;a=!0}while(a||c!==b);return b},e.EarCut.earcutLinked=function(a,b,c,d,f,g,h){if(a){!h&&g&&e.EarCut.indexCurve(a,d,f,g);for(var m,n,p=a;a.prev!==a.next;)if(m=a.prev,n=a.next,g?e.EarCut.isEarHashed(a,d,f,g):e.EarCut.isEar(a))b.push(m.i/c),b.push(a.i/c),b.push(n.i/c),e.EarCut.removeNode(a),p=a=n.next;else if((a=
n)===p){h?1===h?(a=e.EarCut.cureLocalIntersections(a,b,c),e.EarCut.earcutLinked(a,b,c,d,f,g,2)):2===h&&e.EarCut.splitEarcut(a,b,c,d,f,g):e.EarCut.earcutLinked(e.EarCut.filterPoints(a),b,c,d,f,g,1);break}}},e.EarCut.isEar=function(a){var b=a.prev,c=a.next;if(0<=e.EarCut.area(b,a,c))return!1;for(var d=a.next.next;d!==a.prev;){if(e.EarCut.pointInTriangle(b.x,b.y,a.x,a.y,c.x,c.y,d.x,d.y)&&0<=e.EarCut.area(d.prev,d,d.next))return!1;d=d.next}return!0},e.EarCut.isEarHashed=function(a,b,c,d){var f=a.prev,
g=a.next;if(0<=e.EarCut.area(f,a,g))return!1;var h=f.x>a.x?f.x>g.x?f.x:g.x:a.x>g.x?a.x:g.x,m=f.y>a.y?f.y>g.y?f.y:g.y:a.y>g.y?a.y:g.y,n=e.EarCut.zOrder(f.x<a.x?f.x<g.x?f.x:g.x:a.x<g.x?a.x:g.x,f.y<a.y?f.y<g.y?f.y:g.y:a.y<g.y?a.y:g.y,b,c,d);b=e.EarCut.zOrder(h,m,b,c,d);for(c=a.nextZ;c&&c.z<=b;){if(c!==a.prev&&c!==a.next&&e.EarCut.pointInTriangle(f.x,f.y,a.x,a.y,g.x,g.y,c.x,c.y)&&0<=e.EarCut.area(c.prev,c,c.next))return!1;c=c.nextZ}for(c=a.prevZ;c&&c.z>=n;){if(c!==a.prev&&c!==a.next&&e.EarCut.pointInTriangle(f.x,
f.y,a.x,a.y,g.x,g.y,c.x,c.y)&&0<=e.EarCut.area(c.prev,c,c.next))return!1;c=c.prevZ}return!0},e.EarCut.cureLocalIntersections=function(a,b,c){var d=a;do{var f=d.prev,g=d.next.next;e.EarCut.intersects(f,d,d.next,g)&&e.EarCut.locallyInside(f,g)&&e.EarCut.locallyInside(g,f)&&(b.push(f.i/c),b.push(d.i/c),b.push(g.i/c),e.EarCut.removeNode(d),e.EarCut.removeNode(d.next),d=a=g);d=d.next}while(d!==a);return d},e.EarCut.splitEarcut=function(a,b,c,d,f,g){var h=a;do{for(var m=h.next.next;m!==h.prev;){if(h.i!==
m.i&&e.EarCut.isValidDiagonal(h,m))return a=e.EarCut.splitPolygon(h,m),h=e.EarCut.filterPoints(h,h.next),a=e.EarCut.filterPoints(a,a.next),e.EarCut.earcutLinked(h,b,c,d,f,g),void e.EarCut.earcutLinked(a,b,c,d,f,g);m=m.next}h=h.next}while(h!==a)},e.EarCut.eliminateHoles=function(a,b,c,d){var f,g,h=[];var m=0;for(f=b.length;m<f;m++){var n=b[m]*d;var p=m<f-1?b[m+1]*d:a.length;(g=e.EarCut.linkedList(a,n,p,d,!1))===g.next&&(g.steiner=!0);h.push(e.EarCut.getLeftmost(g))}h.sort(e.EarCut.compareX);for(m=
0;m<h.length;m++)e.EarCut.eliminateHole(h[m],c),c=e.EarCut.filterPoints(c,c.next);return c},e.EarCut.compareX=function(a,b){return a.x-b.x},e.EarCut.eliminateHole=function(a,b){if(b=e.EarCut.findHoleBridge(a,b))a=e.EarCut.splitPolygon(b,a),e.EarCut.filterPoints(a,a.next)},e.EarCut.findHoleBridge=function(a,b){var c,d=b,f=a.x,g=a.y,h=-1/0;do{if(g<=d.y&&g>=d.next.y){var m=d.x+(g-d.y)*(d.next.x-d.x)/(d.next.y-d.y);m<=f&&h<m&&(h=m,c=d.x<d.next.x?d:d.next)}d=d.next}while(d!==b);if(!c)return null;if(a.x===
c.x)return c.prev;var n;b=c;m=1/0;for(d=c.next;d!==b;)f>=d.x&&d.x>=c.x&&e.EarCut.pointInTriangle(g<c.y?f:h,g,c.x,c.y,g<c.y?h:f,g,d.x,d.y)&&((n=Math.abs(g-d.y)/(f-d.x))<m||n===m&&d.x>c.x)&&e.EarCut.locallyInside(d,a)&&(c=d,m=n),d=d.next;return c},e.EarCut.indexCurve=function(a,b,c,d){for(var f=a;null===f.z&&(f.z=e.EarCut.zOrder(f.x,f.y,b,c,d)),f.prevZ=f.prev,f.nextZ=f.next,(f=f.next)!==a;);f.prevZ.nextZ=null;f.prevZ=null;e.EarCut.sortLinked(f)},e.EarCut.sortLinked=function(a){var b,c,d,f,g=1;do{var h=
a;var m=a=null;for(d=0;h;){d++;var n=h;for(b=f=0;b<g&&(f++,n=n.nextZ);b++);for(b=g;0<f||0<b&&n;)0===f?(n=(c=n).nextZ,b--):0!==b&&n?h.z<=n.z?(h=(c=h).nextZ,f--):(n=(c=n).nextZ,b--):(h=(c=h).nextZ,f--),m?m.nextZ=c:a=c,c.prevZ=m,m=c;h=n}m.nextZ=null;g*=2}while(1<d);return a},e.EarCut.zOrder=function(a,b,c,d,f){return 1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)/f)|a<<8))|a<<4))|a<<2))|a<<1)|(1431655765&((b=858993459&((b=252645135&((b=16711935&((b=32767*(b-d)/f)|b<<8))|b<<4))|b<<
2))|b<<1))<<1},e.EarCut.getLeftmost=function(a){for(var b=a,c=a;b.x<c.x&&(c=b),(b=b.next)!==a;);return c},e.EarCut.pointInTriangle=function(a,b,c,d,f,g,h,m){return 0<=(f-h)*(b-m)-(a-h)*(g-m)&&0<=(a-h)*(d-m)-(c-h)*(b-m)&&0<=(c-h)*(g-m)-(f-h)*(d-m)},e.EarCut.isValidDiagonal=function(a,b){return e.EarCut.equals(a,b)||a.next.i!==b.i&&a.prev.i!==b.i&&!e.EarCut.intersectsPolygon(a,b)&&e.EarCut.locallyInside(a,b)&&e.EarCut.locallyInside(b,a)&&e.EarCut.middleInside(a,b)},e.EarCut.area=function(a,b,c){return(b.y-
a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)},e.EarCut.equals=function(a,b){return a.x===b.x&&a.y===b.y},e.EarCut.intersects=function(a,b,c,d){return 0<e.EarCut.area(a,b,c)!=0<e.EarCut.area(a,b,d)&&0<e.EarCut.area(c,d,a)!=0<e.EarCut.area(c,d,b)},e.EarCut.intersectsPolygon=function(a,b){var c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&e.EarCut.intersects(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1},e.EarCut.locallyInside=function(a,b){return 0>e.EarCut.area(a.prev,a,a.next)?0<=e.EarCut.area(a,
b,a.next)&&0<=e.EarCut.area(a,a.prev,b):0>e.EarCut.area(a,b,a.prev)||0>e.EarCut.area(a,a.next,b)},e.EarCut.middleInside=function(a,b){var c=a,d=!1,f=(a.x+b.x)/2;for(b=(a.y+b.y)/2;c.y>b!=c.next.y>b&&f<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(d=!d),(c=c.next)!==a;);return d},e.EarCut.splitPolygon=function(a,b){var c=new e.EarCut.Node(a.i,a.x,a.y),d=new e.EarCut.Node(b.i,b.x,b.y),f=a.next,g=b.prev;return(a.next=b).prev=a,(c.next=f).prev=c,(d.next=c).prev=d,(g.next=d).prev=g,d},e.EarCut.insertNode=
function(a,b,c,d){a=new e.EarCut.Node(a,b,c);return d?(a.next=d.next,(a.prev=d).next.prev=a,d.next=a):(a.prev=a).next=a,a},e.EarCut.removeNode=function(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)},e.EarCut.Node=function(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.stencilBufferLimit=6,PIXI.WebGLGraphics.renderGraphics=function(a,
b){var c,d=b.gl,f=b.projection,g=b.offset,h=b.shaderManager.primitiveShader;a.dirty&&PIXI.WebGLGraphics.updateGraphics(a,d);var m=a._webGL[d.id];if(m)for(var n=0;n<m.data.length;n++)1===m.data[n].mode?(c=m.data[n],b.stencilManager.pushStencil(a,c,b),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(c.indices.length-4)),b.stencilManager.popStencil(a,c,b)):(c=m.data[n],b.shaderManager.setShader(h),h=b.shaderManager.primitiveShader,d.uniformMatrix3fv(h.translationMatrix,!1,a.worldTransform.toArray(!0)),
d.uniform1f(h.flipY,1),d.uniform2f(h.projectionVector,f.x,-f.y),d.uniform2f(h.offsetVector,-g.x,-g.y),d.uniform3fv(h.tintColor,e.Color.hexToRGBArray(a.tint)),d.uniform1f(h.alpha,a.worldAlpha),d.bindBuffer(d.ARRAY_BUFFER,c.buffer),d.vertexAttribPointer(h.aVertexPosition,2,d.FLOAT,!1,24,0),d.vertexAttribPointer(h.colorAttribute,4,d.FLOAT,!1,24,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c.indexBuffer),d.drawElements(d.TRIANGLE_STRIP,c.indices.length,d.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=
function(a,b){var c=a._webGL[b.id];if(c||=a._webGL[b.id]={lastIndex:0,data:[],gl:b},a.dirty=!1,a.clearDirty){a.clearDirty=!1;for(b=0;b<c.data.length;b++){var d=c.data[b];d.reset();PIXI.WebGLGraphics.graphicsDataPool.push(d)}c.data=[];c.lastIndex=0}for(b=c.lastIndex;b<a.graphicsData.length;b++){d=a.graphicsData[b];if(d.type===e.POLYGON){if((d.points=d.shape.points.slice(),d.shape.closed&&(d.points[0]===d.points[d.points.length-2]&&d.points[1]===d.points[d.points.length-1]||d.points.push(d.points[0],
d.points[1])),d.fill)&&d.points.length>=PIXI.WebGLGraphics.stencilBufferLimit)if(d.points.length<2*PIXI.WebGLGraphics.stencilBufferLimit){var f=PIXI.WebGLGraphics.switchMode(c,0);PIXI.WebGLGraphics.buildPoly(d,f)||(f=PIXI.WebGLGraphics.switchMode(c,1),PIXI.WebGLGraphics.buildComplexPoly(d,f))}else f=PIXI.WebGLGraphics.switchMode(c,1),PIXI.WebGLGraphics.buildComplexPoly(d,f);0<d.lineWidth&&(f=PIXI.WebGLGraphics.switchMode(c,0),PIXI.WebGLGraphics.buildLine(d,f))}else f=PIXI.WebGLGraphics.switchMode(c,
0),d.type===e.RECTANGLE?PIXI.WebGLGraphics.buildRectangle(d,f):d.type===e.CIRCLE||d.type===e.ELLIPSE?PIXI.WebGLGraphics.buildCircle(d,f):d.type===e.ROUNDEDRECTANGLE&&PIXI.WebGLGraphics.buildRoundedRectangle(d,f);c.lastIndex++}for(b=0;b<c.data.length;b++)(f=c.data[b]).dirty&&f.upload()},PIXI.WebGLGraphics.switchMode=function(a,b){var c;return a.data.length&&(c=a.data[a.data.length-1]).mode===b&&1!==b||((c=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(a.gl)).mode=b,a.data.push(c)),
c.dirty=!0,c},PIXI.WebGLGraphics.buildRectangle=function(a,b){var c=a.shape,d=c.x,f=c.y,g=c.width;c=c.height;if(a.fill){var h=e.Color.hexToRGBArray(a.fillColor),m=a.fillAlpha,n=h[0]*m,p=h[1]*m;h=h[2]*m;var q=b.points,r=b.indices,u=q.length/6;q.push(d,f);q.push(n,p,h,m);q.push(d+g,f);q.push(n,p,h,m);q.push(d,f+c);q.push(n,p,h,m);q.push(d+g,f+c);q.push(n,p,h,m);r.push(u,u,u+1,u+2,u+3,u+3)}a.lineWidth&&(m=a.points,a.points=[d,f,d+g,f,d+g,f+c,d,f+c,d,f],PIXI.WebGLGraphics.buildLine(a,b),a.points=m)},
PIXI.WebGLGraphics.buildRoundedRectangle=function(a,b){var c=a.shape,d=c.x,f=c.y,g=c.width,h=c.height,m=c.radius;c=[];if(c.push(d,f+m),c=(c=(c=(c=c.concat(PIXI.WebGLGraphics.quadraticBezierCurve(d,f+h-m,d,f+h,d+m,f+h))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(d+g-m,f+h,d+g,f+h,d+g,f+h-m))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(d+g,f+m,d+g,f,d+g-m,f))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(d+m,f,d,f,d,f+m)),a.fill){h=e.Color.hexToRGBArray(a.fillColor);d=a.fillAlpha;f=h[0]*
d;g=h[1]*d;h=h[2]*d;m=b.points;var n=b.indices,p=m.length/6,q=e.EarCut.Triangulate(c,null,2),r;for(r=0;r<q.length;r+=3)n.push(q[r]+p),n.push(q[r]+p),n.push(q[r+1]+p),n.push(q[r+2]+p),n.push(q[r+2]+p);for(r=0;r<c.length;r++)m.push(c[r],c[++r],f,g,h,d)}a.lineWidth&&(d=a.points,a.points=c,PIXI.WebGLGraphics.buildLine(a,b),a.points=d)},PIXI.WebGLGraphics.quadraticBezierCurve=function(a,b,c,d,f,g){for(var h,m,n,p,q,r=[],u=0;20>=u;u++)m=a,p=c,h=q=u/20,h=m+(p-m)*h,m=b+(d-b)*q,n=c+(f-c)*q,p=d+(g-d)*q,h+=
(n-h)*q,q=m+(p-m)*q,r.push(h,q);return r},PIXI.WebGLGraphics.buildCircle=function(a,b){var c,d=a.shape,f=d.x,g=d.y;var h=a.type===e.CIRCLE?(c=d.radius,d.radius):(c=d.width,d.height);d=2*Math.PI/40;if(a.fill){var m=e.Color.hexToRGBArray(a.fillColor);var n=a.fillAlpha,p=m[0]*n,q=m[1]*n,r=m[2]*n,u=b.points,x=b.indices,w=u.length/6;x.push(w);for(m=0;41>m;m++)u.push(f,g,p,q,r,n),u.push(f+Math.sin(d*m)*c,g+Math.cos(d*m)*h,p,q,r,n),x.push(w++,w++);x.push(w-1)}if(a.lineWidth){n=a.points;a.points=[];for(m=
0;41>m;m++)a.points.push(f+Math.sin(d*m)*c,g+Math.cos(d*m)*h);PIXI.WebGLGraphics.buildLine(a,b);a.points=n}},PIXI.WebGLGraphics.buildLine=function(a,b){var c,d=a.points;if(0!==d.length){if(a.lineWidth%2)for(c=0;c<d.length;c++)d[c]+=.5;c=new PIXI.Point(d[0],d[1]);var f=new PIXI.Point(d[d.length-2],d[d.length-1]);if(c.x===f.x&&c.y===f.y){(d=d.slice()).pop();d.pop();var g=(f=new PIXI.Point(d[d.length-2],d[d.length-1])).x+.5*(c.x-f.x);c=f.y+.5*(c.y-f.y);d.unshift(g,c);d.push(g,c)}var h,m,n,p,q,r,u,x;
g=b.points;b=b.indices;f=d.length/2;var w=d.length,A=g.length/6,C=a.lineWidth/2;c=e.Color.hexToRGBArray(a.lineColor);a=a.lineAlpha;var L=c[0]*a,M=c[1]*a,P=c[2]*a;var V=d[0];var aa=d[1];var ja=d[2];var W=-(aa-d[3]);var E=V-ja;W/=x=Math.sqrt(W*W+E*E);W*=C;E=E/x*C;g.push(V-W,aa-E,L,M,P,a);g.push(V+W,aa+E,L,M,P,a);for(c=1;c<f-1;c++){V=d[2*(c-1)];aa=d[2*(c-1)+1];ja=d[2*c];var F=d[2*c+1];var B=d[2*(c+1)];var I=d[2*(c+1)+1];W=-(aa-F);E=V-ja;W/=x=Math.sqrt(W*W+E*E);E/=x;W*=C;E*=C;var X=-(F-I);var U=ja-B;
X/=x=Math.sqrt(X*X+U*U);U/=x;var ia=(-W+V)*(-E+F)-(-W+ja)*(-E+aa);var la=(-(X*=C)+B)*(-(U*=C)+F)-(-X+ja)*(-U+I);var ma=(aa=-E+aa-(-E+F))*(u=-X+ja-(-X+B))-(r=-U+I-(-U+F))*(q=-W+ja-(-W+V));.1>Math.abs(ma)?(g.push(ja-W,F-E,L,M,P,a),g.push(ja+W,F+E,L,M,P,a)):19600<((h=(q*la-u*ia)/ma)-ja)*(h-ja)+((m=(r*ia-aa*la)/ma)-F)+(m-F)?(n=W-X,p=E-U,n/=x=Math.sqrt(n*n+p*p),p/=x,n*=C,p*=C,g.push(ja-n,F-p),g.push(L,M,P,a),g.push(ja+n,F+p),g.push(L,M,P,a),g.push(ja-n,F-p),g.push(L,M,P,a),w++):(g.push(h,m),g.push(L,M,
P,a),g.push(ja-(h-ja),F-(m-F)),g.push(L,M,P,a))}V=d[2*(f-2)];aa=d[2*(f-2)+1];ja=d[2*(f-1)];W=-(aa-(F=d[2*(f-1)+1]));E=V-ja;W/=x=Math.sqrt(W*W+E*E);W*=C;E=E/x*C;g.push(ja-W,F-E);g.push(L,M,P,a);g.push(ja+W,F+E);g.push(L,M,P,a);b.push(A);for(c=0;c<w;c++)b.push(A++);b.push(A-1)}},PIXI.WebGLGraphics.buildComplexPoly=function(a,b){var c=a.points.slice();if(!(6>c.length)){var d=b.indices;b.points=c;b.alpha=a.fillAlpha;b.color=e.Color.hexToRGBArray(a.fillColor);var f,g;b=1/0;var h=-1/0,m=1/0,n=-1/0;for(a=
0;a<c.length;a+=2)b=(f=c[a])<b?f:b,h=h<f?f:h,m=(g=c[a+1])<m?g:m,n=n<g?g:n;c.push(b,m,h,m,h,n,b,n);c=c.length/2;for(a=0;a<c;a++)d.push(a)}},PIXI.WebGLGraphics.buildPoly=function(a,b){var c=a.points;if(!(6>c.length)){var d=b.points;b=b.indices;var f=c.length/2,g=e.Color.hexToRGBArray(a.fillColor);a=a.fillAlpha;var h=g[0]*a,m=g[1]*a;g=g[2]*a;var n=e.EarCut.Triangulate(c,null,2);if(!n)return!1;var p=d.length/6,q;for(q=0;q<n.length;q+=3)b.push(n[q]+p),b.push(n[q]+p),b.push(n[q+1]+p),b.push(n[q+2]+p),b.push(n[q+
2]+p);for(q=0;q<f;q++)d.push(c[2*q],c[2*q+1],h,m,g,a);return!0}},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.alpha=this.mode=1;this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,
this.buffer);a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW);this.dirty=!1},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(a,b){var c=a.worldAlpha;a.dirty&&(this.updateGraphicsTint(a),a.dirty=!1);for(var d=0;d<a.graphicsData.length;d++){var f=a.graphicsData[d],g=f.shape,h=f._fillTint,m=f._lineTint;
if(b.lineWidth=f.lineWidth,f.type===e.POLYGON){b.beginPath();var n=g.points;b.moveTo(n[0],n[1]);for(var p=1;p<n.length/2;p++)b.lineTo(n[2*p],n[2*p+1]);g.closed&&b.lineTo(n[0],n[1]);n[0]===n[n.length-2]&&n[1]===n[n.length-1]&&b.closePath();f.fill&&(b.globalAlpha=f.fillAlpha*c,b.fillStyle="#"+("00000"+(0|h).toString(16)).substr(-6),b.fill());f.lineWidth&&(b.globalAlpha=f.lineAlpha*c,b.strokeStyle="#"+("00000"+(0|m).toString(16)).substr(-6),b.stroke())}else if(f.type===e.RECTANGLE)(f.fillColor||0===
f.fillColor)&&(b.globalAlpha=f.fillAlpha*c,b.fillStyle="#"+("00000"+(0|h).toString(16)).substr(-6),b.fillRect(g.x,g.y,g.width,g.height)),f.lineWidth&&(b.globalAlpha=f.lineAlpha*c,b.strokeStyle="#"+("00000"+(0|m).toString(16)).substr(-6),b.strokeRect(g.x,g.y,g.width,g.height));else if(f.type===e.CIRCLE)b.beginPath(),b.arc(g.x,g.y,g.radius,0,2*Math.PI),b.closePath(),f.fill&&(b.globalAlpha=f.fillAlpha*c,b.fillStyle="#"+("00000"+(0|h).toString(16)).substr(-6),b.fill()),f.lineWidth&&(b.globalAlpha=f.lineAlpha*
c,b.strokeStyle="#"+("00000"+(0|m).toString(16)).substr(-6),b.stroke());else if(f.type===e.ELLIPSE){var q=2*g.width;p=2*g.height;n=g.x-q/2;g=g.y-p/2;b.beginPath();var r=q/2*.5522848,u=p/2*.5522848,x=n+q,w=g+p;q=n+q/2;p=g+p/2;b.moveTo(n,p);b.bezierCurveTo(n,p-u,q-r,g,q,g);b.bezierCurveTo(q+r,g,x,p-u,x,p);b.bezierCurveTo(x,p+u,q+r,w,q,w);b.bezierCurveTo(q-r,w,n,p+u,n,p);b.closePath();f.fill&&(b.globalAlpha=f.fillAlpha*c,b.fillStyle="#"+("00000"+(0|h).toString(16)).substr(-6),b.fill());f.lineWidth&&
(b.globalAlpha=f.lineAlpha*c,b.strokeStyle="#"+("00000"+(0|m).toString(16)).substr(-6),b.stroke())}else f.type===e.ROUNDEDRECTANGLE&&(n=g.x,p=g.y,r=g.width,u=g.height,g=g.radius,x=Math.min(r,u)/2|0,g=x<g?x:g,b.beginPath(),b.moveTo(n,p+g),b.lineTo(n,p+u-g),b.quadraticCurveTo(n,p+u,n+g,p+u),b.lineTo(n+r-g,p+u),b.quadraticCurveTo(n+r,p+u,n+r,p+u-g),b.lineTo(n+r,p+g),b.quadraticCurveTo(n+r,p,n+r-g,p),b.lineTo(n+g,p),b.quadraticCurveTo(n,p,n,p+g),b.closePath(),(f.fillColor||0===f.fillColor)&&(b.globalAlpha=
f.fillAlpha*c,b.fillStyle="#"+("00000"+(0|h).toString(16)).substr(-6),b.fill()),f.lineWidth&&(b.globalAlpha=f.lineAlpha*c,b.strokeStyle="#"+("00000"+(0|m).toString(16)).substr(-6),b.stroke()))}},PIXI.CanvasGraphics.renderGraphicsMask=function(a,b){var c=a.graphicsData.length;if(0!==c){b.beginPath();for(var d=0;d<c;d++){var f=a.graphicsData[d],g=f.shape;if(f.type===e.POLYGON){f=g.points;b.moveTo(f[0],f[1]);for(var h=1;h<f.length/2;h++)b.lineTo(f[2*h],f[2*h+1]);f[0]===f[f.length-2]&&f[1]===f[f.length-
1]&&b.closePath()}else if(f.type===e.RECTANGLE)b.rect(g.x,g.y,g.width,g.height),b.closePath();else if(f.type===e.CIRCLE)b.arc(g.x,g.y,g.radius,0,2*Math.PI),b.closePath();else if(f.type===e.ELLIPSE){var m=2*g.width;h=2*g.height;f=g.x-m/2;g=g.y-h/2;var n=m/2*.5522848,p=h/2*.5522848,q=f+m,r=g+h;m=f+m/2;h=g+h/2;b.moveTo(f,h);b.bezierCurveTo(f,h-p,m-n,g,m,g);b.bezierCurveTo(m+n,g,q,h-p,q,h);b.bezierCurveTo(q,h+p,m+n,r,m,r);b.bezierCurveTo(m-n,r,f,h+p,f,h);b.closePath()}else f.type===e.ROUNDEDRECTANGLE&&
(f=g.x,h=g.y,n=g.width,p=g.height,g=g.radius,q=Math.min(n,p)/2|0,g=q<g?q:g,b.moveTo(f,h+g),b.lineTo(f,h+p-g),b.quadraticCurveTo(f,h+p,f+g,h+p),b.lineTo(f+n-g,h+p),b.quadraticCurveTo(f+n,h+p,f+n,h+p-g),b.lineTo(f+n,h+g),b.quadraticCurveTo(f+n,h,f+n-g,h),b.lineTo(f+g,h),b.quadraticCurveTo(f,h,f,h+g),b.closePath())}}},PIXI.CanvasGraphics.updateGraphicsTint=function(a){if(16777215!==a.tint)for(var b=(a.tint>>16&255)/255,c=(a.tint>>8&255)/255,d=(255&a.tint)/255,f=0;f<a.graphicsData.length;f++){var g=a.graphicsData[f],
h=0|g.fillColor,m=0|g.lineColor;g._fillTint=((h>>16&255)/255*b*255<<16)+((h>>8&255)/255*c*255<<8)+(255&h)/255*d*255;g._lineTint=((m>>16&255)/255*b*255<<16)+((m>>8&255)/255*c*255<<8)+(255&m)/255*d*255}},e.GraphicsData=function(a,b,c,d,f,g,h){this.lineWidth=a;this.lineColor=b;this.lineAlpha=c;this._lineTint=b;this.fillColor=d;this.fillAlpha=f;this._fillTint=d;this.fill=g;this.shape=h;this.type=h.type},e.GraphicsData.prototype.constructor=e.GraphicsData,e.GraphicsData.prototype.clone=function(){return new e.GraphicsData(this.lineWidth,
this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.Graphics=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);this.type=e.GRAPHICS;this.physicsType=e.SPRITE;this.anchor=new e.Point;PIXI.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineColor=this.lineWidth=0;this.graphicsData=[];this.tint=16777215;this.blendMode=PIXI.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=!1;this.boundsPadding=0;this._localBounds=new e.Rectangle(0,
0,1,1);this.dirty=!0;this.cachedSpriteDirty=this.webGLDirty=this._boundsDirty=!1;e.Component.Core.init.call(this,a,b,c,"",null)},e.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),e.Graphics.prototype.constructor=e.Graphics,e.Component.Core.install.call(e.Graphics.prototype,"Angle AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LifeSpan PhysicsBody Reset".split(" ")),e.Graphics.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate,e.Graphics.prototype.preUpdateLifeSpan=
e.Component.LifeSpan.preUpdate,e.Graphics.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate,e.Graphics.prototype.preUpdateCore=e.Component.Core.preUpdate,e.Graphics.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},e.Graphics.prototype.postUpdate=function(){e.Component.PhysicsBody.postUpdate.call(this);e.Component.FixedToCamera.postUpdate.call(this);this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=
!1);for(var a=0;a<this.children.length;a++)this.children[a].postUpdate()},e.Graphics.prototype.destroy=function(a){this.clear();e.Component.Destroy.prototype.destroy.call(this,a)},e.Graphics.prototype.drawTriangle=function(a,b){void 0===b&&(b=!1);var c=new e.Polygon(a);if(b){b=new e.Point(this.game.camera.x-a[0].x,this.game.camera.y-a[0].y);var d=new e.Point(a[1].x-a[0].x,a[1].y-a[0].y);a=(new e.Point(a[1].x-a[2].x,a[1].y-a[2].y)).cross(d);0<b.dot(a)&&this.drawPolygon(c)}else this.drawPolygon(c)},
e.Graphics.prototype.drawTriangles=function(a,b,c){void 0===c&&(c=!1);var d,f=new e.Point,g=new e.Point,h=new e.Point,m=[];if(b)if(a[0]instanceof e.Point)for(d=0;d<b.length/3;d++)m.push(a[b[3*d]]),m.push(a[b[3*d+1]]),m.push(a[b[3*d+2]]),3===m.length&&(this.drawTriangle(m,c),m=[]);else for(d=0;d<b.length;d++)f.x=a[2*b[d]],f.y=a[2*b[d]+1],m.push(f.copyTo({})),3===m.length&&(this.drawTriangle(m,c),m=[]);else if(a[0]instanceof e.Point)for(d=0;d<a.length/3;d++)this.drawTriangle([a[3*d],a[3*d+1],a[3*d+
2]],c);else for(d=0;d<a.length/6;d++)f.x=a[6*d],f.y=a[6*d+1],g.x=a[6*d+2],g.y=a[6*d+3],h.x=a[6*d+4],h.y=a[6*d+5],this.drawTriangle([f,g,h],c)},e.Graphics.prototype.lineStyle=function(a,b,c){return this.lineWidth=a||0,this.lineColor=b||0,this.lineAlpha=void 0===c?1:c,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new e.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=
this.lineAlpha)),this},e.Graphics.prototype.moveTo=function(a,b){return this.drawShape(new e.Polygon([a,b])),this},e.Graphics.prototype.lineTo=function(a,b){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(a,b),this.dirty=!0,this._boundsDirty=!0,this},e.Graphics.prototype.quadraticCurveTo=function(a,b,c,d){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var f=this.currentPath.shape.points;0===f.length&&this.moveTo(0,
0);for(var g=f[f.length-2],h=f[f.length-1],m,n=1;20>=n;++n){var p=g+(a-g)*(m=n/20);var q=h+(b-h)*m;f.push(p+(a+(c-a)*m-p)*m,q+(b+(d-b)*m-q)*m)}return this.dirty=!0,this._boundsDirty=!0,this},e.Graphics.prototype.bezierCurveTo=function(a,b,c,d,f,g){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var h,m,n,p,q,r=this.currentPath.shape.points,u=r[r.length-2],x=r[r.length-1],w,A=1;20>=A;++A)n=(m=(h=1-(w=A/20))*h)*h,q=(p=w*w)*w,r.push(n*
u+3*m*w*a+3*h*p*c+q*f,n*x+3*m*w*b+3*h*p*d+q*g);return this.dirty=!0,this._boundsDirty=!0,this},e.Graphics.prototype.arcTo=function(a,b,c,d,f){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(a,b):this.moveTo(a,b);var g=this.currentPath.shape.points,h=g[g.length-1]-b,m=g[g.length-2]-a;d-=b;c-=a;var n=Math.abs(h*c-m*d);if(1E-8>n||0===f)g[g.length-2]===a&&g[g.length-1]===b||g.push(a,b);else{var p=h*h+m*m,q=d*d+c*c,r=h*d+m*c;g=f*Math.sqrt(p)/n;n=f*Math.sqrt(q)/
n;p=g*r/p;q=n*r/q;r=g*c+n*m;var u=g*d+n*h;this.arc(r+a,u+b,f,Math.atan2(h*(n+p)-u,m*(n+p)-r),Math.atan2(d*(g+q)-u,c*(g+q)-r),c*h<m*d)}return this.dirty=!0,this._boundsDirty=!0,this},e.Graphics.prototype.arc=function(a,b,c,d,f,g,h){if(d===f)return this;void 0===g&&(g=!1);void 0===h&&(h=40);!g&&f<=d?f+=2*Math.PI:g&&d<=f&&(d+=2*Math.PI);f=g?-1*(d-f):f-d;var m=Math.ceil(Math.abs(f)/(2*Math.PI))*h;if(0===f)return this;h=a+Math.cos(d)*c;var n=b+Math.sin(d)*c;g&&this.filling?this.moveTo(a,b):this.moveTo(h,
n);g=this.currentPath.shape.points;f/=2*m;h=2*f;n=Math.cos(f);var p=Math.sin(f);--m;for(var q=m%1/m,r=0;r<=m;r++){var u=f+d+h*(r+q*r),x=Math.cos(u);u=-Math.sin(u);g.push((n*x+p*u)*c+a,(n*-u+p*x)*c+b)}return this.dirty=!0,this._boundsDirty=!0,this},e.Graphics.prototype.beginFill=function(a,b){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=void 0===b?1:b,this.currentPath&&2>=this.currentPath.shape.points.length&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,
this.currentPath.fillAlpha=this.fillAlpha),this},e.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},e.Graphics.prototype.drawRect=function(a,b,c,d){return this.drawShape(new e.Rectangle(a,b,c,d)),this},e.Graphics.prototype.drawRoundedRect=function(a,b,c,d,f){return this.drawShape(new e.RoundedRectangle(a,b,c,d,f)),this},e.Graphics.prototype.drawCircle=function(a,b,c){return this.drawShape(new e.Circle(a,b,c)),this},e.Graphics.prototype.drawEllipse=
function(a,b,c,d){return this.drawShape({x:a,y:b,width:c,height:d,type:e.ELLIPSE}),this},e.Graphics.prototype.drawPolygon=function(a){a instanceof e.Polygon&&(a=a.points);var b=a;if(!Array.isArray(b)){b=Array(arguments.length);for(var c=0;c<b.length;++c)b[c]=arguments[c]}return this.drawShape(new e.Polygon(b)),this},e.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this._boundsDirty=!0,this.clearDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this},
e.Graphics.prototype.generateTexture=function(a,b,c){void 0===a&&(a=1);void 0===b&&(b=PIXI.scaleModes.DEFAULT);void 0===c&&(c=0);var d=this.getBounds();d.width+=c;d.height+=c;c=new PIXI.CanvasBuffer(d.width*a,d.height*a);b=PIXI.Texture.fromCanvas(c.canvas,b);return b.baseTexture.resolution=a,c.context.scale(a,a),c.context.translate(-d.x,-d.y),PIXI.CanvasGraphics.renderGraphics(this,c.context),b},e.Graphics.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||
this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=
this.blendMode;var b=PIXI.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(b[0],b[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this.mask,a);a.drawCount++;a.spriteBatch.start()}},e.Graphics.prototype._renderCanvas=
function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,a);var b=a.context,c=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=
this.blendMode,b.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode]);this._mask&&a.maskManager.pushMask(this._mask,a);var d=a.resolution;b.setTransform(c.a*d,c.b*d,c.c*d,c.d*d,c.tx*a.resolution+a.shakeX,c.ty*a.resolution+a.shakeY);PIXI.CanvasGraphics.renderGraphics(this,b);for(b=0;b<this.children.length;b++)this.children[b]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},e.Graphics.prototype.getBounds=function(a){if(this._currentBounds)return this._currentBounds;if(this.isMask)return e.EmptyRectangle;
this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var b=this._localBounds,c=b.x,d=b.width+b.x,f=b.y,g=b.height+b.y;a=a||this.worldTransform;var h=a.a,m=a.b,n=a.c,p=a.d,q=a.tx,r=a.ty,u=h*d+n*g+q;b=p*g+m*d+r;a=h*c+n*g+q;g=p*g+m*c+r;var x=h*c+n*f+q;c=p*f+m*c+r;h=h*d+n*f+q;d=p*f+m*d+r;f=u;m=b;return u=h<(u=x<(u=a<u?a:u)?x:u)?h:u,b=d<(b=c<(b=g<b?g:b)?c:b)?d:b,f=(f=(f=f<a?a:f)<x?x:f)<h?h:f,m=(m=(m=m<g?g:m)<c?c:m)<d?d:m,this._bounds.x=u,this._bounds.width=
f-u,this._bounds.y=b,this._bounds.height=m-b,this._currentBounds=this._bounds,this._currentBounds},e.Graphics.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=e.identityMatrix;for(var b=0;b<this.children.length;b++)this.children[b].updateTransform();var c=this.getBounds();this.worldTransform=a;for(b=0;b<this.children.length;b++)this.children[b].updateTransform();return c},e.Graphics.prototype.containsPoint=function(a,b){void 0===b&&(b=new e.Point);this.worldTransform.applyInverse(a,
b);a=this.graphicsData;for(var c=0;c<a.length;c++){var d=a[c];if(d.fill&&d.shape&&d.shape.contains(b.x,b.y))return!0}return!1},e.Graphics.prototype.getVisualBounds=function(a){return this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1),this._localBounds.clone(a)},e.Graphics.prototype.updateLocalBounds=function(){var a=1/0,b=-1/0,c=1/0,d=-1/0;if(this.graphicsData.length)for(var f,g,h,m,n,p,q=0;q<this.graphicsData.length;q++){f=this.graphicsData[q];g=f.type;var r=f.lineWidth;if(f=f.shape,
g===e.RECTANGLE||g===e.ROUNDEDRECTANGLE)h=f.x-r/2,m=f.y-r/2,a=h<a?h:a,b=b<h+(n=f.width+r)?h+n:b,c=m<c?m:c,d=d<m+(p=f.height+r)?m+p:d;else if(g===e.CIRCLE)h=f.x,m=f.y,a=h-(n=f.radius+r/2)<a?h-n:a,b=b<h+n?h+n:b,c=m-(p=f.radius+r/2)<c?m-p:c,d=d<m+p?m+p:d;else if(g===e.ELLIPSE)h=f.x,m=f.y,a=h-(n=f.width+r/2)<a?h-n:a,b=b<h+n?h+n:b,c=m-(p=f.height+r/2)<c?m-p:c,d=d<m+p?m+p:d;else for(g=f.points,f=0;f<g.length;f++)g[f]instanceof e.Point?(h=g[f].x,m=g[f].y):(h=g[f],m=g[f+1],f<g.length-1&&f++),a=h-r<a?h-r:
a,b=b<h+r?h+r:b,c=m-r<c?m-r:c,d=d<m+r?m+r:d}else d=c=b=a=0;h=this.boundsPadding;this._localBounds.x=a-h;this._localBounds.width=b-a+2*h;this._localBounds.y=c-h;this._localBounds.height=d-c+2*h},e.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var b=new PIXI.CanvasBuffer(a.width,a.height),c=PIXI.Texture.fromCanvas(b.canvas);this._cachedSprite=new PIXI.Sprite(c);this._cachedSprite.buffer=b;
this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-a.x/a.width;this._cachedSprite.anchor.y=-a.y/a.height;this._cachedSprite.buffer.context.translate(-a.x,-a.y);this.worldAlpha=1;PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha},e.Graphics.prototype.updateCachedSpriteTexture=function(){var a=this._cachedSprite,b=a.texture,c=a.buffer.canvas;b.baseTexture.width=c.width;b.baseTexture.height=c.height;b.crop.width=
b.frame.width=c.width;b.crop.height=b.frame.height=c.height;a._width=c.width;a._height=c.height;b.baseTexture.dirty()},e.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null},e.Graphics.prototype.drawShape=function(a){this.currentPath&&2>=this.currentPath.shape.points.length&&this.graphicsData.pop();this.currentPath=null;a instanceof e.Polygon&&(a=a.clone()).flatten();a=new e.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,
this.fillAlpha,this.filling,a);return this.graphicsData.push(a),a.type===e.POLYGON&&(a.shape.closed=this.filling,this.currentPath=a),this.dirty=!0,this._boundsDirty=!0,a},Object.defineProperty(e.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){(this._cacheAsBitmap=a)?this._generateCachedSprite():this.destroyCachedSprite();this.webGLDirty=this.dirty=!0}}),e.RenderTexture=function(a,b,c,d,f,g,h,m){(void 0===b&&(b=100),void 0===c&&(c=100),void 0===d&&(d=
""),void 0===f&&(f=e.scaleModes.DEFAULT),void 0===g&&(g=1),void 0===h&&(h=a.renderer),void 0===m&&(m=0),this.game=a,this.key=d,this.type=e.RENDERTEXTURE,this._tempMatrix=new e.Matrix,this.width=b,this.height=c,this.resolution=g,this.frame=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=this.frame.clone(),this.baseTexture=new PIXI.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=
[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=f,this.baseTexture.hasLoaded=!0,PIXI.Texture.call(this,this.baseTexture,this.frame.clone()),this.renderer=h,this.renderer.type===e.WEBGL)?(a=this.renderer.gl,this.baseTexture.textureIndex=m,this.baseTexture._dirty[a.id]=!1,this.textureBuffer=new PIXI.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode,m),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.projection=new e.Point(.5*this.width,.5*
-this.height)):(this.textureBuffer=new PIXI.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas);this.valid=!0;this.tempMatrix=new e.Matrix;this._updateUvs()},e.RenderTexture.prototype=Object.create(PIXI.Texture.prototype),e.RenderTexture.prototype.constructor=e.RenderTexture,e.RenderTexture.prototype.renderXY=function(a,b,c,d){a.updateTransform();this._tempMatrix.copyFrom(a.worldTransform);this._tempMatrix.tx=b;this._tempMatrix.ty=
c;this.renderer.type===e.WEBGL?this._renderWebGL(a,this._tempMatrix,d):this._renderCanvas(a,this._tempMatrix,d)},e.RenderTexture.prototype.renderRawXY=function(a,b,c,d){this._tempMatrix.identity().translate(b,c);this.renderer.type===e.WEBGL?this._renderWebGL(a,this._tempMatrix,d):this._renderCanvas(a,this._tempMatrix,d)},e.RenderTexture.prototype.render=function(a,b,c){null==b?this._tempMatrix.copyFrom(a.worldTransform):this._tempMatrix.copyFrom(b);this.renderer.type===e.WEBGL?this._renderWebGL(a,
this._tempMatrix,c):this._renderCanvas(a,this._tempMatrix,c)},e.RenderTexture.prototype.resize=function(a,b,c){a===this.width&&b===this.height||(this.valid=0<a&&0<b,this.width=a,this.height=b,this.frame.width=this.crop.width=a*this.resolution,this.frame.height=this.crop.height=b*this.resolution,c&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===e.WEBGL&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&
this.textureBuffer.resize(this.width,this.height))},e.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===e.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},e.RenderTexture.prototype._renderWebGL=function(a,b,c){if(this.valid&&0!==a.alpha){var d=a.worldTransform;d.identity();d.translate(0,2*this.projection.y);b&&d.append(b);d.scale(1,-1);for(d=0;d<a.children.length;d++)a.children[d].updateTransform();
d=this.renderer.gl;d.viewport(0,0,this.width*this.resolution,this.height*this.resolution);d.bindFramebuffer(d.FRAMEBUFFER,this.textureBuffer.frameBuffer);c&&this.textureBuffer.clear();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer,b);this.renderer.spriteBatch.dirty=!0;d.bindFramebuffer(d.FRAMEBUFFER,null)}},e.RenderTexture.prototype._renderCanvas=function(a,b,c){if(this.valid&&0!==a.alpha){var d=a.worldTransform;d.identity();b&&
d.append(b);for(d=0;d<a.children.length;d++)a.children[d].updateTransform();c&&this.textureBuffer.clear();c=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(a,this.textureBuffer.context,b);this.renderer.resolution=c}},e.RenderTexture.prototype.getImage=function(a,b,c,d){var f=new Image;return f.src=this.getBase64(a,b),c&&(f.onload=c),d&&(f.onerror=d),f},e.RenderTexture.prototype.getBase64=function(a,b){return this.getCanvas().toDataURL(a,b)},e.RenderTexture.prototype.getCanvas=
function(){if(this.renderer.type!==e.WEBGL)return this.textureBuffer.canvas;var a=this.renderer.gl,b=this.textureBuffer.width,c=this.textureBuffer.height,d=new Uint8Array(4*b*c);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer);a.readPixels(0,0,b,c,a.RGBA,a.UNSIGNED_BYTE,d);a.bindFramebuffer(a.FRAMEBUFFER,null);a=new PIXI.CanvasBuffer(b,c);b=a.context.getImageData(0,0,b,c);return b.data.set(d),a.context.putImageData(b,0,0),a.canvas},e.Text=function(a,b,c,d,f){b=b||0;c=c||0;d=null==d?
"":d.toString();this.canvas=e.CanvasPool.create(this);e.Sprite.call(this,a,b,c,PIXI.Texture.fromCanvas(this.canvas));this.type=e.TEXT;this.physicsType=e.SPRITE;this.padding=new e.Point;this.textBounds=null;this.context=this.canvas.getContext("2d");this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.useAdvancedWrap=this.autoRound=!1;this.splitRegExp=/(?:\r\n|\r|\n)/;this.characterLimitSize=-1;this.characterLimitSuffix="";this._testString="|M\u00c2\u00c9Qfjq_";this._res=
a.renderer.resolution;this._text=d;this._fontComponents=null;this._height=this._width=this._charCount=this._lineSpacing=0;this.style={};this.setStyle(f||{});""!==d&&this.updateText()},e.Text.prototype=Object.create(e.Sprite.prototype),e.Text.prototype.constructor=e.Text,e.Text.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},e.Text.prototype.update=function(){},e.Text.prototype.destroy=function(a){this.texture.destroy(!0);
e.Component.Destroy.prototype.destroy.call(this,a)},e.Text.prototype.setShadow=function(a,b,c,d,f,g){return void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c="rgba(0, 0, 0, 1)"),void 0===d&&(d=0),void 0===f&&(f=!0),void 0===g&&(g=!0),this.style.shadowOffsetX=a,this.style.shadowOffsetY=b,this.style.shadowColor=c,this.style.shadowBlur=d,this.style.shadowStroke=f,this.style.shadowFill=g,this.dirty=!0,this},e.Text.prototype.setStyle=function(a,b){void 0===b&&(b=!1);var c=Object.assign({},a);c.font=a.font||
"bold 20pt Arial";c.backgroundColor=a.backgroundColor||null;c.fill=a.fill||"black";c.align=(a.align||"left").toLowerCase();c.boundsAlignH=(a.boundsAlignH||"left").toLowerCase();c.boundsAlignV=(a.boundsAlignV||"top").toLowerCase();c.stroke=a.stroke||"black";c.strokeThickness=Number(a.strokeThickness)||0;c.wordWrap=a.wordWrap||!1;c.wordWrapWidth=a.wordWrapWidth||100;c.maxLines=a.maxLines||0;c.shadowOffsetX=a.shadowOffsetX||0;c.shadowOffsetY=a.shadowOffsetY||0;c.shadowColor=a.shadowColor||"rgba(0,0,0,0)";
c.shadowBlur=a.shadowBlur||0;c.tabs=a.tabs||0;c.fontProperties=a.fontProperties||null;a=this.fontToComponents(c.font);return c.fontStyle&&(a.fontStyle=c.fontStyle),c.fontVariant&&(a.fontVariant=c.fontVariant),c.fontWeight&&(a.fontWeight=c.fontWeight),c.fontSize&&("number"==typeof c.fontSize&&(c.fontSize+="px"),a.fontSize=c.fontSize),this._fontComponents=a,c.font=this.componentsToFont(this._fontComponents),this.style=c,this.dirty=!0,c.testString&&(this.testString=c.testString),b&&this.updateText(),
this},e.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var a=this.text;-1<this.characterLimitSize&&this.characterLimitSize<a.length&&(a=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix);this.style.wordWrap&&(a=this.runWordWrap(this.text));a=a.split(this.splitRegExp);var b=this.style.tabs,c=[],d=0,f=this.style.fontProperties||this.determineFontProperties(this.style.font),g=a.length;0<this.style.maxLines&&
this.style.maxLines<a.length&&(g=this.style.maxLines);for(var h=this._charCount=0;h<g;h++){if(0===b){var m=this.style.strokeThickness+this.padding.x;0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?m+=this.measureLine(a[h]):m+=this.context.measureText(a[h]).width;this.style.wordWrap&&(m-=this.context.measureText(" ").width)}else{var n=a[h].split(/(?:\t)/);m=this.padding.x+this.style.strokeThickness;if(Array.isArray(b))for(var p=0,q=0;q<n.length;q++)m=
0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(n[q]):Math.ceil(this.context.measureText(n[q]).width),0<q&&(p+=b[q-1]),m=p+m;else for(q=0;q<n.length;q++)0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?m+=this.measureLine(n[q]):m+=Math.ceil(this.context.measureText(n[q]).width),m+=this.game.math.snapToCeil(m,b)-m}c[h]=Math.ceil(m);d=Math.max(d,c[h])}this.canvas.width=d*this._res;
n=f.fontSize+this.style.strokeThickness+this.padding.y;h=n*g;p=this._lineSpacing;0>p&&Math.abs(p)>n&&(p=-n);0!==p&&(h+=0<p?p*a.length:p*(a.length-1));this.canvas.height=h*this._res;this.context.scale(this._res,this._res);navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height));this.context.fillStyle=this.style.fill;this.context.font=
this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";for(h=this._charCount=0;h<g;h++)q=this.style.strokeThickness/2,m=this.style.strokeThickness/2+h*n+f.ascent,0<h&&(m+=p*h),"right"===this.style.align?q+=d-c[h]:"center"===this.style.align&&(q+=(d-c[h])/2),this.autoRound&&(q=Math.round(q),m=Math.round(m)),0<this.colors.length||0<this.strokeColors.length||
0<this.fontWeights.length||0<this.fontStyles.length?this.updateLine(a[h],q,m):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===b?this.context.strokeText(a[h],q,m):this.renderTabLine(a[h],q,m,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===b?this.context.fillText(a[h],q,m):this.renderTabLine(a[h],q,m,!0)));this.updateTexture();this.dirty=!1},e.Text.prototype.renderTabLine=function(a,b,c,d){a=a.split(/(?:\t)/);var f=this.style.tabs;
if(Array.isArray(f))for(var g=0,h=0;h<a.length;h++){0<h&&(g+=f[h-1]);var m=b+g;d?this.context.fillText(a[h],m,c):this.context.strokeText(a[h],m,c)}else for(h=0;h<a.length;h++)g=Math.ceil(this.context.measureText(a[h]).width),m=this.game.math.snapToCeil(b,f),d?this.context.fillText(a[h],m,c):this.context.strokeText(a[h],m,c),b=m+g},e.Text.prototype.updateShadow=function(a){a?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=
this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},e.Text.prototype.measureLine=function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];if(0<this.fontWeights.length||0<this.fontStyles.length){var f=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(f.fontStyle=this.fontStyles[this._charCount]);this.fontWeights[this._charCount]&&(f.fontWeight=
this.fontWeights[this._charCount]);this.context.font=this.componentsToFont(f)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke));this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill));b+=this.context.measureText(d).width;this._charCount++}return Math.ceil(b)},e.Text.prototype.updateLine=
function(a,b,c){for(var d=0;d<a.length;d++){var f=a[d];if(0<this.fontWeights.length||0<this.fontStyles.length){var g=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(g.fontStyle=this.fontStyles[this._charCount]);this.fontWeights[this._charCount]&&(g.fontWeight=this.fontWeights[this._charCount]);this.context.font=this.componentsToFont(g)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),
this.updateShadow(this.style.shadowStroke),this.context.strokeText(f,b,c));this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(f,b,c));b+=this.context.measureText(f).width;this._charCount++}},e.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},e.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=
!0,this},e.Text.prototype.addColor=function(a,b){return this.colors[b]=a,this.dirty=!0,this},e.Text.prototype.addStrokeColor=function(a,b){return this.strokeColors[b]=a,this.dirty=!0,this},e.Text.prototype.addFontStyle=function(a,b){return this.fontStyles[b]=a,this.dirty=!0,this},e.Text.prototype.addFontWeight=function(a,b){return this.fontWeights[b]=a,this.dirty=!0,this},e.Text.prototype.precalculateWordWrap=function(a){return this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font,
this.runWordWrap(a).split(/(?:\r\n|\r|\n)/)},e.Text.prototype.runWordWrap=function(a){return this.useAdvancedWrap?this.advancedWordWrap(a):this.basicWordWrap(a)},e.Text.prototype.advancedWordWrap=function(a){var b=this.context,c=this.style.wordWrapWidth,d="";a=a.replace(/ +/gi," ").split(/\r?\n/gi);for(var f=a.length,g=0;g<f;g++){var h=a[g],m="";if(h=h.replace(/^ *|\s*$/gi,""),b.measureText(h).width<c)d+=h+"\n";else{var n=c;h=h.split(" ");for(var p=0;p<h.length;p++){var q=h[p],r=q+" ",u=b.measureText(r).width;
if(n<u){if(0===p){for(f=r;f.length&&(f=f.slice(0,-1),!(b.measureText(f).width<=n)););if(!f.length)throw Error("This text's wordWrapWidth setting is less than a single character!");n=q.substr(f.length);h[p]=n;m+=f}n=h.slice(h[p].length?p:p+1).join(" ").replace(/[ \n]*$/gi,"");a[g+1]=n+" "+(a[g+1]||"");f=a.length;break}m+=r;n-=u}d+=m.replace(/[ \n]*$/gi,"")+"\n"}}return d.replace(/[\s|\n]*$/gi,"")},e.Text.prototype.basicWordWrap=function(a){var b="";a=a.split("\n");for(var c=0;c<a.length;c++){for(var d=
this.style.wordWrapWidth,f=a[c].split(" "),g=0;g<f.length;g++){var h=this.context.measureText(f[g]).width,m=h+this.context.measureText(" ").width;d<m?(0<g&&(b+="\n"),b+=f[g]+" ",d=this.style.wordWrapWidth-h):(d-=m,b+=f[g]+" ")}c<a.length-1&&(b+="\n")}return b},e.Text.prototype.updateFont=function(a){a=this.componentsToFont(a);this.style.font!==a&&(this.style.font=a,this.dirty=!0,this.parent&&this.updateTransform())},e.Text.prototype.fontToComponents=function(a){var b=a.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);
if(b){var c=b[5].trim();return/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(c)||/['",]/.exec(c)||(c="'"+c+"'"),{font:a,fontStyle:b[1]||"normal",fontVariant:b[2]||"normal",fontWeight:b[3]||"normal",fontSize:b[4]||"medium",fontFamily:c}}return console.warn("Phaser.Text - unparsable CSS font: "+a),{font:a}},e.Text.prototype.componentsToFont=function(a){var b,c=[];return(b=a.fontStyle)&&"normal"!==b&&c.push(b),(b=a.fontVariant)&&"normal"!==b&&c.push(b),(b=a.fontWeight)&&"normal"!==b&&
c.push(b),(b=a.fontSize)&&"medium"!==b&&c.push(b),(b=a.fontFamily)&&c.push(b),c.length||c.push(a.font),c.join(" ")},e.Text.prototype.setText=function(a,b){return void 0===b&&(b=!1),(a=a.toString()||"")===this._text||(this.text=a,b?this.updateText():this.dirty=!0),this},e.Text.prototype.parseList=function(a){if(!Array.isArray(a))return this;for(var b="",c=0;c<a.length;c++)Array.isArray(a[c])?(b+=a[c].join("\t"),c<a.length-1&&(b+="\n")):(b+=a[c],c<a.length-1&&(b+="\t"));return this.text=b,this.dirty=
!0,this},e.Text.prototype.setTextBounds=function(a,b,c,d){return void 0===a?this.textBounds=null:(this.textBounds?this.textBounds.setTo(a,b,c,d):this.textBounds=new e.Rectangle(a,b,c,d),this.style.wordWrapWidth>c&&(this.style.wordWrapWidth=c)),this.updateTexture(),this},e.Text.prototype.updateTexture=function(){var a=this.texture.baseTexture,b=this.texture.crop,c=this.texture.frame,d=this.canvas.width,f=this.canvas.height;if(a.width=d,a.height=f,b.width=d,b.height=f,c.width=d,c.height=f,this.texture.width=
d,this.texture.height=f,this._width=d,this._height=f,this.textBounds)a=this.textBounds.x,b=this.textBounds.y,"right"===this.style.boundsAlignH?a+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(a+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?b+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(b+=this.textBounds.halfHeight-this.canvas.height/this.resolution/
2),this.pivot.x=-a,this.pivot.y=-b;this.renderable=0!==d&&0!==f;this.texture.requiresReTint=!0;this.texture.baseTexture.dirty()},e.Text.prototype._renderWebGL=function(a){this.dirty&&(this.updateText(),this.dirty=!1);PIXI.Sprite.prototype._renderWebGL.call(this,a)},e.Text.prototype._renderCanvas=function(a){this.dirty&&(this.updateText(),this.dirty=!1);PIXI.Sprite.prototype._renderCanvas.call(this,a)},e.Text.prototype.determineFontProperties=function(a){var b=e.Text.fontPropertiesCache[a];if(b)return b;
b=e.Text.fontPropertiesContext;b.font=a;var c=b.measureText(this.testString);if(c.actualBoundingBoxAscent)b={ascent:d=Math.ceil(c.actualBoundingBoxAscent),descent:f=Math.ceil(c.actualBoundingBoxDescent),fontSize:d+f};else{var d,f;c=b.measureText("MX").width;b={ascent:d=Math.ceil(.75*c),descent:f=Math.ceil(.25*c),fontSize:d+f}}return e.Text.fontPropertiesCache[a]=b},e.Text.prototype.getBounds=function(a){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,
a)},e.Text.prototype.setCharacterLimit=function(a,b){this.characterLimitSuffix=void 0===b?"":b;this.characterLimitSize=a;this.updateText()},Object.defineProperty(e.Text.prototype,"text",{get:function(){return this._text},set:function(a){a!==this._text&&(this._text=a.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(e.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(a){this._fontComponents=this.fontToComponents(a||
"bold 20pt Arial");this.updateFont(this._fontComponents)}}),Object.defineProperty(e.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(a){a=(a=a||"Arial").trim();/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(a)||/['",]/.exec(a)||(a="'"+a+"'");this._fontComponents.fontFamily=a;this.updateFont(this._fontComponents)}}),Object.defineProperty(e.Text.prototype,"fontSize",{get:function(){var a=this._fontComponents.fontSize;return a&&/(?:^0$|px$)/.exec(a)?
parseInt(a,10):a},set:function(a){"number"==typeof(a=a||"0")&&(a+="px");this._fontComponents.fontSize=a;this.updateFont(this._fontComponents)}}),Object.defineProperty(e.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(a){this._fontComponents.fontWeight=a||"normal";this.updateFont(this._fontComponents)}}),Object.defineProperty(e.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(a){this._fontComponents.fontStyle=
a||"normal";this.updateFont(this._fontComponents)}}),Object.defineProperty(e.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(a){this._fontComponents.fontVariant=a||"normal";this.updateFont(this._fontComponents)}}),Object.defineProperty(e.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(a){a!==this.style.fill&&(this.style.fill=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"align",{get:function(){return this.style.align},
set:function(a){(a=a.toLowerCase())!==this.style.align&&(this.style.align=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"resolution",{get:function(){return this._res},set:function(a){a!==this._res&&(this._res=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(a){a!==this.style.tabs&&(this.style.tabs=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},
set:function(a){(a=a.toLowerCase())!==this.style.boundsAlignH&&(this.style.boundsAlignH=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(a){(a=a.toLowerCase())!==this.style.boundsAlignV&&(this.style.boundsAlignV=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(a){a!==this.style.stroke&&(this.style.stroke=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,
"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(a){a!==this.style.strokeThickness&&(this.style.strokeThickness=Number(a),this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(a){a!==this.style.wordWrap&&(this.style.wordWrap=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(a){a!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=
a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(a){a!==this._lineSpacing&&(this._lineSpacing=parseFloat(a),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(e.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(a){a!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},
set:function(a){a!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(a){a!==this.style.shadowColor&&(this.style.shadowColor=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(a){a!==this.style.shadowBlur&&(this.style.shadowBlur=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,
"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(a){a!==this.style.shadowStroke&&(this.style.shadowStroke=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(a){a!==this.style.shadowFill&&(this.style.shadowFill=a,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.texture.frame.width/this.resolution*this.scale.x},
set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}}),Object.defineProperty(e.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.texture.frame.height/this.resolution*this.scale.y},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}}),Object.defineProperty(e.Text.prototype,"testString",{get:function(){return this._testString},set:function(a){this._testString=a;this.updateText()}}),e.Text.fontPropertiesCache={},e.Text.fontPropertiesCanvas=
document.createElement("canvas"),e.Text.fontPropertiesContext=e.Text.fontPropertiesCanvas.getContext("2d"),e.BitmapText=function(a,b,c,d,f,g,h){b=b||0;c=c||0;d=d||"";f=f||"";g=g||32;h=h||"left";PIXI.DisplayObjectContainer.call(this);this.type=e.BITMAPTEXT;this.physicsType=e.SPRITE;this.textHeight=this.textWidth=0;this.anchor=new e.Point;this._prevAnchor=new e.Point;this._glyphs=[];this._maxWidth=0;this._text=f.toString()||"";this._data=a.cache.getBitmapFont(d);this._font=d;this._fontSize=g;this._align=
h;this._letterSpacing=0;this._tint=16777215;this.updateText();this.dirty=!1;e.Component.Core.init.call(this,a,b,c,"",null)},e.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),e.BitmapText.prototype.constructor=e.BitmapText,e.Component.Core.install.call(e.BitmapText.prototype,"Angle AutoCull Bounds Destroy FixedToCamera InputEnabled InWorld LifeSpan PhysicsBody Reset".split(" ")),e.BitmapText.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate,e.BitmapText.prototype.preUpdateLifeSpan=
e.Component.LifeSpan.preUpdate,e.BitmapText.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate,e.BitmapText.prototype.preUpdateCore=e.Component.Core.preUpdate,e.BitmapText.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},e.BitmapText.prototype.postUpdate=function(){e.Component.PhysicsBody.postUpdate.call(this);e.Component.FixedToCamera.postUpdate.call(this);this.body&&this.body.type===e.Physics.ARCADE&&
(this.textWidth===this.body.sourceWidth&&this.textHeight===this.body.sourceHeight||this.body.setSize(this.textWidth,this.textHeight))},e.BitmapText.prototype.setText=function(a){this.text=a},e.BitmapText.prototype.scanLine=function(a,b,c){for(var d=0,f=0,g=-1,h=0,m=null,n=0<this._maxWidth?this._maxWidth:null,p=[],q=0;q<c.length;q++){var r=q===c.length-1;if(/(?:\r\n|\r|\n)/.test(c.charAt(q)))return{width:f,text:c.substr(0,q),end:r,chars:p};var u,x=c.charCodeAt(q),w=a.chars[x];void 0===w&&(x=32,w=a.chars[x]);
m=m&&w.kerning[m]?w.kerning[m]:0;if(/(\s)/.test(c.charAt(q))&&(g=q,h=f),u=(m+w.texture.width+w.xOffset)*b,n&&n<=f+u&&-1<g)return{width:h||f,text:c.substr(0,q-(q-g)),end:!1,chars:p};f+=(w.xAdvance+m+this.letterSpacing)*b;p.push(d+(w.xOffset+m+this.letterSpacing)*b);d+=(w.xAdvance+m+this.letterSpacing)*b;m=x}return{width:f,text:c,end:r,chars:p}},e.BitmapText.prototype.cleanText=function(a,b){void 0===b&&(b="");var c=this._data.font;if(!c)return"";a=a.replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");for(var d=
0;d<a.length;d++){for(var f="",g=a[d],h=0;h<g.length;h++)f=c.chars[g.charCodeAt(h)]?f.concat(g[h]):f.concat(b);a[d]=f}return a.join("\n")},e.BitmapText.prototype.updateText=function(){var a=this._data.font;if(a){var b=this.text,c=this._fontSize/a.size,d=[],f=0;this.textWidth=0;do(n=this.scanLine(a,c,b)).y=f,d.push(n),n.width>this.textWidth&&(this.textWidth=n.width),f+=a.lineHeight*c,b=b.substr(n.text.length+1);while(!1===n.end);this.textHeight=f;f=b=0;for(var g=this.textWidth*this.anchor.x,h=this.textHeight*
this.anchor.y,m=0;m<d.length;m++){var n=d[m];"right"===this._align?f=this.textWidth-n.width:"center"===this._align&&(f=(this.textWidth-n.width)/2);for(var p=0;p<n.text.length;p++){var q=n.text.charCodeAt(p),r=a.chars[q];void 0===r&&(q=32,r=a.chars[q]);(q=this._glyphs[b])?q.texture=r.texture:((q=new PIXI.Sprite(r.texture)).name=n.text[p],this._glyphs.push(q));q.position.x=n.chars[p]+f-g;q.position.y=n.y+r.yOffset*c-h;q.scale.set(c);q.tint=this.tint;q.texture.requiresReTint=!0;q.cachedTint=16777215;
q.parent||this.addChild(q);b++}}for(m=b;m<this._glyphs.length;m++)this.removeChild(this._glyphs[m])}},e.BitmapText.prototype.purgeGlyphs=function(){for(var a=this._glyphs.length,b=[],c=0;c<this._glyphs.length;c++)this._glyphs[c].parent!==this?this._glyphs[c].destroy():b.push(this._glyphs[c]);return this._glyphs=b,this.updateText(),a-b.length},e.BitmapText.prototype.updateTransform=function(){!this.dirty&&this.anchor.equals(this._prevAnchor)||(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor));
PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Object.defineProperty(e.BitmapText.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(a){"number"==typeof a&&(this._letterSpacing=a,this.updateText())}}),Object.defineProperty(e.BitmapText.prototype,"align",{get:function(){return this._align},set:function(a){a===this._align||"left"!==a&&"center"!==a&&"right"!==a||(this._align=a,this.updateText())}}),Object.defineProperty(e.BitmapText.prototype,"tint",
{get:function(){return this._tint},set:function(a){a!==this._tint&&(this._tint=a,this.updateText())}}),Object.defineProperty(e.BitmapText.prototype,"font",{get:function(){return this._font},set:function(a){a!==this._font&&(this._font=a.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}}),Object.defineProperty(e.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(a){(a=parseInt(a,10))!==this._fontSize&&0<a&&(this._fontSize=a,this.updateText())}}),
Object.defineProperty(e.BitmapText.prototype,"text",{get:function(){return this._text},set:function(a){a!==this._text&&(this._text=a.toString()||"",this.updateText())}}),Object.defineProperty(e.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(a){a!==this._maxWidth&&(this._maxWidth=a,this.updateText())}}),Object.defineProperty(e.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(a){this._data.base.scaleMode=a?0:1;this._data.base.dirty()}}),
e.RetroFont=function(a,b,c,d,f,g,h,m,n,p){if(!a.cache.checkImageKey(b))return!1;null==g&&(g=a.cache.getImage(b).width/c);this.characterWidth=c;this.characterHeight=d;this.characterSpacingX=h||0;this.characterSpacingY=m||0;this.characterPerRow=g;this.offsetX=n||0;this.offsetY=p||0;this.align="left";this.multiLine=!1;this.autoUpperCase=!0;this.fixedWidth=this.customSpacingY=this.customSpacingX=0;this.fontSet=a.cache.getImage(b);this._text="";this.grabData=[];this.frameData=new e.FrameData;c=this.offsetX;
d=this.offsetY;for(h=g=0;h<f.length;h++)m=this.frameData.addFrame(new e.Frame(h,c,d,this.characterWidth,this.characterHeight)),this.grabData[f.charCodeAt(h)]=m.index,++g===this.characterPerRow?(g=0,c=this.offsetX,d+=this.characterHeight+this.characterSpacingY):c+=this.characterWidth+this.characterSpacingX;a.cache.updateFrameData(b,this.frameData);this.stamp=new e.Image(a,0,0,b,0);e.RenderTexture.call(this,a,100,100,"",e.scaleModes.NEAREST);this.type=e.RETROFONT},e.RetroFont.prototype=Object.create(e.RenderTexture.prototype),
e.RetroFont.prototype.constructor=e.RetroFont,e.RetroFont.ALIGN_LEFT="left",e.RetroFont.ALIGN_RIGHT="right",e.RetroFont.ALIGN_CENTER="center",e.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",e.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",e.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",e.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",e.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",
e.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",e.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",e.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",e.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",e.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",e.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",e.RetroFont.prototype.setFixedWidth=function(a,b){void 0===b&&(b="left");this.fixedWidth=a;
this.align=b},e.RetroFont.prototype.setText=function(a,b,c,d,f,g){this.multiLine=b||!1;this.customSpacingX=c||0;this.customSpacingY=d||0;this.align=f||"left";this.autoUpperCase=!g;0<a.length&&(this.text=a)},e.RetroFont.prototype.buildRetroFontText=function(){var a=0;if(this.clear(),this.multiLine){var b=this._text.split("\n");0<this.fixedWidth?this.resize(this.fixedWidth,b.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+
this.customSpacingX),b.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var c=0;c<b.length;c++){var d=0;this.align===e.RetroFont.ALIGN_RIGHT?d=this.width-b[c].length*(this.characterWidth+this.customSpacingX):this.align===e.RetroFont.ALIGN_CENTER&&(d=this.width/2-b[c].length*(this.characterWidth+this.customSpacingX)/2,d+=this.customSpacingX/2);0>d&&(d=0);this.pasteLine(b[c],d,a,this.customSpacingX);a+=this.characterHeight+this.customSpacingY}}else 0<this.fixedWidth?this.resize(this.fixedWidth,
this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),d=0,this.align===e.RetroFont.ALIGN_RIGHT?d=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===e.RetroFont.ALIGN_CENTER&&(d=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,d+=this.customSpacingX/2),0>d&&(d=0),this.pasteLine(this._text,d,0,this.customSpacingX);this.requiresReTint=!0},e.RetroFont.prototype.pasteLine=function(a,
b,c,d){for(var f=0;f<a.length;f++)if(" "===a.charAt(f))b+=this.characterWidth+d;else if(0<=this.grabData[a.charCodeAt(f)]&&(this.stamp.frame=this.grabData[a.charCodeAt(f)],this.renderXY(this.stamp,b,c,!1),(b+=this.characterWidth+d)>this.width))break},e.RetroFont.prototype.getLongestLine=function(){var a=0;if(0<this._text.length)for(var b=this._text.split("\n"),c=0;c<b.length;c++)b[c].length>a&&(a=b[c].length);return a},e.RetroFont.prototype.removeUnsupportedCharacters=function(a){for(var b="",c=0;c<
this._text.length;c++){var d=this._text[c],f=d.charCodeAt(0);(0<=this.grabData[f]||!a&&"\n"===d)&&(b=b.concat(d))}return b},e.RetroFont.prototype.updateOffset=function(a,b){if(this.offsetX!==a||this.offsetY!==b){a-=this.offsetX;b-=this.offsetY;for(var c=this.game.cache.getFrameData(this.stamp.key).getFrames(),d=c.length;d--;)c[d].x+=a,c[d].y+=b;this.buildRetroFontText()}},Object.defineProperty(e.RetroFont.prototype,"text",{get:function(){return this._text},set:function(a){var b;(b=this.autoUpperCase?
a.toUpperCase():a)!==this._text&&(this._text=b,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(e.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(a){this.stamp.smoothed=a;this.buildRetroFontText()}}),e.Rope=function(a,b,c,d,f,g){this.points=g||[];this._hasUpdateAnimation=!1;this._updateAnimationCallback=null;b=b||0;c=c||0;d=d||null;f=f||null;this.type=e.ROPE;PIXI.DisplayObjectContainer.call(this);this.texture=
e.Cache.DEFAULT;this.uvs=new Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new Float32Array([0,0,100,0,100,100,0,100]);this.colors=new Float32Array([1,1,1,1]);this.indices=new Uint16Array([0,1,2,3]);g&&(this.vertices=new Float32Array(4*g.length),this.uvs=new Float32Array(4*g.length),this.colors=new Float32Array(2*g.length),this.indices=new Uint16Array(2*g.length));this.dirty=!0;this.canvasPadding=0;this.drawMode=e.Rope.TRIANGLE_STRIP;e.Component.Core.init.call(this,a,b,c,d,f);this.refresh()},e.Rope.prototype=
Object.create(PIXI.DisplayObjectContainer.prototype),e.Rope.prototype.constructor=e.Rope,e.Component.Core.install.call(e.Rope.prototype,"Angle Animation AutoCull Bounds BringToTop Crop Delta Destroy FixedToCamera InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset ScaleMinMax Smoothed".split(" ")),e.Rope.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate,e.Rope.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate,e.Rope.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate,e.Rope.prototype.preUpdateCore=
e.Component.Core.preUpdate,e.Rope.TRIANGLE_STRIP=0,e.Rope.TRIANGLES=1,e.Rope.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},e.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},e.Rope.prototype.reset=function(a,b){return e.Component.Reset.prototype.reset.call(this,a,b),this},e.Rope.prototype.refresh=function(){var a=this.points;if(!(1>a.length)){var b=this.uvs,c=this.indices,
d=this.colors;this.count-=.2;a=a.length;for(var f,g,h=0;h<a;h++)g=h/(a-1),b[f=4*h]=g,b[f+1]=0,b[f+2]=g,b[f+3]=1,d[f=2*h]=1,d[f+1]=1,c[f=2*h]=f,c[f+1]=f+1}},e.Rope.prototype.updateTransform=function(){var a=this.points;if(!(1>a.length)){var b=a[0];this.count-=.2;for(var c,d,f,g=this.vertices,h=a.length,m=this.texture.height/2,n=0;n<h;n++){c=a[n];d=4*n;var p=n<h-1?a[n+1]:c;var q=-(p.x-b.x);p=p.y-b.y;b=Math.sqrt(p*p+q*q);f=m;p/=b;q/=b;p*=f;q*=f;g[d]=c.x+p;g[d+1]=c.y+q;g[d+2]=c.x-p;g[d+3]=c.y-q;b=c}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)}},
e.Rope.prototype.setTexture=function(a){this.texture=a},e.Rope.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())},e.Rope.prototype._initWebGL=function(a){a=a.gl;this._vertexBuffer=a.createBuffer();this._indexBuffer=a.createBuffer();this._uvBuffer=a.createBuffer();this._colorBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,
this._vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvs,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colors,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW)},e.Rope.prototype._renderStrip=function(a){var b=a.gl,c=a.projection,d=a.offset,f=a.shaderManager.stripShader,
g=this.drawMode===e.Rope.TRIANGLE_STRIP?b.TRIANGLE_STRIP:b.TRIANGLES;a.blendModeManager.setBlendMode(this.blendMode);b.uniformMatrix3fv(f.translationMatrix,!1,this.worldTransform.toArray(!0));b.uniform2f(f.projectionVector,c.x,-c.y);b.uniform2f(f.offsetVector,-d.x,-d.y);b.uniform1f(f.alpha,this.worldAlpha);this.dirty?(this.dirty=!1,b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.vertices,b.STATIC_DRAW),b.vertexAttribPointer(f.aVertexPosition,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,
this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW),b.vertexAttribPointer(f.aTextureCoord,2,b.FLOAT,!1,0,0),b.activeTexture(b.TEXTURE0),this.texture.baseTexture._dirty[b.id]?a.renderer.updateTexture(this.texture.baseTexture):b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id]),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)):(b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferSubData(b.ARRAY_BUFFER,
0,this.vertices),b.vertexAttribPointer(f.aVertexPosition,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.vertexAttribPointer(f.aTextureCoord,2,b.FLOAT,!1,0,0),b.activeTexture(b.TEXTURE0),this.texture.baseTexture._dirty[b.id]?a.renderer.updateTexture(this.texture.baseTexture):b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id]),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer));b.drawElements(g,this.indices.length,b.UNSIGNED_SHORT,0)},e.Rope.prototype._renderCanvas=
function(a){if(this.visible&&!(0>=this.alpha)){var b=a.context,c=this.worldTransform,d=c.tx*a.resolution+a.shakeX,f=c.ty*a.resolution+a.shakeY;a.roundPixels?b.setTransform(c.a,c.b,c.c,c.d,0|d,0|f):b.setTransform(c.a,c.b,c.c,c.d,d,f);this.drawMode===e.Rope.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(b):this._renderCanvasTriangles(b)}},e.Rope.prototype._renderCanvasTriangleStrip=function(a){var b=this.vertices,c=this.uvs,d=b.length/2;this.count++;for(var f=0;f<d-2;f++){var g=2*f;this._renderCanvasDrawTriangle(a,
b,c,g,g+2,g+4)}},e.Rope.prototype._renderCanvasTriangles=function(a){var b=this.vertices,c=this.uvs,d=this.indices,f=d.length;this.count++;for(var g=0;g<f;g+=3)this._renderCanvasDrawTriangle(a,b,c,2*d[g],2*d[g+1],2*d[g+2])},e.Rope.prototype._renderCanvasDrawTriangle=function(a,b,c,d,f,g){var h=this.texture.baseTexture.source,m=this.texture.width,n=this.texture.height,p=b[d],q=b[f],r=b[g],u=b[d+1],x=b[f+1];b=b[g+1];var w=c[d]*m,A=c[f]*m;m*=c[g];d=c[d+1]*n;f=c[f+1]*n;c=c[g+1]*n;if(0<this.canvasPadding){g=
this.canvasPadding/this.worldTransform.a;n=this.canvasPadding/this.worldTransform.d;var C=(p+q+r)/3,L=(u+x+b)/3,M=p-C,P=u-L,V=Math.sqrt(M*M+P*P);p=C+M/V*(V+g);u=L+P/V*(V+n);P=x-L;q=C+(M=q-C)/(V=Math.sqrt(M*M+P*P))*(V+g);x=L+P/V*(V+n);P=b-L;r=C+(M=r-C)/(V=Math.sqrt(M*M+P*P))*(V+g);b=L+P/V*(V+n)}a.save();a.beginPath();a.moveTo(p,u);a.lineTo(q,x);a.lineTo(r,b);a.closePath();a.clip();g=w*f+d*m+A*c-f*m-d*A-w*c;a.transform((p*f+d*r+q*c-f*r-d*q-p*c)/g,(u*f+d*b+x*c-f*b-d*x-u*c)/g,(w*q+p*m+A*r-q*m-p*A-w*r)/
g,(w*x+u*m+A*b-x*m-u*A-w*b)/g,(w*f*r+d*q*m+p*A*c-p*f*m-d*A*r-w*q*c)/g,(w*f*b+d*x*m+u*A*c-u*f*m-d*A*b-w*x*c)/g);a.drawImage(h,0,0);a.restore()},e.Rope.prototype.renderStripFlat=function(a){var b=this.context;a=a.vertices;var c=a.length/2;this.count++;b.beginPath();for(var d=1;d<c-2;d++){var f=2*d,g=a[f+2],h=a[f+4],m=a[f+3],n=a[f+5];b.moveTo(a[f],a[f+1]);b.lineTo(g,m);b.lineTo(h,n)}b.fillStyle="#FF0000";b.fill();b.closePath()},e.Rope.prototype.getBounds=function(a){var b=a||this.worldTransform;a=b.a;
var c=b.b,d=b.c,f=b.d,g=b.tx,h=b.ty;b=-1/0;for(var m=-1/0,n=1/0,p=1/0,q=this.vertices,r=0;r<q.length;r+=2){var u=q[r],x=q[r+1],w=a*u+d*x+g;u=f*x+c*u+h;n=w<n?w:n;p=u<p?u:p;b=b<w?w:b;m=m<u?u:m}if(n===-1/0||m===1/0)return e.EmptyRectangle;a=this._bounds;return a.x=n,a.width=b-n,a.y=p,a.height=m-p,this._currentBounds=a},Object.defineProperty(e.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(a){a&&"function"==typeof a?(this._hasUpdateAnimation=!0,this._updateAnimation=
a):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(e.Rope.prototype,"segments",{get:function(){for(var a,b,c,d,f=[],g=0;g<this.points.length;g++)a=4*g,b=this.vertices[a]*this.scale.x,c=this.vertices[a+1]*this.scale.y,d=this.vertices[a+4]*this.scale.x,a=this.vertices[a+3]*this.scale.y,d=e.Math.difference(b,d),a=e.Math.difference(c,a),b+=this.world.x,c+=this.world.y,b=new e.Rectangle(b,c,d,a),f.push(b);return f}}),e.TileSprite=function(a,b,c,d,f,g,h){b=b||0;c=c||0;
d=d||256;f=f||256;g=g||null;h=h||null;PIXI.Sprite.call(this,new PIXI.Texture(e.Cache.DEFAULT.baseTexture),d,f);this.type=e.TILESPRITE;this.physicsType=e.SPRITE;this._scroll=new e.Point;this.tileScale=new e.Point(1,1);this.tileScaleOffset=new e.Point(1,1);this.tilePosition=new e.Point;this.textureDebug=!1;this.tilePattern=this.tilingTexture=this.canvasBuffer=null;this.refreshTexture=!0;this.frameHeight=this.frameWidth=0;this._width=d;this._height=f;e.Component.Core.init.call(this,a,b,c,g,h)},e.TileSprite.prototype=
Object.create(PIXI.Sprite.prototype),e.TileSprite.prototype.constructor=e.TileSprite,e.Component.Core.install.call(e.TileSprite.prototype,"Angle Animation AutoCull Bounds BringToTop Destroy FixedToCamera Health InCamera InputEnabled InWorld LifeSpan LoadTexture Overlap PhysicsBody Reset Smoothed".split(" ")),e.TileSprite.prototype.preUpdatePhysics=e.Component.PhysicsBody.preUpdate,e.TileSprite.prototype.preUpdateLifeSpan=e.Component.LifeSpan.preUpdate,e.TileSprite.prototype.preUpdateInWorld=e.Component.InWorld.preUpdate,
e.TileSprite.prototype.preUpdateCore=e.Component.Core.preUpdate,e.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=.001*this._scroll.x*this.game.time.delta),0!==this._scroll.y&&(this.tilePosition.y+=.001*this._scroll.y*this.game.time.delta),!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},e.TileSprite.prototype.autoScroll=function(a,b){return this._scroll.set(a,b),this},e.TileSprite.prototype.stopScroll=
function(){return this._scroll.set(0,0),this},e.TileSprite.prototype.destroy=function(a){e.Component.Destroy.prototype.destroy.call(this,a);PIXI.Sprite.prototype.destroy.call(this);this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null);this.tilePosition=this.tileScaleOffset=this.tileScale=null;this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},e.TileSprite.prototype.reset=function(a,b){return e.Component.Reset.prototype.reset.call(this,a,b),this.tilePosition.x=
0,this.tilePosition.y=0,this},e.TileSprite.prototype.setTexture=function(a){return this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215),this},e.TileSprite.prototype._renderWebGL=function(a){if(this.visible&&this.renderable&&0!==this.alpha){if(this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this.refreshTexture){if(this.generateTilingTexture(!0,
a),!this.tilingTexture)return;this.tilingTexture.needsUpdate&&(this.tilingTexture.baseTexture.textureIndex=this.texture.baseTexture.textureIndex,a.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)}a.spriteBatch.renderTilingSprite(this);for(var b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);b=!1;this._filters&&(b=!0,a.spriteBatch.stop(),a.filterManager.popFilter());this._mask&&(b||a.spriteBatch.stop(),a.maskManager.popMask(this._mask,a));b&&
a.spriteBatch.start()}},e.TileSprite.prototype._renderCanvas=function(a){if(this.visible&&this.renderable&&0!==this.alpha){var b=a.context;this._mask&&a.maskManager.pushMask(this._mask,a);b.globalAlpha=this.worldAlpha;var c=this.worldTransform,d=a.resolution,f=c.tx*d+a.shakeX,g=c.ty*d+a.shakeY;if(b.setTransform(c.a*d,c.b*d,c.c*d,c.d*d,f,g),16777215===this.tint||!this.texture.requiresReTint&&this.cachedTint===this.tint||(this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=
this.tint,this.texture.requiresReTint=!1,this.refreshTexture=!0),this.refreshTexture){if(this.generateTilingTexture(!1,a),!this.tilingTexture)return;this.tilePattern=b.createPattern(this.tilingTexture.baseTexture.source,"repeat")}c=a.currentBlendMode;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode]);d=this.tilePosition;var h=this.tileScale;d.x%=this.tilingTexture.baseTexture.width;d.y%=this.tilingTexture.baseTexture.height;
b.scale(h.x,h.y);b.translate(d.x+this.anchor.x*-this._width,d.y+this.anchor.y*-this._height);b.fillStyle=this.tilePattern;f=-d.x;g=-d.y;var m=this._width/h.x,n=this._height/h.y;a.roundPixels&&(f|=0,g|=0,m|=0,n|=0);b.fillRect(f,g,m,n);b.scale(1/h.x,1/h.y);b.translate(-d.x+this.anchor.x*this._width,-d.y+this.anchor.y*this._height);this._mask&&a.maskManager.popMask(a);for(f=0;f<this.children.length;f++)this.children[f]._renderCanvas(a);c!==this.blendMode&&(a.currentBlendMode=c,b.globalCompositeOperation=
PIXI.blendModesCanvas[c])}},e.TileSprite.prototype.onTextureUpdate=function(){},e.TileSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var b=this.texture,c=b.frame,d=this._frame.sourceSizeW||this._frame.width,f=this._frame.sourceSizeH||this._frame.height,g=0,h=0;this._frame.trimmed&&(g=this._frame.spriteSourceSizeX,h=this._frame.spriteSourceSizeY);a&&(d=e.Math.getNextPowerOfTwo(d),f=e.Math.getNextPowerOfTwo(f));this.canvasBuffer?(this.canvasBuffer.resize(d,
f),this.tilingTexture.baseTexture.width=d,this.tilingTexture.baseTexture.height=f):(this.canvasBuffer=new PIXI.CanvasBuffer(d,f),this.tilingTexture=PIXI.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0);this.tilingTexture.needsUpdate=!0;this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,d,f));a=b.crop.width;var m=b.crop.height;a===d&&m===f||(a=d,m=f);this.canvasBuffer.context.drawImage(this.tintedTexture?this.tintedTexture:
b.baseTexture.source,b.crop.x,b.crop.y,b.crop.width,b.crop.height,g,h,a,m);this.tileScaleOffset.x=c.width/d;this.tileScaleOffset.y=c.height/f;this.refreshTexture=!1;this.tilingTexture.baseTexture._powerOf2=!0}},e.TileSprite.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,f=b*(1-this.anchor.y),g=b*-this.anchor.y;b=this.worldTransform;var h=b.a,m=b.b,n=b.c,p=b.d,q=b.tx,r=b.ty;b=h*d+n*g+q;a=p*g+m*d+r;var u=h*c+n*g+q;g=p*g+m*c+r;var x=h*c+n*f+q;
c=p*f+m*c+r;h=h*d+n*f+q;n=p*f+m*d+r;d=-1/0;f=-1/0;m=1/0;p=1/0;m=h<(m=x<(m=u<(m=b<m?b:m)?u:m)?x:m)?h:m;p=n<(p=c<(p=g<(p=a<p?a:p)?g:p)?c:p)?n:p;d=(d=(d=(d=d<b?b:d)<u?u:d)<x?x:d)<h?h:d;f=(f=(f=(f=f<a?a:f)<g?g:f)<c?c:f)<n?n:f;b=this._bounds;return b.x=m,b.width=d-m,b.y=p,b.height=f-p,this._currentBounds=b},Object.defineProperty(e.TileSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(e.TileSprite.prototype,"height",{get:function(){return this._height},
set:function(a){this._height=a}}),e.CanvasPool={create:function(a,b,c){var d=e.CanvasPool.getFirst();-1===d?(a={parent:a,canvas:document.createElement("canvas")},e.CanvasPool.pool.push(a),a=a.canvas):(e.CanvasPool.pool[d].parent=a,a=e.CanvasPool.pool[d].canvas);return void 0!==b&&(a.width=b,a.height=c),a},getFirst:function(){for(var a=e.CanvasPool.pool,b=0;b<a.length;b++)if(!a[b].parent)return b;return-1},remove:function(a){for(var b=e.CanvasPool.pool,c=0;c<b.length;c++)b[c].parent===a&&(b[c].parent=
null,b[c].canvas.width=1,b[c].canvas.height=1)},removeByCanvas:function(a){for(var b=e.CanvasPool.pool,c=0;c<b.length;c++)b[c].canvas===a&&(b[c].parent=null,b[c].canvas.width=1,b[c].canvas.height=1)},getTotal:function(){for(var a=e.CanvasPool.pool,b=0,c=0;c<a.length;c++)a[c].parent&&b++;return b},getFree:function(){for(var a=e.CanvasPool.pool,b=0,c=0;c<a.length;c++)a[c].parent||b++;return b},log:function(){console.log("CanvasPool: %s used, %s free, %s total",e.CanvasPool.getTotal(),e.CanvasPool.getFree(),
e.CanvasPool.pool.length)},clear:function(){e.CanvasPool.pool.length=0}},e.CanvasPool.pool=[],Object.defineProperty(e.CanvasPool,"length",{get:function(){return this.pool.length}}),e.Device=function(){this.deviceReadyAt=0;this.iOS=this.desktop=this.initialized=!1;this.iOSVersion=0;this.canvas=this.windowsPhone=this.windows=this.macOS=this.linux=this.chromeOS=this.android=this.crosswalk=this.ejecta=this.electron=this.nodeWebkit=this.node=this.cordova=this.cocoonJSApp=this.cocoonJS=!1;this.canvasBitBltShift=
null;this.vibration=this.typedArray=this.pointerLock=this.css3D=this.worker=this.localStorage=this.fileSystem=this.file=this.webGL=this.canUseMultiply=this.canHandleAlpha=!1;this.getUserMedia=!0;this.mspointer=this.touch=this.quirksMode=!1;this.wheelEvent=null;this.chrome=this.arora=!1;this.chromeVersion=0;this.firefox=this.epiphany=!1;this.firefoxVersion=0;this.ie=!1;this.ieVersion=0;this.trident=!1;this.tridentVersion=0;this.safari=this.opera=this.midori=this.mobileSafari=this.edge=!1;this.safariVersion=
0;this.iPad=this.iPhone4=this.iPhone=this.hlsVideo=this.vp9Video=this.webmVideo=this.mp4Video=this.h264Video=this.oggVideo=this.dolby=this.webm=this.m4a=this.wav=this.mp3=this.opus=this.ogg=this.webAudio=this.audioData=this.silk=this.webApp=!1;this.pixelRatio=0;this.fullscreen=this.support32bit=this.LITTLE_ENDIAN=this.littleEndian=!1;this.cancelFullscreen=this.requestFullscreen="";this.fullscreenKeyboard=!1},e.Device=new e.Device,e.Device.onInitialized=new e.Signal,e.Device.whenReady=function(a,b,
c){var d=this._readyCheck;this.deviceReadyAt||!d?a.call(b,this):d._monitor||c?(d._queue=d._queue||[],d._queue.push([a,b])):(d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]),a=void 0!==window.cordova,b=navigator.isCocoonJS,"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):a&&!b?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,
!1)))},e.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){var b;this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",a._monitor);document.removeEventListener("DOMContentLoaded",a._monitor);window.removeEventListener("load",a._monitor);this._initialize();this.initialized=!0;for(this.onInitialized.dispatch(this);b=a._queue.shift();)b[0].call(b[1],this);this.onInitialized=this._initialize=this._readyCheck=null}}else window.setTimeout(a._monitor,
20)},e.Device._initialize=function(){var a,b,c,d=this;!function(){var f=navigator.userAgent;/Playstation Vita/.test(f)?d.vita=!0:/Kindle/.test(f)||/\bKF[A-Z][A-Z]+/.test(f)||/Silk.*Mobile Safari/.test(f)?d.kindle=!0:/Android/.test(f)?d.android=!0:/CrOS/.test(f)?d.chromeOS=!0:/iP[ao]d|iPhone/i.test(f)?(d.iOS=!0,navigator.appVersion.match(/OS (\d+)/),d.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(f)?d.linux=!0:/Mac OS/.test(f)?d.macOS=!0:/Windows/.test(f)&&(d.windows=!0);(/Windows Phone/i.test(f)||
/IEMobile/i.test(f))&&(d.android=!1,d.iOS=!1,d.macOS=!1,d.windows=!0,d.windowsPhone=!0);var g=/Silk/.test(f);(d.windows||d.macOS||d.linux&&!g||d.chromeOS)&&(d.desktop=!0);(d.windowsPhone||/Windows NT/i.test(f)&&/Touch/i.test(f))&&(d.desktop=!1)}();(function(){var f=navigator.userAgent;if(/Arora/.test(f)?d.arora=!0:/Edge\/\d+/.test(f)?d.edge=!0:/Chrome\/(\d+)/.test(f)&&!d.windowsPhone?(d.chrome=!0,d.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(f)?d.epiphany=!0:/Firefox\D+(\d+)/.test(f)?(d.firefox=
!0,d.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(f)&&d.iOS?d.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(f)?(d.ie=!0,d.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(f)?d.midori=!0:/Opera/.test(f)?d.opera=!0:/Safari\/(\d+)/.test(f)&&!d.windowsPhone?(d.safari=!0,/Version\/(\d+)\./.test(f)&&(d.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(f)&&(d.ie=!0,d.trident=!0,d.tridentVersion=parseInt(RegExp.$1,10),d.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(f)&&
(d.silk=!0),navigator.standalone&&(d.webApp=!0),void 0!==window.cordova&&(d.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(d.node=!0),d.node&&"object"==typeof process.versions&&(d.nodeWebkit=!!process.versions["node-webkit"],d.electron=!!process.versions.electron),navigator.isCocoonJS&&(d.cocoonJS=!0),d.cocoonJS)try{d.cocoonJSApp="undefined"!=typeof CocoonJS}catch(g){d.cocoonJSApp=!1}void 0!==window.ejecta&&(d.ejecta=!0);/Crosswalk/.test(f)&&(d.crosswalk=!0)})();(function(){d.audioData=
!!window.Audio;d.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var f=document.createElement("audio");try{if(f.canPlayType&&(f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(d.ogg=!0),(f.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||f.canPlayType("audio/opus;").replace(/^no$/,""))&&(d.opus=!0),f.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(d.mp3=!0),f.canPlayType("audio/wav").replace(/^no$/,"")&&(d.wav=!0),(f.canPlayType("audio/x-m4a;")||f.canPlayType("audio/aac;").replace(/^no$/,
""))&&(d.m4a=!0),f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(d.webm=!0),""!==f.canPlayType('audio/mp4;codecs="ec-3"')))if(d.edge)d.dolby=!0;else if(d.safari&&9<=d.safariVersion&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var g=parseInt(RegExp.$1,10),h=parseInt(RegExp.$2,10);(10===g&&11<=h||10<g)&&(d.dolby=!0)}}catch(m){}})();(function(){var f=document.createElement("video");try{f.canPlayType&&(f.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(d.oggVideo=
!0),f.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(d.h264Video=!0,d.mp4Video=!0),f.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(d.webmVideo=!0),f.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(d.vp9Video=!0),f.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(d.hlsVideo=!0))}catch(g){}})();(function(){var f,g=document.createElement("p"),h={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",
MozTransform:"-moz-transform",transform:"transform"},m;for(m in document.body.insertBefore(g,null),h)void 0!==g.style[m]&&(g.style[m]="translate3d(1px,1px,1px)",f=window.getComputedStyle(g).getPropertyValue(h[m]));document.body.removeChild(g);d.css3D=void 0!==f&&0<f.length&&"none"!==f})();d.pixelRatio=window.devicePixelRatio||1;d.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone");d.iPhone4=2===d.pixelRatio&&d.iPhone;d.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");"undefined"!=
typeof Int8Array?d.typedArray=!0:d.typedArray=!1;"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(d.littleEndian=(a=new ArrayBuffer(4),b=new Uint8Array(a),c=new Uint32Array(a),b[0]=161,b[1]=178,b[2]=195,b[3]=212,3569595041===c[0]||2712847316!==c[0]&&null),d.LITTLE_ENDIAN=d.littleEndian);d.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==d.littleEndian&&function(){if(void 0===
Uint8ClampedArray)return!1;var f=e.CanvasPool.create(this,1,1).getContext("2d");if(!f)return!1;f=f.createImageData(1,1);return e.CanvasPool.remove(this),f.data instanceof Uint8ClampedArray}();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;navigator.vibrate&&(d.vibration=!0);d.canvas=!!window.CanvasRenderingContext2D||d.cocoonJS;try{d.localStorage=!!localStorage.getItem}catch(f){d.localStorage=!1}d.file=!!(window.File&&window.FileReader&&window.FileList&&
window.Blob);d.fileSystem=!!window.requestFileSystem;d.webGL=!!window.WebGLRenderingContext;d.worker=!!window.Worker;d.pointerLockElement=("pointerLockElement"in document?"pointerLockElement":"mozPointerLockElement"in document&&"mozPointerLockElement")||"webkitPointerLockElement"in document&&"webkitPointerLockElement";d.pointerlockchange=("onpointerlockchange"in document?"pointerlockchange":"onmozpointerlockchange"in document&&"mozpointerlockchange")||"onwebkitpointerlockchange"in document&&"webkitpointerlockchange";
d.pointerlockerror=("onpointerlockerror"in document?"pointerlockerror":"onmozpointerlockerror"in document&&"mozpointerlockerror")||"onwebkitpointerlockerror"in document&&"webkitpointerlockerror";d.pointerLock=!!d.pointerLockElement;d.quirksMode="CSS1Compat"!==document.compatMode;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;
d.getUserMedia=d.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;d.firefox&&21>d.firefoxVersion&&(d.getUserMedia=!1);!d.iOS&&(d.ie||d.firefox||d.chrome)&&(d.canvasBitBltShift=!0);(d.safari||d.mobileSafari)&&(d.canvasBitBltShift=!1);(function(){var f=e.CanvasPool.create(this,6,1),g=f.getContext("2d");g.fillStyle="rgba(10, 20, 30, 0.5)";g.fillRect(0,0,1,1);var h=g.getImageData(0,0,1,1);if(h){g.putImageData(h,1,0);var m=g.getImageData(1,0,1,1);d.canHandleAlpha=m.data[0]===h.data[0]&&m.data[1]===
h.data[1]&&m.data[2]===h.data[2]&&m.data[3]===h.data[3]}g.globalCompositeOperation="multiply";d.canUseMultiply="multiply"===g.globalCompositeOperation;e.CanvasPool.removeByCanvas(f);PIXI.CanvasTinter.tintMethod=d.canUseMultiply?PIXI.CanvasTinter.tintWithMultiply:PIXI.CanvasTinter.tintWithPerPixel})();(function(){for(var f="requestFullscreen requestFullScreen webkitRequestFullscreen webkitRequestFullScreen msRequestFullscreen msRequestFullScreen mozRequestFullScreen mozRequestFullscreen".split(" "),
g=document.createElement("div"),h=0;h<f.length;h++)if(g[f[h]]){d.fullscreen=!0;d.requestFullscreen=f[h];break}f="cancelFullScreen exitFullscreen webkitCancelFullScreen webkitExitFullscreen msCancelFullScreen msExitFullscreen mozCancelFullScreen mozExitFullscreen".split(" ");if(d.fullscreen)for(h=0;h<f.length;h++)if(document[f[h]]){d.cancelFullscreen=f[h];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(d.fullscreenKeyboard=!0)})();("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&
1<=window.navigator.maxTouchPoints)&&(d.touch=!0);(window.PointerEvent||window.MSPointerEvent||window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(d.mspointer=!0);d.cocoonJS||("onwheel"in window||d.ie&&"WheelEvent"in window?d.wheelEvent="wheel":"onmousewheel"in window?d.wheelEvent="mousewheel":d.firefox&&"MouseScrollEvent"in window&&(d.wheelEvent="DOMMouseScroll"))},e.Device.canPlayAudio=function(a){return!("mp3"!==a||!this.mp3)||!("ogg"!==a||!this.ogg&&!this.opus)||!("m4a"!==a||
!this.m4a)||!("opus"!==a||!this.opus)||!("wav"!==a||!this.wav)||!("webm"!==a||!this.webm)||!("mp4"!==a||!this.dolby)},e.Device.canPlayVideo=function(a){return!("webm"!==a||!this.webmVideo&&!this.vp9Video)||!("mp4"!==a||!this.mp4Video&&!this.h264Video)||!("ogg"!==a&&"ogv"!==a||!this.oggVideo)||!("mpeg"!==a||!this.hlsVideo)},e.Device.needsTouchUnlock=function(){return!!(!this.cocoonJS&&(this.iOS||this.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)},e.Device.isAndroidStockBrowser=
function(){var a=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return a&&537>a[1]},e.Canvas={create:function(a,b,c,d,f){b=b||256;c=c||256;a=f?document.createElement("canvas"):e.CanvasPool.create(a,b,c);return"string"==typeof d&&""!==d&&(a.id=d),a.width=b,a.height=c,a.style.display="block",a},setBackgroundColor:function(a,b){return b=b||"rgb(0,0,0)",a.style.backgroundColor=b,a},setTouchAction:function(a,b){return b=b||"none",a.style.msTouchAction=b,a.style["ms-touch-action"]=b,
a.style["touch-action"]=b,a},setUserSelect:function(a,b){return b=b||"none",a.style["-webkit-touch-callout"]=b,a.style["-webkit-user-select"]=b,a.style["-khtml-user-select"]=b,a.style["-moz-user-select"]=b,a.style["-ms-user-select"]=b,a.style["user-select"]=b,a.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",a},addToDOM:function(a,b,c){var d;return void 0===c&&(c=!0),b&&("string"==typeof b?d=document.getElementById(b):"object"==typeof b&&1===b.nodeType&&(d=b)),d||=document.body,c&&d.style&&
(d.style.overflow="hidden"),d.appendChild(a),a},removeFromDOM:function(a){a.parentNode&&a.parentNode.removeChild(a)},setTransform:function(a,b,c,d,f,g,h){return a.setTransform(d,g,h,f,b,c),a},setSmoothingEnabled:function(a,b){var c=e.Canvas.getSmoothingPrefix(a);return c&&(a[c]=b),a},getSmoothingPrefix:function(a){var b=["i","webkitI","msI","mozI","oI"],c;for(c in b){var d=b[c]+"mageSmoothingEnabled";if(d in a)return d}return null},getSmoothingEnabled:function(a){var b=e.Canvas.getSmoothingPrefix(a);
if(b)return a[b]},setImageRenderingCrisp:function(a){for(var b=["-webkit-optimize-contrast","-moz-crisp-edges","crisp-edges","pixelated"],c=0;c<b.length;c++)a.style["image-rendering"]=b[c];return a.style.msInterpolationMode="nearest-neighbor",a},setImageRenderingBicubic:function(a){return a.style["image-rendering"]="auto",a.style.msInterpolationMode="bicubic",a}},e.RequestAnimationFrame=function(a,b){void 0===b&&(b=!1);this.game=a;this.isRunning=!1;this.forceSetTimeOut=b;a=["ms","moz","webkit","o"];
for(b=0;b<a.length&&!window.requestAnimationFrame;b++)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"];this._isSetTimeOut=!1;this._timeOutID=this._onLoop=null},e.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var a=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return a.updateSetTimeout()},this._timeOutID=
window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(b){return a.updateRAF(b)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(a){this.isRunning&&(this.game.update(Math.floor(a)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):
window.cancelAnimationFrame(this._timeOutID);this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return!1===this._isSetTimeOut}},e.RequestAnimationFrame.prototype.constructor=e.RequestAnimationFrame,e.Math={PI2:2*Math.PI,HALF_PI:.5*Math.PI,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,degToRad:function(a){return a*e.Math.DEG_TO_RAD},radToDeg:function(a){return a*e.Math.RAD_TO_DEG},getNextPowerOfTwo:function(a){if(0<a&&0==(a&a-1))return a;for(var b=1;b<a;)b<<=1;return b},
isPowerOfTwo:function(a,b){return 0<a&&0==(a&a-1)&&0<b&&0==(b&b-1)},random:function(a,b){if(void 0===a&&(a=0),void 0===b&&(b=1),a===b)return a;if(b<a){var c=a;a=b;b=c}return Math.random()*(b-a)+a},between:function(a,b){if(void 0===a&&(a=0),void 0===b&&(b=1),a===b)return a;if(b<a){var c=a;a=b;b=c}return a=Math.ceil(a),b=Math.floor(b),Math.floor(Math.random()*(b-a+1))+a},fuzzyEqual:function(a,b,c){return void 0===c&&(c=1E-4),Math.abs(a-b)<c},fuzzyLessThan:function(a,b,c){return void 0===c&&(c=1E-4),
a<b+c},fuzzyGreaterThan:function(a,b,c){return void 0===c&&(c=1E-4),b-c<a},fuzzyCeil:function(a,b){return void 0===b&&(b=1E-4),Math.ceil(a-b)},fuzzyFloor:function(a,b){return void 0===b&&(b=1E-4),Math.floor(a+b)},average:function(){for(var a=0,b=arguments.length,c=0;c<b;c++)a+=+arguments[c];return a/b},shear:function(a){return a%1},snapTo:function(a,b,c){return void 0===c&&(c=0),0===b?a:(a-=c,c+b*Math.round(a/b))},snapToFloor:function(a,b,c){return void 0===c&&(c=0),0===b?a:(a-=c,c+b*Math.floor(a/
b))},snapToCeil:function(a,b,c){return void 0===c&&(c=0),0===b?a:(a-=c,c+b*Math.ceil(a/b))},roundTo:function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=10);b=Math.pow(c,-b);return Math.round(a*b)/b},floorTo:function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=10);b=Math.pow(c,-b);return Math.floor(a*b)/b},ceilTo:function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=10);b=Math.pow(c,-b);return Math.ceil(a*b)/b},trunc:function(a){return isFinite(a)?a-a%1||(0>a?-0:0===a?a:0):a},rotateToAngle:function(a,b,c){return void 0===
c&&(c=.05),a===b||(Math.abs(b-a)<=c||Math.abs(b-a)>=e.Math.PI2-c?a=b:(Math.abs(b-a)>Math.PI&&(b<a?b+=e.Math.PI2:b-=e.Math.PI2),a<b?a+=c:b<a&&(a-=c))),a},getShortestAngle:function(a,b){a=b-a;return 0===a?0:a-360*Math.floor((a- -180)/360)},angleBetween:function(a,b,c,d){return Math.atan2(d-b,c-a)},angleBetweenY:function(a,b,c,d){return Math.atan2(c-a,d-b)},angleBetweenPoints:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},angleBetweenPointsY:function(a,b){return Math.atan2(b.x-a.x,b.y-a.y)},reverseAngle:function(a){return this.normalizeAngle(a+
Math.PI,!0)},normalizeAngle:function(a){return 0<=(a%=2*Math.PI)?a:a+2*Math.PI},maxAdd:function(a,b,c){return Math.min(a+b,c)},minSub:function(a,b,c){return Math.max(a-b,c)},wrap:function(a,b,c){c-=b;if(0>=c)return 0;a=(a-b)%c;return 0>a&&(a+=c),a+b},wrapValue:function(a,b,c){return(Math.abs(a)+Math.abs(b))%Math.abs(c)},isOdd:function(a){return!!(1&a)},isEven:function(a){return!(1&a)},min:function(){for(var a=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments,b=1,c=0,d=a.length;b<
d;b++)a[b]<a[c]&&(c=b);return a[c]},max:function(){for(var a=1===arguments.length&&"object"==typeof arguments[0]?arguments[0]:arguments,b=1,c=0,d=a.length;b<d;b++)a[b]>a[c]&&(c=b);return a[c]},minProperty:function(a){for(var b=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:arguments.slice(1),c=1,d=0,f=b.length;c<f;c++)b[c][a]<b[d][a]&&(d=c);return b[d][a]},maxProperty:function(a){for(var b=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:arguments.slice(1),c=1,d=
0,f=b.length;c<f;c++)b[c][a]>b[d][a]&&(d=c);return b[d][a]},wrapAngle:function(a,b){return b?this.wrap(a,-Math.PI,Math.PI):this.wrap(a,-180,180)},linearInterpolation:function(a,b){var c=a.length-1,d=c*b,f=Math.floor(d);return 0>b?this.linear(a[0],a[1],d):1<b?this.linear(a[c],a[c-1],c-d):this.linear(a[f],a[c<f+1?c:f+1],d-f)},bezierInterpolation:function(a,b){for(var c=0,d=a.length-1,f=0;f<=d;f++)c+=Math.pow(1-b,d-f)*Math.pow(b,f)*a[f]*this.bernstein(d,f);return c},catmullRomInterpolation:function(a,
b){var c=a.length-1,d=c*b,f=Math.floor(d);return a[0]===a[c]?(0>b&&(f=Math.floor(d=c*(1+b))),this.catmullRom(a[(f-1+c)%c],a[f],a[(f+1)%c],a[(f+2)%c],d-f)):0>b?a[0]-(this.catmullRom(a[0],a[0],a[1],a[1],-d)-a[0]):1<b?a[c]-(this.catmullRom(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):this.catmullRom(a[f?f-1:0],a[f],a[c<f+1?c:f+1],a[c<f+2?c:f+2],d-f)},linear:function(a,b,c){return(b-a)*c+a},bernstein:function(a,b){return this.factorial(a)/this.factorial(b)/this.factorial(a-b)},factorial:function(a){if(0===a)return 1;
for(var b=a;--a;)b*=a;return b},catmullRom:function(a,b,c,d,f){a=.5*(c-a);d=.5*(d-b);var g=f*f;return(2*b-2*c+a+d)*f*g+(-3*b+3*c-2*a-d)*g+a*f+b},difference:function(a,b){return Math.abs(a-b)},roundAwayFromZero:function(a){return 0<a?Math.ceil(a):Math.floor(a)},sinCosGenerator:function(a,b,c,d){void 0===b&&(b=1);void 0===c&&(c=1);void 0===d&&(d=1);d=d*Math.PI/a;for(var f=[],g=[],h=0;h<a;h++)b+=(c-=b*d)*d,f[h]=c,g[h]=b;return{sin:g,cos:f,length:a}},hypot:function(a,b){return Math.sqrt(a*a+b*b)},distance:function(a,
b,c,d){a-=c;b-=d;return Math.sqrt(a*a+b*b)},distanceSq:function(a,b,c,d){a-=c;b-=d;return a*a+b*b},distancePow:function(a,b,c,d,f){return void 0===f&&(f=2),Math.sqrt(Math.pow(c-a,f)+Math.pow(d-b,f))},clamp:function(a,b,c){return a<b?b:c<a?c:a},clampBottom:function(a,b){return a<b?b:a},within:function(a,b,c){return Math.abs(a-b)<=c},mapLinear:function(a,b,c,d,f){return d+(a-b)*(f-d)/(c-b)},smoothstep:function(a,b,c){return(a=Math.max(0,Math.min(1,(a-b)/(c-b))))*a*(3-2*a)},smootherstep:function(a,b,
c){return(a=Math.max(0,Math.min(1,(a-b)/(c-b))))*a*a*(a*(6*a-15)+10)},sign:function(a){return 0>a?-1:0<a?1:0},percent:function(a,b,c){return void 0===c&&(c=0),b<a||b<c?1:a<c||a<c?0:(a-c)/b}},e.RandomDataGenerator=function(a){void 0===a&&(a=[]);this.c=1;this.s2=this.s1=this.s0=0;"string"==typeof a?this.state(a):this.sow(a)},e.RandomDataGenerator.prototype={rnd:function(){var a=2091639*this.s0+2.3283064365386963E-10*this.c;return this.c=0|a,this.s0=this.s1,this.s1=this.s2,this.s2=a-this.c,this.s2},
sow:function(a){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,a)for(var b=0;b<a.length&&null!=a[b];b++){var c=a[b];this.s0-=this.hash(c);this.s0+=~~(0>this.s0);this.s1-=this.hash(c);this.s1+=~~(0>this.s1);this.s2-=this.hash(c);this.s2+=~~(0>this.s2)}},hash:function(a){var b;var c=4022871197;a=a.toString();for(b=0;b<a.length;b++){var d=.02519603282416938*(c+a.charCodeAt(b));d-=c=d>>>0;c=(d*=c)>>>0;c+=4294967296*(d-c)}return 2.3283064365386963E-10*(c>>>0)},
integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565E-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(a,b){return Math.floor(this.realInRange(0,b-a+1)+a)},between:function(a,b){return this.integerInRange(a,b)},realInRange:function(a,b){return this.frac()*(b-a)+a},normal:function(){return 1-2*this.frac()},uuid:function(){var a,b;for(b=a="";36>a++;b+=~a%5|3*a&4?(15^a?
8^this.frac()*(20^a?16:4):4).toString(16):"-");return b},pick:function(a){return a[this.integerInRange(0,a.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(a){return a[~~(Math.pow(this.frac(),2)*(a.length-1)+.5)]},timestamp:function(a,b){return this.realInRange(a||9466848E5,b||1577862E6)},angle:function(){return this.integerInRange(-180,180)},state:function(a){return"string"==typeof a&&a.match(/^!rnd/)&&(a=a.split(","),this.c=parseFloat(a[1]),this.s0=parseFloat(a[2]),this.s1=
parseFloat(a[3]),this.s2=parseFloat(a[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join()}},e.RandomDataGenerator.prototype.constructor=e.RandomDataGenerator,e.QuadTree=function(a,b,c,d,f,g,h){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(a,b,c,d,f,g,h)},e.QuadTree.prototype={reset:function(a,b,c,d,f,g,h){this.maxObjects=f||10;this.maxLevels=g||4;this.level=h||0;this.bounds={x:Math.round(a),y:Math.round(b),width:c,height:d,
subWidth:Math.floor(c/2),subHeight:Math.floor(d/2),right:Math.round(a)+Math.floor(c/2),bottom:Math.round(b)+Math.floor(d/2)};this.objects.length=0;this.nodes.length=0},populate:function(a){a.forEach(this.populateHandler,this,!0)},populateHandler:function(a){a.body&&a.exists&&this.insert(a.body)},split:function(){this.nodes[0]=new e.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new e.QuadTree(this.bounds.x,
this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new e.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new e.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(a){var b,c=0;if(null==this.nodes[0]||-1===(b=this.getIndex(a))){if(this.objects.push(a),
this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();c<this.objects.length;)-1!==(b=this.getIndex(this.objects[c]))?this.nodes[b].insert(this.objects.splice(c,1)[0]):c++}else this.nodes[b].insert(a)},getIndex:function(a){var b=-1;return a.x<this.bounds.right&&a.right<this.bounds.right?a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom?b=1:a.y>this.bounds.bottom&&(b=2):a.x>this.bounds.right&&(a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom?b=0:a.y>
this.bounds.bottom&&(b=3)),b},retrieve:function(a){if(a instanceof e.Rectangle)var b=this.objects,c=this.getIndex(a);else{if(!a.body)return this._empty;b=this.objects;c=this.getIndex(a.body)}return this.nodes[0]&&(b=-1!==c?b.concat(this.nodes[c].retrieve(a)):(b=(b=(b=b.concat(this.nodes[0].retrieve(a))).concat(this.nodes[1].retrieve(a))).concat(this.nodes[2].retrieve(a))).concat(this.nodes[3].retrieve(a))),b},clear:function(){this.objects.length=0;for(var a=this.nodes.length;a--;)this.nodes[a].clear(),
this.nodes.splice(a,1);this.nodes.length=0}},e.QuadTree.prototype.constructor=e.QuadTree,e.TweenManager=function(a){this.game=a;this._tweens=[];this._add=[];this.easeMap={Power0:e.Easing.Power0,Power1:e.Easing.Power1,Power2:e.Easing.Power2,Power3:e.Easing.Power3,Power4:e.Easing.Power4,Linear:e.Easing.Linear.None,Quad:e.Easing.Quadratic.Out,Cubic:e.Easing.Cubic.Out,Quart:e.Easing.Quartic.Out,Quint:e.Easing.Quintic.Out,Sine:e.Easing.Sinusoidal.Out,Expo:e.Easing.Exponential.Out,Circ:e.Easing.Circular.Out,
Elastic:e.Easing.Elastic.Out,Back:e.Easing.Back.Out,Bounce:e.Easing.Bounce.Out,"Quad.easeIn":e.Easing.Quadratic.In,"Cubic.easeIn":e.Easing.Cubic.In,"Quart.easeIn":e.Easing.Quartic.In,"Quint.easeIn":e.Easing.Quintic.In,"Sine.easeIn":e.Easing.Sinusoidal.In,"Expo.easeIn":e.Easing.Exponential.In,"Circ.easeIn":e.Easing.Circular.In,"Elastic.easeIn":e.Easing.Elastic.In,"Back.easeIn":e.Easing.Back.In,"Bounce.easeIn":e.Easing.Bounce.In,"Quad.easeOut":e.Easing.Quadratic.Out,"Cubic.easeOut":e.Easing.Cubic.Out,
"Quart.easeOut":e.Easing.Quartic.Out,"Quint.easeOut":e.Easing.Quintic.Out,"Sine.easeOut":e.Easing.Sinusoidal.Out,"Expo.easeOut":e.Easing.Exponential.Out,"Circ.easeOut":e.Easing.Circular.Out,"Elastic.easeOut":e.Easing.Elastic.Out,"Back.easeOut":e.Easing.Back.Out,"Bounce.easeOut":e.Easing.Bounce.Out,"Quad.easeInOut":e.Easing.Quadratic.InOut,"Cubic.easeInOut":e.Easing.Cubic.InOut,"Quart.easeInOut":e.Easing.Quartic.InOut,"Quint.easeInOut":e.Easing.Quintic.InOut,"Sine.easeInOut":e.Easing.Sinusoidal.InOut,
"Expo.easeInOut":e.Easing.Exponential.InOut,"Circ.easeInOut":e.Easing.Circular.InOut,"Elastic.easeInOut":e.Easing.Elastic.InOut,"Back.easeInOut":e.Easing.Back.InOut,"Bounce.easeInOut":e.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)},e.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var a=0;a<this._tweens.length;a++)this._tweens[a].pendingDelete=!0;this._add=[]},removeFrom:function(a,b){if(void 0===
b&&(b=!0),Array.isArray(a))for(b=0,c=a.length;b<c;b++)this.removeFrom(a[b]);else if(a.type===e.GROUP&&b){b=0;for(var c=a.children.length;b<c;b++)this.removeFrom(a.children[b])}else{b=0;for(c=this._tweens.length;b<c;b++)a===this._tweens[b].target&&this.remove(this._tweens[b]);b=0;for(c=this._add.length;b<c;b++)a===this._add[b].target&&this.remove(this._add[b])}},add:function(a){(a._manager=this)._add.push(a)},create:function(a){return new e.Tween(a,this.game,this)},remove:function(a){var b=this._tweens.indexOf(a);
-1!==b?this._tweens[b].pendingDelete=!0:-1!==(b=this._add.indexOf(a))&&(this._add[b].pendingDelete=!0)},update:function(){var a=this._add.length,b=this._tweens.length;if(0===b&&0===a)return!1;for(var c=0;c<b;)this._tweens[c].update(this.game.time.deltaTotal)?c++:(this._tweens.splice(c,1),b--);return 0<a&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(a,b){return b||=!1,this._tweens.some(function(c){return c.target===a&&(!b||c.isRunning&&!c.pendingDelete)})},
_pauseAll:function(){for(var a=this._tweens.length-1;0<=a;a--)this._tweens[a]._pause()},_resumeAll:function(){for(var a=this._tweens.length-1;0<=a;a--)this._tweens[a]._resume()},pauseAll:function(){for(var a=this._tweens.length-1;0<=a;a--)this._tweens[a].pause()},resumeAll:function(){for(var a=this._tweens.length-1;0<=a;a--)this._tweens[a].resume(!0)},destroy:function(){this.game.onPause.remove(this._pauseAll,this);this.game.onResume.remove(this._resumeAll,this);this._tweens=this._add=this.game=null}},
e.TweenManager.prototype.constructor=e.TweenManager,e.Tween=function(a,b,c){this.game=b;this.target=a;this.manager=c;this.timeline=[];this.reverse=!1;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=!1;this.onStart=new e.Signal;this.onLoop=new e.Signal;this.onRepeat=new e.Signal;this.onChildComplete=new e.Signal;this.onComplete=new e.Signal;this.isRunning=!1;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=!1;this._onUpdateCallbackContext=this._onUpdateCallback=null;
this._pausedTime=0;this._hasStarted=this._codePaused=!1},e.Tween.updateColor=function(a){e.Color.updateColor(a.target)},e.Tween.prototype={to:function(a,b,c,d,f,g,h){return(void 0===b||0>=b)&&(b=1E3),null==c&&(c=e.Easing.Default),void 0===d&&(d=!1),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=!1),"string"==typeof c&&this.manager.easeMap[c]&&(c=this.manager.easeMap[c]),this.isRunning?console.warn("Phaser.Tween.to cannot be called after Tween.start"):(this.timeline.push((new e.TweenData(this)).to(a,
b,c,f,g,h)),d&&this.start()),this},from:function(a,b,c,d,f,g,h){return void 0===b&&(b=1E3),null==c&&(c=e.Easing.Default),void 0===d&&(d=!1),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=!1),"string"==typeof c&&this.manager.easeMap[c]&&(c=this.manager.easeMap[c]),this.isRunning?console.warn("Phaser.Tween.from cannot be called after Tween.start"):(this.timeline.push((new e.TweenData(this)).from(a,b,c,f,g,h)),d&&this.start()),this},start:function(a){if(void 0===a&&(a=0),this.pendingDelete)return console.warn("Phaser.Tween.start cannot be called after Tween.stop"),
this;if(null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var b=0;b<this.timeline.length;b++)for(var c in this.timeline[b].vEnd)this.properties[c]=this.target[c]||0,Array.isArray(this.properties[c])||(this.properties[c]*=1);for(b=0;b<this.timeline.length;b++)this.timeline[b].loadValues();return this.manager.add(this),this.isRunning=!0,(0>a||a>this.timeline.length-1)&&(a=0),this.current=a,this.timeline[this.current].start(),this},stop:function(a){return void 0===
a&&(a=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,a&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(a,b,c){if(0===this.timeline.length)return this;if(void 0===c&&(c=0),-1===c)for(c=0;c<this.timeline.length;c++)this.timeline[c][a]=b;else this.timeline[c][a]=b;return this},delay:function(a,b){return this.updateTweenData("delay",a,b)},repeat:function(a,
b,c){return void 0===b&&(b=0),this.updateTweenData("repeatCounter",a,c),this.updateTweenData("repeatTotal",a,c),this.updateTweenData("repeatDelay",b,c)},repeatDelay:function(a,b){return this.updateTweenData("repeatDelay",a,b)},yoyo:function(a,b,c){return void 0===b&&(b=0),this.updateTweenData("yoyo",a,c),this.updateTweenData("yoyoDelay",b,c)},yoyoDelay:function(a,b){return this.updateTweenData("yoyoDelay",a,b)},easing:function(a,b){return"string"==typeof a&&this.manager.easeMap[a]&&(a=this.manager.easeMap[a]),
this.updateTweenData("easingFunction",a,b)},interpolation:function(a,b,c){return void 0===b&&(b=e.Math),this.updateTweenData("interpolationFunction",a,c),this.updateTweenData("interpolationContext",b,c)},repeatAll:function(a){return void 0===a&&(a=0),this.repeatCounter=a,this},chain:function(){for(var a=arguments.length;a--;)0<a?arguments[a-1].chainedTween=arguments[a]:this.chainedTween=arguments[a];return this},loop:function(a){return void 0===a&&(a=!0),this.repeatCounter=a?-1:0,this},onUpdateCallback:function(a,
b){return this._onUpdateCallback=a,this._onUpdateCallbackContext=b,this},pause:function(){this._codePaused=this.isPaused=!0;this._pausedTime=this.game.time.deltaTotal},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.deltaTotal)},resume:function(){if(this.isPaused){this._codePaused=this.isPaused=!1;for(var a=0;a<this.timeline.length;a++)this.timeline[a].isRunning||(this.timeline[a].startTime+=this.game.time.deltaTotal-this._pausedTime)}},_resume:function(){this._codePaused||
this.resume()},update:function(a){if(this.pendingDelete||!this.target)return!1;if(this.isPaused)return!0;a=this.timeline[this.current].update(a);if(a===e.TweenData.PENDING)return!0;if(a===e.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(a===e.TweenData.LOOPED)return-1===
this.timeline[this.current].repeatCounter?this.onLoop.dispatch(this.target,this):this.onRepeat.dispatch(this.target,this),!0;if(a===e.TweenData.COMPLETE)return a=!1,this.reverse?(this.current--,0>this.current&&(this.current=this.timeline.length-1,a=!0)):(this.current++,this.current===this.timeline.length&&(a=!(this.current=0))),a?-1===this.repeatCounter?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):0<this.repeatCounter?(this.repeatCounter--,this.timeline[this.current].start(),
this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)},generateData:function(a,b){if(null===this.game||null===this.target)return null;void 0===a&&(a=60);void 0===b&&(b=[]);for(var c=0;c<this.timeline.length;c++)for(var d in this.timeline[c].vEnd)this.properties[d]=this.target[d]||0,Array.isArray(this.properties[d])||
(this.properties[d]*=1);for(c=0;c<this.timeline.length;c++)this.timeline[c].loadValues();for(c=0;c<this.timeline.length;c++)b=b.concat(this.timeline[c].generateData(a));return b}},Object.defineProperty(e.Tween.prototype,"totalDuration",{get:function(){for(var a=0,b=0;b<this.timeline.length;b++)a+=this.timeline[b].duration;return a}}),e.Tween.prototype.constructor=e.Tween,e.TweenData=function(a){this.parent=a;this.game=a.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=
1E3;this.repeatTotal=this.repeatDelay=this.repeatCounter=this.value=this.percent=0;this.yoyo=this.interpolate=!1;this.yoyoDelay=0;this.inReverse=!1;this.dt=this.delay=0;this.startTime=null;this.easingFunction=e.Easing.Default;this.interpolationFunction=e.Math.linearInterpolation;this.interpolationContext=e.Math;this.isFrom=this.isRunning=!1},e.TweenData.PENDING=0,e.TweenData.RUNNING=1,e.TweenData.LOOPED=2,e.TweenData.COMPLETE=3,e.TweenData.prototype={to:function(a,b,c,d,f,g){return this.vEnd=a,this.duration=
b,this.easingFunction=c,this.delay=d,this.repeatTotal=f,this.yoyo=g,this.isFrom=!1,this},from:function(a,b,c,d,f,g){return this.vEnd=a,this.duration=b,this.easingFunction=c,this.delay=d,this.repeatTotal=f,this.yoyo=g,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.deltaTotal+this.delay,this.parent.reverse?this.dt=this.duration:this.dt=0,0<this.delay?this.isRunning=!1:this.isRunning=!0,this.isFrom)for(var a in this.vStartCache)this.vStart[a]=this.vEndCache[a],this.vEnd[a]=this.vStartCache[a],
this.parent.target[a]=this.vStart[a];return this.value=0,this.repeatCounter=this.repeatTotal,this},loadValues:function(){for(var a in this.parent.properties){if(this.vStart[a]=this.parent.properties[a],Array.isArray(this.vEnd[a])){if(0===this.vEnd[a].length)continue;0===this.percent&&(this.vEnd[a]=[this.vStart[a]].concat(this.vEnd[a]))}void 0!==this.vEnd[a]?("string"==typeof this.vEnd[a]&&(this.vEnd[a]=this.vStart[a]+parseFloat(this.vEnd[a])),this.parent.properties[a]=this.vEnd[a]):this.vEnd[a]=this.vStart[a];
this.vStartCache[a]=this.vStart[a];this.vEndCache[a]=this.vEnd[a]}return this},update:function(a){if(this.isRunning){if(a<this.startTime)return e.TweenData.RUNNING}else{if(!(a>=this.startTime))return e.TweenData.PENDING;this.isRunning=!0}a=this.game.time.delta;for(var b in this.parent.reverse?(this.dt-=a*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=a*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent),
this.vEnd){a=this.vStart[b];var c=this.vEnd[b];Array.isArray(c)?this.parent.target[b]=this.interpolationFunction.call(this.interpolationContext,c,this.value):this.parent.target[b]=a+(c-a)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():e.TweenData.RUNNING},generateData:function(a){this.parent.reverse?this.dt=this.duration:this.dt=0;var b=[],c=!1;a=1/a*1E3;do{this.parent.reverse?(this.dt-=a,this.dt=Math.max(this.dt,0)):(this.dt+=a,this.dt=
Math.min(this.dt,this.duration));this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var d={},f;for(f in this.vEnd){var g=this.vStart[f],h=this.vEnd[f];Array.isArray(h)?d[f]=this.interpolationFunction.call(this.interpolationContext,h,this.value):d[f]=g+(h-g)*this.value}b.push(d);(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(c=!0)}while(!c);this.yoyo&&(c=b.slice(),c.reverse(),b=b.concat(c));return b},repeat:function(){if(this.yoyo){if(this.inReverse&&
0===this.repeatCounter){for(var a in this.vStartCache)this.vStart[a]=this.vStartCache[a],this.vEnd[a]=this.vEndCache[a];return this.inReverse=!1,e.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return e.TweenData.COMPLETE;if(this.inReverse)for(a in this.vStartCache)this.vStart[a]=this.vEndCache[a],this.vEnd[a]=this.vStartCache[a];else{for(a in this.vStartCache)this.vStart[a]=this.vStartCache[a],this.vEnd[a]=this.vEndCache[a];0<this.repeatCounter&&this.repeatCounter--}return this.startTime=
this.game.time.deltaTotal,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.parent.reverse?this.dt=this.duration:this.dt=0,e.TweenData.LOOPED}},e.TweenData.prototype.constructor=e.TweenData,e.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>
(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 0===a?0:1===a?1:1-Math.cos(a*Math.PI/2)},Out:function(a){return 0===a?0:1===a?1:Math.sin(a*Math.PI/2)},InOut:function(a){return 0===a?0:
1===a?1:.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(2-Math.pow(2,-10*(a-1)))}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){return 0===a?0:1===a?1:(.1,-1*Math.pow(2,
10*--a)*Math.sin(2*(a-.1)*Math.PI/.4))},Out:function(a){return 0===a?0:1===a?1:(.1,1*Math.pow(2,-10*a)*Math.sin(2*(a-.1)*Math.PI/.4)+1)},InOut:function(a){return 0===a?0:1===a?1:(.1,1>(a*=2)?1*Math.pow(2,10*--a)*Math.sin(2*(a-.1)*Math.PI/.4)*-.5:1*Math.pow(2,-10*--a)*Math.sin(2*(a-.1)*Math.PI/.4)*.5+1)}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?a*a*(3.5949095*a-2.5949095)*.5:.5*((a-=2)*a*(3.5949095*a+
2.5949095)+2)}},Bounce:{In:function(a){return 1-e.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*e.Easing.Bounce.In(2*a):.5*e.Easing.Bounce.Out(2*a-1)+.5}}},e.Easing.Default=e.Easing.Linear.None,e.Easing.Power0=e.Easing.Linear.None,e.Easing.Power1=e.Easing.Quadratic.Out,e.Easing.Power2=e.Easing.Cubic.Out,e.Easing.Power3=e.Easing.Quartic.Out,
e.Easing.Power4=e.Easing.Quintic.Out,e.Time=function(a){this.game=a;this.deltaTotal=this.delta=this.elapsedMS=this.elapsed=this.now=this.time=0;this.deltaMax=200;this.desiredFpsMult=1/60;this._desiredFps=60;this.suggestedFps=this.desiredFps;this.slowMotion=1;this.advancedTiming=!1;this.rps=this.ups=this.fps=this.renders=this.updates=this.frames=0;this.fpsMin=1E3;this.fpsMax=0;this.msMin=1E3;this.timeExpected=this.timeToCall=this.pauseDuration=this.msMax=0;this.events=new e.Timer(this.game,!1);this._pauseStarted=
this._timeLastSecond=this._started=this._elapsedAccumulator=this._frameCount=0;this._timers=[]},e.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start();this.timeExpected=this.time},add:function(a){return this._timers.push(a),a},create:function(a){void 0===a&&(a=!0);a=new e.Timer(this.game,a);return this._timers.push(a),a},removeAll:function(){for(var a=0;a<this._timers.length;a++)this._timers[a].destroy();this._timers=[];this.events.removeAll()},refresh:function(){var a=
this.time;this.time=Date.now();this.elapsedMS=this.time-a},update:function(a){var b=this.time,c=this.now;this.time=Date.now();this.elapsedMS=this.time-b;this.now=a;this.elapsed=this.now-c;this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1E3/this._desiredFps+this.timeExpected-a)),this.timeExpected=a+this.timeToCall);this.advancedTiming&&this.updateAdvancedTiming()},updateTimers:function(){var a=0,b=this._timers.length;if(b)for(;a<b;)this._timers[a].update(this.deltaTotal)?a++:(this._timers.splice(a,
1),b--)},updateAdvancedTiming:function(){if(this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this._desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1E3){var a=this.now-this._timeLastSecond;this.fps=Math.round(1E3*this.frames/a);this.ups=Math.round(1E3*
this.updates/a);this.rps=Math.round(1E3*this.renders/a);this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.renders=this.updates=this.frames=0}},preUpdate:function(a){this.delta=a*=1E3;this.deltaTotal+=a;this.game.paused||(this.events.update(this.deltaTotal),this.updateTimers());this.advancedTiming&&this.updates++},preRender:function(){this.advancedTiming&&this.renders++},gamePaused:function(){this._pauseStarted=Date.now()},gameResumed:function(){this.time=
Date.now();this.pauseDuration=this.time-this._pauseStarted},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(a){return this.time-a},elapsedSecondsSince:function(a){return.001*(this.time-a)},reset:function(){this._started=this.time;this.removeAll()}},Object.defineProperty(e.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(a){this._desiredFps=a;this.desiredFpsMult=1/a}}),Object.defineProperty(e.Time.prototype,"desiredMinFps",
{get:function(){return 1E3/this.deltaMax},set:function(a){this.deltaMax=1E3/a}}),e.Time.prototype.constructor=e.Time,e.Timer=function(a,b){void 0===b&&(b=!0);this.game=a;this.running=!1;this.autoDestroy=b;this.expired=!1;this.elapsed=0;this.events=[];this.onComplete=new e.Signal;this.nextTick=0;this._codePaused=this.paused=!1;this._pauseTotal=this._pauseStarted=this._started=0;this._now=this.game.time?this.game.time.deltaTotal:0;this._newTick=this._diff=this._i=this._marked=this._len=0},e.Timer.MINUTE=
6E4,e.Timer.SECOND=1E3,e.Timer.HALF=500,e.Timer.QUARTER=250,e.Timer.prototype={create:function(a,b,c,d,f,g){var h=(a=Math.round(a))+this._now;a=new e.TimerEvent(this,a,h,c,b,d,f,g);return this.events.push(a),this.order(),this.expired=!1,a},add:function(a,b,c){return this.create(a,!1,0,b,c,Array.prototype.slice.call(arguments,3))},repeat:function(a,b,c,d){return this.create(a,!1,b,c,d,Array.prototype.slice.call(arguments,4))},loop:function(a,b,c){return this.create(a,!0,0,b,c,Array.prototype.slice.call(arguments,
3))},start:function(a){if(!this.running)for(this._started=this.game.time.deltaTotal+(a||0),this.running=!0,a=0;a<this.events.length;a++)this.events[a].tick=this.events[a].delay+this._started},stop:function(a){this.running=!1;void 0===a&&(a=!0);a&&(this.events.length=0)},remove:function(a){for(var b=0;b<this.events.length;b++)if(this.events[b]===a)return this.events[b].pendingDelete=!0;return!1},order:function(){0<this.events.length&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},
sortHandler:function(a,b){return a.tick<b.tick?-1:a.tick>b.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length;this._i=0},update:function(a){if(this.paused)return!0;if(this.elapsed=a-this._now,this._now=a,this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&0<this._len){for(;this._i<this._len&&this.running;){a=this.events[this._i];if(!(this._now>=
a.tick)||a.pendingDelete)break;this._newTick=this._now+a.delay-(this._now-a.tick);0>this._newTick&&(this._newTick=this._now+a.delay);!0===a.loop?a.tick=this._newTick:0<a.repeatCount?(a.repeatCount--,a.tick=this._newTick):(this._marked++,a.pendingDelete=!0);a.callback.apply(a.callbackContext,a.args);this._i++}this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return!this.expired||!this.autoDestroy},pause:function(){this.running&&(this._codePaused=!0,this.paused||
(this._pauseStarted=this.game.time.deltaTotal,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.deltaTotal,this.paused=!0)},adjustEvents:function(a){for(var b=0;b<this.events.length;b++)if(!this.events[b].pendingDelete){var c=this.events[b].tick-a;0>c&&(c=0);this.events[b].tick=this._now+c}a=this.nextTick-a;this.nextTick=0>a?this._now:this._now+a},resume:function(){if(this.paused){var a=this.game.time.deltaTotal;this._pauseTotal+=a-this._now;this._now=
a;this.adjustEvents(this._pauseStarted);this._codePaused=this.paused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll();this._i=this._len=this.events.length=0},destroy:function(){this.onComplete.removeAll();this.running=!1;this.expired=!0;this.events=[];this._i=this._len=0}},Object.defineProperty(e.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(e.Timer.prototype,"duration",{get:function(){return this.running&&
this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(e.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(e.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(e.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),e.Timer.prototype.constructor=e.Timer,e.TimerEvent=function(a,b,c,d,f,g,h,m){this.timer=a;this.delay=b;this.tick=c;this.repeatCount=
d-1;this.loop=f;this.callback=g;this.callbackContext=h;this.args=m;this.pendingDelete=!1},e.TimerEvent.prototype.constructor=e.TimerEvent,e.AnimationManager=function(a){this.sprite=a;this.game=a.game;this.currentAnim=this.currentFrame=null;this.updateIfVisible=!0;this.isLoaded=!1;this._frameData=null;this._anims={};this._outputFrames=[]},e.AnimationManager.prototype={loadFrameData:function(a,b){if(void 0===a)return!1;if(this.isLoaded)for(var c in this._anims)this._anims[c].updateFrameData(a);return this._frameData=
a,null==b?this.frame=0:"string"==typeof b?this.frameName=b:this.frame=b,this.isLoaded=!0},copyFrameData:function(a,b){if(this._frameData=a.clone(),this.isLoaded)for(var c in this._anims)this._anims[c].updateFrameData(this._frameData);return null==b?this.frame=0:"string"==typeof b?this.frameName=b:this.frame=b,this.isLoaded=!0},add:function(a,b,c,d,f){return b=b||[],c=c||60,void 0===d&&(d=!1),void 0===f&&(f=!(!b||"number"!=typeof b[0])),this._outputFrames=[],this._frameData.getFrameIndexes(b,f,this._outputFrames),
this._anims[a]=new e.Animation(this.game,this.sprite,a,this._frameData,this._outputFrames,c,d),this.currentAnim=this._anims[a],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[a]},validateFrames:function(a,b){void 0===b&&(b=!0);for(var c=0;c<a.length;c++)if(!0===b){if(a[c]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(a[c]))return!1;return!0},play:function(a,b,c,d){if(this._anims[a])return this.currentAnim===this._anims[a]?!1===this.currentAnim.isPlaying?
(this.currentAnim.paused=!1,this.currentAnim.play(b,c,d)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[a],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(b,c,d))},stop:function(a,b){void 0===b&&(b=!1);!this.currentAnim||"string"==typeof a&&a!==this.currentAnim.name||this.currentAnim.stop(b)},update:function(){return!(this.updateIfVisible&&!this.sprite.visible)&&!(!this.currentAnim||
!this.currentAnim.update())&&(this.currentFrame=this.currentAnim.currentFrame,!0)},next:function(a){this.currentAnim&&(this.currentAnim.next(a),this.currentFrame=this.currentAnim.currentFrame)},previous:function(a){this.currentAnim&&(this.currentAnim.previous(a),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(a){return"string"==typeof a&&this._anims[a]?this._anims[a]:null},refreshFrame:function(){},destroy:function(){var a=null;for(a in this._anims)this._anims.hasOwnProperty(a)&&
this._anims[a].destroy();this._anims={};this._outputFrames=[];this.game=this.sprite=this.currentFrame=this.currentAnim=this._frameData=null}},e.AnimationManager.prototype.constructor=e.AnimationManager,Object.defineProperty(e.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(e.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(e.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},
set:function(a){this.currentAnim.paused=a}}),Object.defineProperty(e.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:void 0}}),Object.defineProperty(e.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this.currentFrame.index:void 0},set:function(a){var b;"number"==typeof a&&this._frameData&&(b=this._frameData.getFrame(a))&&(this.currentFrame=b,this.sprite.setFrame(this.currentFrame))}}),Object.defineProperty(e.AnimationManager.prototype,
"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(a){var b;"string"==typeof a&&this._frameData&&(b=this._frameData.getFrameByName(a))?(this.currentFrame=b,this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame)):console.warn("Cannot set frameName: "+a)}}),e.Animation=function(a,b,c,d,f,g,h){void 0===h&&(h=!1);this.game=a;this._parent=b;this._frameData=d;this.name=c;this._frames=[];this._frames=this._frames.concat(f);this.delay=
1E3/g;this.loop=h;this.loopCount=0;this.isPaused=this.isPlaying=this.isFinished=this.killOnComplete=!1;this._frameDiff=this._frameIndex=this._pauseStartTime=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new e.Signal;this.onUpdate=null;this.onComplete=new e.Signal;this.onLoop=new e.Signal;this.isReversed=!1;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)},e.Animation.prototype={play:function(a,b,c){return"number"==
typeof a&&(this.delay=1E3/a),"boolean"==typeof b&&(this.loop=b),void 0!==c&&(this.killOnComplete=c),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.deltaTotal,this._timeNextFrame=this.game.time.deltaTotal+this.delay,this._frameIndex=this.isReversed?this._frames.length-1:0,this.updateCurrentFrame(!1,!0),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),(this._parent.animations.currentAnim=
this)._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0;this.paused=this.isFinished=!1;this.loopCount=0;this._timeLastFrame=this.game.time.deltaTotal;this._timeNextFrame=this.game.time.deltaTotal+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);(this._parent.animations.currentAnim=this)._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,
this)},reverse:function(){return this.reversed=!this.reversed,this},reverseOnce:function(){return this.onComplete.addOnce(this.reverse,this),this.reverse()},setFrame:function(a,b){var c;if(void 0===b&&(b=!1),"string"==typeof a)for(b=0;b<this._frames.length;b++)this._frameData.getFrame(this._frames[b]).name===a&&(c=b);else if("number"==typeof a)if(b)c=a;else for(b=0;b<this._frames.length;b++)this._frames[b]===a&&(c=b);c&&(this._frameIndex=c-(this.isReversed?-1:1),this._timeNextFrame=this.game.time.deltaTotal,
this.update())},stop:function(a,b){void 0===a&&(a=!1);void 0===b&&(b=!1);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;a&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame));b&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.deltaTotal)},onResume:function(){this.isPlaying&&(this._timeNextFrame=
this.game.time.deltaTotal+this._frameDiff)},update:function(){if(this.isPaused)return!1;var a=this.game.time.deltaTotal,b=a-this._timeNextFrame;return!!(this.isPlaying&&0<=b)&&(this._frameSkip=1,this._frameDiff=b,this._timeLastFrame=a,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=a+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&
this._frameIndex>=this._frames.length||this.isReversed&&-1>=this._frameIndex?this.loop?(this._frameIndex=Math.abs(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),!this.onUpdate||(this.onUpdate.dispatch(this,
this.currentFrame),!!this._frameData)):(this.complete(),!1):this.updateCurrentFrame(!0))},updateCurrentFrame:function(a,b){if(void 0===b&&(b=!1),!this._frameData)return!1;var c=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(b||c!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),!this.onUpdate||!a||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)},next:function(a){void 0===a&&(a=1);a=
this._frameIndex+a;a>=this._frames.length&&(this.loop?a%=this._frames.length:a=this._frames.length-1);a!==this._frameIndex&&(this._frameIndex=a,this.updateCurrentFrame(!0))},previous:function(a){void 0===a&&(a=1);a=this._frameIndex-a;0>a&&(this.loop?a=this._frames.length+a:a++);a!==this._frameIndex&&(this._frameIndex=a,this.updateCurrentFrame(!0))},updateFrameData:function(a){this.currentFrame=(this._frameData=a)?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&
(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.updateCurrentFrame(!1);this.isPlaying=!1;this.isFinished=
!0;this.paused=!1;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);this.killOnComplete&&this._parent.kill()}},e.Animation.prototype.constructor=e.Animation,Object.defineProperty(e.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(a){(this.isPaused=a)?this._pauseStartTime=this.game.time.deltaTotal:this.isPlaying&&(this._timeNextFrame=this.game.time.deltaTotal+this.delay)}}),Object.defineProperty(e.Animation.prototype,
"reversed",{get:function(){return this.isReversed},set:function(a){this.isReversed=a}}),Object.defineProperty(e.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(e.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(a){this.currentFrame=this._frameData.getFrame(this._frames[a]);null!==this.currentFrame&&(this._frameIndex=a,this._parent.setFrame(this.currentFrame),this.onUpdate&&
this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(e.Animation.prototype,"speed",{get:function(){return 1E3/this.delay},set:function(a){0<a&&(this.delay=1E3/a)}}),Object.defineProperty(e.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(a){a&&null===this.onUpdate?this.onUpdate=new e.Signal:a||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),e.Animation.generateFrameNames=function(a,b,c,d,f){void 0===d&&(d="");var g=
[];if(b<c)for(var h=b;h<=c;h++)b=a+(b="number"==typeof f?e.Utils.pad(h.toString(),f,"0",1):h.toString())+d,g.push(b);else for(h=b;c<=h;h--)b=a+(b="number"==typeof f?e.Utils.pad(h.toString(),f,"0",1):h.toString())+d,g.push(b);return g},e.Frame=function(a,b,c,d,f,g){this.index=a;this.x=b;this.y=c;this.width=d;this.height=f;0!==this.width&&0!==this.height||console.warn('Phaser.Frame: Frame "'+g+'" has a width or height of zero');this.name=g;this.centerX=Math.floor(d/2);this.centerY=Math.floor(f/2);this.distance=
e.Math.distance(0,0,d,f);this.trimmed=this.rotated=!1;this.sourceSizeW=d;this.sourceSizeH=f;this.spriteSourceSizeH=this.spriteSourceSizeW=this.spriteSourceSizeY=this.spriteSourceSizeX=0;this.right=this.x+this.width;this.bottom=this.y+this.height},e.Frame.prototype={resize:function(a,b){this.width=a;this.height=b;this.centerX=Math.floor(a/2);this.centerY=Math.floor(b/2);this.distance=e.Math.distance(0,0,a,b);this.sourceSizeW=a;this.sourceSizeH=b;this.right=this.x+a;this.bottom=this.y+b},setTrim:function(a,
b,c,d,f,g,h){(this.trimmed=a)&&(this.sourceSizeW=b,this.sourceSizeH=c,this.centerX=Math.floor(b/2),this.centerY=Math.floor(c/2),this.spriteSourceSizeX=d,this.spriteSourceSizeY=f,this.spriteSourceSizeW=g,this.spriteSourceSizeH=h)},clone:function(){var a=new e.Frame(this.index,this.x,this.y,this.width,this.height,this.name),b;for(b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a},getRect:function(a){return void 0===a?a=new e.Rectangle(this.x,this.y,this.width,this.height):a.setTo(this.x,this.y,
this.width,this.height),a}},e.Frame.prototype.constructor=e.Frame,e.FrameData=function(){this._frames=[];this._frameNames=[]},e.FrameData.prototype={addFrame:function(a){return a.index=this._frames.length,this._frames.push(a),""!==a.name&&(this._frameNames[a.name]=a.index),a},getFrame:function(a){return a>=this._frames.length&&(a=0),this._frames[a]},getFrameByName:function(a){return"number"==typeof this._frameNames[a]?this._frames[this._frameNames[a]]:null},checkFrameName:function(a){return null!=
this._frameNames[a]},clone:function(){for(var a=new e.FrameData,b=0;b<this._frames.length;b++)a._frames.push(this._frames[b].clone());for(var c in this._frameNames)this._frameNames.hasOwnProperty(c)&&(a._frameNames[c]=this._frameNames[c]);return a},getFrameRange:function(a,b,c){for(void 0===c&&(c=[]);a<=b;a++)c.push(this._frames[a]);return c},getFrames:function(a,b,c){if(void 0===b&&(b=!0),void 0===c&&(c=[]),void 0===a||0===a.length)for(var d=0;d<this._frames.length;d++)c.push(this._frames[d]);else for(d=
0;d<a.length;d++)b?c.push(this.getFrame(a[d])):c.push(this.getFrameByName(a[d]));return c},getFrameIndexes:function(a,b,c){if(void 0===b&&(b=!0),void 0===c&&(c=[]),void 0===a||0===a.length)for(var d=0;d<this._frames.length;d++)c.push(this._frames[d].index);else for(d=0;d<a.length;d++)b&&this._frames[a[d]]?c.push(this._frames[a[d]].index):this.getFrameByName(a[d])&&c.push(this.getFrameByName(a[d]).index);return c},destroy:function(){this._frameNames=this._frames=null}},e.FrameData.prototype.constructor=
e.FrameData,Object.defineProperty(e.FrameData.prototype,"total",{get:function(){return this._frames.length}}),e.AnimationParser={spriteSheet:function(a,b,c,d,f,g,h,m){void 0===f&&(f=-1);void 0===g&&(g=0);void 0===h&&(h=0);void 0===m&&(m=0);var n=b;if("string"==typeof b?n=a.cache.getImage(b):b=n.name,null===n)return null;if(0>=c||0>=d)return console.error('Spritesheet "%s": frameWidth (%s) and frameHeight (%s) values must be positive',b,c,d),null;a=n.width;var p=n.height;if(0===a||0===p)return console.error('Spritesheet "%s": Texture width (%s) or height (%s) is zero',
b,a,p),null;if(a<c||p<d)return console.error('Spritesheet "%s": Texture width (%s) or height (%s) is less than the given frameWidth (%s) or frameHeight (%s)',b,a,p,c,d),null;var q=Math.floor((a-g)/(c+h)),r=Math.floor((p-g)/(d+h)),u=q*r;n=u;var x=u-1,w=0,A=x;if(u<m||m<-u)return console.error('Spritesheet "%s": skipFrames=%s is larger than the frame total %s',b,m,u),null;if(-1<f&&(A=(u=f)-1),1>q&&console.warn('Spritesheet "%s": Texture has width %d, but it should be at least %d (frameWidth=%s, margin=%s, spacing=%s)',
b,a,c+g+h,c,g,h),1>r&&console.warn('Spritesheet "%s": Texture has height %d, but it should be at least %d (frameHeight=%s, margin=%s, spacing=%s)',b,p,d+g+h,d,g,h),0===n)return console.error('Spritesheet "%s": zero frames were produced',b),null;if(0<m?A=(w=m)+Math.min(u,n-m)-1:0>m&&(w=(A=x+m)-Math.min(u,n+m)+1),0>w)return console.error('Spritesheet "%s": There is no frame at index %s',b,w),null;if(x<A)return console.warn('Spritesheet "%s": There is no frame at index %s. Last frame found is index %s',
b,A,x),null;b=new e.FrameData;m=f=g;for(q=p=0;q<n&&!(A<q);q++)w<=q&&b.addFrame(new e.Frame(p++,f,m,c,d,"")),a<(f+=c+h)+c&&(f=g,m+=d+h);return b},JSONData:function(a,b){if(!b.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(b);a=new e.FrameData;for(var c=b.frames,d=0;d<c.length;d++)b=a.addFrame(new e.Frame(d,c[d].frame.x,c[d].frame.y,c[d].frame.w,c[d].frame.h,c[d].filename)),c[d].trimmed&&b.setTrim(c[d].trimmed,
c[d].sourceSize.w,c[d].sourceSize.h,c[d].spriteSourceSize.x,c[d].spriteSourceSize.y,c[d].spriteSourceSize.w,c[d].spriteSourceSize.h),c[d].rotated&&(b.rotated=!0);return a},JSONDataPyxel:function(a,b){if(["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(h){if(!b[h])return console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+h+'" key.'),void console.log(b)}),1!==b.layers.length)return console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps."),
void console.log(b);a=new e.FrameData;for(var c=b.tileheight,d=b.tilewidth,f=b.layers[0].tiles,g=0;g<f.length;g++)a.addFrame(new e.Frame(g,f[g].x,f[g].y,d,c,"frame_"+g)).setTrim(!1);return a},JSONDataHash:function(a,b){if(!b.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(b);a=new e.FrameData;var c=b.frames,d=0,f;for(f in c)b=a.addFrame(new e.Frame(d,c[f].frame.x,c[f].frame.y,c[f].frame.w,c[f].frame.h,f)),
c[f].trimmed&&b.setTrim(c[f].trimmed,c[f].sourceSize.w,c[f].sourceSize.h,c[f].spriteSourceSize.x,c[f].spriteSourceSize.y,c[f].spriteSourceSize.w,c[f].spriteSourceSize.h),c[f].rotated&&(b.rotated=!0),d++;return a},XMLData:function(a,b){if(b.getElementsByTagName("TextureAtlas")){var c,d,f,g;a=new e.FrameData;for(var h=b.getElementsByTagName("SubTexture"),m=0;m<h.length;m++){var n=(c=h[m].attributes).name.value;var p=parseInt(c.x.value,10);var q=parseInt(c.y.value,10);b=parseInt(c.width.value,10);var r=
parseInt(c.height.value,10);var u=d=null;c.frameX&&(d=Math.abs(parseInt(c.frameX.value,10)),u=Math.abs(parseInt(c.frameY.value,10)),f=parseInt(c.frameWidth.value,10),g=parseInt(c.frameHeight.value,10));n=a.addFrame(new e.Frame(m,p,q,b,r,n));null===d&&null===u||n.setTrim(!0,b,r,d,u,f,g)}return a}console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag")}},e.Cache=function(a){this.game=a;this.autoResolveURL=!1;this._cache={canvas:{},image:{},texture:{},
sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{},compressedTexture:{},data:{}};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.onSoundUnlock=new e.Signal;this._cacheMap=[];this._cacheMap[e.Cache.CANVAS]=this._cache.canvas;this._cacheMap[e.Cache.IMAGE]=this._cache.image;this._cacheMap[e.Cache.TEXTURE]=this._cache.texture;this._cacheMap[e.Cache.SOUND]=this._cache.sound;this._cacheMap[e.Cache.TEXT]=this._cache.text;
this._cacheMap[e.Cache.PHYSICS]=this._cache.physics;this._cacheMap[e.Cache.TILEMAP]=this._cache.tilemap;this._cacheMap[e.Cache.BINARY]=this._cache.binary;this._cacheMap[e.Cache.BITMAPDATA]=this._cache.bitmapData;this._cacheMap[e.Cache.BITMAPFONT]=this._cache.bitmapFont;this._cacheMap[e.Cache.JSON]=this._cache.json;this._cacheMap[e.Cache.XML]=this._cache.xml;this._cacheMap[e.Cache.VIDEO]=this._cache.video;this._cacheMap[e.Cache.SHADER]=this._cache.shader;this._cacheMap[e.Cache.RENDER_TEXTURE]=this._cache.renderTexture;
this._cacheMap[e.Cache.DATA]=this._cache.data;this._pendingCount=0;this.onReady=new e.Signal;this._addImages()},e.Cache.CANVAS=1,e.Cache.IMAGE=2,e.Cache.TEXTURE=3,e.Cache.SOUND=4,e.Cache.TEXT=5,e.Cache.PHYSICS=6,e.Cache.TILEMAP=7,e.Cache.BINARY=8,e.Cache.BITMAPDATA=9,e.Cache.BITMAPFONT=10,e.Cache.JSON=11,e.Cache.XML=12,e.Cache.VIDEO=13,e.Cache.SHADER=14,e.Cache.RENDER_TEXTURE=15,e.Cache.DATA=16,e.Cache.DEFAULT=null,e.Cache.DEFAULT_KEY="__default",e.Cache.DEFAULT_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",
e.Cache.MISSING=null,e.Cache.MISSING_KEY="__missing",e.Cache.MISSING_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",e.Cache.READY_TIMEOUT=1E3,e.Cache.prototype={addCompressedTextureMetaData:function(a,
b,c,d){this.checkImageKey(a)&&this.removeImage(a);d=c in e.LoaderParser?e.LoaderParser[c](d):d;c={key:a,url:b,data:d,base:new PIXI.BaseTexture(d,null,this.game.resolution),frame:new e.Frame(0,0,0,d.width,d.height,a),frameData:new e.FrameData,fileFormat:c};return c.frameData.addFrame(new e.Frame(0,0,0,d.width,d.height,b)),this._cache.image[a]=c,this._resolveURL(b,c),c},addCanvas:function(a,b,c){void 0===c&&(c=b.getContext("2d"));this._cache.canvas[a]={canvas:b,context:c}},addImage:function(a,b,c){this.checkImageKey(a)&&
this.removeImage(a);!1===c.complete&&console.warn('Phaser.Cache.addImage: Image "%s" is not complete',a);var d={key:a,url:b,data:c,base:new PIXI.BaseTexture(c,null,this.game.resolution),frame:new e.Frame(0,0,0,c.width,c.height,a),frameData:new e.FrameData};return d.frameData.addFrame(new e.Frame(0,0,0,c.width,c.height,b)),this._cache.image[a]=d,this._resolveURL(b,d),"__default"===a?e.Cache.DEFAULT=new PIXI.Texture(d.base):"__missing"===a&&(e.Cache.MISSING=new PIXI.Texture(d.base)),d},addImageAsync:function(a,
b,c){var d=this,f=new Image;f.onload=function(){c.call(this,d.addImage(a,null,f));d._removePending();f.onload=null};this._addPending();f.src=b},addDefaultImage:function(){this.addImageAsync(e.Cache.DEFAULT_KEY,e.Cache.DEFAULT_SRC,function(a){a.base.skipRender=!0;e.Cache.DEFAULT=new PIXI.Texture(a.base)})},addMissingImage:function(){this.addImageAsync(e.Cache.MISSING_KEY,e.Cache.MISSING_SRC,function(a){e.Cache.MISSING=new PIXI.Texture(a.base)})},addSound:function(a,b,c,d,f){void 0===d&&(f=!(d=!0));
void 0===f&&(f=!(d=!1));var g=!1;f&&(g=!0);this._cache.sound[a]={url:b,data:c,isDecoding:!1,decoded:g,webAudio:d,audioTag:f,locked:this.game.sound.touchLocked};this._resolveURL(b,this._cache.sound[a])},addText:function(a,b,c){this._cache.text[a]={url:b,data:c};this._resolveURL(b,this._cache.text[a])},addPhysicsData:function(a,b,c,d){this._cache.physics[a]={url:b,data:c,format:d};this._resolveURL(b,this._cache.physics[a])},addTilemap:function(a,b,c,d){this._cache.tilemap[a]={url:b,data:c,format:d};
this._resolveURL(b,this._cache.tilemap[a])},addBinary:function(a,b){this._cache.binary[a]=b},addBitmapData:function(a,b,c){return b.key=a,void 0===c&&(c=new e.FrameData).addFrame(b.textureFrame),this._cache.bitmapData[a]={data:b,frameData:c},b},addBitmapFont:function(a,b,c,d,f,g,h){c={url:b,data:c,font:null,base:new PIXI.BaseTexture(c,null,this.game.resolution)};void 0===g&&(g=0);void 0===h&&(h=0);c.font="json"===f?e.LoaderParser.jsonBitmapFont(d,c.base,g,h,!1,this.game.resolution):e.LoaderParser.xmlBitmapFont(d,
c.base,g,h,!1,this.game.resolution);this._cache.bitmapFont[a]=c;this._resolveURL(b,c)},addBitmapFontFromAtlas:function(a,b,c,d,f,g,h){if(c=this.getFrameByName(b,c)){var m;b={font:null,base:this.getBaseTexture(b),frame:c};void 0===g&&(g=0);void 0===h&&(h=0);"json"===f?(m=this.getJSON(d),b.font=e.LoaderParser.jsonBitmapFont(m,b.base,g,h,c,this.game.resolution)):(m=this.getXML(d),b.font=e.LoaderParser.xmlBitmapFont(m,b.base,g,h,c,this.game.resolution));this._cache.bitmapFont[a]=b}},addJSON:function(a,
b,c){this._cache.json[a]={url:b,data:c};this._resolveURL(b,this._cache.json[a])},addXML:function(a,b,c){this._cache.xml[a]={url:b,data:c};this._resolveURL(b,this._cache.xml[a])},addVideo:function(a,b,c,d){this._cache.video[a]={url:b,data:c,isBlob:d,locked:!0};this._resolveURL(b,this._cache.video[a])},addShader:function(a,b,c){this._cache.shader[a]={url:b,data:c};this._resolveURL(b,this._cache.shader[a])},addRenderTexture:function(a,b){this._cache.renderTexture[a]={texture:b,frame:new e.Frame(0,0,
0,b.width,b.height,"","")}},addSpriteSheet:function(a,b,c,d,f,g,h,m,n){void 0===g&&(g=-1);void 0===h&&(h=0);void 0===m&&(m=0);c={key:a,url:b,data:c,frameWidth:d,frameHeight:f,margin:h,spacing:m,base:new PIXI.BaseTexture(c,null,this.game.resolution),frameData:e.AnimationParser.spriteSheet(this.game,c,d,f,g,h,m,n)};this._cache.image[a]=c;this._resolveURL(b,c)},addTextureAtlas:function(a,b,c,d,f){c={key:a,url:b,data:c,base:new PIXI.BaseTexture(c,null,this.game.resolution)};f===e.Loader.TEXTURE_ATLAS_XML_STARLING?
c.frameData=e.AnimationParser.XMLData(this.game,d,a):f===e.Loader.TEXTURE_ATLAS_JSON_PYXEL?c.frameData=e.AnimationParser.JSONDataPyxel(this.game,d,a):Array.isArray(d.frames)?c.frameData=e.AnimationParser.JSONData(this.game,d,a):c.frameData=e.AnimationParser.JSONDataHash(this.game,d,a);this._cache.image[a]=c;this._resolveURL(b,c)},addData:function(a,b){this._cache.data[a]=b},reloadSound:function(a){var b=this,c=this.getSound(a);c&&(c.data.src=c.url,c.data.addEventListener("canplaythrough",function(){return b.reloadSoundComplete(a)},
!1),c.data.load())},reloadSoundComplete:function(a){var b=this.getSound(a);b&&(b.locked=!1,this.onSoundUnlock.dispatch(a))},updateSound:function(a,b,c){(a=this.getSound(a))&&(a[b]=c)},decodedSound:function(a,b){a=this.getSound(a);a.data=b;a.decoded=!0;a.isDecoding=!1},isSoundDecoded:function(a){if(a=this.getItem(a,e.Cache.SOUND,"isSoundDecoded"))return a.decoded},isSoundReady:function(a){if(a=this.getItem(a,e.Cache.SOUND,"isSoundDecoded"))return a.decoded&&!this.game.sound.touchLocked},checkKey:function(a,
b){return!!this._cacheMap[a][b]},checkURL:function(a){return!!this._urlMap[this._resolveURL(a)]},checkCanvasKey:function(a){return this.checkKey(e.Cache.CANVAS,a)},checkDataKey:function(a){return this.checkKey(e.Cache.DATA,a)},checkImageKey:function(a){return this.checkKey(e.Cache.IMAGE,a)},checkTextureKey:function(a){return this.checkKey(e.Cache.TEXTURE,a)},checkSoundKey:function(a){return this.checkKey(e.Cache.SOUND,a)},checkTextKey:function(a){return this.checkKey(e.Cache.TEXT,a)},checkPhysicsKey:function(a){return this.checkKey(e.Cache.PHYSICS,
a)},checkTilemapKey:function(a){return this.checkKey(e.Cache.TILEMAP,a)},checkBinaryKey:function(a){return this.checkKey(e.Cache.BINARY,a)},checkBitmapDataKey:function(a){return this.checkKey(e.Cache.BITMAPDATA,a)},checkBitmapFontKey:function(a){return this.checkKey(e.Cache.BITMAPFONT,a)},checkJSONKey:function(a){return this.checkKey(e.Cache.JSON,a)},checkXMLKey:function(a){return this.checkKey(e.Cache.XML,a)},checkVideoKey:function(a){return this.checkKey(e.Cache.VIDEO,a)},checkShaderKey:function(a){return this.checkKey(e.Cache.SHADER,
a)},checkRenderTextureKey:function(a){return this.checkKey(e.Cache.RENDER_TEXTURE,a)},getItem:function(a,b,c,d){return this.checkKey(b,a)?void 0===d?this._cacheMap[b][a]:this._cacheMap[b][a][d]:(c&&console.warn("Phaser.Cache."+c+': Key "'+a+'" not found in Cache.'),null)},getCanvas:function(a){return this.getItem(a,e.Cache.CANVAS,"getCanvas","canvas")},getImage:function(a,b){null==a&&(a="__default");void 0===b&&(b=!1);a=this.getItem(a,e.Cache.IMAGE,"getImage");return null===a&&(a=this.getItem("__missing",
e.Cache.IMAGE,"getImage")),b?a:a.data},getTextureFrame:function(a){return this.getItem(a,e.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(a){return this.getItem(a,e.Cache.SOUND,"getSound")},getSoundData:function(a){return this.getItem(a,e.Cache.SOUND,"getSoundData","data")},getText:function(a){return this.getItem(a,e.Cache.TEXT,"getText","data")},getPhysicsData:function(a,b,c){var d=this.getItem(a,e.Cache.PHYSICS,"getPhysicsData","data");if(null===d||null==b)return d;if(d[b]){b=d[b];
if(!b||!c)return b;for(var f in b)if((f=b[f]).fixtureKey===c)return f;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+c+" in "+a+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+a+" / "+b+'"');return null},getTilemapData:function(a){return this.getItem(a,e.Cache.TILEMAP,"getTilemapData")},getBinary:function(a){return this.getItem(a,e.Cache.BINARY,"getBinary")},getBitmapData:function(a){return this.getItem(a,e.Cache.BITMAPDATA,"getBitmapData",
"data")},getBitmapFont:function(a){return this.getItem(a,e.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(a,b){return(a=this.getItem(a,e.Cache.JSON,"getJSON","data"))?b?e.Utils.extend(!0,Array.isArray(a)?[]:{},a):a:null},getXML:function(a){return this.getItem(a,e.Cache.XML,"getXML","data")},getVideo:function(a){return this.getItem(a,e.Cache.VIDEO,"getVideo")},getShader:function(a){return this.getItem(a,e.Cache.SHADER,"getShader","data")},getRenderTexture:function(a){return this.getItem(a,e.Cache.RENDER_TEXTURE,
"getRenderTexture")},getData:function(a){return this.getItem(a,e.Cache.DATA,"getData")},getBaseTexture:function(a,b){return void 0===b&&(b=e.Cache.IMAGE),this.getItem(a,b,"getBaseTexture","base")},getFrame:function(a,b){return void 0===b&&(b=e.Cache.IMAGE),this.getItem(a,b,"getFrame","frame")},getFrameCount:function(a,b){return(a=this.getFrameData(a,b))?a.total:0},getFrameData:function(a,b){return void 0===b&&(b=e.Cache.IMAGE),this.getItem(a,b,"getFrameData","frameData")},hasFrameData:function(a,
b){return void 0===b&&(b=e.Cache.IMAGE),null!==this.getItem(a,b,"","frameData")},updateFrameData:function(a,b,c){void 0===c&&(c=e.Cache.IMAGE);this._cacheMap[c][a]&&(this._cacheMap[c][a].frameData=b)},getFrameByIndex:function(a,b,c){return(a=this.getFrameData(a,c))?a.getFrame(b):null},getFrameByName:function(a,b,c){return(a=this.getFrameData(a,c))?a.getFrameByName(b):null},getURL:function(a){return(a=this._resolveURL(a))?this._urlMap[a]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+a+'" or Cache.autoResolveURL was false'),
null)},getKeys:function(a){void 0===a&&(a=e.Cache.IMAGE);var b=[];if(this._cacheMap[a])for(var c in this._cacheMap[a])"__default"!==c&&"__missing"!==c&&b.push(c);return b},removeCanvas:function(a){delete this._cache.canvas[a]},removeImage:function(a,b){void 0===b&&(b=!0);var c=this.getImage(a,!0);b&&c.base&&c.base.destroy();delete this._cache.image[a]},removeSound:function(a){delete this._cache.sound[a]},removeText:function(a){delete this._cache.text[a]},removePhysics:function(a){delete this._cache.physics[a]},
removeTilemap:function(a){delete this._cache.tilemap[a]},removeBinary:function(a){delete this._cache.binary[a]},removeBitmapData:function(a){delete this._cache.bitmapData[a]},removeBitmapFont:function(a){delete this._cache.bitmapFont[a]},removeJSON:function(a){delete this._cache.json[a]},removeXML:function(a){delete this._cache.xml[a]},removeVideo:function(a){delete this._cache.video[a]},removeShader:function(a){delete this._cache.shader[a]},removeRenderTexture:function(a){delete this._cache.renderTexture[a]},
removeSpriteSheet:function(a){delete this._cache.spriteSheet[a]},removeTextureAtlas:function(a){delete this._cache.image[a]},removeData:function(a){delete this._cache.data[a]},clearGLTextures:function(){for(var a in this._cache.image)this._cache.image[a].base._glTextures=[]},_resolveURL:function(a,b){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+a,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",b&&(this._urlMap[this._urlTemp]=b),this._urlTemp):null},destroy:function(){for(var a=
0;a<this._cacheMap.length;a++){var b=this._cacheMap[a],c;for(c in b)"__default"!==c&&"__missing"!==c&&(this.destroyItem(b[c]),delete b[c])}this._urlTemp=this._urlResolver=this._urlMap=null},destroyItem:function(a){a.destroy?a.destroy():(a.base&&a.base.destroy&&a.base.destroy(),a.data&&a.data.destroy&&a.data.destroy(),a.frameData&&a.frameData.destroy&&a.frameData.destroy(),a.texture&&a.texture.destroy&&a.texture.destroy(!0))},_addImages:function(){this._pendingCount=0;this.addDefaultImage();this.addMissingImage();
var a=this,b=e.Cache.READY_TIMEOUT;0<e.Cache.READY_TIMEOUT?setTimeout(function(){a.isReady||(console.warn("Phaser.Cache: Still waiting for images after %s ms.",b),a._ready())},e.Cache.READY_TIMEOUT):this._ready()},_addPending:function(){this._pendingCount+=1},_removePending:function(){--this._pendingCount;this._checkReady()},_checkReady:function(){this.isReady&&this._ready()},_ready:function(){this._pendingCount=0;this.onReady.dispatch(this)}},e.Cache.prototype.constructor=e.Cache,Object.defineProperty(e.Cache.prototype,
"isReady",{get:function(){return 0>=this._pendingCount}}),e.Loader=function(a){this.game=a;this.cache=a.cache;this.hasLoaded=this.isLoading=this.resetLocked=!1;this.preloadSprite=null;this.crossOrigin=!1;this.path=this.baseURL="";this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"};this.onLoadStart=new e.Signal;this.onBeforeLoadComplete=new e.Signal;this.onLoadComplete=new e.Signal;this.onPackComplete=new e.Signal;this.onFileStart=new e.Signal;this.onFileComplete=new e.Signal;
this.onFileError=new e.Signal;this.enableParallel=!0;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=!1;this._loadedFileCount=this._loadedPackCount=this._totalFileCount=this._totalPackCount=0},e.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,e.Loader.TEXTURE_ATLAS_JSON_HASH=1,e.Loader.TEXTURE_ATLAS_XML_STARLING=2,e.Loader.PHYSICS_LIME_CORONA_JSON=3,e.Loader.PHYSICS_PHASER_JSON=4,e.Loader.TEXTURE_ATLAS_JSON_PYXEL=5,e.Loader.mediaTypes=
{avif:"image/avif",bmp:"image/bmp",cur:"image/x-icon",gif:"image/gif",ico:"image/x-icon",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",webp:"image/webp"},e.Loader.getMediaType=function(a){return(a=a.match(/\.(\w+)$/))&&e.Loader.mediaTypes[a[1]]||null},e.Loader._getSource=function(a){return"string"==typeof a?{url:a,type:e.Loader.getMediaType(a)}:a},e.Loader.prototype={setPreloadSprite:function(a,b){b=b||0;this.preloadSprite={sprite:a,direction:b,
width:a.width,height:a.height,rect:null};this.preloadSprite.rect=0===b?new e.Rectangle(0,0,1,a.height):new e.Rectangle(0,0,a.width,1);a.crop(this.preloadSprite.rect);a.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(a,b){return-1<this.getAssetIndex(a,b)},getAssetIndex:function(a,b){for(var c=-1,d=0;d<this._fileList.length;d++){var f=this._fileList[d];
if(f.type===a&&f.key===b&&(c=d,!f.loaded&&!f.loading))break}return c},getAsset:function(a,b){a=this.getAssetIndex(a,b);return-1<a&&{index:a,file:this._fileList[a]}},reset:function(a,b){void 0===b&&(b=!1);this.resetLocked||(a&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,b&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),
this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(a,b,c,d,f,g){if(void 0===f&&(f=!1),void 0===b||""===b)return console.warn("Phaser.Loader: Invalid or no key given of type "+a),this;if(null==c){if(!g)return console.warn("Phaser.Loader: No URL given for file type: "+a+" key: "+b),this;c=b+g}c={type:a,key:b,path:this.path,url:c,syncPoint:0<this._withSyncPointDepth,data:null,loading:!1,loaded:!1,error:!1};
if(d)for(var h in d)c[h]=d[h];a=this.getAssetIndex(a,b);f&&-1<a?(f=this._fileList[a],f.loading||f.loaded?(this._fileList.push(c),this._totalFileCount++):this._fileList[a]=c):-1===a&&(this._fileList.push(c),this._totalFileCount++);return this},replaceInFileList:function(a,b,c,d){return this.addToFileList(a,b,c,d,!0)},pack:function(a,b,c,d){if(void 0===b&&(b=null),void 0===c&&(c=null),void 0===d&&(d=null),!b&&!c)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),
this;a={type:"packfile",key:a,url:b,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:d};c&&("string"==typeof c&&(c=JSON.parse(c)),a.data=c||{},a.loaded=!0);for(c=0;c<this._fileList.length+1;c++)if(b=this._fileList[c],!b||!b.loaded&&!b.loading&&"packfile"!==b.type){this._fileList.splice(c,0,a);this._totalPackCount++;break}return this},image:function(a,b,c){return Array.isArray(b)?this.imageset(a,b,c):"object"==typeof b?this.texture(a,b,c):this.addToFileList("image",
a,b,void 0,c,".png")},imageset:function(a,b,c){var d=b[b.length-1];return this.addToFileList("imageset",a,"string"==typeof d?d:d.url,{sources:b},c)},imageFromBitmapData:function(a,b,c){return this.image(a,b.canvas.toDataURL("image/png"),c)},imageFromGrid:function(a,b,c,d,f,g){return this.imageFromBitmapData(a,this.game.create.grid(a,b,c,d,f,g,!1))},imageFromTexture:function(a,b,c,d,f){return this.imageFromBitmapData(a,this.game.create.texture(a,b,c,d,f,!1))},texture:function(a,b,c){if(this.game.renderType===
e.WEBGL){var d,f=this.game.renderer.extensions.compression;for(d in b)if(d.toUpperCase()in f)return this.addToFileList("texture",a,b[d],void 0,c,".pvr")}return b.truecolor&&this.addToFileList("image",a,b.truecolor,void 0,c,".png"),this},images:function(a,b){if(Array.isArray(b))for(var c=0;c<a.length;c++)this.image(a[c],b[c]);else for(c=0;c<a.length;c++)this.image(a[c]);return this},text:function(a,b,c){return this.addToFileList("text",a,b,void 0,c,".txt")},json:function(a,b,c){return this.addToFileList("json",
a,b,void 0,c,".json")},shader:function(a,b,c){return this.addToFileList("shader",a,b,void 0,c,".frag")},xml:function(a,b,c){return this.addToFileList("xml",a,b,void 0,c,".xml")},script:function(a,b,c,d){return void 0===c&&(c=!1),!1!==c&&void 0===d&&(d=this),this.addToFileList("script",a,b,{syncPoint:!0,callback:c,callbackContext:d},!1,".js")},binary:function(a,b,c,d){return void 0===c&&(c=!1),!1!==c&&void 0===d&&(d=c),this.addToFileList("binary",a,b,{callback:c,callbackContext:d},!1,".bin")},spritesheet:function(a,
b,c,d,f,g,h,m){return void 0===f&&(f=-1),void 0===g&&(g=0),void 0===h&&(h=0),void 0===m&&(m=0),this.addToFileList("spritesheet",a,b,{frameWidth:c,frameHeight:d,frameMax:f,margin:g,spacing:h,skipFrames:m},!1,".png")},audio:function(a,b,c){return this.game.sound.noAudio?this:(void 0===c&&(c=!0),"string"==typeof b&&(b=[b]),this.addToFileList("audio",a,b,{buffer:null,autoDecode:c}))},audioSprite:function(a,b,c,d,f){return this.game.sound.noAudio||(void 0===c&&(c=null),void 0===d&&(d=null),void 0===f&&
(f=!0),this.audio(a,b,f),c?this.json(a+"-audioatlas",c):d?("string"==typeof d&&(d=JSON.parse(d)),this.cache.addJSON(a+"-audioatlas","",d)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")),this},audiosprite:function(a,b,c,d,f){return this.audioSprite(a,b,c,d,f)},video:function(a,b,c,d){return void 0===c&&(c=this.game.device.firefox?"loadeddata":"canplaythrough"),void 0===d&&(d=!1),"string"==typeof b&&(b=[b]),this.addToFileList("video",a,b,
{buffer:null,asBlob:d,loadEvent:c})},tilemap:function(a,b,c,d){if(void 0===b&&(b=null),void 0===c&&(c=null),void 0===d&&(d=e.Tilemap.CSV),b||c||(b=d===e.Tilemap.CSV?a+".csv":a+".json"),c){switch(d){case e.Tilemap.TILED_JSON:"string"==typeof c&&(c=JSON.parse(c))}this.cache.addTilemap(a,null,c,d)}else this.addToFileList("tilemap",a,b,{format:d});return this},tilemapCSV:function(a,b,c){return this.tilemap(a,b,c,e.Tilemap.CSV)},tilemapTiledJSON:function(a,b,c){return this.tilemap(a,b,c,e.Tilemap.TILED_JSON)},
physics:function(a,b,c,d){return void 0===b&&(b=null),void 0===c&&(c=null),void 0===d&&(d=e.Physics.LIME_CORONA_JSON),b||c||(b=a+".json"),c?("string"==typeof c&&(c=JSON.parse(c)),this.cache.addPhysicsData(a,null,c,d)):this.addToFileList("physics",a,b,{format:d}),this},bitmapFont:function(a,b,c,d,f,g){if(null==b&&(b=a+".png"),void 0===c&&(c=null),void 0===d&&(d=null),null===c&&null===d&&(c=a+".xml"),void 0===f&&(f=0),void 0===g&&(g=0),c)this.addToFileList("bitmapfont",a,b,{atlasURL:c,xSpacing:f,ySpacing:g});
else if("string"==typeof d){try{var h=JSON.parse(d)}catch(n){var m=this.parseXml(d)}if(!m&&!h)throw Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",a,b,{atlasURL:null,atlasData:h||m,atlasType:h?"json":"xml",xSpacing:f,ySpacing:g})}return this},atlasJSONArray:function(a,b,c,d){return this.atlas(a,b,c,d,e.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(a,b,c,d){return this.atlas(a,b,c,d,e.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(a,b,c,d){return void 0===
c&&(c=null),void 0===d&&(d=null),c||d||(c=a+".xml"),this.atlas(a,b,c,d,e.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(a,b,c,d,f){if(null==b&&(b=a+".png"),void 0===c&&(c=null),void 0===d&&(d=null),void 0===f&&(f=e.Loader.TEXTURE_ATLAS_JSON_ARRAY),c||d||(c=f===e.Loader.TEXTURE_ATLAS_XML_STARLING?a+".xml":a+".json"),c)this.addToFileList("textureatlas",a,b,{atlasURL:c,format:f});else{switch(f){case e.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof d&&(d=JSON.parse(d));break;case e.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==
typeof d){c=this.parseXml(d);if(!c)throw Error("Phaser.Loader. Invalid Texture Atlas XML given");d=c}}this.addToFileList("textureatlas",a,b,{atlasURL:null,atlasData:d,format:f})}return this},withSyncPoint:function(a,b){this._withSyncPointDepth++;try{a.call(b||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(a,b){a=this.getAsset(a,b);return a&&(a.file.syncPoint=!0),this},removeFile:function(a,b){(a=this.getAsset(a,b))&&(a.loaded||a.loading||this._fileList.splice(a.index,
1))},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(this.game.isBooted){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(var a=0;a<this._flightQueue.length;a++)((d=this._flightQueue[a]).loaded||d.error)&&(this._flightQueue.splice(a,1),a--,d.loading=!1,
d.requestUrl=null,d.requestObject=null,d.error&&this.onFileError.dispatch(d.key,d),"packfile"!==d.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,d.key,!d.error,this._loadedFileCount,this._totalFileCount)):"packfile"===d.type&&d.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(d.key,!d.error,this._loadedPackCount,this._totalPackCount)));var b=!1,c=this.enableParallel?Math.max(1,this.maxParallelDownloads):1;for(a=this._processingHead;a<this._fileList.length;a++){var d;
if("packfile"===(d=this._fileList[a]).type&&!d.error&&d.loaded&&a===this._processingHead&&(this.processPack(d),this._loadedPackCount++,this.onPackComplete.dispatch(d.key,!d.error,this._loadedPackCount,this._totalPackCount)),d.loaded||d.error?a===this._processingHead&&(this._processingHead=a+1):!d.loading&&this._flightQueue.length<c&&("packfile"!==d.type||d.data?b||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(d),d.loading=!0,this.onFileStart.dispatch(this.progress,
d.key,d.url),this.loadFile(d)):(this._flightQueue.push(d),d.loading=!0,this.loadFile(d))),!d.loaded&&d.syncPoint&&(b=!0),this._flightQueue.length>=c||b&&this._loadedPackCount===this._totalPackCount)break}if(this.updateProgress(),this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var f=this;setTimeout(function(){f.finishedLoading(!0)},2E3)}}},finishedLoading:function(a){!this.hasLoaded&&
this.game.state&&(this.hasLoaded=!0,this.isLoading=!1,a||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.game.state.loadUpdate(),this.onBeforeLoadComplete.dispatch(),this.reset(),this.onLoadComplete.dispatch(),this.game.state.loadComplete())},asyncComplete:function(a,b){void 0===b&&(b="");a.loaded=!0;a.error=!!b;b&&(a.errorMessage=b,console.warn("Phaser.Loader - "+a.type+"["+a.key+"]: "+b));this.processLoadQueue()},processPack:function(a){var b=a.data[a.key];if(b)for(var c=
0;c<b.length;c++){var d=b[c];switch(d.type){case "image":this.image(d.key,d.url,d.overwrite);break;case "text":this.text(d.key,d.url,d.overwrite);break;case "json":this.json(d.key,d.url,d.overwrite);break;case "xml":this.xml(d.key,d.url,d.overwrite);break;case "script":this.script(d.key,d.url,d.callback,a.callbackContext||this);break;case "binary":this.binary(d.key,d.url,d.callback,a.callbackContext||this);break;case "spritesheet":this.spritesheet(d.key,d.url,d.frameWidth,d.frameHeight,d.frameMax,
d.margin,d.spacing,d.skipFrames);break;case "video":this.video(d.key,d.urls);break;case "audio":this.audio(d.key,d.urls,d.autoDecode);break;case "audiosprite":this.audiosprite(d.key,d.urls,d.jsonURL,d.jsonData,d.autoDecode);break;case "tilemap":this.tilemap(d.key,d.url,d.data,e.Tilemap[d.format]);break;case "physics":this.physics(d.key,d.url,d.data,e.Loader[d.format]);break;case "bitmapFont":this.bitmapFont(d.key,d.textureURL,d.atlasURL,d.atlasData,d.xSpacing,d.ySpacing);break;case "atlasJSONArray":this.atlasJSONArray(d.key,
d.textureURL,d.atlasURL,d.atlasData);break;case "atlasJSONHash":this.atlasJSONHash(d.key,d.textureURL,d.atlasURL,d.atlasData);break;case "atlasXML":this.atlasXML(d.key,d.textureURL,d.atlasURL,d.atlasData);break;case "atlas":this.atlas(d.key,d.textureURL,d.atlasURL,d.atlasData,e.Loader[d.format]);break;case "shader":this.shader(d.key,d.url,d.overwrite)}}else console.warn("Phaser.Loader - "+a.key+": pack has data, but not for pack key")},transformUrl:function(a,b){return!!a&&(a.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?
a:this.baseURL+b.path+a)},loadFile:function(a){switch(a.type){case "packfile":this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.fileComplete);break;case "image":case "spritesheet":case "textureatlas":case "bitmapfont":this.loadImageTag(a);break;case "imageset":this.loadPictureTag(a);break;case "audio":a.url=this.getAudioURL(a.url);a.url?this.game.sound.usingWebAudio?this.xhrLoad(a,this.transformUrl(a.url,a),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(a):this.fileError(a,
null,"No supported audio URL specified or device does not have audio playback support");break;case "video":a.url=this.getVideoURL(a.url);a.url?a.asBlob?this.xhrLoad(a,this.transformUrl(a.url,a),"blob",this.fileComplete):this.loadVideoTag(a):this.fileError(a,null,"No supported video URL specified or device does not have video playback support");break;case "json":this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.jsonLoadComplete);break;case "xml":this.xhrLoad(a,this.transformUrl(a.url,a),"text",
this.xmlLoadComplete);break;case "tilemap":a.format===e.Tilemap.TILED_JSON?this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.jsonLoadComplete):a.format===e.Tilemap.CSV?this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.csvLoadComplete):this.asyncComplete(a,"invalid Tilemap format: "+a.format);break;case "text":case "script":case "shader":case "physics":this.xhrLoad(a,this.transformUrl(a.url,a),"text",this.fileComplete);break;case "texture":"truecolor"===a.key.split("_").pop()?this.loadImageTag(a):
this.xhrLoad(a,this.transformUrl(a.url,a),"arraybuffer",this.fileComplete);break;case "binary":this.xhrLoad(a,this.transformUrl(a.url,a),"arraybuffer",this.fileComplete)}},loadImageTag:function(a){var b=this;a.data=new Image;a.data.name=a.key;this.crossOrigin&&(a.data.crossOrigin=this.crossOrigin);a.data.onload=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,b.fileComplete(a))};a.data.onerror=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,b.fileError(a))};a.data.src=
this.transformUrl(a.url,a);a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,this.fileComplete(a))},loadPictureTag:function(a){for(var b=this,c=document.createElement("picture"),d=a.sources,f=e.Loader._getSource(d.pop()),g=0,h=d.length;g<h;g++){var m=e.Loader._getSource(d[g]);m.type&&m.url||console.warn('Skipping an invalid source for image "%s" (url: "%s", type: "%s")',a.key,m.url,m.type);var n=document.createElement("source");n.setAttribute("type",m.type);n.setAttribute("srcset",
this.transformUrl(m.url,a));c.appendChild(n)}a.data=document.createElement("img");a.data.name=a.key;this.crossOrigin&&(a.data.crossOrigin=this.crossOrigin);a.data.onload=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,a.url=a.data.currentSrc,b.fileComplete(a))};a.data.onerror=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,a.url=a.data.currentSrc,b.fileError(a))};c.appendChild(a.data);a.data.src=this.transformUrl(f.url,a);a.data.complete&&a.data.width&&a.data.height&&
(a.data.onload=null,a.data.onerror=null,this.fileComplete(a))},loadVideoTag:function(a){var b=this;a.data=document.createElement("video");a.data.name=a.key;a.data.crossOrigin=this.crossOrigin;a.data.controls=!1;a.data.autoplay=!1;a.data.playsInline=!0;var c=function(){a.data.removeEventListener(a.loadEvent,c,!1);a.data.onerror=null;a.data.canplay=!0;b.game.load.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener(a.loadEvent,c,!1);a.data.onerror=null;a.data.canplay=!1;b.fileError(a)};
a.data.addEventListener(a.loadEvent,c,!1);a.data.src=this.transformUrl(a.url,a);a.data.load()},loadAudioTag:function(a){var b=this;if(this.game.sound.touchLocked)a.data=new Audio,a.data.name=a.key,a.data.preload="auto",a.data.src=this.transformUrl(a.url,a),this.fileComplete(a);else{a.data=new Audio;a.data.name=a.key;var c=function(){a.data.removeEventListener("canplaythrough",c,!1);a.data.onerror=null;b.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener("canplaythrough",c,!1);a.data.onerror=
null;b.fileError(a)};a.data.preload="auto";a.data.src=this.transformUrl(a.url,a);a.data.addEventListener("canplaythrough",c,!1);a.data.load()}},xhrLoad:function(a,b,c,d,f){var g=new XMLHttpRequest;g.open("GET",b,!0);g.responseType=c;!1!==this.headers.requestedWith&&g.setRequestHeader("X-Requested-With",this.headers.requestedWith);this.headers[a.type]&&g.setRequestHeader("Accept",this.headers[a.type]);f=f||this.fileError;var h=this;g.onload=function(){try{return 4===g.readyState&&400<=g.status&&599>=
g.status?f.call(h,a,g):d.call(h,a,g)}catch(m){h.hasLoaded?console.error(m):h.asyncComplete(a,m.message||"Exception")}};g.onerror=function(){try{return f.call(h,a,g)}catch(m){h.hasLoaded?console.error(m):h.asyncComplete(a,m.message||"Exception")}};a.requestObject=g;a.requestUrl=b;g.send()},getVideoURL:function(a){for(var b=0;b<a.length;b++){var c,d=a[b];if(d.uri){if(c=d.type,d=d.uri,this.game.device.canPlayVideo(c))return d}else{if(0===d.indexOf("blob:")||0===d.indexOf("data:"))return d;if(0<=d.indexOf("?")&&
(d=d.substr(0,d.indexOf("?"))),c=d.substr((Math.max(0,d.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayVideo(c))return a[b]}}return null},getAudioURL:function(a){if(this.game.sound.noAudio)return null;for(var b=0;b<a.length;b++){var c,d=a[b];if(d.uri){if(c=d.type,d=d.uri,this.game.device.canPlayAudio(c))return d}else{if(0===d.indexOf("blob:")||0===d.indexOf("data:"))return d;if(0<=d.indexOf("?")&&(d=d.substr(0,d.indexOf("?"))),c=d.substr((Math.max(0,d.lastIndexOf("."))||1/0)+1).toLowerCase(),
this.game.device.canPlayAudio(c))return a[b]}}return null},fileError:function(a,b,c){var d="error loading asset from URL "+(a.requestUrl||this.transformUrl(a.url,a));!c&&b&&(c=b.status);c&&(d=d+" ("+c+")");this.asyncComplete(a,d)},fileComplete:function(a,b){if(this.game.isBooted){var c=!0;switch(a.type){case "packfile":b=JSON.parse(b.responseText);a.data=b||{};break;case "texture":var d=/\.([^.]+)$/.exec(a.url.split("?",1)[0])[1].toLowerCase();null!==a.data?this.cache.addCompressedTextureMetaData(a.key,
a.url,d,a.data):this.cache.addCompressedTextureMetaData(a.key,a.url,d,b.response);break;case "image":case "imageset":this.cache.addImage(a.key,a.url,a.data);break;case "spritesheet":this.cache.addSpriteSheet(a.key,a.url,a.data,a.frameWidth,a.frameHeight,a.frameMax,a.margin,a.spacing,a.skipFrames);break;case "textureatlas":if(null==a.atlasURL)this.cache.addTextureAtlas(a.key,a.url,a.data,a.atlasData,a.format);else if(c=!1,a.format===e.Loader.TEXTURE_ATLAS_JSON_ARRAY||a.format===e.Loader.TEXTURE_ATLAS_JSON_HASH||
a.format===e.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",this.jsonLoadComplete);else{if(a.format!==e.Loader.TEXTURE_ATLAS_XML_STARLING)throw Error("Phaser.Loader. Invalid Texture Atlas format: "+a.format);this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",this.xmlLoadComplete)}break;case "bitmapfont":a.atlasURL?(c=!1,this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",function(f,g){try{var h=JSON.parse(g.responseText)}catch(m){}h?(f.atlasType="json",
this.jsonLoadComplete(f,g)):(f.atlasType="xml",this.xmlLoadComplete(f,g))})):this.cache.addBitmapFont(a.key,a.url,a.data,a.atlasData,a.atlasType,a.xSpacing,a.ySpacing);break;case "video":if(a.asBlob)try{a.data=b.response}catch(f){throw Error("Phaser.Loader. Unable to parse video file as Blob: "+a.key);}this.cache.addVideo(a.key,a.url,a.data,a.asBlob);break;case "audio":this.game.sound.usingWebAudio?(a.data=b.response,this.cache.addSound(a.key,a.url,a.data,!0,!1),a.autoDecode&&this.game.sound.decode(a.key)):
this.cache.addSound(a.key,a.url,a.data,!1,!0);break;case "text":a.data=b.responseText;this.cache.addText(a.key,a.url,a.data);break;case "shader":a.data=b.responseText;this.cache.addShader(a.key,a.url,a.data);break;case "physics":b=JSON.parse(b.responseText);this.cache.addPhysicsData(a.key,a.url,b,a.format);break;case "script":a.data=document.createElement("script");a.data.language="javascript";a.data.type="text/javascript";a.data.defer=!1;a.data.text=b.responseText;document.head.appendChild(a.data);
a.callback&&(a.data=a.callback.call(a.callbackContext,a.key,b.responseText));break;case "binary":a.callback?a.data=a.callback.call(a.callbackContext,a.key,b.response):a.data=b.response,this.cache.addBinary(a.key,a.data)}c&&this.asyncComplete(a)}},jsonLoadComplete:function(a,b){b=JSON.parse(b.responseText);"tilemap"===a.type?this.cache.addTilemap(a.key,a.url,b,a.format):"bitmapfont"===a.type?this.cache.addBitmapFont(a.key,a.url,a.data,b,a.atlasType,a.xSpacing,a.ySpacing):"json"===a.type?this.cache.addJSON(a.key,
a.url,b):this.cache.addTextureAtlas(a.key,a.url,a.data,b,a.format);this.asyncComplete(a)},csvLoadComplete:function(a,b){this.cache.addTilemap(a.key,a.url,b.responseText,a.format);this.asyncComplete(a)},xmlLoadComplete:function(a,b){var c=this.parseXml(b.responseText);if(!c)return console.warn("Phaser.Loader - "+a.key+": invalid XML ("+(b.responseType||b.contentType)+")"),void this.asyncComplete(a,"invalid XML");"bitmapfont"===a.type?this.cache.addBitmapFont(a.key,a.url,a.data,c,a.atlasType,a.xSpacing,
a.ySpacing):"textureatlas"===a.type?this.cache.addTextureAtlas(a.key,a.url,a.data,c,a.format):"xml"===a.type&&this.cache.addXML(a.key,a.url,c);this.asyncComplete(a)},parseXml:function(a){try{if(window.DOMParser)var b=(new DOMParser).parseFromString(a,"text/xml");else(b=new ActiveXObject("Microsoft.XMLDOM")).async="false",b.loadXML(a)}catch(c){b=null}return b&&b.documentElement&&!b.getElementsByTagName("parsererror").length?b:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?
this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-
this._loadedPackCount}},Object.defineProperty(e.Loader.prototype,"progressFloat",{get:function(){return e.Math.clamp(this._loadedFileCount/this._totalFileCount*100||0,0,100)}}),Object.defineProperty(e.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}}),e.Loader.prototype.constructor=e.Loader,e.LoaderParser={bitmapFont:function(a,b,c,d,f,g){return this.xmlBitmapFont(a,b,c,d,f,g)},xmlBitmapFont:function(a,b,c,d,f,g){null==g&&(g=1);var h={},m=a.getElementsByTagName("info")[0],
n=a.getElementsByTagName("common")[0];h.font=m.getAttribute("face");h.size=parseInt(m.getAttribute("size"),10);h.lineHeight=parseInt(n.getAttribute("lineHeight"),10)+d;h.chars={};m=a.getElementsByTagName("char");n=f?f.x:0;var p=f?f.y:0;for(d=0;d<m.length;d++){var q=parseInt(m[d].getAttribute("id"),10);q=h.chars[q]={x:parseInt(m[d].getAttribute("x"),10),y:parseInt(m[d].getAttribute("y"),10),width:parseInt(m[d].getAttribute("width"),10),height:parseInt(m[d].getAttribute("height"),10),xOffset:parseInt(m[d].getAttribute("xoffset"),
10)/g,yOffset:parseInt(m[d].getAttribute("yoffset"),10)/g,xAdvance:(parseInt(m[d].getAttribute("xadvance"),10)+c)/g,kerning:{}};if(f&&f.trimmed){if(q.x+q.width>f.spriteSourceSizeX+f.spriteSourceSizeW&&(q.width-=q.x+q.width-f.spriteSourceSizeX-f.spriteSourceSizeW),q.y+q.height>f.spriteSourceSizeY+f.spriteSourceSizeH&&(q.height-=q.y+q.height-f.spriteSourceSizeY-f.spriteSourceSizeH),q.x<f.spriteSourceSizeX){var r=f.spriteSourceSizeX-q.x;q.x=0;q.width-=r;q.xOffset+=r}q.y<f.spriteSourceSizeY&&(r=f.spriteSourceSizeY-
q.y,q.y=0,q.height-=r,q.yOffset+=r)}q.x+=n;q.y+=p}a=a.getElementsByTagName("kerning");for(d=0;d<a.length;d++)c=parseInt(a[d].getAttribute("first"),10),f=parseInt(a[d].getAttribute("second"),10),m=parseInt(a[d].getAttribute("amount"),10)/g,h.chars[f]&&(h.chars[f].kerning[c]=m);return this.finalizeBitmapFont(b,h)},jsonBitmapFont:function(a,b,c,d,f,g){null==g&&(g=1);var h={font:a.font.info._face,size:parseInt(a.font.info._size,10),lineHeight:parseInt(a.font.common._lineHeight,10)+d,chars:{}},m=f?f.x:
0,n=f?f.y:0;return a.font.chars.char.forEach(function(p){var q=parseInt(p._id,10);p=h.chars[q]={x:parseInt(p._x,10),y:parseInt(p._y,10),width:parseInt(p._width,10),height:parseInt(p._height,10),xOffset:parseInt(p._xoffset,10)/g,yOffset:parseInt(p._yoffset,10)/g,xAdvance:(parseInt(p._xadvance,10)+c)/g,kerning:{}};if(f&&f.trimmed){if(p.x+p.width>f.spriteSourceSizeX+f.spriteSourceSizeW&&(p.width-=p.x+p.width-f.spriteSourceSizeX-f.spriteSourceSizeW),p.y+p.height>f.spriteSourceSizeY+f.spriteSourceSizeH&&
(p.height-=p.y+p.height-f.spriteSourceSizeY-f.spriteSourceSizeH),p.x<f.spriteSourceSizeX)q=f.spriteSourceSizeX-p.x,p.x=0,p.width-=q,p.xOffset+=q;p.y<f.spriteSourceSizeY&&(q=f.spriteSourceSizeY-p.y,p.y=0,p.height-=q,p.yOffset+=q)}p.x+=m;p.y+=n}),a.font.kernings&&a.font.kernings.kerning&&a.font.kernings.kerning.forEach(function(p){h.chars[p._second]&&(h.chars[p._second].kerning[p._first]=parseInt(p._amount,10)/g)}),this.finalizeBitmapFont(b,h)},finalizeBitmapFont:function(a,b){return Object.keys(b.chars).forEach(function(c){c=
b.chars[c];c.texture=new PIXI.Texture(a,new e.Rectangle(c.x,c.y,c.width,c.height))}),b},pvr:function(a){var b,c=new Uint32Array(a.slice(0,52));a=new Uint8Array(a);var d=null,f=c[3]<<32|c[2];if(55727696===c[0]&&0<=[0,1,2,3,6,7,9,11].indexOf(f)){switch(0<=f&&3>=f?b="PVRTC":7<=f&&11>=f?b="S3TC":6===f&&(b="ETC1"),f){case 0:d=35841;break;case 1:d=35843;break;case 2:d=35840;break;case 3:d=35842;break;case 6:d=36196;break;case 7:d=33777;break;case 9:d=33778;break;case 11:d=33779;break;default:d=-1}d={complete:!0,
fileFormat:"PVR",compressionAlgorithm:b,flags:c[1],pixelFormat:f,colorSpace:c[4],channelType:c[5],height:c[6],width:c[7],depth:c[8],numberOfSurfaces:c[9],numberOfFaces:c[10],numberOfMipmaps:c[11],metaDataSize:c[12],textureData:a.subarray(52+c[12],a.byteLength),glExtensionFormat:d}}return d},dds:function(a){var b=new Uint8Array(a);a=new Uint32Array(a);var c=null;return 68===b[0]&&68===b[1]&&83===b[2]&&32===b[3]&&("DX10"===(c={complete:!0,fileFormat:"DDS",compressionAlgorithm:"S3TC",size:a[1],flags:a[2],
height:a[3],width:a[4],pitch:a[5],depth:a[6],mipmapCount:a[7],formatSize:a[19],formatFlag:a[19],formatFourCC:[String.fromCharCode(b[84]),String.fromCharCode(b[85]),String.fromCharCode(b[86]),String.fromCharCode(b[87])].join(""),formatBitCount:a[21],formatRBitMask:a[22],formatGBitMask:a[23],formatBBitMask:a[24],formatABitMask:a[25],caps1:a[26],caps2:a[27],caps3:a[28],caps4:a[29],reserved2:a[30],DXGIFormat:null,resourceDimension:null,miscFlag:null,arraySize:null,textureData:b.subarray(a[1]+4,b.byteLength)}).formatFourCC?
(c.DXGIFormat=a[31],c.resourceDimension=a[32],c.miscFlag=a[33],c.arraySize=a[34],c.miscFlag=a[35]):"DXT5"===c.formatFourCC?c.glExtensionFormat=33779:"DXT3"===c.formatFourCC&&(c.glExtensionFormat=33778)),c},ktx:function(a){var b=new Uint8Array(a);a=new Uint32Array(a);var c=null,d=16+a[15]/4|0,f=a[d],g=a[7],h=0;if(171===b[0]&&75===b[1]&&84===b[2]&&88===b[3]&&32===b[4]&&49===b[5]&&49===b[6]&&187===b[7]&&13===b[8]&&10===b[9]&&26===b[10]&&10===b[11]&&0<=[36196,35840,35841,35842,35843,33776,33777,33778,
33779].indexOf(g)){switch(g){case 36196:h="ETC1";break;case 35840:case 35841:case 35842:case 35843:h="PVRTC";break;case 33776:case 33777:case 33778:case 33779:h="S3TC"}c={complete:!0,fileFormat:"KTX",compressionAlgorithm:h,endianness:a[3],glType:a[4],glTypeSize:a[5],glFormat:a[6],glInternalFormat:a[7],glBaseInternalFormat:a[8],width:a[9],height:a[10],pixelDepth:a[11],numberOfArrayElements:a[12],numberOfFaces:a[13],numberOfMipmapLevels:a[14],bytesOfKeyValueData:a[15],keyAndValueByteSize:a[16],imageSize:f,
textureData:b.subarray(4*(d+1),f+100)}}return c},pkm:function(a){a=new Uint8Array(a);var b=null;return 80===a[0]&&75===a[1]&&77===a[2]&&32===a[3]&&(b={complete:!0,fileFormat:"PKM",compressionAlgorithm:"ETC1",format:65535&(a[6]<<8|a[7]),width:65535&(a[8]<<8|a[9]),height:65535&(a[10]<<8|a[11]),originalWidth:65535&(a[12]<<8|a[13]),originalHeight:65535&(a[14]<<8|a[15]),textureData:a.subarray(16,a.length)}),b}},e.AudioSprite=function(a,b){for(var c in this.game=a,this.key=b,this.config=this.game.cache.getJSON(b+
"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={},this.config.spritemap)a=this.config.spritemap[c],b=this.game.add.sound(this.key),b.addMarker(c,a.start,a.end-a.start,null,a.loop),this.sounds[c]=b;this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},e.AudioSprite.prototype={play:function(a,b){return void 0===b&&(b=1),this.sounds[a].play(a,null,b)},stop:function(a){if(a)this.sounds[a].stop();else for(var b in this.sounds)this.sounds[b].stop()},
get:function(a){return this.sounds[a]}},e.AudioSprite.prototype.constructor=e.AudioSprite,e.Sound=function(a,b,c,d,f){void 0===c&&(c=1);void 0===d&&(d=!1);void 0===f&&(f=a.sound.connectToMaster);this.game=a;this.key=this.name=b;this.loop=d;this.markers={};this.context=null;this.autoplay=!1;this.stopTime=this.position=this.durationMS=this.duration=this.currentTime=this.startTime=this.totalDuration=0;this.paused=!1;this.pausedTime=this.pausedPosition=0;this.isPlaying=!1;this.currentMarker="";this.fadeTween=
null;this.playOnce=this.allowMultiple=this.override=this.pendingPlayback=!1;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this._sound=this.gainNode=this.masterGainNode=this.externalNode=null;this._globalVolume=1;this._removeFromSoundManager=this._pendingStart=this._markedToDelete=!1;this._sourceId=0;this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,void 0===this.context.createGain?this.gainNode=
this.context.createGainNode():this.gainNode=this.context.createGain(),this.gainNode.gain.value=c,f&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(b)&&this.game.cache.isSoundReady(b)?(this._sound=this.game.cache.getSoundData(b),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this));this.onDecoded=new e.Signal;this.onPlay=new e.Signal;this.onPause=new e.Signal;this.onResume=
new e.Signal;this.onLoop=new e.Signal;this.onStop=new e.Signal;this.onMute=new e.Signal;this.onMarkerComplete=new e.Signal;this.onFadeComplete=new e.Signal;this._volume=c;this._buffer=null;this._muted=!1;this._tempLoop=this._muteVolume=this._tempPause=this._tempVolume=this._tempPosition=this._tempMarker=0;this._onDecodedEventDispatched=this._paused=!1},e.Sound.prototype={soundHasUnlocked:function(a){a===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},
addMarker:function(a,b,c,d,f){null==c&&(c=1);null==d&&(d=1);void 0===f&&(f=!1);this.markers[a]={name:a,start:b,stop:b+c,volume:d,duration:c,durationMS:1E3*c,loop:f}},removeMarker:function(a){delete this.markers[a]},onEndedHandler:function(){this._sound&&(this._removeOnEndedHandler(),this.isPlaying=!1,this.currentTime=this.durationMS,this.stop(),this.playOnce&&(this._markedToDelete=!0,this._removeFromSoundManager=!0),this._markedToDelete&&(this._disconnectSource(),this._removeFromSoundManager?this.game.sound.remove(this):
(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())))},update:function(){if(this.game.cache.checkSoundKey(this.key)){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0);this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&
(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop));var a=this.game.time.time;if(this.isPlaying){if(this._pendingStart){var b=this._sound.currentTime;if(!(b>((this.paused?this._tempPause:0)||this.position||0)))return;this._pendingStart=!1;this.startTime=a-1E3*b;this.stopTime=this.startTime+this.durationMS}this.currentTime=a-this.startTime;this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=
!1,""===this.currentMarker?(this.currentTime=0,this.startTime=a,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0,!1))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),""===this.currentMarker&&(this.currentTime=0,this.startTime=a),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0,!1)):this.stop())}}else this.destroy()},loopFull:function(a){return this.play(null,0,a,!0)},play:function(a,
b,c,d,f,g){if((void 0!==a&&!1!==a&&null!==a||(a=""),void 0===f&&(f=!0),void 0===g&&(g=!0),this.isPlaying&&!this.allowMultiple&&!f&&!this.override)||(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||f)&&(this.usingWebAudio?this._stopSourceAndDisconnect():this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0),this.isPlaying=!1),""===a&&0<Object.keys(this.markers).length))return this;if(""!==a){if(!this.markers[a])return console.warn("Phaser.Sound.play: audio marker "+a+
" doesn't exist"),this;this.currentMarker=a;this.position=this.markers[a].start;this.volume=this.markers[a].volume;this.loop=this.markers[a].loop;this.duration=this.markers[a].duration;this.durationMS=this.markers[a].durationMS;void 0!==c&&(this.volume=c);void 0!==d&&(this.loop=d);this._tempMarker=a;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else b=b||0,void 0===c&&(c=this._volume),void 0===d&&(d=this.loop),this.position=Math.max(0,b),this.volume=c,this.loop=
d,this.durationMS=this.duration=0,this._tempMarker=a,this._tempPosition=b,this._tempVolume=c,this._tempLoop=d;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._createSourceAndConnect(),this.loop&&""===a&&(this._sound.loop=!0),this.loop||""!==a||this._addOnEndedHandler(),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1E3*this.totalDuration)),this.loop&&""===a?this._startSource(0,0):this._startSource(0,
this.position,this.duration),this.isPlaying=!0,this.paused=!1,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,g&&this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||
4===this._sound.readyState)?(this._sound.play(),this._sound.loop=this.loop,this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1E3*this.totalDuration),this._globalVolume=this.game.sound.volume,this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted||this.game.sound.mute?this._sound.volume=0:this._sound.volume=this._volume*this._globalVolume,this._pendingStart=!this.currentMarker,this.isPlaying=!0,this.paused=!1,this._tempPause=
0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,g&&this.onPlay.dispatch(this)):this.pendingPlayback=!0,this.playOnce&&(this.loop&&console.warn("Phaser.Sound.play: audio clip "+this.name+" cannot be deleted while looping."),this._markedToDelete=!0,this._removeFromSoundManager=!0),this},restart:function(a,b,c,d){void 0===d&&(d=!1);this.play(a||"",b||0,c||1,d,!0)},pause:function(){this.isPlaying&&(this.paused=!0,this.pausedPosition=this.currentTime,
this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused){if(this.usingWebAudio){var a=Math.max(0,this.position+this.pausedPosition/1E3);this._createSourceAndConnect();""===this.currentMarker&&(this.loop?this._sound.loop=!0:this._addOnEndedHandler());var b=this.duration-this.pausedPosition/1E3;this.loop&&""===this.currentMarker?this._startSource(0,a):this._startSource(0,a,b)}else this._pendingStart=!this.currentMarker,
this._sound.currentTime=this._tempPause,this._tempPause=0,this._sound.play();this.isPlaying=!0;this.paused=!1;this.startTime+=this.game.time.time-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound&&(this.usingWebAudio?this._stopSourceAndDisconnect():this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.pendingPlayback=!1,this.isPlaying=!1,!this.paused){var a=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,
this);this.currentMarker="";null!==this.fadeTween&&this.fadeTween.stop();this.onStop.dispatch(this,a)}},fadeIn:function(a,b,c){void 0===b&&(b=!1);void 0===c&&(c=this.currentMarker);this.paused||(this.play(c,0,0,b),this.fadeTo(a,1))},fadeOut:function(a){this.fadeTo(a,0)},fadeTo:function(a,b){this.isPlaying&&!this.paused&&b!==this.volume&&(void 0===a&&(a=1E3),void 0!==b?(this.fadeTween=this.game.add.tween(this).to({volume:b},a,e.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,
this)):console.warn("Phaser.Sound.fadeTo: No Volume Specified."))},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);0===this.volume&&this.stop()},updateGlobalVolume:function(a){this.usingAudioTag&&this._sound&&(this._globalVolume=a,this._sound.volume=this._globalVolume*this._volume)},destroy:function(a){void 0===a&&(a=!0);this._markedToDelete=!0;this._removeFromSoundManager=a;this.stop();a?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=
null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())},_createSourceAndConnect:function(){this._sound=this.context.createBufferSource();this._sound.connect(this.externalNode||this.gainNode);this._buffer=this.game.cache.getSoundData(this.key);this._sound.buffer=this._buffer;this._sourceId++},_disconnectSource:function(){this._sound.disconnect(this.externalNode||
this.gainNode)},_startSource:function(a,b,c){void 0===c?this._sound.start(a||0,b||0):this._sound.start(a||0,b||0,c)},_stopSourceAndDisconnect:function(){this._removeOnEndedHandler();try{this._sound.stop(0)}catch(a){}this._disconnectSource();this._sound=null},_addOnEndedHandler:function(){this._sound.onended=this.onEndedHandler.bind(this)},_removeOnEndedHandler:function(){this._sound.onended=null}},e.Sound.prototype.constructor=e.Sound,Object.defineProperty(e.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),
Object.defineProperty(e.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(e.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(a){(a=a||!1)!==this._muted&&(a?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&
this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}}),Object.defineProperty(e.Sound.prototype,"volume",{get:function(){return this._volume},set:function(a){this.usingAudioTag&&(a=this.game.math.clamp(a,0,1));this._muted?this._muteVolume=a:(this._tempVolume=a,this._volume=a,this.usingWebAudio?this.gainNode.gain.value=a:this.usingAudioTag&&this._sound&&(this._sound.volume=this._globalVolume*a))}}),Object.defineProperty(e.Sound.prototype,"sourceId",{get:function(){return this._sound?
this._sourceId:null}}),e.SoundManager=function(a){this.game=a;this.onSoundDecode=new e.Signal;this.onVolumeChange=new e.Signal;this.onMute=new e.Signal;this.onUnMute=new e.Signal;this.onTouchUnlock=new e.Signal;this.onStateChange=new e.Signal;this.baseLatency=this.context=null;this.noAudio=this.usingAudioTag=this.usingWebAudio=!1;this.connectToMaster=!0;this.touchLocked=!1;this.channels=32;this.muteOnPause=!0;this._muted=this._codeMuted=!1;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=
new e.ArraySet;this._watching=!1;this._watchContext=this._watchCallback=null;this._onClick=this._onClick.bind(this);this._onStateChange=this._onStateChange.bind(this)},e.SoundManager.prototype={boot:function(){var a=this.game.device,b=window.PhaserGlobal;if(a.iOS&&!1===a.webAudio&&(this.channels=1),b){if(!0===b.disableAudio)return this.noAudio=!0,void(this.touchLocked=!1);if(!0===b.disableWebAudio)return this.usingAudioTag=!0,void(this.touchLocked=!1)}if(b&&b.audioContext)this.context=b.audioContext;
else if(b=window.AudioContext||window.webkitAudioContext)try{this.context=new b}catch(c){this.context=null,this.touchLocked=this.usingWebAudio=!1,console.warn(c)}if(null===this.context){if(void 0===window.Audio)return void(this.noAudio=!0);this.usingAudioTag=!0}else this.usingWebAudio=!0,this.baseLatency=this.context.baseLatency||256/(this.context.sampleRate||44100),void 0===this.context.createGain?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=
1,this.masterGain.connect(this.context.destination),this.context.onstatechange=this._onStateChange,"suspended"===this.context.state&&this.game.canvas.addEventListener("click",this._onClick);this.noAudio||a.needsTouchUnlock()&&this.setTouchLock();this.usingWebAudio&&a.chrome&&65>=a.chromeVersion&&console.log('A "GainNode.gain.value setter smoothing is deprecated" notice in Chrome is normal. <https://github.com/photonstorm/phaser-ce/issues/385>')},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&
!0===window.PhaserGlobal.disableAudio||(this.game.input.addTouchLockCallback(this.unlock,this,!0),this.touchLocked=!0)},setTouchUnlock:function(){this.touchLocked=!1;this._unlockSource=null;this.onTouchUnlock.dispatch()},webAudioIsSuspended:function(){return this.usingWebAudio&&"suspended"===this.context.state},resumeWebAudio:function(){if(this.usingWebAudio)return this.context.resume()},resumeWebAudioIfSuspended:function(){if(this.webAudioIsSuspended())return this.context.resume()},unlock:function(){if(this.noAudio||
!this.touchLocked||null!==this._unlockSource)return!0;if(this.usingAudioTag)this.setTouchUnlock();else if(this.usingWebAudio){var a=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=a;this._unlockSource.connect(this.context.destination);var b=this;this._unlockSource.onended=function(){b.setTouchUnlock();b.resumeWebAudioIfSuspended()};void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0);this.resumeWebAudioIfSuspended()}return!0},
stopAll:function(){if(!this.noAudio)for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].stop()},pauseAll:function(){if(!this.noAudio)for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].pause()},resumeAll:function(){if(!this.noAudio)for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].resume()},decode:function(a,b){b=b||null;var c=this.game.cache.getSoundData(a);if(c&&!1===this.game.cache.isSoundDecoded(a)){this.game.cache.updateSound(a,"isDecoding",
!0);var d=this;try{this.context.decodeAudioData(c,function(f){d.game.isBooted&&f&&(d.game.cache.decodedSound(a,f),d.onSoundDecode.dispatch(a,b))})}catch(f){}}},setDecodedCallback:function(a,b,c){"string"==typeof a&&(a=[a]);this._watchList.reset();for(var d=0;d<a.length;d++)a[d]instanceof e.Sound?this.game.cache.isSoundDecoded(a[d].key)||this._watchList.add(a[d].key):this.game.cache.isSoundDecoded(a[d])||this._watchList.add(a[d]);0===this._watchList.total?(this._watching=!1,b.call(c)):(this._watching=
!0,this._watchCallback=b,this._watchContext=c)},update:function(){if(!this.noAudio){if(!this.webAudioIsSuspended())for(var a=0;a<this._sounds.length;a++)this._sounds[a].update();if(this._watching){for(a=this._watchList.first;a;)this.game.cache.isSoundDecoded(a)&&this._watchList.remove(a),a=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},add:function(a,b,c,d){void 0===b&&(b=1);void 0===c&&(c=!1);void 0===d&&(d=this.connectToMaster);
a=new e.Sound(this.game,a,b,c,d);return this._sounds.push(a),a},addSprite:function(a){return new e.AudioSprite(this.game,a)},remove:function(a){for(var b=this._sounds.length;b--;)if(this._sounds[b]===a)return this._sounds[b].destroy(!1),this._sounds.splice(b,1),!0;return!1},removeAll:function(){this.stopAll();for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].destroy();this._sounds.length=0},removeByKey:function(a){for(var b=this._sounds.length,c=0;b--;)this._sounds[b].key===a&&
(this._sounds[b].destroy(!1),this._sounds.splice(b,1),c++);return c},play:function(a,b,c){if(!this.noAudio)return a=this.add(a,b,c),a.play(),a},setMute:function(){if(!this._muted){this._muted=!0;this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var a=0;a<this._sounds.length;a++)this._sounds[a].usingAudioTag&&(this._sounds[a].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1;this.usingWebAudio&&(this.masterGain.gain.value=
this._muteVolume);for(var a=0;a<this._sounds.length;a++)this._sounds[a].usingAudioTag&&(this._sounds[a].mute=!1);this.onUnMute.dispatch()}},gamePaused:function(){this.muteOnPause&&this.setMute()},gameResumed:function(){this.resumeWebAudio();this.muteOnPause&&this.unsetMute()},destroy:function(){this.removeAll();this.onMute.dispose();this.onSoundDecode.dispose();this.onStateChange.dispose();this.onTouchUnlock.dispose();this.onUnMute.dispose();this.onVolumeChange.dispose();this.game.canvas.removeEventListener("click",
this._onClick);this.context&&(this.context.onstatechange=null,window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close(),this.context=null)},_onStateChange:function(){this.onStateChange.dispatch(this.context.state)},_onClick:function(){this.resumeWebAudioIfSuspended();this.game.canvas.removeEventListener("click",this._onClick)}},e.SoundManager.prototype.constructor=e.SoundManager,Object.defineProperty(e.SoundManager.prototype,"mute",{get:function(){return this._muted},
set:function(a){a?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}}),Object.defineProperty(e.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(a){if(0>a?a=0:1<a&&(a=1),this._volume!==a){if(this._volume=a,this.usingWebAudio)this.masterGain.gain.value=a;else for(var b=0;b<this._sounds.length;b++)this._sounds[b].usingAudioTag&&this._sounds[b].updateGlobalVolume(a);this.onVolumeChange.dispatch(a)}}}),e.ScaleManager=function(a,
b,c){this.game=a;this.dom=e.DOM;this.grid=null;this.height=this.width=0;this.maxHeight=this.minHeight=this.maxWidth=this.minWidth=null;this.offset=new e.Point;this._pageAlignVertically=this._pageAlignHorizontally=this.incorrectOrientation=this.forcePortrait=this.forceLandscape=!1;this.onOrientationChange=new e.Signal;this.enterIncorrectOrientation=new e.Signal;this.leaveIncorrectOrientation=new e.Signal;this.hasPhaserSetFullScreen=!1;this._createdFullScreenTarget=this.fullScreenTarget=null;this.onFullScreenInit=
new e.Signal;this.onFullScreenChange=new e.Signal;this.onFullScreenError=new e.Signal;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new e.Point(1,1);this.scaleFactorInversed=new e.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new e.Rectangle;this.sourceAspectRatio=this.aspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,
canExpandParent:!0,clickTrampoline:""};this._fullScreenScaleMode=this._scaleMode=e.ScaleManager.NO_SCALE;this.parentIsWindow=!1;this.parentNode=null;this.parentScaleFactor=new e.Point(1,1);this.trackParentInterval=2E3;this.onSizeChange=new e.Signal;this._fullScreenRestore=this._pendingScaleMode=this.onResizeContext=this.onResize=null;this._gameSize=new e.Rectangle;this._userScaleFactor=new e.Point(1,1);this._userScaleTrim=new e.Point(0,0);this._updateThrottle=this._lastUpdate=0;this._updateThrottleReset=
100;this._parentBounds=new e.Rectangle;this._tempBounds=new e.Rectangle;this._lastReportedCanvasSize=new e.Rectangle;this._lastReportedGameSize=new e.Rectangle;this._booted=!1;a.config&&this.parseConfig(a.config);this.setupScale(b,c)},e.ScaleManager.EXACT_FIT=0,e.ScaleManager.NO_SCALE=1,e.ScaleManager.SHOW_ALL=2,e.ScaleManager.RESIZE=3,e.ScaleManager.USER_SCALE=4,e.ScaleManager.MODES=["EXACT_FIT","NO_SCALE","SHOW_ALL","RESIZE","USER_SCALE"],e.ScaleManager.prototype={boot:function(){var a=this.compatibility;
a.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?a.scrollTo=new e.Point(0,1):a.scrollTo=new e.Point(0,0));this.game.device.desktop?(a.orientationFallback="screen",a.clickTrampoline="when-not-mouse"):(a.orientationFallback="",a.clickTrampoline="");var b=this;this._orientationChange=function(c){return b.orientationChange(c)};this._windowResize=function(c){return b.windowResize(c)};
window.addEventListener("orientationchange",this._orientationChange,!1);window.addEventListener("resize",this._windowResize,!1);this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(c){return b.fullScreenChange(c)},this._fullScreenError=function(c){return b.fullScreenError(c)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,
!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1));this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,
this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);e.FlexGrid&&(this.grid=new e.FlexGrid(this,this.width,this.height));this._booted=!0;null!==this._pendingScaleMode&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(a){void 0!==a.scaleMode&&(this._booted?this.scaleMode=a.scaleMode:this._pendingScaleMode=a.scaleMode);void 0!==a.fullScreenScaleMode&&
(this.fullScreenScaleMode=a.fullScreenScaleMode);a.fullScreenTarget&&(this.fullScreenTarget=a.fullScreenTarget);this.pageAlignHorizontally=a.alignH||!1;this.pageAlignVertically=a.alignV||!1;a.scaleH&&a.scaleV&&this.setUserScale(a.scaleH,a.scaleV,a.trimH,a.trimV)},setupScale:function(a,b){var c,d=new e.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?c=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(c=this.game.parent));c?(this.parentNode=
c,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds,this.parentNode),d.width=this._parentBounds.width,d.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,d.width=this.dom.visualBounds.width,d.height=this.dom.visualBounds.height,this.offset.set(0,0));a="number"==typeof a?a:(this.parentScaleFactor.x=parseInt(a,10)/100,d.width*this.parentScaleFactor.x);b="number"==typeof b?b:(this.parentScaleFactor.y=
parseInt(b,10)/100,d.height*this.parentScaleFactor.y);a=Math.floor(a);b=Math.floor(b);this._gameSize.setTo(0,0,a,b);this.updateDimensions(a,b,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(a,b){this._gameSize.setTo(0,0,a,b);this.currentScaleMode!==e.ScaleManager.RESIZE&&this.updateDimensions(a,b,!0);this.queueUpdate(!0)},setUserScale:function(a,b,c,d,f,g){this._userScaleFactor.setTo(a,b);this._userScaleTrim.setTo(0|c,0|d);void 0===f&&(f=!0);void 0===g&&(g=!0);f&&this.queueUpdate(g)},
setResizeCallback:function(a,b){this.onResize=a;this.onResizeContext=b},signalSizeChange:function(){if(!e.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!e.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var a=this.width,b=this.height;this._lastReportedCanvasSize.setTo(0,0,a,b);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);this.grid&&this.grid.onResize(a,b);this.onSizeChange.dispatch(this,a,b);this.currentScaleMode===e.ScaleManager.RESIZE&&(this.game.state.resize(a,
b),this.game.load.resize(a,b))}},setMinMax:function(a,b,c,d){this.minWidth=a;this.minHeight=b;void 0!==c&&(this.maxWidth=c);void 0!==d&&(this.maxHeight=d)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var a=this._updateThrottle;this._updateThrottleReset=400<=a?0:100;this.dom.getOffset(this.game.canvas,this.offset);var b=this._parentBounds.width,c=this._parentBounds.height,d=this.getParentBounds(this._parentBounds);b=d.width!==b||d.height!==c;c=this.updateOrientationState();
(b||c)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,d),this.updateLayout(),this.signalSizeChange());d=2*this._updateThrottle;this._updateThrottle<a&&(d=Math.min(a,this._updateThrottleReset));this._updateThrottle=e.Math.clamp(d,25,this.trackParentInterval);this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(a,b,c){this.width=a*this.parentScaleFactor.x;this.height=b*this.parentScaleFactor.y;
this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();c&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/
this.game.height;this.aspectRatio=this.width/this.height;this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(a,b){void 0===b&&(b=!1);!0!==a||!0!==b?(this.forceLandscape=a,this.forcePortrait=b,this.queueUpdate(!0)):console.warn("Phaser.ScaleManager: forceLandscape and forcePortrait cannot both be true.")},
classifyOrientation:function(a){return"portrait-primary"===a||"portrait-secondary"===a?"portrait":"landscape-primary"===a||"landscape-secondary"===a?"landscape":null},updateOrientationState:function(){var a=this.screenOrientation,b=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var c=a!==this.screenOrientation,d=b!==this.incorrectOrientation;
return d&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(c||d)&&this.onOrientationChange.dispatch(this,a,b),c||d},orientationChange:function(a){this.event=a;this.queueUpdate(!0)},windowResize:function(a){this.event=a;this.queueUpdate(!0)},scrollTop:function(){var a=this.compatibility.scrollTo;a&&window.scrollTo(a.x,a.y)},refresh:function(){this.scrollTop();this.queueUpdate(!0)},updateLayout:function(){var a=this.currentScaleMode;a!==
e.ScaleManager.RESIZE?((this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():a===e.ScaleManager.EXACT_FIT?this.setExactFit():a===e.ScaleManager.SHOW_ALL?(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent&&(this.setShowAll(!0),this.resetCanvas()),this.setShowAll()):a===e.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):a===
e.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),this.compatibility.canExpandParent||a!==e.ScaleManager.SHOW_ALL&&a!==e.ScaleManager.USER_SCALE)||(a=this.getParentBounds(this._tempBounds),this.width=Math.min(this.width,a.width),this.height=Math.min(this.height,a.height)),this.width|=0,this.height|=0,this.reflowCanvas()):this.reflowGame()},getParentBounds:function(a,b){a=
a||new e.Rectangle;var c=b||this.boundingParent;b=this.dom.visualBounds;var d=this.dom.layoutBounds;if(c){var f=c.getBoundingClientRect();c=c.offsetParent?c.offsetParent.getBoundingClientRect():c.getBoundingClientRect();a.setTo(f.left-c.left,f.top-c.top,f.width,f.height);f=this.windowConstraints;f.right&&(c="layout"===f.right?d:b,a.right=Math.min(a.right,c.width));f.bottom&&(c="layout"===f.bottom?d:b,a.bottom=Math.min(a.bottom,c.height))}else a.setTo(0,0,b.width,b.height);return a.setTo(Math.round(a.x),
Math.round(a.y),Math.round(a.width),Math.round(a.height)),a},align:function(a,b){null!=a&&(this.pageAlignHorizontally=a);null!=b&&(this.pageAlignVertically=b)},alignCanvas:function(a,b){var c=this.getParentBounds(this._tempBounds),d=this.game.canvas,f=this.margin;if(a){f.left=f.right=0;a=d.getBoundingClientRect();if(this.width<c.width&&!this.incorrectOrientation){var g=a.left-c.x,h=c.width/2-this.width/2;g=Math.max(h,0)-g;f.left=Math.round(g)}d.style.marginLeft=f.left+"px";0!==f.left&&(f.right=-(c.width-
a.width-f.left),d.style.marginRight=f.right+"px")}b&&(f.top=f.bottom=0,a=d.getBoundingClientRect(),this.height<c.height&&!this.incorrectOrientation&&(g=a.top-c.y,h=c.height/2-this.height/2,g=Math.max(h,0)-g,f.top=Math.round(g)),d.style.marginTop=f.top+"px",0!==f.top&&(f.bottom=-(c.height-a.height-f.top),d.style.marginBottom=f.bottom+"px"));f.x=f.left;f.y=f.top},reflowGame:function(){this.resetCanvas("","");var a=this.getParentBounds(this._tempBounds);this.updateDimensions(a.width,a.height,!0)},reflowCanvas:function(){this.incorrectOrientation||
(this.width=e.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=e.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height));this.resetCanvas();this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically));this.updateScalingAndBounds()},resetCanvas:function(a,b){void 0===a&&(a=this.width+"px");void 0===b&&(b=this.height+"px");var c=this.game.canvas;
this.compatibility.noMargins||(c.style.marginLeft="",c.style.marginTop="",c.style.marginRight="",c.style.marginBottom="");c.style.width=a;c.style.height=b},queueUpdate:function(a){a&&(this._parentBounds.width=0,this._parentBounds.height=0);this._updateThrottle=this._updateThrottleReset},reset:function(a){a&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(a){var b=this.getParentBounds(this._tempBounds),
c=b.width;b=b.height;a=a?Math.max(b/this.game.height,c/this.game.width):Math.min(b/this.game.height,c/this.game.width);this.width=Math.round(this.game.width*a);this.height=Math.round(this.game.height*a)},setExactFit:function(){var a=this.getParentBounds(this._tempBounds);this.width=a.width;this.height=a.height;this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var a=
document.createElement("div");return a.style.margin="0",a.style.padding="0",a.style.background="#000",a},startFullScreen:function(a,b,c){if(this.isFullScreen)return!1;if(this.compatibility.supportsFullScreen){if("when-not-mouse"===this.compatibility.clickTrampoline){var d=this.game.input;if(d.activePointer&&d.activePointer!==d.mousePointer&&(b||!1!==b))return void d.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[a,!1])}void 0!==a&&this.game.renderType===e.CANVAS&&(this.game.stage.smoothed=
a);(a=this.fullScreenTarget)||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),a=this._createdFullScreenTarget);b={targetElement:a};if(this.hasPhaserSetFullScreen=!0,this.onFullScreenInit.dispatch(this,b),this._createdFullScreenTarget)b=this.game.canvas,b.parentNode.insertBefore(a,b),a.appendChild(b);return void 0===c&&(c={navigationUI:"hide"}),this.game.device.fullscreenKeyboard?a[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):a[this.game.device.requestFullscreen](c),
!0}var f=this;setTimeout(function(){f.fullScreenError()},10)},stopFullScreen:function(){return!(!this.isFullScreen||!this.compatibility.supportsFullScreen)&&(this.hasPhaserSetFullScreen=!1,document[this.game.device.cancelFullscreen](),!0)},cleanupCreatedTarget:function(){var a=this._createdFullScreenTarget;if(a&&a.parentNode){var b=a.parentNode;b.insertBefore(this.game.canvas,a);b.removeChild(a)}this._createdFullScreenTarget=null},prepScreenMode:function(a){var b=!!this._createdFullScreenTarget,c=
this._createdFullScreenTarget||this.fullScreenTarget;a?(b||this.fullScreenScaleMode===e.ScaleManager.EXACT_FIT)&&c!==this.game.canvas&&(this._fullScreenRestore={targetWidth:c.style.width,targetHeight:c.style.height},c.style.width="100%",c.style.height="100%"):(this._fullScreenRestore&&(c.style.width=this._fullScreenRestore.targetWidth,c.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},
fullScreenChange:function(a){this.event=a;this.isFullScreen?this.prepScreenMode(!0):(this.prepScreenMode(!1),this.cleanupCreatedTarget());this.updateLayout();this.queueUpdate(!0);this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(a){this.event=a;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(a,b,c,d){if((void 0===
b&&(b=this.width),void 0===c&&(c=this.height),void 0===d&&(d=!1),!a||!a.scale)||(a.scale.x=1,a.scale.y=1,0>=a.width||0>=a.height||0>=b||0>=c))return a;var f=a.height*b/a.width,g=a.width*c/a.height;return(b<g?d:!d)?(a.width=Math.floor(b),a.height=Math.floor(f)):(a.width=Math.floor(g),a.height=Math.floor(c)),a},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,!1);window.removeEventListener("resize",this._windowResize,
!1);this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,
!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},e.ScaleManager.prototype.constructor=e.ScaleManager,Object.defineProperty(e.ScaleManager.prototype,"boundingParent",{get:function(){return this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget?null:this.game.canvas&&this.game.canvas.parentNode||null}}),Object.defineProperty(e.ScaleManager.prototype,
"scaleMode",{get:function(){return this._scaleMode},set:function(a){return a!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=a),this._scaleMode}}),Object.defineProperty(e.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(a){return a!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=a,this.prepScreenMode(!0),
this.queueUpdate(!0)):this._fullScreenScaleMode=a),this._fullScreenScaleMode}}),Object.defineProperty(e.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(e.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(a){a!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=a,this.queueUpdate(!0))}}),Object.defineProperty(e.ScaleManager.prototype,
"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(a){a!==this._pageAlignVertically&&(this._pageAlignVertically=a,this.queueUpdate(!0))}}),Object.defineProperty(e.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(e.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}}),
Object.defineProperty(e.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(e.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(e.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),e.Utils.Debug=function(a){this.game=a;this.context=this.canvas=this.bmd=this.sprite=null;this.font="14px monospace";this.columnWidth=
100;this.lineHeight=16;this.lineWidth=1;this.renderShadow=!0;this.currentColor=null;this.currentY=this.currentX=0;this.currentAlpha=1;this.isDisabled=this.dirty=!1;this._rect=this._line=null},e.Utils.Debug.GEOM_AUTO=0,e.Utils.Debug.GEOM_RECTANGLE=1,e.Utils.Debug.GEOM_CIRCLE=2,e.Utils.Debug.GEOM_POINT=3,e.Utils.Debug.GEOM_LINE=4,e.Utils.Debug.GEOM_ELLIPSE=5,e.Utils.Debug.prototype={boot:function(){this.game.renderType===e.CANVAS?this.context=this.game.context:(this.bmd=new e.BitmapData(this.game,"__DEBUG",
this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.sprite.anchor.set(0,0),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=e.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d"));this._line=new e.Line;this._rect=new e.Rectangle},resize:function(){this.bmd.resize(this.game.width,this.game.height);this.canvas.width=this.game.width;this.canvas.height=this.game.height},
preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height);this.sprite&&this.bmd.clear()},start:function(a,b,c,d){"number"!=typeof a&&(a=0);"number"!=typeof b&&(b=0);c=c||"rgb(255,255,255)";void 0===d&&(d=0);this.currentX=a;this.currentY=b;this.currentColor=c;this.columnWidth=d;this.dirty=!0;this.context.save();
this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=c;this.context.fillStyle=c;this.context.font=this.font;this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var a=this.currentX,b=0;b<arguments.length;b++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[b],a+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[b],a,this.currentY),a+=this.columnWidth;this.currentY+=
this.lineHeight},gameInfo:function(a,b,c){var d=this.game;this.start(a,b,c);this.line("Game ID "+d.id);this.line({1:"Canvas",2:"WebGL",3:"Headless",4:"WebGL Multitexture"}[d.renderType]+" ("+d.width+" x "+d.height+")");this.line("Paused: "+d.paused);this.line("Stepping: "+d.stepping+" ("+d.stepCount+")");this.stop()},state:function(a,b,c){var d=this.game.state,f=Object.keys(d.states);this.start(a,b,c);for(a=0;a<f.length;a++)b=f[a],b===d.current?this.line((d._created?"* ":"> ")+b):b===d._pendingState?
this.line("+ "+b):this.line("  "+b);this.stop()},sound:function(a,b,c){var d=this.game.sound;this.start(a,b,c);d.noAudio?this.line("Audio is disabled"):(this.line("Volume: "+d.volume.toFixed(2)+(d.mute?" (Mute)":"")),this.line("Mute on pause: "+d.muteOnPause),this.line("Using: "+(d.usingWebAudio?"Web Audio - "+d.context.state:"Audio Tag")),this.line("Touch locked: "+d.touchLocked),this.line("Sounds: "+d._sounds.length));this.stop()},soundInfo:function(a,b,c,d){if(this.start(b,c,d),this.line("Sound: "+
a.key+"  Touch locked: "+a.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(a.key)+"  Pending Playback: "+a.pendingPlayback),this.line("Decoded: "+a.isDecoded+"  Decoding: "+a.isDecoding),this.line("Playing: "+a.isPlaying+"  Loop: "+a.loop),this.line("Time: "+(a.currentTime/1E3).toFixed(3)+"s  Total: "+a.totalDuration.toFixed(3)+"s"),this.line("Volume: "+a.volume.toFixed(2)+(a.mute?" (Mute)":"")),this.line("Using: "+(a.usingWebAudio?"Web Audio":"Audio Tag")),a.usingWebAudio&&
this.line("  Source: "+(a.sourceId||"none")),a.usingAudioTag&&a._sound)b=a._sound,this.line("  currentSrc: "+b.currentSrc),this.line("  currentTime: "+b.currentTime),this.line("  duration: "+b.duration),this.line("  ended: "+b.ended),this.line("  loop: "+b.loop),this.line("  muted: "+b.muted),this.line("  paused: "+b.paused);""!==a.currentMarker&&(this.line("Marker: "+a.currentMarker+"  Duration: "+a.duration.toFixed(3)+"s ("+a.durationMS+"ms)"),this.line("Start: "+a.markers[a.currentMarker].start.toFixed(3)+
"  Stop: "+a.markers[a.currentMarker].stop.toFixed(3)),this.line("Position: "+a.position.toFixed(3)));this.stop()},camera:function(a,b,c){var d=a.deadzone,f=a.target;a=a.view;d&&(this._rect.setTo(a.x+d.x,a.y+d.y,d.width,d.height),this.rectangle(this._rect,b,c));f&&(this._line.setTo(a.centerX,a.centerY,f.x,f.y),this.geom(this._line,b,c),this.geom(f,b,!1,3))},cameraInfo:function(a,b,c,d){var f=a.bounds,g=a.deadzone,h=a.target,m=a.view;this.start(b,c,d);this.line("Camera ("+a.width+" x "+a.height+")");
this.line("x: "+a.x+" y: "+a.y);this.line("Bounds: "+(f?"x: "+f.x+" y: "+f.y+" w: "+f.width+" h: "+f.height:"none"));this.line("View: x: "+m.x+" y: "+m.y+" w: "+m.width+" h: "+m.height);this.line("Center: x: "+a.centerX+" y: "+a.centerY);this.line("Deadzone: "+(g?"x: "+g.x+" y: "+g.y+" w: "+g.width+" h: "+g.height:g));this.line("Total in view: "+a.totalInView);this.line("At limit: x: "+a.atLimit.x+" y: "+a.atLimit.y);this.line("Target: "+(h?h.name||h:"none"));this.stop()},timer:function(a,b,c,d){this.start(b,
c,d);this.line("Timer (running: "+a.running+" expired: "+a.expired+")");this.line("Next Tick: "+a.next+" Duration: "+a.duration);this.line("Paused: "+a.paused+" Length: "+a.length);this.stop()},pointer:function(a,b,c,d,f,g){null!=a&&(void 0===b&&(b=!1),c=c||"rgba(0,255,0,0.5)",d=d||"rgba(255,255,0,0.5)",g=g||"rgba(255,0,0,0.5)",!0!==b||!0!==a.isUp)&&(this.start(a.x,a.y-150,f),this.context.beginPath(),this.context.arc(a.x,a.y,a.circle.radius,0,2*Math.PI),a.active?this.context.fillStyle=a.isDown?c:
d:this.context.fillStyle=g,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(a.positionDown.x,a.positionDown.y),this.context.lineTo(a.position.x,a.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),b=a.movementX,c=a.movementY,(b||c)&&(this.context.beginPath(),this.context.moveTo(b+a.position.x,c+a.position.y),this.context.lineTo(a.position.x,a.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath()),
this.line("ID: "+a.id+" Active: "+a.active),this.line("World X: "+a.worldX.toFixed(1)+" World Y: "+a.worldY.toFixed(1)),this.line("Screen X: "+a.x.toFixed(1)+" Screen Y: "+a.y.toFixed(1)+" In: "+a.withinGame),this.line("Movement: X: "+b+" Y: "+c),this.line("Duration: "+a.duration+" ms"),this.line("is Down: "+a.isDown+" is Up: "+a.isUp),this.line("Identifier: "+a.identifier+" Pointer ID: "+a.pointerId),a.isMouse&&this.line("Buttons: "+this._pointerButtonIcon(a.leftButton)+" "+this._pointerButtonIcon(a.middleButton)+
" "+this._pointerButtonIcon(a.rightButton)),this.stop())},_pointerButtonIcon:function(a){return a.isDown?"x":a.isUp?"o":"-"},spriteInputInfo:function(a,b,c,d){this.start(b,c,d);this.line("Sprite Input: ("+a.width+" x "+a.height+")");this.line("x: "+a.input.pointerX().toFixed(1)+" y: "+a.input.pointerY().toFixed(1));this.line("over: "+a.input.pointerOver()+" duration: "+a.input.overDuration().toFixed(0));this.line("down: "+a.input.pointerDown()+" duration: "+a.input.downDuration().toFixed(0));this.line("just over: "+
a.input.justOver()+" just out: "+a.input.justOut());this.stop()},key:function(a,b,c,d){this.start(b,c,d,150);this.line("Key:",a.keyCode,"isDown:",a.isDown);this.line("justDown:",a.justDown,"justUp:",a.justUp);this.line("Time Down:",a.timeDown.toFixed(0),"duration:",a.duration.toFixed(0));this.stop()},inputInfo:function(a,b,c,d){var f=this.game.input;if(void 0===d&&(d=!0),this.start(a,b,c),this.line("Input"),this.line("X: "+f.x+" Y: "+f.y),this.line("World X: "+f.worldX+" World Y: "+f.worldY),this.line("Scale X: "+
f.scale.x.toFixed(2)+" Scale Y: "+f.scale.x.toFixed(2)),this.line("Screen X: "+f.activePointer.screenX.toFixed(1)+" Screen Y: "+f.activePointer.screenY.toFixed(1)),d){this.line("Sources:");this.line("  "+this._inputHandler(f.mouse,"mouse"));this.line("  "+this._inputHandler(f.mspointer,"mspointer"));this.line("  "+this._inputHandler(f.touch,"touch"));a=f.pointers;var g=f.mousePointer;b=e.PointerModes;d=c=0;this.line("Pointers:");this.line("  "+(g.isDown?"x":"o")+" "+b[g.pointerMode]+" "+g.identifier);
for(g=0;g<a.length;g++){var h=a[g];this.line("  "+(h.active?"+":"-")+" "+b[h.pointerMode]+" "+h.identifier);h.active?c+=1:d+=1}this.line("  Active: "+c+" Free: "+d+" Max: "+f.maxPointers)}this.stop()},inputHandler:function(a,b,c,d,f){this.start(c,d,f);this.line(b||"?");this.line("active: "+a.active);a.active&&(this.line("enabled: "+a.enabled),"capture"in a&&this.line("capture: "+a.capture),"preventDefault"in a&&this.line("preventDefault: "+a.preventDefault),"event"in a&&this.line("event: "+(a.event?
a.event.type:a.event)));this.stop()},_inputHandler:function(a,b){return this._inputHandlerStatusIcon(a)+" "+b+" "+this._inputHandlerCaptureIcon(a)},_inputHandlerStatusIcon:function(a){return a.active?a.enabled?"+":"-":" "},_inputHandlerCaptureIcon:function(a){return a.active&&(a.capture||a.preventDefault)?"*":" "},spriteBounds:function(a,b,c){a=a.getBounds();a.x+=this.game.camera.x;a.y+=this.game.camera.y;this.rectangle(a,b,c)},ropeSegments:function(a,b,c){var d=this;a.segments.forEach(function(f){d.rectangle(f,
b,c)},this)},spriteInfo:function(a,b,c,d){this.start(b,c,d);this.line("Sprite: "+(a.name||"")+" ("+a.width+" x "+a.height+") anchor: "+a.anchor.x+" x "+a.anchor.y);this.line("x: "+a.x.toFixed(1)+" y: "+a.y.toFixed(1));this.line("angle: "+a.angle.toFixed(1)+" rotation: "+a.rotation.toFixed(1));this.line("visible: "+a.visible+" in camera: "+a.inCamera);this.line("bounds x: "+a._bounds.x.toFixed(1)+" y: "+a._bounds.y.toFixed(1)+" w: "+a._bounds.width.toFixed(1)+" h: "+a._bounds.height.toFixed(1));this.line("parent: "+
(a.parent?a.parent.name||"(DisplayObject)":"(none)"));this.stop()},spriteCoords:function(a,b,c,d){this.start(b,c,d,100);a.name&&this.line(a.name);this.line("x:",a.x.toFixed(2),"y:",a.y.toFixed(2));this.line("pos x:",a.position.x.toFixed(2),"pos y:",a.position.y.toFixed(2));this.line("world x:",a.world.x.toFixed(2),"world y:",a.world.y.toFixed(2));this.stop()},lineInfo:function(a,b,c,d){this.start(b,c,d,80);this.line("start.x:",a.start.x.toFixed(2),"start.y:",a.start.y.toFixed(2));this.line("end.x:",
a.end.x.toFixed(2),"end.y:",a.end.y.toFixed(2));this.line("length:",a.length.toFixed(2),"angle:",a.angle);this.stop()},pixel:function(a,b,c,d){d=d||2;this.start();this.context.fillStyle=c;this.context.fillRect(a,b,d,d);this.stop()},geom:function(a,b,c,d){void 0===c&&(c=!0);void 0===d&&(d=0);b=b||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=b;this.context.strokeStyle=b;this.context.lineWidth=this.lineWidth;b=e.Utils.Debug;d===b.GEOM_RECTANGLE||a instanceof e.Rectangle?c?this.context.fillRect(a.x-
this.game.camera.x,a.y-this.game.camera.y,a.width,a.height):this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height):d===b.GEOM_CIRCLE||a instanceof e.Circle?(this.context.beginPath(),this.context.arc(a.x-this.game.camera.x,a.y-this.game.camera.y,a.radius,0,2*Math.PI,!1),this.context.closePath(),c?this.context.fill():this.context.stroke()):d===b.GEOM_POINT||a instanceof e.Point?this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,4,4):d===b.GEOM_LINE||
a instanceof e.Line?(this.context.beginPath(),this.context.moveTo(a.start.x+.5-this.game.camera.x,a.start.y+.5-this.game.camera.y),this.context.lineTo(a.end.x+.5-this.game.camera.x,a.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()):(d===b.GEOM_ELLIPSE||a instanceof e.Ellipse)&&(this.context.beginPath(),this.context.ellipse(a.centerX-this.game.camera.x,a.centerY-this.game.camera.y,a.width/2,a.height/2,0,2*Math.PI,!1),this.context.closePath(),c?this.context.fill():this.context.stroke());
this.stop()},rectangle:function(a,b,c){void 0===c&&(c=!0);b=b||"rgba(0, 255, 0, 0.4)";this.start();c?(this.context.fillStyle=b,this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)):(this.context.lineWidth=this.lineWidth,this.context.strokeStyle=b,this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height));this.stop()},text:function(a,b,c,d,f){d=d||"rgb(255,255,255)";f=f||this.font;this.start();this.context.font=f;this.renderShadow&&(this.context.fillStyle=
"rgb(0,0,0)",this.context.fillText(a,b+1,c+1));this.context.fillStyle=d;this.context.fillText(a,b,c);this.stop()},quadTree:function(a,b){b=b||"rgba(255,0,0,0.3)";this.start();var c=a.bounds;if(0===a.nodes.length)for(this.context.strokeStyle=b,this.context.strokeRect(c.x,c.y,c.width,c.height),this.text("size: "+a.objects.length,c.x+4,c.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",b=0;b<a.objects.length;b++)this.context.strokeRect(a.objects[b].x,a.objects[b].y,a.objects[b].width,
a.objects[b].height);else for(b=0;b<a.nodes.length;b++)this.quadTree(a.nodes[b]);this.stop()},body:function(a,b,c){a.body&&(this.start(),a.body.type===e.Physics.ARCADE?e.Physics.Arcade.Body.render(this.context,a.body,b,c,this.lineWidth):a.body.type===e.Physics.NINJA?e.Physics.Ninja.Body.render(this.context,a.body,b,c):a.body.type===e.Physics.BOX2D&&e.Physics.Box2D.renderBody(this.context,a.body,b),this.stop())},bodyInfo:function(a,b,c,d){a.body&&(this.start(b,c,d,210),a.body.type===e.Physics.ARCADE?
e.Physics.Arcade.Body.renderBodyInfo(this,a.body):a.body.type===e.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,a.body),this.stop())},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(a,b){this.start();e.Physics.Box2D.renderBody(this.context,a,b);this.stop()},displayList:function(a){if(void 0===a&&(a=this.game.world),a.hasOwnProperty("renderOrderID")?
console.log("["+a.renderOrderID+"]",a):console.log("[]",a),a.children&&0<a.children.length)for(var b=0;b<a.children.length;b++)this.game.debug.displayList(a.children[b])},renderer:function(a,b,c){var d=this.game.renderer,f=d.renderSession;if(this.start(a,b,c),this.line((d.gl?"WebGL":"Canvas")+" Renderer ("+d.width+" x "+d.height+")"),this.line("autoResize: "+d.autoResize),this.line("clearBeforeRender: "+d.clearBeforeRender),this.line("resolution: "+d.resolution),this.line("transparent: "+d.transparent),
this.line("renderSession:"),d.gl){this.line("  currentBatchedTextures: ("+d.currentBatchedTextures.length+")");for(a=0;a<d.currentBatchedTextures.length;a++)this.line("    "+d.currentBatchedTextures[a]);this.line("  drawCount: "+f.drawCount);this.line("  maxTextures: "+d.maxTextures);this.line("  maxTextureSize: "+d.maxTextureSize);this.line("  maxTextureAvailableSpace: "+f.maxTextureAvailableSpace);this.line("  roundPixels: "+f.roundPixels)}else this.line("  roundPixels: "+f.roundPixels),this.line("  scaleMode: "+
(0===f.scaleMode?"LINEAR":1===f.scaleMode?"NEAREST":f.scaleMode));this.stop()},canvasPool:function(a,b,c,d){var f=e.CanvasPool;this.start(a,b,c,d||100);this.line("Canvas Pool");this.line("Used:",f.getTotal());this.line("Free:",f.getFree());this.line("Total:",f.length);this.stop()},physicsGroup:function(a,b,c,d){a.forEach(this.body,this,d,b,c)},phaser:function(a,b,c){this.text("Phaser v"+e.VERSION+" "+(this.game.renderType===e.WEBGL?"WebGL":"Canvas")+" "+(this.game.device.webAudio?"WebAudio":"HTML Audio"),
a,b,c,this.font)},scale:function(a,b,c){this.start(a,b,c);b=this.game.scale;c=b.scaleFactorInversed;var d=b._parentBounds;a=" x ";this.line("Game: "+this.game.width+a+this.game.height);this.line("Canvas: "+b.width+a+b.height+" ("+c.x.toFixed(2)+a+c.y.toFixed(2)+") ["+b.aspectRatio.toFixed(2)+"]");this.line("Mode: "+e.ScaleManager.MODES[b.currentScaleMode]+(b.currentScaleMode===e.ScaleManager.USER_SCALE?" ("+b._userScaleFactor.x+a+b._userScaleFactor.y+")":""));this.line("Parent: "+(b.parentIsWindow?
"window":b.parentNode)+(d.empty?"":" ("+d.width+a+d.height+")"));this.line("Screen: "+b.classifyOrientation(b.screenOrientation)+(b.incorrectOrientation?" (incorrect)":""));this.stop()},loader:function(a,b,c,d){var f=e.Utils.pad;this.start(b,c,d);a.hasLoaded?this.line("Complete"+(a.resetLocked?" [locked]":"")):a.isLoading?this.line("Loading"):this.line("Not started");a.hasLoaded&&!a.resetLocked||(this.line("Progress: "+f(a.progress,3)+"%"),this.line("Files: "+a._loadedFileCount+" of "+a._totalFileCount),
this.line("Packs: "+a._loadedPackCount+" of "+a._loadedPackCount));this.stop()},device:function(a,b,c){var d=this.game.device;this.start(a,b,c);this.line("Device");this.line("Pointer Events: "+d.mspointer);this.line("Touch: "+d.touch);this.line("Web Audio: "+d.webAudio);this.line("WebGL: "+d.webGL);this.stop()},destroy:function(){e.CanvasPool.remove(this)}},e.Utils.Debug.prototype.constructor=e.Utils.Debug,e.DOM={getOffset:function(a,b){b=b||new e.Point;a=a.getBoundingClientRect();var c=e.DOM.scrollY,
d=document.documentElement.clientTop;return b.x=a.left+e.DOM.scrollX-document.documentElement.clientLeft,b.y=a.top+c-d,b},getBounds:function(a,b){return void 0===b&&(b=0),!(!(a=a&&!a.nodeType?a[0]:a)||1!==a.nodeType)&&this.calibrate(a.getBoundingClientRect(),b)},calibrate:function(a,b){b=+b||0;var c={width:0,height:0,left:0,right:0,top:0,bottom:0};return c.width=(c.right=a.right+b)-(c.left=a.left-b),c.height=(c.bottom=a.bottom+b)-(c.top=a.top-b),c},getAspectRatio:function(a){var b=(a=null==a?this.visualBounds:
1===a.nodeType?this.getBounds(a):a).width,c=a.height;return"function"==typeof b&&(b=b.call(a)),"function"==typeof c&&(c=c.call(a)),b/c},inLayoutViewport:function(a,b){a=this.getBounds(a,b);return!!a&&0<=a.bottom&&0<=a.right&&a.top<=this.layoutBounds.width&&a.left<=this.layoutBounds.height},getScreenOrientation:function(a){var b=window.screen,c=b.orientation||b.mozOrientation||b.msOrientation;if(c&&"string"==typeof c.type)return c.type;if("string"==typeof c)return c;if("screen"===a)return b.height>
b.width?"portrait-primary":"landscape-primary";if("viewport"===a)return this.visualBounds.height>this.visualBounds.width?"portrait-primary":"landscape-primary";if("window.orientation"===a&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?"portrait-primary":"landscape-primary";if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return"portrait-primary";if(window.matchMedia("(orientation: landscape)").matches)return"landscape-primary"}return this.visualBounds.height>
this.visualBounds.width?"portrait-primary":"landscape-primary"},visualBounds:new e.Rectangle,layoutBounds:new e.Rectangle,documentBounds:new e.Rectangle},e.Device.whenReady(function(a){var b=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},c=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};(Object.defineProperty(e.DOM,"scrollX",{get:b}),Object.defineProperty(e.DOM,
"scrollY",{get:c}),Object.defineProperty(e.DOM.visualBounds,"x",{get:b}),Object.defineProperty(e.DOM.visualBounds,"y",{get:c}),Object.defineProperty(e.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(e.DOM.layoutBounds,"y",{value:0}),a.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight)?(a=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},b=function(){return Math.max(window.innerHeight,
document.documentElement.clientHeight)},Object.defineProperty(e.DOM.visualBounds,"width",{get:a}),Object.defineProperty(e.DOM.visualBounds,"height",{get:b}),Object.defineProperty(e.DOM.layoutBounds,"width",{get:a}),Object.defineProperty(e.DOM.layoutBounds,"height",{get:b})):(Object.defineProperty(e.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(e.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(e.DOM.layoutBounds,
"width",{get:function(){var d=document.documentElement.clientWidth,f=window.innerWidth;return d<f?f:d}}),Object.defineProperty(e.DOM.layoutBounds,"height",{get:function(){var d=document.documentElement.clientHeight,f=window.innerHeight;return d<f?f:d}}));Object.defineProperty(e.DOM.documentBounds,"x",{value:0});Object.defineProperty(e.DOM.documentBounds,"y",{value:0});Object.defineProperty(e.DOM.documentBounds,"width",{get:function(){var d=document.documentElement;return Math.max(d.clientWidth,d.offsetWidth,
d.scrollWidth)}});Object.defineProperty(e.DOM.documentBounds,"height",{get:function(){var d=document.documentElement;return Math.max(d.clientHeight,d.offsetHeight,d.scrollHeight)}})},null,!0),e.ArraySet=function(a){this.position=0;this.list=a||[]},e.ArraySet.prototype={add:function(a){return this.exists(a)||this.list.push(a),a},getIndex:function(a){return this.list.indexOf(a)},getByKey:function(a,b){for(var c=this.list.length;c--;)if(this.list[c][a]===b)return this.list[c];return null},exists:function(a){return-1<
this.list.indexOf(a)},reset:function(){this.list.length=0},remove:function(a){var b=this.list.indexOf(a);if(-1<b)return this.list.splice(b,1),a},setAll:function(a,b){for(var c=this.list.length;c--;)this.list[c]&&(this.list[c][a]=b)},callAll:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=this.list.length;c--;)this.list[c]&&this.list[c][a]&&this.list[c][a].apply(this.list[c],b)},removeAll:function(a){void 0===a&&(a=!1);for(var b=this.list.length;b--;)if(this.list[b]){var c=this.remove(this.list[b]);
a&&c.destroy()}this.position=0;this.list=[]}},Object.defineProperty(e.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(e.ArraySet.prototype,"first",{get:function(){return(this.position=0)<this.list.length?this.list[0]:null}}),Object.defineProperty(e.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),e.ArraySet.prototype.constructor=e.ArraySet,e.ArrayUtils={getRandomItem:function(a,
b,c){if(null===a)return null;void 0===b&&(b=0);void 0===c&&(c=a.length);b+=Math.floor(Math.random()*c);return void 0===a[b]?null:a[b]},removeRandomItem:function(a,b,c){if(null==a)return null;void 0===b&&(b=0);void 0===c&&(c=a.length);b+=Math.floor(Math.random()*c);return b<a.length?(a=a.splice(b,1),void 0===a[0]?null:a[0]):null},remove:function(a,b,c){var d=a.length;if(!(d<=b||0===c)){null==c&&(c=1);for(d-=c;b<d;++b)a[b]=a[b+c];a.length=d}},shuffle:function(a){for(var b=a.length-1;0<b;b--){var c=
Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d}return a},transposeMatrix:function(a){for(var b=a.length,c=a[0].length,d=Array(c),f=0;f<c;f++){d[f]=Array(b);for(var g=b-1;-1<g;g--)d[f][g]=a[g][f]}return d},rotateMatrix:function(a,b){if("string"!=typeof b&&(b=(b%360+360)%360),90===b||-270===b||"rotateLeft"===b)a=(a=e.ArrayUtils.transposeMatrix(a)).reverse();else if(-90===b||270===b||"rotateRight"===b)a=a.reverse(),a=e.ArrayUtils.transposeMatrix(a);else if(180===Math.abs(b)||"rotate180"===b){for(b=
0;b<a.length;b++)a[b].reverse();a=a.reverse()}return a},findClosest:function(a,b){if(!b.length)return NaN;if(1===b.length||a<b[0])return b[0];for(var c=1;b[c]<a;)c++;var d=b[c-1];b=c<b.length?b[c]:Number.POSITIVE_INFINITY;return b-a<=a-d?b:d},rotateRight:function(a){var b=a.pop();return a.unshift(b),b},rotateLeft:function(a){var b=a.shift();return a.push(b),b},numberArray:function(a,b){null==b&&(b=a,a=0);for(var c=[];a<=b;a++)c.push(a);return c},numberArrayStep:function(a,b,c){null==a&&(a=0);null==
b&&(b=a,a=0);void 0===c&&(c=1);var d=[];b=Math.max(e.Math.roundAwayFromZero((b-a)/(c||1)),0);for(var f=0;f<b;f++)d.push(a),a+=c;return d}},e.LinkedList=function(){this.last=this.first=this.prev=this.next=null;this.total=0},e.LinkedList.prototype={add:function(a){return 0===this.total&&null===this.first&&null===this.last?(this.first=a,this.last=a,((this.next=a).prev=this).total++):((this.last.next=a).prev=this.last,this.last=a,this.total++),a},reset:function(){this.prev=this.next=this.last=this.first=
null;this.total=0},remove:function(a){if(1===this.total)return this.reset(),void(a.next=a.prev=null);a===this.first?this.first=this.first.next:a===this.last&&(this.last=this.last.prev);a.prev&&(a.prev.next=a.next);a.next&&(a.next.prev=a.prev);a.next=a.prev=null;null===this.first&&(this.last=null);this.total--},callAll:function(a){if(this.first&&this.last)for(var b=this.first;b&&b[a]&&b[a].call(b),(b=b.next)!==this.last.next;);}},e.LinkedList.prototype.constructor=e.LinkedList,e.Create=function(a){this.game=
a;this.ctx=this.canvas=this.bmd=null;this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",
6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]},e.Create.PALETTE_ARNE=
0,e.Create.PALETTE_JMP=1,e.Create.PALETTE_CGA=2,e.Create.PALETTE_C64=3,e.Create.PALETTE_JAPANESE_MACHINE=4,e.Create.prototype={texture:function(a,b,c,d,f,g,h,m){void 0===c&&(c=8);void 0===d&&(d=c);void 0===f&&(f=0);void 0===g&&(g=!0);var n=b[0].length*c,p=b.length*d;null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context);this.bmd.resize(n,p);this.bmd.clear();for(n=0;n<b.length;n++){p=b[n];for(var q=0;q<p.length;q++){var r=p[q];"."!==r&&" "!==r&&
(this.ctx.fillStyle=this.palettes[f][r],this.ctx.fillRect(q*c,n*d,c,d))}}return g?this.bmd.generateTexture(a,h,m):this.copy()},grid:function(a,b,c,d,f,g,h,m,n){void 0===h&&(h=!0);null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context);this.bmd.resize(b,c);this.ctx.fillStyle=g;for(g=0;g<c;g+=f)this.ctx.fillRect(0,g,b,1);for(f=0;f<b;f+=d)this.ctx.fillRect(f,0,1,c);return h?this.bmd.generateTexture(a,m,n):this.copy()},copy:function(a,b,c,d,f,g,h){return null==
a&&(a=this.game.make.bitmapData()),a.resize(this.bmd.width,this.bmd.height),a.draw(this.bmd,b,c,d,f,g,h)}},e.Create.prototype.constructor=e.Create,e.FlexGrid=function(a,b,c){this.game=a.game;this.manager=a;this.width=b;this.height=c;this.boundsCustom=new e.Rectangle(0,0,b,c);this.boundsFluid=new e.Rectangle(0,0,b,c);this.boundsFull=new e.Rectangle(0,0,b,c);this.boundsNone=new e.Rectangle(0,0,b,c);this.positionCustom=new e.Point(0,0);this.positionFluid=new e.Point(0,0);this.positionFull=new e.Point(0,
0);this.positionNone=new e.Point(0,0);this.scaleCustom=new e.Point(1,1);this.scaleFluid=new e.Point(1,1);this.scaleFluidInversed=new e.Point(1,1);this.scaleFull=new e.Point(1,1);this.scaleNone=new e.Point(1,1);this.customOffsetY=this.customOffsetX=this.customHeight=this.customWidth=0;this.ratioH=b/c;this.ratioV=c/b;this.multiplier=0;this.layers=[]},e.FlexGrid.prototype={setSize:function(a,b){this.width=a;this.height=b;this.ratioH=a/b;this.ratioV=b/a;this.scaleNone=new e.Point(1,1);this.boundsNone.width=
this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(a,b,c,d){void 0===d&&(d=!0);this.customWidth=a;this.customHeight=b;this.boundsCustom.width=a;this.boundsCustom.height=b;a=new e.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return d&&this.game.world.add(a),this.layers.push(a),c&&a.addMultiple(c),a},createFluidLayer:function(a,b){void 0===b&&(b=!0);var c=new e.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return b&&
this.game.world.add(c),this.layers.push(c),a&&c.addMultiple(a),c},createFullLayer:function(a){var b=new e.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(b),this.layers.push(b),void 0!==a&&b.addMultiple(a),b},createFixedLayer:function(a){var b=new e.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(b),this.layers.push(b),void 0!==a&&b.addMultiple(a),b},reset:function(){for(var a=this.layers.length;a--;)this.layers[a].persist||
(this.layers[a].position=null,this.layers[a].scale=null,this.layers.slice(a,1))},onResize:function(a,b){this.ratioH=a/b;this.ratioV=b/a;this.refresh(a,b)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/
this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,
this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(a){this.manager.scaleSprite(a);a.x=this.manager.bounds.centerX;a.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},e.FlexGrid.prototype.constructor=e.FlexGrid,e.FlexLayer=function(a,b,c,d){e.Group.call(this,a.game,null,"__flexLayer"+
a.game.rnd.uuid(),!1);this.manager=a.manager;this.grid=a;this.persist=!1;this.position=b;this.bounds=c;this.scale=d;this.topLeft=c.topLeft;this.topMiddle=new e.Point(c.halfWidth,0);this.topRight=c.topRight;this.bottomLeft=c.bottomLeft;this.bottomMiddle=new e.Point(c.halfWidth,c.bottom);this.bottomRight=c.bottomRight},e.FlexLayer.prototype=Object.create(e.Group.prototype),e.FlexLayer.prototype.constructor=e.FlexLayer,e.FlexLayer.prototype.resize=function(){},e.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+
" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},e.Color={RED:16711680,ORANGE:16750848,YELLOW:16776960,GREEN:65280,AQUA:65535,BLUE:255,VIOLET:16711935,WHITE:16777215,BLACK:0,GRAY:6710886,packPixel:function(a,b,c,d){return e.Device.LITTLE_ENDIAN?(d<<24|c<<16|
b<<8|a)>>>0:(a<<24|b<<16|c<<8|d)>>>0},unpackPixel:function(a,b,c,d){return null==b&&(b=e.Color.createColor()),null==c&&(c=!1),null==d&&(d=!1),e.Device.LITTLE_ENDIAN?(b.a=(4278190080&a)>>>24,b.b=(16711680&a)>>>16,b.g=(65280&a)>>>8,b.r=255&a):(b.r=(4278190080&a)>>>24,b.g=(16711680&a)>>>16,b.b=(65280&a)>>>8,b.a=255&a),b.color=a,b.rgba="rgba("+b.r+","+b.g+","+b.b+","+b.a/255+")",c&&e.Color.RGBtoHSL(b.r,b.g,b.b,b),d&&e.Color.RGBtoHSV(b.r,b.g,b.b,b),b},fromRGBA:function(a,b){return b||=e.Color.createColor(),
b.r=(4278190080&a)>>>24,b.g=(16711680&a)>>>16,b.b=(65280&a)>>>8,b.a=255&a,b.rgba="rgba("+b.r+","+b.g+","+b.b+","+b.a+")",b},toRGBA:function(a,b,c,d){return a<<24|b<<16|c<<8|d},toABGR:function(a,b,c,d){return(d<<24|c<<16|b<<8|a)>>>0},hexToRGBArray:function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]},RGBArrayToHex:function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},RGBtoHSL:function(a,b,c,d){d||=e.Color.createColor(a,b,c,1);a/=255;b/=255;c/=255;var f=Math.min(a,b,c),g=Math.max(a,b,c);
if(d.h=0,d.s=0,d.l=(g+f)/2,g!==f){var h=g-f;d.s=.5<d.l?h/(2-g-f):h/(g+f);g===a?d.h=(b-c)/h+(b<c?6:0):g===b?d.h=(c-a)/h+2:g===c&&(d.h=(a-b)/h+4);d.h/=6}return d},HSLtoRGB:function(a,b,c,d){if(d?(d.r=c,d.g=c,d.b=c):d=e.Color.createColor(c,c,c),0!==b)b=.5>c?c*(1+b):c+b-c*b,c=2*c-b,d.r=e.Color.hueToColor(c,b,a+1/3),d.g=e.Color.hueToColor(c,b,a),d.b=e.Color.hueToColor(c,b,a-1/3);return d.r=Math.floor(255*d.r|0),d.g=Math.floor(255*d.g|0),d.b=Math.floor(255*d.b|0),e.Color.updateColor(d),d},RGBtoHSV:function(a,
b,c,d){d||=e.Color.createColor(a,b,c,255);a/=255;b/=255;c/=255;var f=Math.min(a,b,c),g=Math.max(a,b,c),h=g-f;return d.h=0,d.s=0===g?0:h/g,(d.v=g)!==f&&(g===a?d.h=(b-c)/h+(b<c?6:0):g===b?d.h=(c-a)/h+2:g===c&&(d.h=(a-b)/h+4),d.h/=6),d},HSVtoRGB:function(a,b,c,d){void 0===d&&(d=e.Color.createColor(0,0,0,1,a,b,0,c));var f=Math.floor(6*a),g=6*a-f;a=c*(1-b);var h=c*(1-g*b);b=c*(1-(1-g)*b);switch(f%6){case 0:var m=c;var n=b;var p=a;break;case 1:m=h;n=c;p=a;break;case 2:m=a;n=c;p=b;break;case 3:m=a;n=h;p=
c;break;case 4:m=b;n=a;p=c;break;case 5:m=c,n=a,p=h}return d.r=Math.floor(255*m),d.g=Math.floor(255*n),d.b=Math.floor(255*p),e.Color.updateColor(d),d},hueToColor:function(a,b,c){return 0>c&&(c+=1),1<c&&--c,c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a},createColor:function(a,b,c,d,f,g,h,m){return e.Color.updateColor({r:a||0,g:b||0,b:c||0,a:d||1,h:f||0,s:g||0,l:h||0,v:m||0,color:0,color32:0,rgba:""})},updateColor:function(a){return a.rgba="rgba("+a.r.toFixed()+","+a.g.toFixed()+","+a.b.toFixed()+
","+a.a.toString()+")",a.color=e.Color.getColor(a.r,a.g,a.b),a.color32=e.Color.getColor32(255*a.a,a.r,a.g,a.b),a},getColor32:function(a,b,c,d){return a<<24|b<<16|c<<8|d},getColor:function(a,b,c){return a<<16|b<<8|c},RGBtoString:function(a,b,c,d,f){return void 0===d&&(d=255),void 0===f&&(f="#"),"#"===f?"#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1):"0x"+e.Color.componentToHex(d)+e.Color.componentToHex(a)+e.Color.componentToHex(b)+e.Color.componentToHex(c)},hexToRGB:function(a){if(a=e.Color.hexToColor(a))return e.Color.getColor32(a.a,
a.r,a.g,a.b)},hexToColor:function(a,b){a=a.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(f,g,h,m){return g+g+h+h+m+m});var c=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);if(c){a=parseInt(c[1],16);var d=parseInt(c[2],16);c=parseInt(c[3],16);b?(b.r=a,b.g=d,b.b=c):b=e.Color.createColor(a,d,c)}return b},webToColor:function(a,b){b||=e.Color.createColor();a=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(a);return a&&(b.r=~~Number(a[1]),b.g=~~Number(a[2]),
b.b=~~Number(a[3]),b.a=void 0!==a[4]?Number(a[4]):1,e.Color.updateColor(b)),b},valueToColor:function(a,b){if(b||=e.Color.createColor(),"string"==typeof a)return 0===a.indexOf("rgb")?e.Color.webToColor(a,b):(b.a=1,e.Color.hexToColor(a,b));if("number"!=typeof a)return b;a=e.Color.getRGB(a);return b.r=a.r,b.g=a.g,b.b=a.b,b.a=a.a/255,b},componentToHex:function(a){a=a.toString(16);return 1===a.length?"0"+a:a},HSVColorWheel:function(a,b){void 0===a&&(a=1);void 0===b&&(b=1);for(var c=[],d=0;359>=d;d++)c.push(e.Color.HSVtoRGB(d/
359,a,b));return c},HSLColorWheel:function(a,b){void 0===a&&(a=.5);void 0===b&&(b=.5);for(var c=[],d=0;359>=d;d++)c.push(e.Color.HSLtoRGB(d/359,a,b));return c},interpolateColor:function(a,b,c,d,f,g){void 0===f&&(f=255);void 0===g&&(g=0);a=e.Color.getRGB(a);b=e.Color.getRGB(b);if(0===g)var h=(b.red-a.red)*d/c+a.red,m=(b.green-a.green)*d/c+a.green,n=(b.blue-a.blue)*d/c+a.blue;if(1===g){var p;g=e.Color.RGBtoHSV(a.r,a.g,a.b);h=e.Color.RGBtoHSV(b.r,b.g,b.b);m=h.h-g.h;g.h>h.h&&(n=h.h,h.h=g.h,g.h=n,m=-m,
d=c-d);.5<m&&(g.h+=1,p=((h.h-g.h)*d/c+g.h)%1);.5>=m&&(p=(h.h-g.h)*d/c+g.h);var q=e.Color.HSVtoRGB(p,(h.s-g.s)*d/c+g.s,(h.v-g.v)*d/c+g.v,q);h=q.r;m=q.g;n=q.b}return e.Color.getColor32(f,h,m,n)},interpolateColorWithRGB:function(a,b,c,d,f,g){a=e.Color.getRGB(a);return e.Color.getColor((b-a.red)*g/f+a.red,(c-a.green)*g/f+a.green,(d-a.blue)*g/f+a.blue)},interpolateRGB:function(a,b,c,d,f,g,h,m){return e.Color.getColor((d-a)*m/h+a,(f-b)*m/h+b,(g-c)*m/h+c)},linear:function(a,b,c){return this.interpolateColor(a,
b,1,c)},linearInterpolation:function(a,b){b=e.Math.linear(0,a.length-1,b);return this.linear(a[Math.floor(b)],a[Math.ceil(b)],b%1)},getRandomColor:function(a,b,c){return(void 0===a&&(a=0),void 0===b&&(b=255),void 0===c&&(c=255),255<b||b<a)?e.Color.getColor(255,255,255):e.Color.getColor32(c,a+Math.round(Math.random()*(b-a)),a+Math.round(Math.random()*(b-a)),a+Math.round(Math.random()*(b-a)))},getRGB:function(a){return 16777215<a?{alpha:a>>>24,red:a>>16&255,green:a>>8&255,blue:255&a,a:a>>>24,r:a>>16&
255,g:a>>8&255,b:255&a}:{alpha:255,red:a>>16&255,green:a>>8&255,blue:255&a,a:255,r:a>>16&255,g:a>>8&255,b:255&a}},getWebRGB:function(a){if("object"==typeof a)return"rgba("+a.r.toString()+","+a.g.toString()+","+a.b.toString()+","+(a.a/255).toString()+")";a=e.Color.getRGB(a);return"rgba("+a.r.toString()+","+a.g.toString()+","+a.b.toString()+","+(a.a/255).toString()+")"},getAlpha:function(a){return a>>>24},getAlphaFloat:function(a){return(a>>>24)/255},getRed:function(a){return a>>16&255},getGreen:function(a){return a>>
8&255},getBlue:function(a){return 255&a},blendNormal:function(a){return a},blendLighten:function(a,b){return a<b?b:a},blendDarken:function(a,b){return a<b?a:b},blendMultiply:function(a,b){return a*b/255},blendAverage:function(a,b){return(a+b)/2},blendAdd:function(a,b){return Math.min(255,a+b)},blendSubtract:function(a,b){return Math.max(0,a+b-255)},blendDifference:function(a,b){return Math.abs(a-b)},blendNegation:function(a,b){return 255-Math.abs(255-a-b)},blendScreen:function(a,b){return 255-((255-
a)*(255-b)>>8)},blendExclusion:function(a,b){return a+b-2*a*b/255},blendOverlay:function(a,b){return 128>b?2*a*b/255:255-2*(255-a)*(255-b)/255},blendSoftLight:function(a,b){return 128>b?b/255*(64+(a>>1))*2:255-2*(255-(64+(a>>1)))*(255-b)/255},blendHardLight:function(a,b){return e.Color.blendOverlay(b,a)},blendColorDodge:function(a,b){return 255===b?b:Math.min(255,(a<<8)/(255-b))},blendColorBurn:function(a,b){return 0===b?b:Math.max(0,255-(255-a<<8)/b)},blendLinearDodge:function(a,b){return e.Color.blendAdd(a,
b)},blendLinearBurn:function(a,b){return e.Color.blendSubtract(a,b)},blendLinearLight:function(a,b){return 128>b?e.Color.blendLinearBurn(a,2*b):e.Color.blendLinearDodge(a,2*(b-128))},blendVividLight:function(a,b){return 128>b?e.Color.blendColorBurn(a,2*b):e.Color.blendColorDodge(a,2*(b-128))},blendPinLight:function(a,b){return 128>b?e.Color.blendDarken(a,2*b):e.Color.blendLighten(a,2*(b-128))},blendHardMix:function(a,b){return 128>e.Color.blendVividLight(a,b)?0:255},blendReflect:function(a,b){return 255===
b?b:Math.min(255,a*a/(255-b))},blendGlow:function(a,b){return e.Color.blendReflect(b,a)},blendPhoenix:function(a,b){return Math.min(a,b)-Math.max(a,b)+255}},e.Physics=function(a,b){b=b||{};this.game=a;this.config=b;this.matter=this.chipmunk=this.box2d=this.ninja=this.p2=this.arcade=null;this.parseConfig()},e.Physics.ARCADE=0,e.Physics.P2JS=1,e.Physics.NINJA=2,e.Physics.BOX2D=3,e.Physics.CHIPMUNK=4,e.Physics.MATTERJS=5,e.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&
!0!==this.config.arcade||!e.Physics.hasOwnProperty("Arcade")||(this.arcade=new e.Physics.Arcade(this.game));this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&e.Physics.hasOwnProperty("Ninja")&&(this.ninja=new e.Physics.Ninja(this.game));this.config.hasOwnProperty("p2")&&!0===this.config.p2&&e.Physics.hasOwnProperty("P2")&&(this.p2=new e.Physics.P2(this.game,this.config));this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&e.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new e.Physics.Box2D(this.game,
this.config));this.config.hasOwnProperty("matter")&&!0===this.config.matter&&e.Physics.hasOwnProperty("Matter")&&(this.matter=new e.Physics.Matter(this.game,this.config))},startSystem:function(a){a===e.Physics.ARCADE?this.arcade=new e.Physics.Arcade(this.game):a===e.Physics.P2JS?null===this.p2?this.p2=new e.Physics.P2(this.game,this.config):this.p2.reset():a===e.Physics.NINJA?this.ninja=new e.Physics.Ninja(this.game):a===e.Physics.BOX2D?null===this.box2d?this.box2d=new e.Physics.Box2D(this.game,this.config):
this.box2d.reset():a===e.Physics.MATTERJS&&(null===this.matter?this.matter=new e.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(a,b,c){void 0===b&&(b=e.Physics.ARCADE);void 0===c&&(c=!1);b===e.Physics.ARCADE?this.arcade.enable(a):b===e.Physics.P2JS&&this.p2?this.p2.enable(a,c):b===e.Physics.NINJA&&this.ninja?this.ninja.enableAABB(a):b===e.Physics.BOX2D&&this.box2d?this.box2d.enable(a):b===e.Physics.MATTERJS&&this.matter?this.matter.enable(a):console.warn(a.key+" is attempting to enable a physics body using an unknown physics system.")},
preUpdate:function(){this.p2&&this.p2.preUpdate();this.box2d&&this.box2d.preUpdate();this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update();this.box2d&&this.box2d.update();this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld();this.ninja&&this.ninja.setBoundsToWorld();this.p2&&this.p2.setBoundsToWorld();this.box2d&&this.box2d.setBoundsToWorld();this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear();
this.box2d&&this.box2d.clear();this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset();this.box2d&&this.box2d.reset();this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy();this.box2d&&this.box2d.destroy();this.matter&&this.matter.destroy();this.matter=this.box2d=this.p2=this.ninja=this.arcade=null}},e.Physics.prototype.constructor=e.Physics,e.Physics.Arcade=function(a){this.game=a;this.gravity=new e.Point;this.bounds=new e.Rectangle(0,0,a.world.width,
a.world.height);this.checkCollision={up:!0,down:!0,left:!0,right:!0};this.maxObjects=10;this.OVERLAP_BIAS=this.maxLevels=4;this.forceX=!1;this.sortDirection=e.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=!0;this.isPaused=!1;this.quadTree=new e.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()},e.Physics.Arcade.prototype.constructor=e.Physics.Arcade,e.Physics.Arcade.SORT_NONE=
0,e.Physics.Arcade.LEFT_RIGHT=1,e.Physics.Arcade.RIGHT_LEFT=2,e.Physics.Arcade.TOP_BOTTOM=3,e.Physics.Arcade.BOTTOM_TOP=4,e.Physics.Arcade.prototype={setBounds:function(a,b,c,d){this.bounds.setTo(a,b,c,d)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(a,b){void 0===b&&(b=!0);var c;if(Array.isArray(a))for(c=a.length;c--;)a[c]instanceof e.Group?this.enable(a[c].children,b):(this.enableBody(a[c]),b&&a[c].hasOwnProperty("children")&&0<a[c].children.length&&
this.enable(a[c],!0));else a instanceof e.Group?this.enable(a.children,b):(this.enableBody(a),b&&a.hasOwnProperty("children")&&0<a.children.length&&this.enable(a.children,!0))},enableBody:function(a){a.hasOwnProperty("body")&&null===a.body&&(a.body=new e.Physics.Arcade.Body(a),a.parent&&a.parent instanceof e.Group&&a.parent.addToHash(a))},updateMotion:function(a){if(a.allowRotation){var b=this.computeVelocity(0,a,a.angularVelocity,a.angularAcceleration,a.angularDrag,a.maxAngular)-a.angularVelocity;
a.angularVelocity+=b;a.rotation+=.001*a.angularVelocity*this.game.time.delta}a.velocity.x=this.computeVelocity(1,a,a.velocity.x,a.acceleration.x,a.drag.x,a.maxVelocity.x);a.velocity.y=this.computeVelocity(2,a,a.velocity.y,a.acceleration.y,a.drag.y,a.maxVelocity.y)},computeVelocity:function(a,b,c,d,f,g){return void 0===g&&(g=1E4),1===a&&b.allowGravity?c+=.001*(this.gravity.x+b.gravity.x)*this.game.time.delta:2===a&&b.allowGravity&&(c+=.001*(this.gravity.y+b.gravity.y)*this.game.time.delta),d?c+=.001*
d*this.game.time.delta:f&&b.allowDrag&&(0<c-(f*=.001*this.game.time.delta)?c-=f:0>c+f?c+=f:c=0),g<c?c=g:c<-g&&(c=-g),c},overlap:function(a,b,c,d,f){return c=c||null,d=d||null,f=f||c,this._total=0,this.collideObjects(a,b,c,d,f,!0),0<this._total},collide:function(a,b,c,d,f){return c=c||null,d=d||null,f=f||c,this._total=0,this.collideObjects(a,b,c,d,f,!1),0<this._total},sortLeftRight:function(a,b){return a.body&&b.body?a.body.x-b.body.x:0},sortRightLeft:function(a,b){return a.body&&b.body?b.body.x-a.body.x:
0},sortTopBottom:function(a,b){return a.body&&b.body?a.body.y-b.body.y:0},sortBottomTop:function(a,b){return a.body&&b.body?b.body.y-a.body.y:0},sort:function(a,b){null!==a.physicsSortDirection?b=a.physicsSortDirection:void 0===b&&(b=this.sortDirection);b===e.Physics.Arcade.LEFT_RIGHT?a.hash.sort(this.sortLeftRight):b===e.Physics.Arcade.RIGHT_LEFT?a.hash.sort(this.sortRightLeft):b===e.Physics.Arcade.TOP_BOTTOM?a.hash.sort(this.sortTopBottom):b===e.Physics.Arcade.BOTTOM_TOP&&a.hash.sort(this.sortBottomTop)},
collideObjects:function(a,b,c,d,f,g){if(!Array.isArray(a)&&Array.isArray(b))for(var h=0;h<b.length;h++)b[h]&&this.collideHandler(a,b[h],c,d,f,g);else if(Array.isArray(a)&&!Array.isArray(b))for(h=0;h<a.length;h++)a[h]&&this.collideHandler(a[h],b,c,d,f,g);else if(Array.isArray(a)&&Array.isArray(b))for(h=0;h<a.length;h++){if(a[h])for(var m=0;m<b.length;m++)b[m]&&this.collideHandler(a[h],b[m],c,d,f,g)}else this.collideHandler(a,b,c,d,f,g)},collideHandler:function(a,b,c,d,f,g){if(void 0===b&&a.physicsType===
e.GROUP)return this.sort(a),void this.collideGroupVsSelf(a,c,d,f,g);a&&b&&a.exists&&b.exists&&(this.sortDirection!==e.Physics.Arcade.SORT_NONE&&(a.physicsType===e.GROUP&&this.sort(a),b.physicsType===e.GROUP&&this.sort(b)),a.physicsType===e.SPRITE?b.physicsType===e.SPRITE?this.collideSpriteVsSprite(a,b,c,d,f,g):b.physicsType===e.GROUP?this.collideSpriteVsGroup(a,b,c,d,f,g):b.physicsType===e.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(a,b,c,d,f,g):a.physicsType===e.GROUP?b.physicsType===e.SPRITE?
this.collideSpriteVsGroup(b,a,c,d,f,g):b.physicsType===e.GROUP?this.collideGroupVsGroup(a,b,c,d,f,g):b.physicsType===e.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(a,b,c,d,f,g):a.physicsType===e.TILEMAPLAYER&&(b.physicsType===e.SPRITE?this.collideSpriteVsTilemapLayer(b,a,c,d,f,g):b.physicsType===e.GROUP&&this.collideGroupVsTilemapLayer(b,a,c,d,f,g)))},collideSpriteVsSprite:function(a,b,c,d,f,g){return!(!a.body||!b.body)&&(this.separate(a.body,b.body,d,f,g)&&(c&&c.call(f,a,b),this._total++),!0)},
collideSpriteVsGroup:function(a,b,c,d,f,g){if(0!==b.length&&a.body)if(this.skipQuadTree||a.body.skipQuadTree)for(var h={},m=0;m<b.hash.length;m++){var n=b.hash[m];if(n&&n.exists&&n.body){if(h=n.body.getBounds(h),this.sortDirection===e.Physics.Arcade.LEFT_RIGHT){if(a.body.right<h.x)break;if(h.right<a.body.x)continue}else if(this.sortDirection===e.Physics.Arcade.RIGHT_LEFT){if(a.body.x>h.right)break;if(h.x>a.body.right)continue}else if(this.sortDirection===e.Physics.Arcade.TOP_BOTTOM){if(a.body.bottom<
h.y)break;if(h.bottom<a.body.y)continue}else if(this.sortDirection===e.Physics.Arcade.BOTTOM_TOP){if(a.body.y>h.bottom)break;if(h.y>a.body.bottom)continue}this.collideSpriteVsSprite(a,n,c,d,f,g)}}else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(b),b=this.quadTree.retrieve(a),m=0;m<b.length;m++)this.separate(a.body,b[m],d,f,g)&&(c&&c.call(f,
a,b[m].sprite),this._total++)},collideGroupVsSelf:function(a,b,c,d,f){if(0!==a.length)for(var g=0;g<a.hash.length;g++){var h={},m=a.hash[g];if(m&&m.exists&&m.body){h=m.body.getBounds(h);for(var n=g+1;n<a.hash.length;n++){var p={},q=a.hash[n];if(q&&q.exists&&q.body){if(p=q.body.getBounds(p),this.sortDirection===e.Physics.Arcade.LEFT_RIGHT){if(h.right<p.x)break;if(p.right<h.x)continue}else if(this.sortDirection===e.Physics.Arcade.RIGHT_LEFT){if(h.x>p.right)continue;if(p.x>h.right)break}else if(this.sortDirection===
e.Physics.Arcade.TOP_BOTTOM){if(h.bottom<p.y)continue;if(p.bottom<h.y)break}else if(this.sortDirection===e.Physics.Arcade.BOTTOM_TOP){if(h.y>p.bottom)continue;if(p.y>m.body.bottom)break}this.collideSpriteVsSprite(m,q,b,c,d,f)}}}}},collideGroupVsGroup:function(a,b,c,d,f,g){if(0!==a.length&&0!==b.length)for(var h=0;h<a.children.length;h++)a.children[h].exists&&(a.children[h].physicsType===e.GROUP?this.collideGroupVsGroup(a.children[h],b,c,d,f,g):this.collideSpriteVsGroup(a.children[h],b,c,d,f,g))},
separate:function(a,b,c,d,f){if(!a.enable||!b.enable||a.checkCollision.none||b.checkCollision.none||!this.intersects(a,b)||c&&!1===c.call(d,a.sprite,b.sprite))return!1;if(a.isCircle&&b.isCircle)return this.separateCircle(a,b,f);if(a.isCircle!==b.isCircle){c=a.isCircle?b:a;d=c.x;var g=c.right,h=c.bottom,m=(a.isCircle?a:b).center;if((m.y<c.y||m.y>h)&&(m.x<d||m.x>g))return this.separateCircle(a,b,f)}d=c=!1;this.forceX||Math.abs(this.gravity.y+a.gravity.y)<Math.abs(this.gravity.x+a.gravity.x)?(c=this.separateX(a,
b,f),this.intersects(a,b)&&(d=this.separateY(a,b,f))):(d=this.separateY(a,b,f),this.intersects(a,b)&&(c=this.separateX(a,b,f)));c=c||d;return c&&(f?(a.onOverlap&&a.onOverlap.dispatch(a.sprite,b.sprite),b.onOverlap&&b.onOverlap.dispatch(b.sprite,a.sprite)):(a.onCollide&&a.onCollide.dispatch(a.sprite,b.sprite),b.onCollide&&b.onCollide.dispatch(b.sprite,a.sprite))),c},intersects:function(a,b){return a!==b&&(a.isCircle?b.isCircle?e.Math.distance(a.center.x,a.center.y,b.center.x,b.center.y)<=a.halfWidth+
b.halfWidth:this.circleBodyIntersects(a,b):b.isCircle?this.circleBodyIntersects(b,a):!(a.right<=b.position.x)&&!(a.bottom<=b.position.y)&&!(a.position.x>=b.right)&&!(a.position.y>=b.bottom))},circleBodyIntersects:function(a,b){var c=e.Math.clamp(a.center.x,b.left,b.right);b=e.Math.clamp(a.center.y,b.top,b.bottom);return(a.center.x-c)*(a.center.x-c)+(a.center.y-b)*(a.center.y-b)<=a.halfWidth*a.halfWidth},separateCircle:function(a,b,c){this.getOverlapX(a,b);this.getOverlapY(a,b);var d=Math.atan2(b.center.y-
a.center.y,b.center.x-a.center.x),f=0;if(a.isCircle!==b.isCircle){var g=b.isCircle?a.position.x:b.position.x,h=b.isCircle?a.position.y:b.position.y,m=b.isCircle?a.right:b.right,n=b.isCircle?a.bottom:b.bottom,p=a.isCircle?a.center.x:b.center.x,q=a.isCircle?a.center.y:b.center.y,r=a.isCircle?a.halfWidth:b.halfWidth;q<h?p<g?f=e.Math.distance(p,q,g,h)-r:m<p&&(f=e.Math.distance(p,q,m,h)-r):n<q&&(p<g?f=e.Math.distance(p,q,g,n)-r:m<p&&(f=e.Math.distance(p,q,m,n)-r));f*=-1}else f=a.halfWidth+b.halfWidth-
e.Math.distance(a.center.x,a.center.y,b.center.x,b.center.y);if(c||0===f||a.immovable&&b.immovable||a.customSeparateX||b.customSeparateX)return 0!==f&&(a.onOverlap&&a.onOverlap.dispatch(a.sprite,b.sprite),b.onOverlap&&b.onOverlap.dispatch(b.sprite,a.sprite)),0!==f;m=a.velocity.x*Math.cos(d)+a.velocity.y*Math.sin(d);c=-a.velocity.x*Math.sin(d)+a.velocity.y*Math.cos(d);n=b.velocity.x*Math.cos(d)+b.velocity.y*Math.sin(d);g=-b.velocity.x*Math.sin(d)+b.velocity.y*Math.cos(d);h=((a.mass-b.mass)*m+2*b.mass*
n)/(a.mass+b.mass);m=(2*a.mass*m+(b.mass-a.mass)*n)/(a.mass+b.mass);return a.immovable||(a.velocity.x=(h*Math.cos(d)-c*Math.sin(d))*a.bounce.x,a.velocity.y=(c*Math.cos(d)+h*Math.sin(d))*a.bounce.y),b.immovable||(b.velocity.x=(m*Math.cos(d)-g*Math.sin(d))*b.bounce.x,b.velocity.y=(g*Math.cos(d)+m*Math.sin(d))*b.bounce.y),Math.abs(d)<Math.PI/2?0<a.velocity.x&&!a.immovable&&b.velocity.x>a.velocity.x?a.velocity.x*=-1:0>b.velocity.x&&!b.immovable&&a.velocity.x<b.velocity.x?b.velocity.x*=-1:0<a.velocity.y&&
!a.immovable&&b.velocity.y>a.velocity.y?a.velocity.y*=-1:0>b.velocity.y&&!b.immovable&&a.velocity.y<b.velocity.y&&(b.velocity.y*=-1):Math.abs(d)>Math.PI/2&&(0>a.velocity.x&&!a.immovable&&b.velocity.x<a.velocity.x?a.velocity.x*=-1:0<b.velocity.x&&!b.immovable&&a.velocity.x>b.velocity.x?b.velocity.x*=-1:0>a.velocity.y&&!a.immovable&&b.velocity.y<a.velocity.y?a.velocity.y*=-1:0<b.velocity.y&&!b.immovable&&a.velocity.x>b.velocity.y&&(b.velocity.y*=-1)),a.immovable||(a.x+=.001*a.velocity.x*this.game.time.delta-
f*Math.cos(d),a.y+=.001*a.velocity.y*this.game.time.delta-f*Math.sin(d)),b.immovable||(b.x+=.001*b.velocity.x*this.game.time.delta+f*Math.cos(d),b.y+=.001*b.velocity.y*this.game.time.delta+f*Math.sin(d)),a.onCollide&&a.onCollide.dispatch(a.sprite,b.sprite),b.onCollide&&b.onCollide.dispatch(b.sprite,a.sprite),!0},getOverlapX:function(a,b,c){var d=0,f=a.deltaAbsX()+b.deltaAbsX()+this.OVERLAP_BIAS;return 0===a.deltaX()&&0===b.deltaX()?(a.embedded=!0,b.embedded=!0):a.deltaX()>b.deltaX()?f<(d=a.right-
b.x)&&!c||!1===a.checkCollision.right||!1===b.checkCollision.left?d=0:(a.touching.none=!1,a.touching.right=!0,b.touching.none=!1,b.touching.left=!0):a.deltaX()<b.deltaX()&&(f<-(d=a.x-b.width-b.x)&&!c||!1===a.checkCollision.left||!1===b.checkCollision.right?d=0:(a.touching.none=!1,a.touching.left=!0,b.touching.none=!1,b.touching.right=!0)),a.overlapX=d,b.overlapX=d},getOverlapY:function(a,b,c){var d=0,f=a.deltaAbsY()+b.deltaAbsY()+this.OVERLAP_BIAS;return 0===a.deltaY()&&0===b.deltaY()?(a.embedded=
!0,b.embedded=!0):a.deltaY()>b.deltaY()?f<(d=a.bottom-b.y)&&!c||!1===a.checkCollision.down||!1===b.checkCollision.up?d=0:(a.touching.none=!1,a.touching.down=!0,b.touching.none=!1,b.touching.up=!0):a.deltaY()<b.deltaY()&&(f<-(d=a.y-b.bottom)&&!c||!1===a.checkCollision.up||!1===b.checkCollision.down?d=0:(a.touching.none=!1,a.touching.up=!0,b.touching.none=!1,b.touching.down=!0)),a.overlapY=d,b.overlapY=d},separateX:function(a,b,c){var d=this.getOverlapX(a,b,c);if(c||0===d||a.immovable&&b.immovable||
a.customSeparateX||b.customSeparateX)return 0!==d||a.embedded&&b.embedded;c=a.velocity.x;var f=b.velocity.x;a.immovable||b.immovable?a.immovable?(b.x+=d,b.velocity.x=c-f*b.bounce.x,a.moves&&(b.y+=(a.y-a.prev.y)*a.friction.y)):(a.x-=d,a.velocity.x=f-c*a.bounce.x,b.moves&&(a.y+=(b.y-b.prev.y)*b.friction.y)):(d*=.5,a.x-=d,b.x+=d,d=Math.sqrt(f*f*b.mass/a.mass)*(0<f?1:-1),c=Math.sqrt(c*c*a.mass/b.mass)*(0<c?1:-1),f=.5*(d+c),a.velocity.x=f+(d-f)*a.bounce.x,b.velocity.x=f+(c-f)*b.bounce.x);return!0},separateY:function(a,
b,c){var d=this.getOverlapY(a,b,c);if(c||0===d||a.immovable&&b.immovable||a.customSeparateY||b.customSeparateY)return 0!==d||a.embedded&&b.embedded;c=a.velocity.y;var f=b.velocity.y;a.immovable||b.immovable?a.immovable?(b.y+=d,b.velocity.y=c-f*b.bounce.y,a.moves&&(b.x+=(a.x-a.prev.x)*a.friction.x)):(a.y-=d,a.velocity.y=f-c*a.bounce.y,b.moves&&(a.x+=(b.x-b.prev.x)*b.friction.x)):(d*=.5,a.y-=d,b.y+=d,d=Math.sqrt(f*f*b.mass/a.mass)*(0<f?1:-1),c=Math.sqrt(c*c*a.mass/b.mass)*(0<c?1:-1),f=.5*(d+c),a.velocity.y=
f+(d-f)*a.bounce.y,b.velocity.y=f+(c-f)*b.bounce.y);return!0},getObjectsUnderPointer:function(a,b,c,d){if(0!==b.length&&a.exists)return this.getObjectsAtLocation(a.x,a.y,b,c,d,a)},getObjectsAtLocation:function(a,b,c,d,f,g){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(c);var h=new e.Rectangle(a,b,1,1);c=[];h=this.quadTree.retrieve(h);for(var m=
0;m<h.length;m++)h[m].hitTest(a,b)&&(d&&d.call(f,g,h[m].sprite),c.push(h[m].sprite));return c},moveToObject:function(a,b,c,d){void 0===c&&(c=60);void 0===d&&(d=0);var f=e.Point.angle(b,a);return 0<d&&(c=this.distanceBetween(a,b)/(d/1E3)),a.body.velocity.setToPolar(f,c),f},moveToPointer:function(a,b,c,d){void 0===b&&(b=60);c=c||this.game.input.activePointer;void 0===d&&(d=0);var f=this.angleToPointer(a,c);return 0<d&&(b=this.distanceToPointer(a,c)/(d/1E3)),a.body.velocity.setToPolar(f,b),f},moveToXY:function(a,
b,c,d,f){void 0===d&&(d=60);void 0===f&&(f=0);var g=Math.atan2(c-a.y,b-a.x);return 0<f&&(d=this.distanceToXY(a,b,c)/(f/1E3)),a.body.velocity.setToPolar(g,d),g},velocityFromAngle:function(a,b,c){return void 0===b&&(b=60),(c||new e.Point).setToPolar(a,b,!0)},velocityFromRotation:function(a,b,c){return void 0===b&&(b=60),(c||new e.Point).setToPolar(a,b)},accelerationFromRotation:function(a,b,c){return void 0===b&&(b=60),(c||new e.Point).setToPolar(a,b)},accelerateToObject:function(a,b,c,d,f){void 0===
c&&(c=60);void 0===d&&(d=1E3);void 0===f&&(f=1E3);b=this.angleBetween(a,b);return a.body.acceleration.setToPolar(b,c),a.body.maxVelocity.setTo(d,f),b},accelerateToPointer:function(a,b,c,d,f){void 0===c&&(c=60);void 0===b&&(b=this.game.input.activePointer);void 0===d&&(d=1E3);void 0===f&&(f=1E3);b=this.angleToPointer(a,b);return a.body.acceleration.setToPolar(b,c),a.body.maxVelocity.setTo(d,f),b},accelerateToXY:function(a,b,c,d,f,g){void 0===d&&(d=60);void 0===f&&(f=1E3);void 0===g&&(g=1E3);b=this.angleToXY(a,
b,c);return a.body.acceleration.setTo(b,d),a.body.maxVelocity.setTo(f,g),b},distanceBetween:function(a,b,c,d){var f,g;return void 0===c&&(c=!1),g=d?(f=a.centerX-b.centerX,a.centerY-b.centerY):c?(f=a.world.x-b.world.x,a.world.y-b.world.y):(f=a.x-b.x,a.y-b.y),Math.sqrt(f*f+g*g)},distanceToXY:function(a,b,c,d){void 0===d&&(d=!1);b=d?a.world.x-b:a.x-b;a=d?a.world.y-c:a.y-c;return Math.sqrt(b*b+a*a)},distanceToPointer:function(a,b,c){void 0===b&&(b=this.game.input.activePointer);void 0===c&&(c=!1);var d=
c?a.world.x-b.worldX:a.x-b.worldX;a=c?a.world.y-b.worldY:a.y-b.worldY;return Math.sqrt(d*d+a*a)},closest:function(a,b,c,d){for(var f=1/0,g=null,h=0,m=b.length;h<m;h++){var n=b[h],p=this.distanceBetween(a,n,c,d);p<f&&(g=n,f=p)}return g},farthest:function(a,b,c,d){for(var f=-1,g=null,h=0,m=b.length;h<m;h++){var n=b[h],p=this.distanceBetween(a,n,c,d);f<p&&(g=n,f=p)}return g},angleBetween:function(a,b,c){return void 0===c&&(c=!1),c?e.Point.angle(b.world,a.world):e.Point.angle(b,a)},angleBetweenCenters:function(a,
b){return Math.atan2(b.centerY-a.centerY,b.centerX-a.centerX)},angleToXY:function(a,b,c,d){return void 0===d&&(d=!1),d?Math.atan2(c-a.world.y,b-a.world.x):Math.atan2(c-a.y,b-a.x)},angleToPointer:function(a,b,c){return void 0===b&&(b=this.game.input.activePointer),void 0===c&&(c=!1),c?Math.atan2(b.worldY-a.world.y,b.worldX-a.world.x):Math.atan2(b.worldY-a.y,b.worldX-a.x)},worldAngleToPointer:function(a,b){return this.angleToPointer(a,b,!0)}},e.Physics.Arcade.Body=function(a){this.sprite=a;this.game=
a.game;this.type=e.Physics.ARCADE;this.enable=!0;this.isCircle=!1;this.radius=0;this.offset=new e.Point;this.position=new e.Point(a.x,a.y);this.prev=new e.Point(this.position.x,this.position.y);this.allowRotation=!0;this.preRotation=this.rotation=a.angle;this.width=a.width;this.height=a.height;this.sourceWidth=a.width;this.sourceHeight=a.height;a.texture&&(this.sourceWidth=a.texture.frame.width,this.sourceHeight=a.texture.frame.height);this.halfWidth=Math.abs(a.width/2);this.halfHeight=Math.abs(a.height/
2);this.center=new e.Point(a.x+this.halfWidth,a.y+this.halfHeight);this.velocity=new e.Point;this.newVelocity=new e.Point;this.deltaMax=new e.Point;this.acceleration=new e.Point;this.allowDrag=!0;this.drag=new e.Point;this.allowGravity=!0;this.gravity=new e.Point;this.bounce=new e.Point;this.onOverlap=this.onCollide=this.onWorldBounds=this.worldBounce=null;this.maxVelocity=new e.Point(1E4,1E4);this.friction=new e.Point(1,0);this.angularDrag=this.angularAcceleration=this.angularVelocity=0;this.maxAngular=
1E3;this.mass=1;this.speed=this.angle=0;this.facing=e.NONE;this.immovable=!1;this.moves=!0;this.customSeparateY=this.customSeparateX=!1;this.overlapR=this.overlapY=this.overlapX=0;this.collideWorldBounds=this.embedded=!1;this.checkCollision={none:!1,up:!0,down:!0,left:!0,right:!0};this.touching={none:!0,up:!1,down:!1,left:!1,right:!1};this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1};this.blocked={none:!0,up:!1,down:!1,left:!1,right:!1};this.tilePadding=new e.Point;this.isMoving=this.syncBounds=
this.skipQuadTree=this.dirty=!1;this.stopVelocityOnCollide=!0;this.moveDuration=this.moveDistance=this.moveTimer=0;this.moveEnd=this.moveTarget=null;this.onMoveComplete=new e.Signal;this.movementCallbackContext=this.movementCallback=null;this._reset=!0;this._sx=a.scale.x;this._sy=a.scale.y;this._dy=this._dx=0},e.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var a=this.sprite.getBounds();a.ceilAll();a.width===this.width&&a.height===this.height||(this.width=a.width,this.height=
a.height,this._reset=!0)}else{a=Math.abs(this.sprite.scale.x);var b=Math.abs(this.sprite.scale.y);a===this._sx&&b===this._sy||(this.width=this.sourceWidth*a,this.height=this.sourceHeight*b,this._sx=a,this._sy=b,this._reset=!0)}this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.updateCenter())},updateCenter:function(){this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&
(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.none=!0,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.overlapR=0,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.updateBounds(),
this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=0>this.sprite.scale.x?this.width:0,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=0>this.sprite.scale.y?this.height:0,this.updateCenter(),this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&
(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(.001*this.velocity.x*this.game.time.delta,.001*this.velocity.y*this.game.time.delta),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.updateCenter(),this.position.x===this.prev.x&&this.position.y===this.prev.y||(this.angle=this.velocity.atan()),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,
this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},updateMovement:function(){var a,b=0!==this.overlapX||0!==this.overlapY;if(a=0<this.moveDuration?(this.moveTimer+=this.game.time.delta,this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),this.moveTarget.length/this.moveDistance),this.movementCallback)var c=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,
a);return!(b||1<=a||void 0!==c&&!0!==c)||(this.stopMovement(1<=a||this.stopVelocityOnCollide&&b),!1)},stopMovement:function(a){this.isMoving&&(this.isMoving=!1,a&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,0!==this.overlapX||0!==this.overlapY))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,0>this.deltaX()?this.facing=e.LEFT:0<this.deltaX()&&(this.facing=e.RIGHT),0>this.deltaY()?this.facing=e.UP:0<this.deltaY()&&(this.facing=
e.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(0>this._dx&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(0>this._dy&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.updateCenter(),
this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var a=this.position,b=this.game.physics.arcade.bounds,c=this.game.physics.arcade.checkCollision,d=this.worldBounce?-this.worldBounce.x:-this.bounce.x,f=this.worldBounce?-this.worldBounce.y:-this.bounce.y;return a.x<b.x&&c.left?(a.x=b.x,this.velocity.x*=d,this.blocked.left=!0,this.blocked.none=!1):this.right>b.right&&c.right&&(a.x=b.right-this.width,this.velocity.x*=
d,this.blocked.right=!0,this.blocked.none=!1),a.y<b.y&&c.up?(a.y=b.y,this.velocity.y*=f,this.blocked.up=!0,this.blocked.none=!1):this.bottom>b.bottom&&c.down&&(a.y=b.bottom-this.height,this.velocity.y*=f,this.blocked.down=!0,this.blocked.none=!1),!this.blocked.none},moveFrom:function(a,b,c){var d;return void 0===b&&(b=this.speed),0!==b&&(void 0===c?(d=this.angle,c=this.game.math.radToDeg(d)):d=this.game.math.degToRad(c),this.moveTimer=0,this.moveDuration=a,0===c||180===c?this.velocity.set(Math.cos(d)*
b,0):90===c||270===c?this.velocity.set(0,Math.sin(d)*b):this.velocity.setToPolar(d,b),this.isMoving=!0)},moveTo:function(a,b,c){var d;a=b/(a/1E3);return 0!==a&&(void 0===c?(d=this.angle,c=this.game.math.radToDeg(d)):d=this.game.math.degToRad(c),b=Math.abs(b),this.moveDuration=0,this.moveDistance=b,null===this.moveTarget&&(this.moveTarget=new e.Line,this.moveEnd=new e.Point),this.moveTarget.fromAngle(this.x,this.y,d,b),this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y),this.moveTarget.setTo(this.x,
this.y,this.x,this.y),0===c||180===c?this.velocity.set(Math.cos(d)*a,0):90===c||270===c?this.velocity.set(0,Math.sin(d)*a):this.velocity.setToPolar(d,a),this.isMoving=!0)},setSize:function(a,b,c,d){void 0===c&&(c=this.offset.x);void 0===d&&(d=this.offset.y);this.sourceWidth=a;this.sourceHeight=b;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(c,d);this.updateCenter();this.isCircle=
!1;this.radius=0},setCircle:function(a,b,c){void 0===b&&(b=this.offset.x);void 0===c&&(c=this.offset.y);0<a?(this.isCircle=!0,this.radius=a,this.sourceWidth=2*a,this.sourceHeight=2*a,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(b,c),this.updateCenter()):this.isCircle=!1},reset:function(a,b){this.stop();this.position.x=a-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*
this.offset.x;this.position.x-=0>this.sprite.scale.x?this.width:0;this.position.y=b-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y;this.position.y-=0>this.sprite.scale.y?this.height:0;this.prev.x=this.position.x;this.prev.y=this.position.y;this.preRotation=this.rotation=this.sprite.angle;this.updateBounds();this.updateCenter()},stop:function(){this.velocity.set(0);this.acceleration.set(0);this.angularAcceleration=this.angularVelocity=this.speed=0},getBounds:function(a){return a.x=
this.x,a.y=this.y,a.right=this.right,a.bottom=this.bottom,a},hitTest:function(a,b){return this.isCircle?e.Circle.contains(this,a,b):e.Rectangle.contains(this,a,b)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},deltaAbsY:function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-
this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof e.Group&&this.sprite.parent.removeFromHash(this.sprite);this.sprite=this.sprite.body=null}},Object.defineProperty(e.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}}),Object.defineProperty(e.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),
Object.defineProperty(e.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}}),Object.defineProperty(e.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(e.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(e.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),e.Physics.Arcade.Body.render=
function(a,b,c,d,f){void 0===d&&(d=!0);c=c||"rgba(0,255,0,0.4)";a.fillStyle=c;a.strokeStyle=c;a.lineWidth=f||1;b.isCircle?(a.beginPath(),a.arc(b.center.x-b.game.camera.x,b.center.y-b.game.camera.y,b.halfWidth,0,2*Math.PI),d?a.fill():a.stroke()):d?a.fillRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height):a.strokeRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height)},e.Physics.Arcade.Body.renderBodyInfo=function(a,b){a.line("x: "+b.x.toFixed(2),
"y: "+b.y.toFixed(2),"width: "+b.width,"height: "+b.height);a.line("velocity x: "+b.velocity.x.toFixed(2),"y: "+b.velocity.y.toFixed(2),"deltaX: "+b._dx.toFixed(2),"deltaY: "+b._dy.toFixed(2));a.line("acceleration x: "+b.acceleration.x.toFixed(2),"y: "+b.acceleration.y.toFixed(2),"speed: "+b.speed.toFixed(2),"angle: "+b.angle.toFixed(2));a.line("gravity x: "+b.gravity.x,"y: "+b.gravity.y,"bounce x: "+b.bounce.x.toFixed(2),"y: "+b.bounce.y.toFixed(2));a.line("touching left: "+b.touching.left,"right: "+
b.touching.right,"up: "+b.touching.up,"down: "+b.touching.down);a.line("blocked left: "+b.blocked.left,"right: "+b.blocked.right,"up: "+b.blocked.up,"down: "+b.blocked.down)},e.Physics.Arcade.Body.prototype.constructor=e.Physics.Arcade.Body,e.Physics.Arcade.TilemapCollision=function(){},e.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(a,b,c,d,f,g){if(a.body){var h=b.getTiles(a.body.position.x-a.body.tilePadding.x-b.getTileOffsetX(),a.body.position.y-a.body.tilePadding.y-
b.getTileOffsetY(),a.body.width+a.body.tilePadding.x,a.body.height+a.body.tilePadding.y,!1,!1);if(0!==h.length)for(var m=0;m<h.length;m++)d?d.call(f,a,h[m])&&this.separateTile(m,a.body,h[m],b,g)&&(this._total++,c&&c.call(f,a,h[m])):this.separateTile(m,a.body,h[m],b,g)&&(this._total++,c&&c.call(f,a,h[m]))}},collideGroupVsTilemapLayer:function(a,b,c,d,f,g){if(0!==a.length)for(var h=0;h<a.children.length;h++)a.children[h].exists&&this.collideSpriteVsTilemapLayer(a.children[h],b,c,d,f,g)},separateTile:function(a,
b,c,d,f){if(!b.enable)return!1;a=d.getTileOffsetX();var g=d.getTileOffsetY();if(!c.intersects(b.position.x-a,b.position.y-g,b.right-a,b.bottom-g))return!1;if(f)return!0;if(c.collisionCallback&&!c.collisionCallback.call(c.collisionCallbackContext,b.sprite,c)||void 0!==c.layer.callbacks&&c.layer.callbacks[c.index]&&!c.layer.callbacks[c.index].callback.call(c.layer.callbacks[c.index].callbackContext,b.sprite,c)||!(c.faceLeft||c.faceRight||c.faceTop||c.faceBottom))return!1;var h=f=0,m=0,n=1;if(b.deltaAbsX()>
b.deltaAbsY()?m=-1:b.deltaAbsX()<b.deltaAbsY()&&(n=-1),0!==b.deltaX()&&0!==b.deltaY()&&(c.faceLeft||c.faceRight)&&(c.faceTop||c.faceBottom)&&(m=Math.min(Math.abs(b.position.x-a-c.right),Math.abs(b.right-a-c.left)),n=Math.min(Math.abs(b.position.y-g-c.bottom),Math.abs(b.bottom-g-c.top))),m<n){if((c.faceLeft||c.faceRight)&&0!==(f=this.tileCheckX(b,c,d))&&!c.intersects(b.position.x-a,b.position.y-g,b.right-a,b.bottom-g))return!0;(c.faceTop||c.faceBottom)&&(h=this.tileCheckY(b,c,d))}else{if((c.faceTop||
c.faceBottom)&&0!==(h=this.tileCheckY(b,c,d))&&!c.intersects(b.position.x-a,b.position.y-g,b.right-a,b.bottom-g))return!0;(c.faceLeft||c.faceRight)&&(f=this.tileCheckX(b,c,d))}return 0!==f||0!==h},tileCheckX:function(a,b,c){var d=0;c=c.getTileOffsetX();return 0>a.deltaX()&&!a.blocked.left&&b.collideRight&&a.checkCollision.left?b.faceRight&&a.x-c<b.right&&(d=a.x-c-b.right)<-this.TILE_BIAS&&(d=0):0<a.deltaX()&&!a.blocked.right&&b.collideLeft&&a.checkCollision.right&&b.faceLeft&&a.right-c>b.left&&(d=
a.right-c-b.left)>this.TILE_BIAS&&(d=0),0!==d&&(a.customSeparateX?a.overlapX=d:this.processTileSeparationX(a,d)),d},tileCheckY:function(a,b,c){var d=0;c=c.getTileOffsetY();return 0>a.deltaY()&&!a.blocked.up&&b.collideDown&&a.checkCollision.up?b.faceBottom&&a.y-c<b.bottom&&(d=a.y-c-b.bottom)<-this.TILE_BIAS&&(d=0):0<a.deltaY()&&!a.blocked.down&&b.collideUp&&a.checkCollision.down&&b.faceTop&&a.bottom-c>b.top&&(d=a.bottom-c-b.top)>this.TILE_BIAS&&(d=0),0!==d&&(a.customSeparateY?a.overlapY=d:this.processTileSeparationY(a,
d)),d},processTileSeparationX:function(a,b){0>b?(a.blocked.left=!0,a.blocked.none=!1):0<b&&(a.blocked.right=!0,a.blocked.none=!1);a.position.x-=b;0===a.bounce.x?a.velocity.x=0:a.velocity.x=-a.velocity.x*a.bounce.x},processTileSeparationY:function(a,b){0>b?(a.blocked.up=!0,a.blocked.none=!1):0<b&&(a.blocked.down=!0,a.blocked.none=!1);a.position.y-=b;0===a.bounce.y?a.velocity.y=0:a.velocity.y=-a.velocity.y*a.bounce.y}},e.Utils.mixinPrototype(e.Physics.Arcade.prototype,e.Physics.Arcade.TilemapCollision.prototype),
p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,e.Physics.P2=function(a,b){this.game=a;void 0===b?b={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(b.hasOwnProperty("gravity")||(b.gravity=[0,0]),b.hasOwnProperty("broadphase")||(b.broadphase=new p2.SAPBroadphase));this.config=b;this.world=new p2.World(this.config);this.frameRate=1/60;this.paused=this.useElapsedTime=!1;this.materials=[];this.gravity=new e.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,
top:null,bottom:null};this.onBodyAdded=new e.Signal;this.onBodyRemoved=new e.Signal;this.onSpringAdded=new e.Signal;this.onSpringRemoved=new e.Signal;this.onConstraintAdded=new e.Signal;this.onConstraintRemoved=new e.Signal;this.onContactMaterialAdded=new e.Signal;this.onContactMaterialRemoved=new e.Signal;this.callbackContext=this.postBroadphaseCallback=null;this.onBeginContact=new e.Signal;this.onEndContact=new e.Signal;b.hasOwnProperty("mpx")&&b.hasOwnProperty("pxm")&&b.hasOwnProperty("mpxi")&&
b.hasOwnProperty("pxmi")&&(this.mpx=b.mpx,this.mpxi=b.mpxi,this.pxm=b.pxm,this.pxmi=b.pxmi);this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new e.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new e.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new e.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsBottom=
this._boundsTop=this._boundsRight=this._boundsLeft=!0;this._boundsOwnGroup=!1;this.setBoundsToWorld(!0,!0,!0,!0,!1)},e.Physics.P2.prototype={removeBodyNextStep:function(a){this._toRemove.push(a)},preUpdate:function(){for(var a=this._toRemove.length;a--;)this.removeBody(this._toRemove[a]);this._toRemove.length=0},enable:function(a,b,c){void 0===b&&(b=!1);void 0===c&&(c=!0);var d;if(Array.isArray(a))for(d=a.length;d--;)a[d]instanceof e.Group?this.enable(a[d].children,b,c):(this.enableBody(a[d],b),c&&
a[d].hasOwnProperty("children")&&0<a[d].children.length&&this.enable(a[d],b,!0));else a instanceof e.Group?this.enable(a.children,b,c):(this.enableBody(a,b),c&&a.hasOwnProperty("children")&&0<a.children.length&&this.enable(a.children,b,!0))},enableBody:function(a,b){a.hasOwnProperty("body")&&null===a.body&&(a.body=new e.Physics.P2.Body(this.game,a,a.x,a.y,1),a.body.debug=b,void 0!==a.anchor&&a.anchor.set(.5))},setImpactEvents:function(a){a?this.world.on("impact",this.impactHandler,this):this.world.off("impact",
this.impactHandler,this)},setPostBroadphaseCallback:function(a,b){this.postBroadphaseCallback=a;this.callbackContext=b;null!==a?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(a){if(this.postBroadphaseCallback&&0!==a.pairs.length)for(var b=a.pairs.length-2;0<=b;b-=2)a.pairs[b].parent&&a.pairs[b+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,a.pairs[b].parent,a.pairs[b+
1].parent)&&a.pairs.splice(b,2)},impactHandler:function(a){if(a.bodyA.parent&&a.bodyB.parent){var b=a.bodyA.parent,c=a.bodyB.parent;b._bodyCallbacks[a.bodyB.id]&&b._bodyCallbacks[a.bodyB.id].call(b._bodyCallbackContext[a.bodyB.id],b,c,a.shapeA,a.shapeB);c._bodyCallbacks[a.bodyA.id]&&c._bodyCallbacks[a.bodyA.id].call(c._bodyCallbackContext[a.bodyA.id],c,b,a.shapeB,a.shapeA);b._groupCallbacks[a.shapeB.collisionGroup]&&b._groupCallbacks[a.shapeB.collisionGroup].call(b._groupCallbackContext[a.shapeB.collisionGroup],
b,c,a.shapeA,a.shapeB);c._groupCallbacks[a.shapeA.collisionGroup]&&c._groupCallbacks[a.shapeA.collisionGroup].call(c._groupCallbackContext[a.shapeA.collisionGroup],c,b,a.shapeB,a.shapeA)}},beginContactHandler:function(a){a.bodyA&&a.bodyB&&(this.onBeginContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB,a.contactEquations),a.bodyA.parent&&a.bodyA.parent.onBeginContact.dispatch(a.bodyB.parent,a.bodyB,a.shapeA,a.shapeB,a.contactEquations),a.bodyB.parent&&a.bodyB.parent.onBeginContact.dispatch(a.bodyA.parent,
a.bodyA,a.shapeB,a.shapeA,a.contactEquations))},endContactHandler:function(a){a.bodyA&&a.bodyB&&(this.onEndContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB),a.bodyA.parent&&a.bodyA.parent.onEndContact.dispatch(a.bodyB.parent,a.bodyB,a.shapeA,a.shapeB),a.bodyB.parent&&a.bodyB.parent.onEndContact.dispatch(a.bodyA.parent,a.bodyA,a.shapeB,a.shapeA))},setBoundsToWorld:function(a,b,c,d,f){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,
a,b,c,d,f)},setWorldMaterial:function(a,b,c,d,f){void 0===b&&(b=!0);void 0===c&&(c=!0);void 0===d&&(d=!0);void 0===f&&(f=!0);b&&this.walls.left&&(this.walls.left.shapes[0].material=a);c&&this.walls.right&&(this.walls.right.shapes[0].material=a);d&&this.walls.top&&(this.walls.top.shapes[0].material=a);f&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=a)},updateBoundsCollisionGroup:function(a){void 0===a&&(a=!0);var b=a?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&
(this.walls.left.shapes[0].collisionGroup=b);this.walls.right&&(this.walls.right.shapes[0].collisionGroup=b);this.walls.top&&(this.walls.top.shapes[0].collisionGroup=b);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=b);this._boundsOwnGroup=a},setBounds:function(a,b,c,d,f,g,h,m,n){void 0===f&&(f=this._boundsLeft);void 0===g&&(g=this._boundsRight);void 0===h&&(h=this._boundsTop);void 0===m&&(m=this._boundsBottom);void 0===n&&(n=this._boundsOwnGroup);this.setupWall(f,"left",a,b,1.5707963267948966,
n);this.setupWall(g,"right",a+c,b,-1.5707963267948966,n);this.setupWall(h,"top",a,b,-3.141592653589793,n);this.setupWall(m,"bottom",a,b+d,0,n);this._boundsLeft=f;this._boundsRight=g;this._boundsTop=h;this._boundsBottom=m;this._boundsOwnGroup=n},setupWall:function(a,b,c,d,f,g){a?(this.walls[b]?this.walls[b].position=[this.pxmi(c),this.pxmi(d)]:(this.walls[b]=new p2.Body({mass:0,position:[this.pxmi(c),this.pxmi(d)],angle:f}),this.walls[b].addShape(new p2.Plane),this.world.addBody(this.walls[b])),g&&
(this.walls[b].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[b]&&(this.world.removeBody(this.walls[b]),this.walls[b]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(.001*this.game.time.delta):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=
new e.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new e.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new e.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var a=this.world.constraints,b=a.length-1;0<=b;b--)this.world.removeConstraint(a[b]);a=this.world.bodies;for(b=
a.length-1;0<=b;b--)this.world.removeBody(a[b]);a=this.world.springs;for(b=a.length-1;0<=b;b--)this.world.removeSpring(a[b]);a=this.world.contactMaterials;for(b=a.length-1;0<=b;b--)this.world.removeContactMaterial(a[b]);this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.impactCallback=this.callbackContext=this.postBroadphaseCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[];this.walls={left:null,
right:null,top:null,bottom:null}},destroy:function(){this.clear();this.game=null},addBody:function(a){return!a.data.world&&(this.world.addBody(a.data),this.onBodyAdded.dispatch(a),!0)},removeBody:function(a){return a.data.world===this.world&&(this.world.removeBody(a.data),this.onBodyRemoved.dispatch(a)),a},addSpring:function(a){return a instanceof e.Physics.P2.Spring||a instanceof e.Physics.P2.RotationalSpring?this.world.addSpring(a.data):this.world.addSpring(a),this.onSpringAdded.dispatch(a),a},
removeSpring:function(a){return a instanceof e.Physics.P2.Spring||a instanceof e.Physics.P2.RotationalSpring?this.world.removeSpring(a.data):this.world.removeSpring(a),this.onSpringRemoved.dispatch(a),a},createDistanceConstraint:function(a,b,c,d,f,g){if(a=this.getBody(a),b=this.getBody(b),a&&b)return this.addConstraint(new e.Physics.P2.DistanceConstraint(this,a,b,c,d,f,g));console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(a,b,c,d){if(a=this.getBody(a),
b=this.getBody(b),a&&b)return this.addConstraint(new e.Physics.P2.GearConstraint(this,a,b,c,d));console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(a,b,c,d,f,g){if(a=this.getBody(a),c=this.getBody(c),a&&c)return this.addConstraint(new e.Physics.P2.RevoluteConstraint(this,a,b,c,d,f,g));console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(a,b,c,d,f){if(a=this.getBody(a),b=this.getBody(b),a&&b)return this.addConstraint(new e.Physics.P2.LockConstraint(this,
a,b,c,d,f));console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(a,b,c,d,f,g,h){if(a=this.getBody(a),b=this.getBody(b),a&&b)return this.addConstraint(new e.Physics.P2.PrismaticConstraint(this,a,b,c,d,f,g,h));console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(a){return this.world.addConstraint(a),this.onConstraintAdded.dispatch(a),a},removeConstraint:function(a){return this.world.removeConstraint(a),this.onConstraintRemoved.dispatch(a),
a},addContactMaterial:function(a){return this.world.addContactMaterial(a),this.onContactMaterialAdded.dispatch(a),a},removeContactMaterial:function(a){return this.world.removeContactMaterial(a),this.onContactMaterialRemoved.dispatch(a),a},getContactMaterial:function(a,b){return this.world.getContactMaterial(a,b)},setMaterial:function(a,b){for(var c=b.length;c--;)b[c].setMaterial(a)},createMaterial:function(a,b){a=new e.Physics.P2.Material(a||"");return this.materials.push(a),void 0!==b&&b.setMaterial(a),
a},createContactMaterial:function(a,b,c){void 0===a&&(a=this.createMaterial());void 0===b&&(b=this.createMaterial());a=new e.Physics.P2.ContactMaterial(a,b,c);return this.addContactMaterial(a)},getBodies:function(){for(var a=[],b=this.world.bodies.length;b--;)a.push(this.world.bodies[b].parent);return a},getBody:function(a){return a instanceof p2.Body?a:a instanceof e.Physics.P2.Body?a.data:a.body&&a.body.type===e.Physics.P2JS?a.body.data:null},getSprings:function(){for(var a=[],b=this.world.springs.length;b--;)a.push(this.world.springs[b].parent);
return a},getConstraints:function(){for(var a=[],b=this.world.constraints.length;b--;)a.push(this.world.constraints[b]);return a},hitTest:function(a,b,c,d){void 0===b&&(b=this.world.bodies);void 0===c&&(c=5);void 0===d&&(d=!1);a=[this.pxmi(a.x),this.pxmi(a.y)];for(var f=[],g=b.length;g--;)b[g]instanceof e.Physics.P2.Body&&(!d||b[g].data.type!==p2.Body.STATIC)?f.push(b[g].data):b[g]instanceof p2.Body&&b[g].parent&&(!d||b[g].type!==p2.Body.STATIC)?f.push(b[g]):b[g]instanceof e.Sprite&&b[g].hasOwnProperty("body")&&
(!d||b[g].body.data.type!==p2.Body.STATIC)&&f.push(b[g].body.data);return this.world.hitTest(a,f,c)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(a){var b=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask|=b);this.walls.right&&(this.walls.right.shapes[0].collisionMask|=b);this.walls.top&&(this.walls.top.shapes[0].collisionMask|=b);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask|=b);this._collisionGroupID++;b=new e.Physics.P2.CollisionGroup(b);
return this.collisionGroups.push(b),a&&this.setCollisionGroup(a,b),b},setCollisionGroup:function(a,b){if(a instanceof e.Group)for(var c=0;c<a.total;c++)a.children[c].body&&a.children[c].body.type===e.Physics.P2JS&&a.children[c].body.setCollisionGroup(b);else a.body.setCollisionGroup(b)},createSpring:function(a,b,c,d,f,g,h,m,n){if(a=this.getBody(a),b=this.getBody(b),a&&b)return this.addSpring(new e.Physics.P2.Spring(this,a,b,c,d,f,g,h,m,n));console.warn("Cannot create Spring, invalid body objects given")},
createRotationalSpring:function(a,b,c,d,f){if(a=this.getBody(a),b=this.getBody(b),a&&b)return this.addSpring(new e.Physics.P2.RotationalSpring(this,a,b,c,d,f));console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(a,b,c,d,f,g){void 0===d&&(d=!1);a=new e.Physics.P2.Body(this.game,null,a,b,c);return g&&!a.addPolygon(f,g)?!1:(d&&this.world.addBody(a.data),a)},createParticle:function(a,b,c,d,f,g){void 0===d&&(d=!1);a=new e.Physics.P2.Body(this.game,null,a,b,
c);return g&&!a.addPolygon(f,g)?!1:(d&&this.world.addBody(a.data),a)},convertCollisionObjects:function(a,b,c){void 0===c&&(c=!0);for(var d=[],f=0,g=a.collision[b].length;f<g;f++){var h=a.collision[b][f],m=h.polyline||h.polygon;if(m)var n=this.createBody(h.x,h.y,0,c,{},m);else h.rectangle&&(n=this.createBody(h.x,h.y,0,c)).addRectangle(h.width,h.height,h.width/2,h.height/2);n&&d.push(n)}return d},clearTilemapLayerBodies:function(a,b){b=a.getLayer(b);for(var c=a.layers[b].bodies.length;c--;)a.layers[b].bodies[c].destroy();
a.layers[b].bodies.length=0},convertTilemap:function(a,b,c,d){b=a.getLayer(b);void 0===c&&(c=!0);void 0===d&&(d=!0);this.clearTilemapLayerBodies(a,b);for(var f,g=0,h=0,m=0,n=a.layers[b].height;m<n;m++)for(var p=f=0,q=a.layers[b].width;p<q;p++){var r=a.layers[b].data[m][p];if(r&&-1<r.index&&r.collides)if(d){var u=a.getTileRight(b,p,m);(0===f&&(g=r.x*r.width,h=r.y*r.height,f=r.width),u&&u.collides)?f+=r.width:((u=this.createBody(g,h,0,!1)).addRectangle(f,r.height,f/2,r.height/2,0),c&&this.addBody(u),
a.layers[b].bodies.push(u),f=0)}else(u=this.createBody(r.x*r.width,r.y*r.height,0,!1)).addRectangle(r.width,r.height,r.width/2,r.height/2,0),c&&this.addBody(u),a.layers[b].bodies.push(u)}return a.layers[b].bodies},mpx:function(a){return 20*a},pxm:function(a){return.05*a},mpxi:function(a){return-20*a},pxmi:function(a){return-.05*a}},Object.defineProperty(e.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=
a}}),Object.defineProperty(e.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}}),Object.defineProperty(e.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(a){this.world.defaultContactMaterial=a}}),Object.defineProperty(e.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(a){this.world.applySpringForces=
a}}),Object.defineProperty(e.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(a){this.world.applyDamping=a}}),Object.defineProperty(e.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(a){this.world.applyGravity=a}}),Object.defineProperty(e.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(a){this.world.solveConstraints=a}}),Object.defineProperty(e.Physics.P2.prototype,
"time",{get:function(){return this.world.time}}),Object.defineProperty(e.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(a){this.world.emitImpactEvent=a}}),Object.defineProperty(e.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(a){this.world.sleepMode=a}}),Object.defineProperty(e.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),e.Physics.P2.FixtureList=function(a){Array.isArray(a)||
(a=[a]);this.rawList=a;this.init();this.parse(this.rawList)},e.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(a,b){this.getFixtures(b).forEach(function(c){c.collisionGroup=a})},setMask:function(a,b){this.getFixtures(b).forEach(function(c){c.collisionMask=a})},setSensor:function(a,b){this.getFixtures(b).forEach(function(c){c.sensor=a})},setMaterial:function(a,b){this.getFixtures(b).forEach(function(c){c.material=
a})},getFixtures:function(a){var b=[];if(a){a instanceof Array||(a=[a]);var c=this;return a.forEach(function(d){c.namedFixtures[d]&&b.push(c.namedFixtures[d])}),this.flatten(b)}return this.allFixtures},getFixtureByKey:function(a){return this.namedFixtures[a]},getGroup:function(a){return this.groupedFixtures[a]},parse:function(){var a,b,c;for(a in c=[],b=this.rawList){var d=b[a];isNaN(a-0)?this.namedFixtures[a]=this.flatten(d):(this.groupedFixtures[a]=this.groupedFixtures[a]||[],this.groupedFixtures[a]=
this.groupedFixtures[a].concat(d));c.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(a){var b,c;return b=[],c=arguments.callee,a.forEach(function(d){return Array.prototype.push.apply(b,Array.isArray(d)?c(d):[d])}),b}},e.Physics.P2.PointProxy=function(a,b){this.world=a;this.destination=b},e.Physics.P2.PointProxy.prototype.constructor=e.Physics.P2.PointProxy,Object.defineProperty(e.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},
set:function(a){this.destination[0]=this.world.pxm(a)}}),Object.defineProperty(e.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(a){this.destination[1]=this.world.pxm(a)}}),Object.defineProperty(e.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=a}}),Object.defineProperty(e.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=
a}}),e.Physics.P2.InversePointProxy=function(a,b){this.world=a;this.destination=b},e.Physics.P2.InversePointProxy.prototype.constructor=e.Physics.P2.InversePointProxy,Object.defineProperty(e.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(a){this.destination[0]=this.world.pxmi(a)}}),Object.defineProperty(e.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(a){this.destination[1]=
this.world.pxmi(a)}}),Object.defineProperty(e.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=-a}}),Object.defineProperty(e.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=-a}}),e.Physics.P2.Body=function(a,b,c,d,f){b=b||null;c=c||0;d=d||0;void 0===f&&(f=1);this.game=a;this.world=a.physics.p2;this.sprite=b;this.type=e.Physics.P2JS;this.offset=new e.Point;
this.data=new p2.Body({position:[this.world.pxmi(c),this.world.pxmi(d)],mass:f});(this.data.parent=this).velocity=new e.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new e.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new e.Point;this.onBeginContact=new e.Signal;this.onEndContact=new e.Signal;this.collidesWith=[];this.removeNextStep=!1;this.debugBody=null;this.dirty=!1;this._collideWorldBounds=!0;this._bodyCallbacks={};this._bodyCallbackContext={};
this._groupCallbacks={};this._groupCallbackContext={};this._reset=!1;b&&(this.setRectangleFromSprite(b),b.exists&&this.game.physics.p2.addBody(this))},e.Physics.P2.Body.prototype={createBodyCallback:function(a,b,c){var d=-1;a.id?d=a.id:a.body&&(d=a.body.id);-1<d&&(null===b?(delete this._bodyCallbacks[d],delete this._bodyCallbackContext[d]):(this._bodyCallbacks[d]=b,this._bodyCallbackContext[d]=c))},createGroupCallback:function(a,b,c){null===b?(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]):
(this._groupCallbacks[a.mask]=b,this._groupCallbackContext[a.mask]=c)},getCollisionMask:function(){var a=0;this._collideWorldBounds&&(a=this.game.physics.p2.boundsCollisionGroup.mask);for(var b=0;b<this.collidesWith.length;b++)a|=this.collidesWith[b].mask;return a},updateCollisionMask:function(a){var b=this.getCollisionMask();if(void 0===a)for(a=this.data.shapes.length-1;0<=a;a--)this.data.shapes[a].collisionMask=b;else a.collisionMask=b},setCollisionGroup:function(a,b){var c=this.getCollisionMask();
if(void 0===b)for(b=this.data.shapes.length-1;0<=b;b--)this.data.shapes[b].collisionGroup=a.mask,this.data.shapes[b].collisionMask=c;else b.collisionGroup=a.mask,b.collisionMask=c},clearCollision:function(a,b,c){if(void 0===a&&(a=!0),void 0===b&&(b=!0),void 0===c)for(c=this.data.shapes.length-1;0<=c;c--)a&&(this.data.shapes[c].collisionGroup=null),b&&(this.data.shapes[c].collisionMask=null);else a&&(c.collisionGroup=null),b&&(c.collisionMask=null);a&&(this.collidesWith.length=0)},removeCollisionGroup:function(a,
b,c){var d;if(void 0===b&&(b=!0),Array.isArray(a))for(var f=0;f<a.length;f++)-1<(d=this.collidesWith.indexOf(a[f]))&&(this.collidesWith.splice(d,1),b&&(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]));else-1<(d=this.collidesWith.indexOf(a))&&(this.collidesWith.splice(d,1),b&&(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]));a=this.getCollisionMask();if(void 0===c)for(f=this.data.shapes.length-1;0<=f;f--)this.data.shapes[f].collisionMask=
a;else c.collisionMask=a},collides:function(a,b,c,d){if(Array.isArray(a))for(var f=0;f<a.length;f++)-1===this.collidesWith.indexOf(a[f])&&(this.collidesWith.push(a[f]),b&&this.createGroupCallback(a[f],b,c));else-1===this.collidesWith.indexOf(a)&&(this.collidesWith.push(a),b&&this.createGroupCallback(a,b,c));a=this.getCollisionMask();if(void 0===d)for(f=this.data.shapes.length-1;0<=f;f--)this.data.shapes[f].collisionMask=a;else d.collisionMask=a},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();
this.shapeChanged()},getVelocityAtPoint:function(a,b){return this.data.getVelocityAtPoint(a,b)},applyDamping:function(a){this.data.applyDamping(a)},applyImpulse:function(a,b,c){this.data.applyImpulse(a,[this.world.pxmi(b),this.world.pxmi(c)])},applyImpulseLocal:function(a,b,c){this.data.applyImpulseLocal(a,[this.world.pxmi(b),this.world.pxmi(c)])},applyForce:function(a,b,c){this.data.applyForce(a,[this.world.pxmi(b),this.world.pxmi(c)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=
0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(a,b){return this.data.toLocalFrame(a,b)},toWorldFrame:function(a,b){return this.data.toWorldFrame(a,b)},rotateLeft:function(a){this.data.angularVelocity=this.world.pxm(-a)},rotateRight:function(a){this.data.angularVelocity=this.world.pxm(a)},moveForward:function(a){a=this.world.pxmi(-a);var b=this.data.angle+Math.PI/2;this.data.velocity[0]=
a*Math.cos(b);this.data.velocity[1]=a*Math.sin(b)},moveBackward:function(a){a=this.world.pxmi(-a);var b=this.data.angle+Math.PI/2;this.data.velocity[0]=-a*Math.cos(b);this.data.velocity[1]=-a*Math.sin(b)},thrust:function(a){a=this.world.pxmi(-a);var b=this.data.angle+Math.PI/2;this.data.force[0]+=a*Math.cos(b);this.data.force[1]+=a*Math.sin(b)},thrustLeft:function(a){a=this.world.pxmi(-a);var b=this.data.angle;this.data.force[0]+=a*Math.cos(b);this.data.force[1]+=a*Math.sin(b)},thrustRight:function(a){a=
this.world.pxmi(-a);var b=this.data.angle;this.data.force[0]-=a*Math.cos(b);this.data.force[1]-=a*Math.sin(b)},reverse:function(a){a=this.world.pxmi(-a);var b=this.data.angle+Math.PI/2;this.data.force[0]-=a*Math.cos(b);this.data.force[1]-=a*Math.sin(b)},moveLeft:function(a){this.data.velocity[0]=this.world.pxmi(-a)},moveRight:function(a){this.data.velocity[0]=this.world.pxmi(a)},moveUp:function(a){this.data.velocity[1]=this.world.pxmi(-a)},moveDown:function(a){this.data.velocity[1]=this.world.pxmi(a)},
preUpdate:function(){this.dirty=!0;this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x;this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y;this.fixedRotation||(this.sprite.rotation=this.data.angle);this.debugBody&&this.debugBody.updateSpriteTransform();this.dirty=!1},reset:function(a,b,c,d){void 0===c&&(c=!1);void 0===d&&(d=!1);this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();
c&&this.setZeroDamping();d&&(this.mass=1);this.x=a;this.y=b},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var a=0;a<this.game.physics.p2._toRemove.length;a++)this.game.physics.p2._toRemove[a]===this&&this.game.physics.p2._toRemove.splice(a,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld();
this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this.debugBody&&this.debugBody.destroy(!0,!0);this.debugBody=null;this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){for(var a=this.data.shapes.length;a--;)this.data.removeShape(this.data.shapes[a]);this.shapeChanged()},addShape:function(a,b,c,d){return void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),this.data.addShape(a,[this.world.pxmi(b),
this.world.pxmi(c)],d),this.shapeChanged(),a},addCircle:function(a,b,c,d){a=new p2.Circle({radius:this.world.pxm(a)});return this.addShape(a,b,c,d)},addRectangle:function(a,b,c,d,f){a=new p2.Box({width:this.world.pxm(a),height:this.world.pxm(b)});return this.addShape(a,c,d,f)},addPlane:function(a,b,c){var d=new p2.Plane;return this.addShape(d,a,b,c)},addParticle:function(a,b,c){var d=new p2.Particle;return this.addShape(d,a,b,c)},addLine:function(a,b,c,d){a=new p2.Line({length:this.world.pxm(a)});
return this.addShape(a,b,c,d)},addCapsule:function(a,b,c,d,f){a=new p2.Capsule({length:this.world.pxm(a),radius:this.world.pxm(b)});return this.addShape(a,c,d,f)},addPolygon:function(a,b){a=a||{};Array.isArray(b)||(b=Array.prototype.slice.call(arguments,1));var c=[];if(1===b.length&&Array.isArray(b[0]))c=b[0].slice(0);else if(Array.isArray(b[0]))c=b.slice();else if("number"==typeof b[0])for(var d=0,f=b.length;d<f;d+=2)c.push([b[d],b[d+1]]);d=c.length-1;c[d][0]===c[0][0]&&c[d][1]===c[0][1]&&c.pop();
for(d=0;d<c.length;d++)c[d][0]=this.world.pxmi(c[d][0]),c[d][1]=this.world.pxmi(c[d][1]);c=this.data.fromPolygon(c,a);return this.shapeChanged(),c},removeShape:function(a){a=this.data.removeShape(a);return this.shapeChanged(),a},setCircle:function(a,b,c,d){return this.clearShapes(),this.addCircle(a,b,c,d)},setRectangle:function(a,b,c,d,f){return void 0===a&&(a=16),void 0===b&&(b=16),this.clearShapes(),this.addRectangle(a,b,c,d,f)},setRectangleFromSprite:function(a){return void 0===a&&(a=this.sprite),
this.clearShapes(),this.addRectangle(a.width,a.height,0,0,a.rotation)},setMaterial:function(a,b){if(void 0===b)for(b=this.data.shapes.length-1;0<=b;b--)this.data.shapes[b].material=a;else b.material=a},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(a,b){a=this.game.cache.getPhysicsData(a,b);b=[];for(var c=0;c<a.length;c++){var d=a[c],f=this.addFixture(d);b[d.filter.group]=b[d.filter.group]||[];b[d.filter.group]=b[d.filter.group].concat(f);d.fixtureKey&&(b[d.fixtureKey]=
f)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),b},addFixture:function(a){var b=[];if(a.circle){(m=new p2.Circle({radius:this.world.pxm(a.circle.radius)})).collisionGroup=a.filter.categoryBits;m.collisionMask=a.filter.maskBits;m.sensor=a.isSensor;var c=p2.vec2.create();c[0]=this.world.pxmi(a.circle.position[0]-this.sprite.width/2);c[1]=this.world.pxmi(a.circle.position[1]-this.sprite.height/2);this.data.addShape(m,c);b.push(m)}else{c=a.polygons;for(var d=p2.vec2.create(),f=0;f<c.length;f++){m=
c[f];for(var g=[],h=0;h<m.length;h+=2)g.push([this.world.pxmi(m[h]),this.world.pxmi(m[h+1])]);var m=new p2.Convex({vertices:g});for(g=0;g!==m.vertices.length;g++)h=m.vertices[g],p2.vec2.sub(h,h,m.centerOfMass);p2.vec2.scale(d,m.centerOfMass,1);d[0]-=this.world.pxmi(this.sprite.width/2);d[1]-=this.world.pxmi(this.sprite.height/2);m.updateTriangles();m.updateCenterOfMass();m.updateBoundingRadius();m.collisionGroup=a.filter.categoryBits;m.collisionMask=a.filter.maskBits;m.sensor=a.isSensor;this.data.addShape(m,
d);b.push(m)}}return b},loadPolygon:function(a,b,c){a=null===a?b:this.game.cache.getPhysicsData(a,b);"number"!=typeof c&&(c=1);b=p2.vec2.create();for(var d=0;d<a.length;d++){for(var f=[],g=0;g<a[d].shape.length;g+=2)f.push([this.world.pxmi(a[d].shape[g]*c),this.world.pxmi(a[d].shape[g+1]*c)]);f=new p2.Convex({vertices:f});for(g=0;g!==f.vertices.length;g++){var h=f.vertices[g];p2.vec2.sub(h,h,f.centerOfMass)}p2.vec2.scale(b,f.centerOfMass,1);b[0]-=this.world.pxmi(this.sprite.width/2);b[1]-=this.world.pxmi(this.sprite.height/
2);f.updateTriangles();f.updateCenterOfMass();f.updateBoundingRadius();this.data.addShape(f,b)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},e.Physics.P2.Body.prototype.constructor=e.Physics.P2.Body,e.Physics.P2.Body.DYNAMIC=1,e.Physics.P2.Body.STATIC=2,e.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(e.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===e.Physics.P2.Body.STATIC},set:function(a){a&&this.data.type!==e.Physics.P2.Body.STATIC?(this.data.type=
e.Physics.P2.Body.STATIC,this.mass=0):a||this.data.type!==e.Physics.P2.Body.STATIC||(this.data.type=e.Physics.P2.Body.DYNAMIC,this.mass=1)}}),Object.defineProperty(e.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===e.Physics.P2.Body.DYNAMIC},set:function(a){a&&this.data.type!==e.Physics.P2.Body.DYNAMIC?(this.data.type=e.Physics.P2.Body.DYNAMIC,this.mass=1):a||this.data.type!==e.Physics.P2.Body.DYNAMIC||(this.data.type=e.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(e.Physics.P2.Body.prototype,
"kinematic",{get:function(){return this.data.type===e.Physics.P2.Body.KINEMATIC},set:function(a){a&&this.data.type!==e.Physics.P2.Body.KINEMATIC?(this.data.type=e.Physics.P2.Body.KINEMATIC,this.mass=4):a||this.data.type!==e.Physics.P2.Body.KINEMATIC||(this.data.type=e.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(e.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(a){a!==this.data.allowSleep&&(this.data.allowSleep=a)}}),Object.defineProperty(e.Physics.P2.Body.prototype,
"angle",{get:function(){return e.Math.wrapAngle(e.Math.radToDeg(this.data.angle))},set:function(a){this.data.angle=e.Math.degToRad(e.Math.wrapAngle(a))}}),Object.defineProperty(e.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(a){this.data.angularDamping=a}}),Object.defineProperty(e.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(a){this.data.angularForce=a}}),Object.defineProperty(e.Physics.P2.Body.prototype,
"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(a){this.data.angularVelocity=a}}),Object.defineProperty(e.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(a){this.data.damping=a}}),Object.defineProperty(e.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(a){a!==this.data.fixedRotation&&(this.data.fixedRotation=a)}}),Object.defineProperty(e.Physics.P2.Body.prototype,"inertia",
{get:function(){return this.data.inertia},set:function(a){this.data.inertia=a}}),Object.defineProperty(e.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(a){a!==this.data.mass&&(this.data.mass=a,this.data.updateMassProperties())}}),Object.defineProperty(e.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(a){a!==this.data.type&&(this.data.type=a)}}),Object.defineProperty(e.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},
set:function(a){this.data.angle=a}}),Object.defineProperty(e.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(a){this.data.sleepSpeedLimit=a}}),Object.defineProperty(e.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(a){this.data.position[0]=this.world.pxmi(a)}}),Object.defineProperty(e.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(a){this.data.position[1]=
this.world.pxmi(a)}}),Object.defineProperty(e.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(e.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(a){a&&!this.debugBody?this.debugBody=new e.Physics.P2.BodyDebug(this.game,this.data):!a&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(e.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},
set:function(a){a&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!a&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),e.Physics.P2.BodyDebug=function(a,b,c){e.Group.call(this,a);var d={pixelsPerLengthUnit:a.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=Object.assign(d,c);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu*=-1;this.body=b;this.canvas=new e.Graphics(a);this.canvas.alpha=this.settings.alpha;
this.add(this.canvas);this.draw();this.updateSpriteTransform()},e.Physics.P2.BodyDebug.prototype=Object.create(e.Group.prototype),e.Physics.P2.BodyDebug.prototype.constructor=e.Physics.P2.BodyDebug,Object.assign(e.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var a,b,c,d,f,g,h,m,n,p;if(g=this.body,(m=this.canvas).clear(),c=parseInt(this.randomPastelHex(),
16),f=this.lineWidth,g instanceof p2.Body&&g.shapes.length){var q=g.shapes.length;for(d=0;d!==q;){if(h=(b=g.shapes[d]).position||0,a=b.angle||0,b instanceof p2.Circle)this.drawCircle(m,h[0]*this.ppu,h[1]*this.ppu,a,b.radius*this.ppu,c,f);else if(b instanceof p2.Capsule)this.drawCapsule(m,h[0]*this.ppu,h[1]*this.ppu,a,b.length*this.ppu,b.radius*this.ppu,16711680,c,f);else if(b instanceof p2.Plane)this.drawPlane(m,h[0]*this.ppu,-h[1]*this.ppu,c,16711680,5*f,10*f,10*f,100*this.ppu,a);else if(b instanceof
p2.Line)this.drawLine(m,b.length*this.ppu,16711680,f);else if(b instanceof p2.Box)this.drawRectangle(m,h[0]*this.ppu,h[1]*this.ppu,a,b.width*this.ppu,b.height*this.ppu,16711680,c,f);else if(b instanceof p2.Convex){var r=[];var u=p2.vec2.create();var x=n=0;for(p=b.vertices.length;0<=p?n<p:p<n;x=0<=p?++n:--n)x=b.vertices[x],p2.vec2.rotate(u,x,a),r.push([(u[0]+h[0])*this.ppu,-(u[1]+h[1])*this.ppu]);this.drawConvex(m,r,b.triangles,16711680,c,f,this.settings.debugPolygons,[h[0]*this.ppu,-h[1]*this.ppu])}d++}}},
drawRectangle:function(a,b,c,d,f,g,h,m,n){void 0===n&&(n=1);void 0===h&&(h=0);a.lineStyle(n,h,1);a.beginFill(m);a.drawRect(b-f/2,c-g/2,f,g)},drawCircle:function(a,b,c,d,f,g,h){void 0===h&&(h=1);void 0===g&&(g=16777215);a.lineStyle(h,0,1);a.beginFill(g,1);a.drawCircle(b,c,2*-f);a.endFill();a.moveTo(b,c);a.lineTo(b+f*Math.cos(-d),c+f*Math.sin(-d))},drawLine:function(a,b,c,d){void 0===d&&(d=1);void 0===c&&(c=0);a.lineStyle(5*d,c,1);a.moveTo(-b/2,0);a.lineTo(b/2,0)},drawConvex:function(a,b,c,d,f,g,h,
m){if(void 0===g&&(g=1),void 0===d&&(d=0),h){d=[16711680,65280,255];for(c=0;c!==b.length+1;){var n=b[c%b.length];h=b[(c+1)%b.length];f=n[0];var p=n[1];n=h[0];h=h[1];a.lineStyle(g,d[c%d.length],1);a.moveTo(f,-p);a.lineTo(n,-h);a.drawCircle(f,-p,2*g);c++}return a.lineStyle(g,0,1),a.drawCircle(m[0],m[1],2*g)}a.lineStyle(g,d,1);a.beginFill(f);for(c=0;c!==b.length;)g=(m=b[c])[0],m=m[1],0===c?a.moveTo(g,-m):a.lineTo(g,-m),c++;if(a.endFill(),2<b.length)return a.moveTo(b[b.length-1][0],-b[b.length-1][1]),
a.lineTo(b[0][0],-b[0][1])},drawPath:function(a,b,c,d,f){var g,h,m,n,p,q;void 0===f&&(f=1);void 0===c&&(c=0);a.lineStyle(f,c,1);"number"==typeof d&&a.beginFill(d);var r=f=null;for(c=0;c<b.length;){var u=(q=b[c])[0];q=q[1];u===f&&q===r||(0===c?a.moveTo(u,q):(g=f,h=r,m=u,n=q,p=b[(c+1)%b.length][0],0!==(m-g)*(b[(c+1)%b.length][1]-h)-(p-g)*(n-h)&&a.lineTo(u,q)),f=u,r=q);c++}"number"==typeof d&&a.endFill();2<b.length&&"number"==typeof d&&(a.moveTo(b[b.length-1][0],b[b.length-1][1]),a.lineTo(b[0][0],b[0][1]))},
drawPlane:function(a,b,c,d,f,g,h,m,n,p){void 0===g&&(g=1);void 0===d&&(d=16777215);a.lineStyle(g,f,11);a.beginFill(d);a.moveTo(b,-c);d=b+Math.cos(p)*this.game.width;f=c+Math.sin(p)*this.game.height;a.lineTo(d,-f);a.moveTo(b,-c);d=b+Math.cos(p)*-this.game.width;f=c+Math.sin(p)*-this.game.height;a.lineTo(d,-f)},drawCapsule:function(a,b,c,d,f,g,h,m,n){void 0===n&&(n=1);void 0===h&&(h=0);a.lineStyle(n,h,1);var p=Math.cos(d);d=Math.sin(d);a.beginFill(m,1);a.drawCircle(-f/2*p+b,-f/2*d+c,2*-g);a.drawCircle(f/
2*p+b,f/2*d+c,2*-g);a.endFill();a.lineStyle(n,h,0);a.beginFill(m,1);a.moveTo(-f/2*p+g*d+b,-f/2*d+g*p+c);a.lineTo(f/2*p+g*d+b,f/2*d+g*p+c);a.lineTo(f/2*p-g*d+b,f/2*d-g*p+c);a.lineTo(-f/2*p-g*d+b,-f/2*d-g*p+c);a.endFill();a.lineStyle(n,h,1);a.moveTo(-f/2*p+g*d+b,-f/2*d+g*p+c);a.lineTo(f/2*p+g*d+b,f/2*d+g*p+c);a.moveTo(-f/2*p-g*d+b,-f/2*d-g*p+c);a.lineTo(f/2*p-g*d+b,f/2*d-g*p+c)},randomPastelHex:function(){var a,b,c,d;return c=[255,255,255],d=Math.floor(256*Math.random()),b=Math.floor(256*Math.random()),
a=Math.floor(256*Math.random()),d=Math.floor((d+3*c[0])/4),b=Math.floor((b+3*c[1])/4),a=Math.floor((a+3*c[2])/4),this.rgbToHex(d,b,a)},rgbToHex:function(a,b,c){return this.componentToHex(a)+this.componentToHex(b)+this.componentToHex(c)},componentToHex:function(a){var b;return 2===(b=a.toString(16)).length?b:b+"0"}}),e.Physics.P2.Spring=function(a,b,c,d,f,g,h,m,n,p){this.game=a.game;void 0===d&&(d=1);void 0===f&&(f=100);void 0===g&&(g=1);d={restLength:(this.world=a).pxm(d),stiffness:f,damping:g};null!=
h&&(d.worldAnchorA=[a.pxm(h[0]),a.pxm(h[1])]);null!=m&&(d.worldAnchorB=[a.pxm(m[0]),a.pxm(m[1])]);null!=n&&(d.localAnchorA=[a.pxm(n[0]),a.pxm(n[1])]);null!=p&&(d.localAnchorB=[a.pxm(p[0]),a.pxm(p[1])]);this.data=new p2.LinearSpring(b,c,d);this.data.parent=this},e.Physics.P2.Spring.prototype.constructor=e.Physics.P2.Spring,e.Physics.P2.RotationalSpring=function(a,b,c,d,f,g){this.game=a.game;this.world=a;void 0===d&&(d=null);void 0===f&&(f=100);void 0===g&&(g=1);d&&=a.pxm(d);this.data=new p2.RotationalSpring(b,
c,{restAngle:d,stiffness:f,damping:g});this.data.parent=this},e.Physics.P2.Spring.prototype.constructor=e.Physics.P2.Spring,e.Physics.P2.Material=function(a){this.name=a;p2.Material.call(this)},e.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),e.Physics.P2.Material.prototype.constructor=e.Physics.P2.Material,e.Physics.P2.ContactMaterial=function(a,b,c){p2.ContactMaterial.call(this,a,b,c)},e.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),e.Physics.P2.ContactMaterial.prototype.constructor=
e.Physics.P2.ContactMaterial,e.Physics.P2.CollisionGroup=function(a){this.mask=a},e.Physics.P2.DistanceConstraint=function(a,b,c,d,f,g,h){void 0===d&&(d=100);void 0===f&&(f=[0,0]);void 0===g&&(g=[0,0]);void 0===h&&(h=Number.MAX_VALUE);this.game=a.game;a={distance:(this.world=a).pxm(d),localAnchorA:[a.pxmi(f[0]),a.pxmi(f[1])],localAnchorB:[a.pxmi(g[0]),a.pxmi(g[1])],maxForce:h};p2.DistanceConstraint.call(this,b,c,a)},e.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),
e.Physics.P2.DistanceConstraint.prototype.constructor=e.Physics.P2.DistanceConstraint,e.Physics.P2.GearConstraint=function(a,b,c,d,f){void 0===d&&(d=0);void 0===f&&(f=1);this.game=a.game;this.world=a;p2.GearConstraint.call(this,b,c,{angle:d,ratio:f})},e.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),e.Physics.P2.GearConstraint.prototype.constructor=e.Physics.P2.GearConstraint,e.Physics.P2.LockConstraint=function(a,b,c,d,f,g){void 0===d&&(d=[0,0]);void 0===f&&(f=0);
void 0===g&&(g=Number.MAX_VALUE);this.game=a.game;a={localOffsetB:[(this.world=a).pxm(d[0]),a.pxm(d[1])],localAngleB:f,maxForce:g};p2.LockConstraint.call(this,b,c,a)},e.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),e.Physics.P2.LockConstraint.prototype.constructor=e.Physics.P2.LockConstraint,e.Physics.P2.PrismaticConstraint=function(a,b,c,d,f,g,h,m){void 0===d&&(d=!0);void 0===f&&(f=[0,0]);void 0===g&&(g=[0,0]);void 0===h&&(h=[0,0]);void 0===m&&(m=Number.MAX_VALUE);
this.game=a.game;a={localAnchorA:[(this.world=a).pxmi(f[0]),a.pxmi(f[1])],localAnchorB:[a.pxmi(g[0]),a.pxmi(g[1])],localAxisA:h,maxForce:m,disableRotationalLock:!d};p2.PrismaticConstraint.call(this,b,c,a)},e.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),e.Physics.P2.PrismaticConstraint.prototype.constructor=e.Physics.P2.PrismaticConstraint,e.Physics.P2.RevoluteConstraint=function(a,b,c,d,f,g,h){void 0===g&&(g=Number.MAX_VALUE);void 0===h&&(h=null);this.game=
a.game;c=[(this.world=a).pxmi(c[0]),a.pxmi(c[1])];f=[a.pxmi(f[0]),a.pxmi(f[1])];h&&=[a.pxmi(h[0]),a.pxmi(h[1])];p2.RevoluteConstraint.call(this,b,d,{worldPivot:h,localPivotA:c,localPivotB:f,maxForce:g})},e.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),e.Physics.P2.RevoluteConstraint.prototype.constructor=e.Physics.P2.RevoluteConstraint,e.ImageCollection=function(a,b,c,d,f,g,h){(void 0===c||0>=c)&&(c=32);(void 0===d||0>=d)&&(d=32);void 0===f&&(f=0);void 0===
g&&(g=0);this.name=a;this.firstgid=0|b;this.imageWidth=0|c;this.imageHeight=0|d;this.imageMargin=0|f;this.imageSpacing=0|g;this.properties=h||{};this.images=[];this.total=0},e.ImageCollection.prototype={containsImageIndex:function(a){return a>=this.firstgid&&a<this.firstgid+this.total},addImage:function(a,b){this.images.push({gid:a,image:b});this.total++}},e.ImageCollection.prototype.constructor=e.ImageCollection,e.Tile=function(a,b,c,d,f,g){this.layer=a;this.index=b;this.x=c;this.y=d;this.rotation=
0;this.flipped=!1;this.worldX=c*f;this.worldY=d*g;this.width=f;this.height=g;this.centerX=Math.abs(f/2);this.centerY=Math.abs(g/2);this.alpha=1;this.properties={};this.collideDown=this.collideUp=this.collideRight=this.collideLeft=this.faceRight=this.faceLeft=this.faceBottom=this.faceTop=this.scanned=!1;this.collisionCallback=null;(this.collisionCallbackContext=this).debug=!1},e.Tile.prototype={containsPoint:function(a,b){return!(a<this.worldX||b<this.worldY||a>this.right||b>this.bottom)},intersects:function(a,
b,c,d){return!(c<=this.worldX)&&!(d<=this.worldY)&&!(a>=this.worldX+this.width)&&!(b>=this.worldY+this.height)},setCollisionCallback:function(a,b){this.collisionCallback=a;this.collisionCallbackContext=b},destroy:function(){this.properties=this.collisionCallbackContext=this.collisionCallback=null},setCollision:function(a,b,c,d){this.collideLeft=a;this.collideRight=b;this.collideUp=c;this.collideDown=d;this.faceLeft=a;this.faceRight=b;this.faceTop=c;this.faceBottom=d},resetCollision:function(){this.faceRight=
this.faceLeft=this.faceBottom=this.faceTop=this.collideDown=this.collideUp=this.collideRight=this.collideLeft=!1},isInteresting:function(a,b){return a&&b?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:a?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:!!b&&(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)},copy:function(a){this.index=a.index;this.alpha=a.alpha;
this.properties=a.properties;this.collideUp=a.collideUp;this.collideDown=a.collideDown;this.collideLeft=a.collideLeft;this.collideRight=a.collideRight;this.collisionCallback=a.collisionCallback;this.collisionCallbackContext=a.collisionCallbackContext}},e.Tile.prototype.constructor=e.Tile,Object.defineProperty(e.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(e.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||
this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(e.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(e.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(e.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(e.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),e.Tilemap=function(a,b,c,d,f,g){this.game=a;this.key=b;a=e.TilemapParser.parse(this.game,
b,c,d,f,g);null!==a&&(this.width=a.width,this.height=a.height,this.tileWidth=a.tileWidth,this.tileHeight=a.tileHeight,this.orientation=a.orientation,this.format=a.format,this.version=a.version,this.properties=a.properties,this.widthInPixels=a.widthInPixels,this.heightInPixels=a.heightInPixels,this.layers=a.layers,this.tilesets=a.tilesets,this.imagecollections=a.imagecollections,this.tiles=a.tiles,this.objects=a.objects,this.objectsMap=a.objectsMap,this.collideIndexes=[],this.collision=a.collision,
this.images=a.images,this.enableDebug=!1,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},e.Tilemap.CSV=0,e.Tilemap.TILED_JSON=1,e.Tilemap.NORTH=0,e.Tilemap.EAST=1,e.Tilemap.SOUTH=2,e.Tilemap.WEST=3,e.Tilemap.prototype={create:function(a,b,c,d,f,g){return void 0===g&&(g=this.game.world),this.width=b,this.height=c,this.setTileSize(d,f),this.layers.length=0,this.createBlankLayer(a,b,c,d,f,g)},setTileSize:function(a,b){this.tileWidth=a;this.tileHeight=b;this.widthInPixels=
this.width*a;this.heightInPixels=this.height*b},addTilesetImage:function(a,b,c,d,f,g,h){if(void 0===a)return null;void 0===c&&(c=this.tileWidth);void 0===d&&(d=this.tileHeight);void 0===f&&(f=0);void 0===g&&(g=0);void 0===h&&(h=0);0===c&&(c=32);0===d&&(d=32);if(null==b&&(b=a),e.BitmapData&&b instanceof e.BitmapData)b=b.canvas;else{if(!this.game.cache.checkImageKey(b))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+b+'"'),null;b=this.game.cache.getImage(b)}var m=this.getTilesetIndex(a);
if(null===m&&this.format===e.Tilemap.TILED_JSON)return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+a+'"'),console.log("Tilesets: ",this.tilesets),null;if(this.tilesets[m])return this.tilesets[m].setImage(b),this.tilesets[m];a=new e.Tileset(a,h,c,d,f,g,{});a.setImage(b);this.tilesets.push(a);b=this.tilesets.length-1;for(var n=m=f,p=0,q=0,r=0,u=h;u<h+a.total&&(this.tiles[u]=[m,n,b],m+=c+g,++p!==a.total)&&(++q!==a.columns||(m=f,n+=d+g,q=0,++r!==
a.rows));u++);return a},createFromObjects:function(a,b,c,d,f,g,h,m,n,p){void 0===f&&(f=!0);void 0===g&&(g=!1);void 0===h&&(h=this.game.world);void 0===m&&(m=e.Sprite);void 0===n&&(n=!0);void 0===p&&(p=!0);var q=this.objects[a];if(!q)return console.warn("Tilemap.createFromObjects: Invalid object layer name given: "+a),void console.log("Object layers: ",this.objects);var r=[],u=[],x=typeof b;"number"===x?this.getObjects(a,"gid",b,r):"string"===x?this.getObjects(a,"name",b,r):Array.isArray(b)?this.getObjects(a,
b[0],b[1],r):null===b&&(r=q);for(a=0;a<r.length;a++){q=r[a];b=new m(this.game,parseFloat(q.x),parseFloat(q.y),c,d);b.name=q.name;b.autoCull=g;b.exists=f;b.visible=q.visible;p&&(q.width&&(b.width=q.width),q.height&&(b.height=q.height));q.rotation&&(b.angle=q.rotation);n&&q.gid&&(b.y-=b.height);null!==h&&h.add(b);q=q.properties;for(var w in q)e.Utils.setProperty(b,w,q[w]);u.push(b)}return u},createFromTiles:function(a,b,c,d,f,g){"number"==typeof a&&(a=[a]);null==b?b=[]:"number"==typeof b&&(b=[b]);d=
this.getLayer(d);void 0===f&&(f=this.game.world);void 0===g&&(g={});void 0===g.customClass&&(g.customClass=e.Sprite);void 0===g.adjustY&&(g.adjustY=!0);var h=this.layers[d].width,m=this.layers[d].height;if(this.copy(0,0,h,m,d),2>this._results.length)return 0;for(var n,p=0,q=1,r=this._results.length;q<r;q++)if(-1!==a.indexOf(this._results[q].index)){for(var u in n=new g.customClass(this.game,this._results[q].worldX,this._results[q].worldY,c),g)n[u]=g[u];f.add(n);p++}if(1===b.length)for(q=0;q<a.length;q++)this.replace(a[q],
b[0],0,0,h,m,d);else if(1<b.length)for(q=0;q<a.length;q++)this.replace(a[q],b[q],0,0,h,m,d);return p},createLayer:function(a,b,c,d){void 0===b&&(b=this.game.width);void 0===c&&(c=this.game.height);void 0===d&&(d=this.game.world);var f=a;if("string"==typeof a&&(f=this.getLayerIndex(a)),null===f||f>this.layers.length)return console.warn('Tilemap.createLayer: Invalid layer ID given: "'+a+'"'),void console.log("Layers: ",this.layers);void 0===b||0>=b?b=Math.min(this.game.width,this.layers[f].widthInPixels):
b>this.game.width&&(b=this.game.width);void 0===c||0>=c?c=Math.min(this.game.height,this.layers[f].heightInPixels):c>this.game.height&&(c=this.game.height);this.enableDebug&&(console.group("Tilemap.createLayer"),console.log("Name:",this.layers[f].name),console.log("Size:",b,"x",c),console.log("Tileset:",this.tilesets[0].name,"index:",f));a=d.add(new e.TilemapLayer(this.game,this,f,b,c));return this.enableDebug&&console.groupEnd(),a},createBlankLayer:function(a,b,c,d,f,g){if(void 0===g&&(g=this.game.world),
null===this.getLayerIndex(a)){for(var h,m={name:a,x:0,y:0,width:b,height:c,widthInPixels:b*d,heightInPixels:c*f,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},n=[],p=0;p<c;p++){h=[];for(var q=0;q<b;q++)h.push(new e.Tile(m,-1,q,p,d,f));n.push(h)}m.data=n;this.layers.push(m);this.currentLayer=this.layers.length-1;b=m.widthInPixels;m=m.heightInPixels;return b>this.game.width&&(b=this.game.width),m>this.game.height&&(m=this.game.height),(n=new e.TilemapLayer(this.game,this,
this.layers.length-1,b,m)).name=a,g.add(n)}console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+a)},getIndex:function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return c;return null},getLayerIndex:function(a){return this.getIndex(this.layers,a)},getObject:function(a){return this.objectsMap[a]||null},getObjects:function(a,b,c,d){a=this.objects[a];var f=a.length;void 0===d&&(d=[]);for(var g=0;g<f;g++){var h=a[g];h[b]===c&&d.push(h)}return d},getTilesetIndex:function(a){return this.getIndex(this.tilesets,
a)},getImageIndex:function(a){return this.getIndex(this.images,a)},setTileIndexCallback:function(a,b,c,d){if(d=this.getLayer(d),"number"==typeof a)null===b?delete this.layers[d].callbacks[a]:this.layers[d].callbacks[a]={callback:b,callbackContext:c};else for(var f=0,g=a.length;f<g;f++)null===b?delete this.layers[d].callbacks[a[f]]:this.layers[d].callbacks[a[f]]={callback:b,callbackContext:c}},setTileLocationCallback:function(a,b,c,d,f,g,h){if(h=this.getLayer(h),this.copy(a,b,c,d,h),!(2>this._results.length))for(a=
1;a<this._results.length;a++)this._results[a].setCollisionCallback(f,g)},setCollision:function(a,b,c,d){if(void 0===b&&(b=!0),void 0===d&&(d=!0),c=this.getLayer(c),"number"==typeof a)return this.setCollisionByIndex(a,b,c,!0);if(Array.isArray(a)){for(var f=0;f<a.length;f++)this.setCollisionByIndex(a[f],b,c,!1);d&&this.calculateFaces(c)}},setCollisionBetween:function(a,b,c,d,f){if(void 0===c&&(c=!0),void 0===f&&(f=!0),d=this.getLayer(d),!(b<a)){for(;a<=b;a++)this.setCollisionByIndex(a,c,d,!1);f&&this.calculateFaces(d)}},
setCollisionByExclusion:function(a,b,c,d){void 0===b&&(b=!0);void 0===d&&(d=!0);c=this.getLayer(c);for(var f=0,g=this.tiles.length;f<g;f++)-1===a.indexOf(f)&&this.setCollisionByIndex(f,b,c,!1);d&&this.calculateFaces(c)},setCollisionByIndex:function(a,b,c,d){if(void 0===b&&(b=!0),void 0===c&&(c=this.currentLayer),void 0===d&&(d=!0),b)this.collideIndexes.push(a);else{var f=this.collideIndexes.indexOf(a);-1<f&&this.collideIndexes.splice(f,1)}for(f=0;f<this.layers[c].height;f++)for(var g=0;g<this.layers[c].width;g++){var h=
this.layers[c].data[f][g];h&&h.index===a&&(b?h.setCollision(!0,!0,!0,!0):h.resetCollision(),h.faceTop=b,h.faceBottom=b,h.faceLeft=b,h.faceRight=b)}return d&&this.calculateFaces(c),c},getLayer:function(a){if(void 0===a)a=this.currentLayer;else if("string"==typeof a){var b=a;null===(a=this.getLayerIndex(a))&&console.warn("No such layer name: "+b)}else a instanceof e.TilemapLayer&&(a=a.index);return a},setPreventRecalculate:function(a){if(!0===a&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=
!0,this.needToRecalculate={}),!1===a&&!0===this.preventingRecalculate){for(var b in this.preventingRecalculate=!1,this.needToRecalculate)this.calculateFaces(b);this.needToRecalculate=!1}},calculateFaces:function(a){if(this.preventingRecalculate)this.needToRecalculate[a]=!0;else for(var b=null,c=null,d=null,f=null,g=0,h=this.layers[a].height;g<h;g++)for(var m=0,n=this.layers[a].width;m<n;m++){var p=this.layers[a].data[g][m];p&&(b=this.getTileAbove(a,m,g),c=this.getTileBelow(a,m,g),d=this.getTileLeft(a,
m,g),f=this.getTileRight(a,m,g),p.collides&&(p.faceTop=!0,p.faceBottom=!0,p.faceLeft=!0,p.faceRight=!0),b&&b.collides&&(p.faceTop=!1),c&&c.collides&&(p.faceBottom=!1),d&&d.collides&&(p.faceLeft=!1),f&&f.collides&&(p.faceRight=!1))}},getTileAbove:function(a,b,c){return 0<c?this.layers[a].data[c-1][b]:null},getTileBelow:function(a,b,c){return c<this.layers[a].height-1?this.layers[a].data[c+1][b]:null},getTileLeft:function(a,b,c){return 0<b?this.layers[a].data[c][b-1]:null},getTileRight:function(a,b,
c){return b<this.layers[a].width-1?this.layers[a].data[c][b+1]:null},setLayer:function(a){a=this.getLayer(a);this.layers[a]&&(this.currentLayer=a)},hasTile:function(a,b,c){return c=this.getLayer(c),void 0!==this.layers[c].data[b]&&void 0!==this.layers[c].data[b][a]&&-1<this.layers[c].data[b][a].index},removeTile:function(a,b,c){if(c=this.getLayer(c),0<=a&&a<this.layers[c].width&&0<=b&&b<this.layers[c].height&&this.hasTile(a,b,c)){var d=this.layers[c].data[b][a];return this.layers[c].data[b][a]=new e.Tile(this.layers[c],
-1,a,b,this.tileWidth,this.tileHeight),this.layers[c].dirty=!0,this.calculateFaces(c),d}},removeTileWorldXY:function(a,b,c,d,f){return f=this.getLayer(f),a=this.game.math.snapToFloor(a,c)/c,b=this.game.math.snapToFloor(b,d)/d,this.removeTile(a,b,f)},putTile:function(a,b,c,d){var f;return null===a?this.removeTile(b,c,d):(d=this.getLayer(d),0<=b&&b<this.layers[d].width&&0<=c&&c<this.layers[d].height?(a instanceof e.Tile?(f=a.index,this.hasTile(b,c,d)?this.layers[d].data[c][b].copy(a):this.layers[d].data[c][b]=
new e.Tile(d,f,b,c,a.width,a.height)):(f=a,this.hasTile(b,c,d)?this.layers[d].data[c][b].index=f:this.layers[d].data[c][b]=new e.Tile(this.layers[d],f,b,c,this.tileWidth,this.tileHeight)),-1<this.collideIndexes.indexOf(f)?this.layers[d].data[c][b].setCollision(!0,!0,!0,!0):this.layers[d].data[c][b].resetCollision(),this.layers[d].dirty=!0,this.calculateFaces(d),this.layers[d].data[c][b]):null)},putTileWorldXY:function(a,b,c,d,f,g){return g=this.getLayer(g),b=this.game.math.snapToFloor(b,d)/d,c=this.game.math.snapToFloor(c,
f)/f,this.putTile(a,b,c,g)},searchTileIndex:function(a,b,c,d,f){void 0===b&&(b=0);void 0===c&&(c=!1);d=this.getLayer(d);var g,h=0,m=this.layers[d].height,n=this.layers[d].width;d=this.layers[d].data;if(f)var p=[];if(c)for(var q=m-1;0<=q;q--){c=d[q];for(var r=n-1;0<=r;r--)if((g=c[r]).index===a)if(b<=h){if(!f)return g;p.push(g)}else h++}else for(q=0;q<m;q++)for(c=d[q],r=0;r<n;r++)if((g=c[r]).index===a)if(b<=h){if(!f)return g;p.push(g)}else h++;return f?p:null},getTile:function(a,b,c,d){return void 0===
d&&(d=!1),c=this.getLayer(c),0<=a&&a<this.layers[c].width&&0<=b&&b<this.layers[c].height?-1===this.layers[c].data[b][a].index?d?this.layers[c].data[b][a]:null:this.layers[c].data[b][a]:null},getTileWorldXY:function(a,b,c,d,f,g){return void 0===c&&(c=this.tileWidth),void 0===d&&(d=this.tileHeight),f=this.getLayer(f),a=this.game.math.snapToFloor(a,c)/c,b=this.game.math.snapToFloor(b,d)/d,this.getTile(a,b,f,g)},copy:function(a,b,c,d,f){if(f=this.getLayer(f),this.layers[f]){void 0===a&&(a=0);void 0===
b&&(b=0);void 0===c&&(c=this.layers[f].width);void 0===d&&(d=this.layers[f].height);0>a&&(a=0);0>b&&(b=0);c>this.layers[f].width&&(c=this.layers[f].width);d>this.layers[f].height&&(d=this.layers[f].height);this._results.length=0;this._results.push({x:a,y:b,width:c,height:d,layer:f});for(var g=b;g<b+d;g++)for(var h=a;h<a+c;h++)this._results.push(this.layers[f].data[g][h]);return this._results}this._results.length=0},paste:function(a,b,c,d){if(void 0===a&&(a=0),void 0===b&&(b=0),d=this.getLayer(d),
c&&!(2>c.length)){a-=c[1].x;b-=c[1].y;for(var f=1;f<c.length;f++)this.layers[d].data[b+c[f].y][a+c[f].x].copy(c[f]);this.layers[d].dirty=!0;this.calculateFaces(d)}},swap:function(a,b,c,d,f,g,h){h=this.getLayer(h);this.copy(c,d,f,g,h);2>this._results.length||(this._tempA=a,this._tempB=b,this._results.forEach(this.swapHandler,this),this.paste(c,d,this._results,h))},swapHandler:function(a){a.index===this._tempA?a.index=this._tempB:a.index===this._tempB&&(a.index=this._tempA)},forEach:function(a,b,c,
d,f,g,h){h=this.getLayer(h);this.copy(c,d,f,g,h);2>this._results.length||(this._results.forEach(a,b),this.paste(c,d,this._results,h))},replace:function(a,b,c,d,f,g,h){if(h=this.getLayer(h),this.copy(c,d,f,g,h),!(2>this._results.length)){for(f=1;f<this._results.length;f++)this._results[f].index===a&&(this._results[f].index=b);this.paste(c,d,this._results,h)}},random:function(a,b,c,d,f){if(f=this.getLayer(f),this.copy(a,b,c,d,f),!(2>this._results.length)){c=[];for(d=1;d<this._results.length;d++)if(this._results[d].index){var g=
this._results[d].index;-1===c.indexOf(g)&&c.push(g)}for(d=1;d<this._results.length;d++)this._results[d].index=this.game.rnd.pick(c);this.paste(a,b,this._results,f)}},shuffle:function(a,b,c,d,f){if(f=this.getLayer(f),this.copy(a,b,c,d,f),!(2>this._results.length)){c=[];for(d=1;d<this._results.length;d++)this._results[d].index&&c.push(this._results[d].index);e.ArrayUtils.shuffle(c);for(d=1;d<this._results.length;d++)this._results[d].index=c[d-1];this.paste(a,b,this._results,f)}},fill:function(a,b,c,
d,f,g){if(g=this.getLayer(g),this.copy(b,c,d,f,g),!(2>this._results.length)){for(d=1;d<this._results.length;d++)this._results[d].index=a;this.paste(b,c,this._results,g)}},removeAllLayers:function(){this.currentLayer=this.layers.length=0},dump:function(){for(var a="",b=[""],c=0;c<this.layers[this.currentLayer].height;c++){for(var d=0;d<this.layers[this.currentLayer].width;d++)a+="%c  ",1<this.layers[this.currentLayer].data[c][d]?this.debugMap[this.layers[this.currentLayer].data[c][d]]?b.push("background: "+
this.debugMap[this.layers[this.currentLayer].data[c][d]]):b.push("background: #ffffff"):b.push("background: rgb(0, 0, 0)");a+="\n"}b[0]=a;console.log.apply(console,b)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}},e.Tilemap.prototype.constructor=e.Tilemap,Object.defineProperty(e.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(a){a!==this.currentLayer&&this.setLayer(a)}}),e.TilemapLayer=function(a,b,c,d,f){d|=0;f|=0;e.Sprite.call(this,
a,0,0);this.map=b;this.index=c;this.layer=b.layers[c];this.canvas=e.CanvasPool.create(this,d,f);this.context=this.canvas.getContext("2d");this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas,null,this.game.resolution)));this.physicsType=this.type=e.TILEMAPLAYER;this.renderSettings={enableScrollDelta:!0,overdrawRatio:.2,copyCanvas:null};this.debug=!1;this.exists=!0;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,
facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorY=this.scrollFactorX=1;this.dirty=!0;this.rayStepRate=4;this._wrap=!1;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:b.tileWidth,tileHeight:b.tileHeight,cw:b.tileWidth,ch:b.tileHeight,tilesets:[]};this._scrollY=this._scrollX=0;this.tileOffset=new e.Point(this.layer.offsetX||0,this.layer.offsetY||0);this._results=[];a.device.canvasBitBltShift||(this.renderSettings.copyCanvas=e.TilemapLayer.ensureSharedCopyCanvas());
this.fixedToCamera=!0},e.TilemapLayer.prototype=Object.create(e.Sprite.prototype),e.TilemapLayer.prototype.constructor=e.TilemapLayer,e.TilemapLayer.prototype.preUpdateCore=e.Component.Core.preUpdate,e.TilemapLayer.sharedCopyCanvas=null,e.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=e.CanvasPool.create(this,2,2)),this.sharedCopyCanvas},e.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()},e.TilemapLayer.prototype.postUpdate=
function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y},e.TilemapLayer.prototype._renderCanvas=function(a){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+
this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderCanvas.call(this,a)},e.TilemapLayer.prototype._renderWebGL=function(a){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/
this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderWebGL.call(this,a)},e.TilemapLayer.prototype.destroy=function(){e.CanvasPool.remove(this);e.Component.Destroy.prototype.destroy.call(this)},e.TilemapLayer.prototype.resize=
function(a,b){this.canvas.width=a;this.canvas.height=b;this.texture.frame.resize(a,b);this.texture.width=a;this.texture.height=b;this.texture.crop.width=a;this.texture.crop.height=b;this.texture.baseTexture.width=a;this.texture.baseTexture.height=b;this.texture.baseTexture.dirty();this.texture.requiresUpdate=!0;this.texture._updateUvs();this.dirty=!0},e.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},
e.TilemapLayer.prototype.getTileOffsetX=function(){return this.tileOffset.x||(this.fixedToCamera?0:this.position.x)},e.TilemapLayer.prototype.getTileOffsetY=function(){return this.tileOffset.y||(this.fixedToCamera?0:this.position.y)},e.TilemapLayer.prototype._fixX=function(a){return 1===this.scrollFactorX||0===this.scrollFactorX&&0===this.position.x?a:0===this.scrollFactorX&&0!==this.position.x?a-this.position.x:this._scrollX+(a-this._scrollX/this.scrollFactorX)},e.TilemapLayer.prototype._unfixX=
function(a){return 1===this.scrollFactorX?a:this._scrollX/this.scrollFactorX+(a-this._scrollX)},e.TilemapLayer.prototype._fixY=function(a){return 1===this.scrollFactorY||0===this.scrollFactorY&&0===this.position.y?a:0===this.scrollFactorY&&0!==this.position.y?a-this.position.y:this._scrollY+(a-this._scrollY/this.scrollFactorY)},e.TilemapLayer.prototype._unfixY=function(a){return 1===this.scrollFactorY?a:this._scrollY/this.scrollFactorY+(a-this._scrollY)},e.TilemapLayer.prototype.getTileX=function(a){return Math.floor(this._fixX(a)/
this._mc.tileWidth)},e.TilemapLayer.prototype.getTileY=function(a){return Math.floor(this._fixY(a)/this._mc.tileHeight)},e.TilemapLayer.prototype.getTileXY=function(a,b,c){return c.x=this.getTileX(a),c.y=this.getTileY(b),c},e.TilemapLayer.prototype.getRayCastTiles=function(a,b,c,d){b||=this.rayStepRate;void 0===c&&(c=!1);void 0===d&&(d=!1);var f=!(c||d);a=a.coordinatesOnLine(b);b=[];var g=new e.Point,h=this.map.layers[this.map.getLayer(this)],m=h.data,n=h.width;h=h.height;for(var p=0;p<a.length;p++){var q=
a[p];this.getTileXY(q[0],q[1],g);q=g.x;var r=g.y;0>q||n<=q||0>r||h<=r||(q=m[r][q],-1===b.indexOf(q)&&(f||q.isInteresting(c,d))&&b.push(q))}return b},e.TilemapLayer.prototype.getTiles=function(a,b,c,d,f,g){void 0===f&&(f=!1);void 0===g&&(g=!1);var h=!(f||g);a=this._fixX(a);b=this._fixY(b);var m=Math.floor(a/(this._mc.cw*this.scale.x)),n=Math.floor(b/(this._mc.ch*this.scale.y));a=Math.ceil((a+c)/(this._mc.cw*this.scale.x))-m;for(b=Math.ceil((b+d)/(this._mc.ch*this.scale.y))-n;this._results.length;)this._results.pop();
for(d=n;d<n+b;d++)for(c=m;c<m+a;c++){var p=this.layer.data[d];p&&p[c]&&(h||p[c].isInteresting(f,g))&&this._results.push(p[c])}return this._results.slice()},e.TilemapLayer.prototype.resolveTileset=function(a){var b=this._mc.tilesets;if(2E3>a)for(;b.length<a;)b.push(void 0);var c=this.map.tiles[a]&&this.map.tiles[a][2];return null!==c&&(c=this.map.tilesets[c])&&c.containsTileIndex(a)?b[a]=c:b[a]=null},e.TilemapLayer.prototype.resetTilesetCache=function(){for(var a=this._mc.tilesets;a.length;)a.pop()},
e.TilemapLayer.prototype.setScale=function(a,b){a=a||1;b=b||a;for(var c=0;c<this.layer.data.length;c++)for(var d=this.layer.data[c],f=0;f<d.length;f++){var g=d[f];g.width=this.map.tileWidth*a;g.height=this.map.tileHeight*b;g.worldX=g.x*g.width;g.worldY=g.y*g.height}this.scale.setTo(a,b)},e.TilemapLayer.prototype.shiftCanvas=function(a,b,c){var d=a.canvas,f=d.width-Math.abs(b),g=d.height-Math.abs(c),h=0,m=0,n=b,p=c;0>b&&(h=-b,n=0);0>c&&(m=-c,p=0);(b=this.renderSettings.copyCanvas)?((b.width<f||b.height<
g)&&(b.width=f,b.height=g),c=b.getContext("2d"),c.clearRect(0,0,f,g),c.drawImage(d,h,m,f,g,0,0,f,g),a.clearRect(n,p,f,g),a.drawImage(b,0,0,f,g,n,p,f,g)):(a.save(),a.globalCompositeOperation="copy",a.drawImage(d,h,m,f,g,n,p,f,g),a.restore())},e.TilemapLayer.prototype.renderRegion=function(a,b,c,d,f,g){var h=this.context,m=this.layer.width,n=this.layer.height,p=this._mc.tileWidth,q=this._mc.tileHeight,r=this._mc.tilesets,u=NaN;this._wrap||(c<=f&&(c=Math.max(0,c),f=Math.min(m-1,f)),d<=g&&(d=Math.max(0,
d),g=Math.min(n-1,g)));var x=c*p-a,w=(c+1048576*m)%m;a=(d+1048576*n)%n;g-=d;for(d=d*q-b;0<=g;a++,g--,d+=q){n<=a&&(a-=n);var A=this.layer.data[a];var C=w;var L=f-c;for(b=x;0<=L;C++,L--,b+=p){m<=C&&(C-=m);var M=A[C];if(M&&!(0>M.index)){var P=M.index,V=r[P];void 0===V&&(V=this.resolveTileset(P));M.alpha===u||this.debug||(h.globalAlpha=M.alpha,u=M.alpha);V?M.rotation||M.flipped?(h.save(),h.translate(b+M.centerX,d+M.centerY),h.rotate(M.rotation),M.flipped&&h.scale(-1,1),V.draw(h,-M.centerX,-M.centerY,
P),h.restore()):V.draw(h,b,d,P):this.debugSettings.missingImageFill&&(h.fillStyle=this.debugSettings.missingImageFill,h.fillRect(b,d,p,q));M.debug&&this.debugSettings.debuggedTileOverfill&&(h.fillStyle=this.debugSettings.debuggedTileOverfill,h.fillRect(b,d,p,q))}}}},e.TilemapLayer.prototype.renderDeltaScroll=function(a,b){var c=this._mc.scrollX,d=this._mc.scrollY,f=this.canvas.width,g=this.canvas.height,h=this._mc.tileWidth,m=this._mc.tileHeight,n=0,p=-h,q=0,r=-m;if(0>a?(n=f+a,p=f-1):0<a&&(p=a),0>
b?(q=g+b,r=g-1):0<b&&(r=b),this.shiftCanvas(this.context,a,b),n=Math.floor((n+c)/h),p=Math.floor((p+c)/h),q=Math.floor((q+d)/m),r=Math.floor((r+d)/m),n<=p)this.context.clearRect(n*h-c,0,(p-n+1)*h,g),this.renderRegion(c,d,n,Math.floor((0+d)/m),p,Math.floor((g-1+d)/m));q<=r&&(this.context.clearRect(0,q*m-d,f,(r-q+1)*m),this.renderRegion(c,d,Math.floor((0+c)/h),q,Math.floor((f-1+c)/h),r))},e.TilemapLayer.prototype.renderFull=function(){var a=this._mc.scrollX,b=this._mc.scrollY,c=this.canvas.width,d=
this.canvas.height,f=this._mc.tileWidth,g=this._mc.tileHeight,h=Math.floor(a/f);f=Math.floor((c-1+a)/f);var m=Math.floor(b/g);g=Math.floor((d-1+b)/g);this.context.clearRect(0,0,c,d);this.renderRegion(a,b,h,m,f,g)},e.TilemapLayer.prototype.render=function(){var a=!1;if(this.visible){(this.dirty||this.layer.dirty)&&(a=!(this.layer.dirty=!1));var b=this.canvas.width,c=this.canvas.height,d=0|this._scrollX,f=0|this._scrollY,g=this._mc,h=g.scrollX-d,m=g.scrollY-f;if(a||0!==h||0!==m||g.renderWidth!==b||
g.renderHeight!==c)return this.context.save(),g.scrollX=d,g.scrollY=f,g.renderWidth===b&&g.renderHeight===c||(g.renderWidth=b,g.renderHeight=c),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(a=!0)),!a&&this.renderSettings.enableScrollDelta&&Math.abs(h)+Math.abs(m)<Math.min(b,c)?this.renderDeltaScroll(h,m):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),
!0}},e.TilemapLayer.prototype.renderDebug=function(){var a=this._mc.scrollX;var b=this._mc.scrollY;var c=this.context,d=this.layer.width,f=this.layer.height,g=this._mc.tileWidth,h=this._mc.tileHeight,m=Math.floor(a/g),n=Math.floor((this.canvas.width-1+a)/g);var p=Math.floor(b/h);var q=Math.floor((this.canvas.height-1+b)/h);var r=m*g-a,u=(m+1048576*d)%d;c.strokeStyle=this.debugSettings.facingEdgeStroke;a=(p+1048576*f)%f;q-=p;for(p=p*h-b;0<=q;a++,q--,p+=h){f<=a&&(a-=f);var x=this.layer.data[a];var w=
u;var A=n-m;for(b=r;0<=A;w++,A--,b+=g){d<=w&&(w-=d);var C=x[w];!C||0>C.index||!C.collides||(this.debugSettings.collidingTileOverfill&&(c.fillStyle=this.debugSettings.collidingTileOverfill,c.fillRect(b,p,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(c.beginPath(),C.faceTop&&(c.moveTo(b,p),c.lineTo(b+this._mc.cw,p)),C.faceBottom&&(c.moveTo(b,p+this._mc.ch),c.lineTo(b+this._mc.cw,p+this._mc.ch)),C.faceLeft&&(c.moveTo(b,p),c.lineTo(b,p+this._mc.ch)),C.faceRight&&(c.moveTo(b+this._mc.cw,
p),c.lineTo(b+this._mc.cw,p+this._mc.ch)),c.closePath(),c.stroke()))}}},Object.defineProperty(e.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(a){this._wrap=a;this.dirty=!0}}),Object.defineProperty(e.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(a){this._scrollX=a}}),Object.defineProperty(e.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(a){this._scrollY=a}}),Object.defineProperty(e.TilemapLayer.prototype,
"collisionWidth",{get:function(){return this._mc.cw},set:function(a){this._mc.cw=0|a;this.dirty=!0}}),Object.defineProperty(e.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(a){this._mc.ch=0|a;this.dirty=!0}}),e.TilemapParser={INSERT_NULL:!1,parse:function(a,b,c,d,f,g){if(void 0===c&&(c=32),void 0===d&&(d=32),void 0===f&&(f=10),void 0===g&&(g=10),void 0===b)return this.getEmptyData();if(null===b)return this.getEmptyData(c,d,f,g);if(a=a.cache.getTilemapData(b)){if(a.format===
e.Tilemap.CSV)return this.parseCSV(b,a.data,c,d);if(!a.format||a.format===e.Tilemap.TILED_JSON)return this.parseTiledJSON(a.data)}else console.warn('No map data found for key "%s"',b)},parseCSV:function(a,b,c,d){var f=this.getEmptyData(),g=[];b=b.trim().split("\n");for(var h=b.length,m=0,n=0;n<b.length;n++){g[n]=[];for(var p=b[n].split(","),q=0;q<p.length;q++)g[n][q]=new e.Tile(f.layers[0],parseInt(p[q],10),q,n,c,d);0===m&&(m=p.length)}return f.format=e.Tilemap.CSV,f.name=a,f.width=m,f.height=h,f.tileWidth=
c,f.tileHeight=d,f.widthInPixels=m*c,f.heightInPixels=h*d,f.layers[0].width=m,f.layers[0].height=h,f.layers[0].widthInPixels=f.widthInPixels,f.layers[0].heightInPixels=f.heightInPixels,f.layers[0].data=g,f},getEmptyData:function(a,b,c,d){return{width:null!=c?c:0,height:null!=d?d:0,tileWidth:null!=a?a:0,tileHeight:null!=b?b:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,
properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},getEmptyObject:function(){return{id:void 0,x:void 0,y:void 0,width:void 0,height:void 0,rotation:void 0,visible:void 0,name:void 0,type:void 0,ellipse:!1,gid:null,point:!1,polygon:null,polyline:null,properties:null,rectangle:!1,template:null,text:null}},createObject:function(a){a=Object.assign(this.getEmptyObject(),a);a.rectangle=!(a.ellipse||a.gid||a.point||a.polygon||a.polyline||a.template||
a.text);var b=a.properties;if(b&&Array.isArray(b)){for(var c={},d=0,f=b.length;d<f;d++){var g=b[d];c[g.name]=g.value}a.properties=c}return a},parseObjectGroup:function(a,b,c,d,f,g){f=f||{x:0,y:0};(d=d||a.name)||console.warn("No name found for objectGroup",a);void 0!==f.x&&void 0!==f.y||console.warn("Malformed xy properties in relativePosition",f);b[d]=b[d]||[];c[d]=c[d]||[];for(var h=0,m=a.objects.length;h<m;h++){var n=a.objects[h],p=this.createObject(n);if(p.x+=f.x,p.y+=f.y,b[d].push(p),p.id&&(g[p.id]=
p),n.polyline){p.polyline=[];for(var q=0;q<n.polyline.length;q++)p.polyline.push([n.polyline[q].x,n.polyline[q].y]);c[d].push(p)}else if(n.polygon){p.polygon=[];for(q=0;q<n.polygon.length;q++)p.polygon.push([n.polygon[q].x,n.polygon[q].y]);c[d].push(p)}else(n.ellipse||n.rectangle)&&c[d].push(p)}return{objectsCollection:b,collisionCollection:c}},parseTiledJSON:function(a){if("orthogonal"!==a.orientation)return console.warn('Phaser CE supports only orthogonal maps. This map\'s orientation is "%s".',
a.orientation),null;for(var b={width:a.width,height:a.height,tileWidth:a.tilewidth,tileHeight:a.tileheight,orientation:a.orientation,format:e.Tilemap.TILED_JSON,version:a.version,properties:a.properties,widthInPixels:a.width*a.tilewidth,heightInPixels:a.height*a.tileheight},c=[],d=0;d<a.layers.length;d++)if("tilelayer"===a.layers[d].type){var f=a.layers[d];if(!f.compression&&f.encoding&&"base64"===f.encoding){for(var g=window.atob(f.data),h=g.length,m=Array(h),n=0;n<h;n+=4)m[n/4]=(g.charCodeAt(n)|
g.charCodeAt(n+1)<<8|g.charCodeAt(n+2)<<16|g.charCodeAt(n+3)<<24)>>>0;f.data=m;delete f.encoding}else if(f.compression){console.warn('Layer compression is unsupported, skipping layer "%s".',f.name);continue}m={name:f.name,x:f.x,y:f.y,width:f.width,height:f.height,widthInPixels:f.width*a.tilewidth,heightInPixels:f.height*a.tileheight,alpha:f.opacity,offsetX:f.offsetx,offsetY:f.offsety,visible:f.visible,properties:{},indexes:[],callbacks:[],bodies:[]};f.properties&&(m.properties=f.properties);var p,
q,r;n=0;var u=[],x=[];g=0;for(h=f.data.length;g<h;g++){if(q=!1,r=p=0,536870912<(A=f.data[g]))switch(2147483648<A&&(A-=2147483648,r+=4),1073741824<A&&(A-=1073741824,r+=2),536870912<A&&(A-=536870912,r+=1),r){case 5:p=Math.PI/2;break;case 6:p=Math.PI;break;case 3:p=3*Math.PI/2;break;case 4:q=!(p=0);break;case 7:p=Math.PI/2;q=!0;break;case 2:p=Math.PI;q=!0;break;case 1:p=3*Math.PI/2,q=!0}0<A?((C=new e.Tile(m,A,n,x.length,a.tilewidth,a.tileheight)).rotation=p,C.flipped=q,0!==r&&(C.flippedVal=r),u.push(C)):
e.TilemapParser.INSERT_NULL?u.push(null):u.push(new e.Tile(m,-1,n,x.length,a.tilewidth,a.tileheight));++n===f.width&&(x.push(u),n=0,u=[])}m.data=x;c.push(m)}b.layers=c;c=[];for(d=0;d<a.layers.length;d++)"imagelayer"===a.layers[d].type&&(f=a.layers[d],n={name:f.name,image:f.image,x:f.x,y:f.y,alpha:f.opacity,visible:f.visible,properties:{}},f.properties&&(n.properties=f.properties),c.push(n));b.images=c;g=[];c={};m=[];u=null;for(d=0;d<a.tilesets.length;d++){if((f=a.tilesets[d]).source)console.warn("Phaser CE can't load external tilesets (%s). Embed the tileset and then export the map again. https://github.com/photonstorm/phaser-ce/issues/273",
f.source);else if(f.image)n=new e.Tileset(f.name,f.firstgid,f.tilewidth,f.tileheight,f.margin,f.spacing,f.properties),f.tileproperties&&(n.tileProperties=f.tileproperties),n.updateTileData(f.imagewidth,f.imageheight),g.push(n);else{if(!f.tiles)throw Error("Tileset "+f.name+" has no `image` or `tiles` property.");h=new e.ImageCollection(f.name,f.firstgid,f.tilewidth,f.tileheight,f.margin,f.spacing,f.properties);for(var w in f.tiles){n=f.tiles[w].image;var A=f.firstgid+parseInt(w,10);h.addImage(A,n)}m.push(h)}for(w in f.tiles)(L=
f.tiles[w].objectgroup)&&(c[parseInt(w,10)+f.firstgid]=L);u&&(u.lastgid=f.firstgid-1);u=f}if(0===g.length&&0===m.length)throw Error("This tilemap has no tilesets.");b.tilesets=g;b.imagecollections=m;var C;f={};w={};A={};for(d=0;d<a.layers.length;d++)if("objectgroup"===a.layers[d].type){var L=a.layers[d];this.parseObjectGroup(L,f,w,void 0,void 0,A)}b.objects=f;b.collision=w;b.objectsMap=A;b.tiles=[];for(d=0;d<b.tilesets.length;d++)for(n=(f=b.tilesets[d]).tileMargin,a=f.tileMargin,h=u=m=0,g=f.firstgid;g<
f.firstgid+f.total&&(b.tiles[g]=[n,a,d],n+=f.tileWidth+f.tileSpacing,++m!==f.total)&&(++u!==f.columns||(n=f.tileMargin,a+=f.tileHeight+f.tileSpacing,u=0,++h!==f.rows));g++);for(d=0;d<b.layers.length;d++)for(w[(m=b.layers[d]).name]=[],f=null,n=0;n<m.data.length;n++)for(u=m.data[n],g=0;g<u.length;g++)null===(C=u[g])||0>C.index||(a=b.tiles[C.index][2],(f=b.tilesets[a]).tileProperties&&f.tileProperties[C.index-f.firstgid]&&(C.properties=e.Utils.mixin(f.tileProperties[C.index-f.firstgid],C.properties)),
(L=c[C.index])&&this.parseObjectGroup(L,b.objects,b.collision,C.layer.name,{x:C.worldX+L.x,y:C.worldY+L.y},A));return b}},e.Tileset=function(a,b,c,d,f,g,h){(void 0===c||0>=c)&&(c=32);(void 0===d||0>=d)&&(d=32);void 0===f&&(f=0);void 0===g&&(g=0);this.name=a;this.firstgid=0|b;this.tileWidth=0|c;this.tileHeight=0|d;this.tileMargin=0|f;this.tileSpacing=0|g;this.properties=h||{};this.image=null;this.total=this.columns=this.rows=0;this.drawCoords=[]},e.Tileset.prototype={draw:function(a,b,c,d){d=d-this.firstgid<<
1;0<=d&&d+1<this.drawCoords.length&&a.drawImage(this.image,this.drawCoords[d],this.drawCoords[d+1],this.tileWidth,this.tileHeight,b,c,this.tileWidth,this.tileHeight)},containsTileIndex:function(a){return a>=this.firstgid&&a<this.firstgid+this.total},setImage:function(a){this.image=a;this.updateTileData(a.width,a.height)},setSpacing:function(a,b){this.tileMargin=0|a;this.tileSpacing=0|b;this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(a,b){var c=(b-2*this.tileMargin+
this.tileSpacing)/(this.tileHeight+this.tileSpacing),d=(a-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);0==c%1&&0==d%1||console.warn("Phaser.Tileset - '%s' image tile area (%s x %s) is not a whole multiple of tile size (%s x %s + %s + %s)",this.name,a,b,this.tileWidth,this.tileHeight,this.tileMargin,this.tileSpacing);c=Math.floor(c);d=Math.floor(d);(this.rows&&this.rows!==c||this.columns&&this.columns!==d)&&console.warn("Phaser.Tileset - Tile layout from image '%s' (%s rows by %s columns) differs from tileset '%s' (%s rows by %s columns)",
this.image.name,d,c,this.name,this.columns,this.rows);this.rows=c;this.columns=d;this.total=c*d;this.drawCoords.length=0;b=a=this.tileMargin;for(c=0;c<this.rows;c++){for(d=0;d<this.columns;d++)this.drawCoords.push(a),this.drawCoords.push(b),a+=this.tileWidth+this.tileSpacing;a=this.tileMargin;b+=this.tileHeight+this.tileSpacing}}},e.Tileset.prototype.constructor=e.Tileset,e.Particle=function(a,b,c,d,f){e.Sprite.call(this,a,b,c,d,f);this.autoScale=!1;this.autoScaleFps=0;this.scaleData=null;this._s=
0;this.autoAlpha=!1;this.autoAlphaFps=0;this.alphaData=null;this._a=0},e.Particle.prototype=Object.create(e.Sprite.prototype),e.Particle.prototype.constructor=e.Particle,e.Particle.prototype.update=function(){if(this.autoScale){this._s-=.001*this.game.time.delta*this.autoScaleFps;var a=Math.round(this._s);0<a?this.scale.set(this.scaleData[a].x,this.scaleData[a].y):this.autoScale=!1}this.autoAlpha&&(this._a-=.001*this.game.time.delta*this.autoAlphaFps,a=Math.round(this._a),0<a?this.alpha=this.alphaData[a].v:
this.autoAlpha=!1)},e.Particle.prototype.onEmit=function(){},e.Particle.prototype.setAlphaData=function(a,b){this.alphaData=a;this._a=a.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=!0;this.autoAlphaFps=b},e.Particle.prototype.setScaleData=function(a,b){this.scaleData=a;this._s=a.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=!0;this.autoScaleFps=b},e.Particle.prototype.reset=function(a,b,c){return e.Component.Reset.prototype.reset.call(this,
a,b,c),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},e.Particles=function(a){this.game=a;this.emitters={};this.ID=0},e.Particles.prototype={add:function(a){return this.emitters[a.id]=a},remove:function(a){delete this.emitters[a.id]}},e.Particles.prototype.constructor=e.Particles,e.Particles.Arcade={},e.Particles.Arcade.Emitter=function(a,b,c,d){this.maxParticles=d||50;e.Group.call(this,a);this._id=this.game.particles.ID++;this.name="emitter"+this.id;this.type=e.EMITTER;
this.physicsType=e.GROUP;this.area=new e.Rectangle(b,c,1,1);this.maxAngle=this.minAngle=null;this.minSpeed=0;this.maxSpeed=100;this.minParticleSpeed=new e.Point(-100,-100);this.maxParticleSpeed=new e.Point(100,100);this.maxParticleScale=this.minParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.maxParticleAlpha=this.minParticleAlpha=1;this.alphaData=null;this.particleClass=e.Particle;this.particleDrag=new e.Point;this.angularDrag=0;this.frequency=100;this.lifespan=
2E3;this.bounce=new e.Point;this.on=!1;this.particleAnchor=new e.Point(.5,.5);this.blendMode=e.blendModes.NORMAL;this.emitX=b;this.emitY=c;this.autoScale=!1;this.autoScaleFps=this.game.time.desiredFps;this.autoAlpha=!1;this.autoAlphaFps=this.game.time.desiredFps;this.particleSendToBack=this.particleBringToTop=!1;this.counts={emitted:0,failed:0,totalEmitted:0,totalFailed:0};this._gravity=new e.Point(0,100);this._minParticleScale=new e.Point(1,1);this._maxParticleScale=new e.Point(1,1);this._flowTotal=
this._flowQuantity=this._counter=this._timer=this._total=0;this._explode=!0;this._frames=null},e.Particles.Arcade.Emitter.prototype=Object.create(e.Group.prototype),e.Particles.Arcade.Emitter.prototype.constructor=e.Particles.Arcade.Emitter,e.Particles.Arcade.Emitter.prototype.update=function(){if(this.counts.emitted=0,this.counts.failed=0,this.on&&this.game.time.deltaTotal>=this._timer)if(this._timer=this.game.time.deltaTotal+this.frequency,0!==this._flowTotal)if(0<this._flowQuantity)for(var a=0;a<
this._flowQuantity;a++){if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,0<this._total&&this._counter>=this._total&&(this.on=!1));for(a=this.children.length;a--;)this.children[a].exists&&this.children[a].update()},e.Particles.Arcade.Emitter.prototype.makeParticles=function(a,b,c,d,
f,g){void 0===b&&(b=0);void 0===c&&(c=this.maxParticles);void 0===d&&(d=!1);void 0===f&&(f=!1);void 0===g&&(g=null);var h=0,m=a,n=b;this._frames=b;for(c>this.maxParticles&&(this.maxParticles=c);h<c;){Array.isArray(a)&&(m=this.game.rnd.pick(a));Array.isArray(b)&&(n=this.game.rnd.pick(b));var p=new this.particleClass(this.game,0,0,m,n,g);this.game.physics.arcade.enable(p,!1);p.body.checkCollision.none=!d;p.body.collideWorldBounds=f;p.body.skipQuadTree=!0;p.exists=!1;p.visible=!1;p.anchor.copyFrom(this.particleAnchor);
this.add(p);h++}return this},e.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this},e.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this},e.Particles.Arcade.Emitter.prototype.explode=function(a,b){return void 0===b&&(b=this.maxParticles),this._flowTotal=0,this.start(!0,a,0,b,!1),this},e.Particles.Arcade.Emitter.prototype.flow=function(a,b,c,d,f){return null==b&&(b=250),void 0!==c&&0!==c||(c=1),void 0===d&&
(d=-1),void 0===f&&(f=!0),c>this.maxParticles&&(c=this.maxParticles),this._counter=0,this._flowQuantity=c,this._flowTotal=d,f?(this.start(!0,a,b,c),this._counter+=c,this.on=!0,this._timer=this.game.time.deltaTotal+b):this.start(!1,a,b,c),this},e.Particles.Arcade.Emitter.prototype.start=function(a,b,c,d,f){if(void 0===a&&(a=!0),void 0===b&&(b=0),null==c&&(c=250),void 0===d&&(d=0),void 0===f&&(f=!1),d>this.maxParticles&&(d=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=b,this.frequency=
c,a||f)for(a=0;a<d;a++)this.emitParticle();else this.on=!0,this._total=d,this._counter=0,this._timer=this.game.time.deltaTotal+c;return this},e.Particles.Arcade.Emitter.prototype.emitParticle=function(a,b,c,d){void 0===a&&(a=null);void 0===b&&(b=null);var f=this.getNextParticle();if(null===f)return this.counts.failed++,this.counts.totalFailed++,!1;this.counts.emitted++;this.counts.totalEmitted++;var g=this.game.rnd;void 0!==c&&void 0!==d?f.loadTexture(c,d):void 0!==c&&(f.loadTexture(c),f.frame=Array.isArray(this._frames)?
g.pick(this._frames):this._frames);c=this.emitX;d=this.emitY;return null!==a?c=a:1<this.width&&(c=g.between(this.left,this.right)),null!==b?d=b:1<this.height&&(d=g.between(this.top,this.bottom)),this.resetParticle(f,c,d),!0},e.Particles.Arcade.Emitter.prototype.getNextParticle=function(){for(var a=this.length;a--;){var b=this.next();if(!b.exists)return b}return null},e.Particles.Arcade.Emitter.prototype.resetParticle=function(a,b,c){var d=this.game.rnd;a.reset(b,c);a.angle=0;a.lifespan=this.lifespan;
this.particleBringToTop?this.bringToTop(a):this.particleSendToBack&&this.sendToBack(a);this.autoScale?a.setScaleData(this.scaleData,this.autoScaleFps):1!==this.minParticleScale||1!==this.maxParticleScale?a.scale.set(d.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y?a.scale.set(d.realInRange(this._minParticleScale.x,this._maxParticleScale.x),d.realInRange(this._minParticleScale.y,this._maxParticleScale.y)):
a.scale.set(this._minParticleScale.x,this._minParticleScale.y);this.autoAlpha?a.setAlphaData(this.alphaData,this.autoAlphaFps):a.alpha=d.realInRange(this.minParticleAlpha,this.maxParticleAlpha);a.blendMode=this.blendMode;b=a.body;b.updateBounds();b.bounce.copyFrom(this.bounce);b.drag.copyFrom(this.particleDrag);null!=this.minAngle&&null!=this.maxAngle?this.game.physics.arcade.velocityFromAngle(this.minAngle===this.maxAngle?this.minAngle:d.between(this.minAngle,this.maxAngle),this.minSpeed===this.maxSpeed?
this.minSpeed:d.between(this.minSpeed,this.maxSpeed),b.velocity):(b.velocity.x=d.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),b.velocity.y=d.between(this.minParticleSpeed.y,this.maxParticleSpeed.y));b.angularVelocity=d.between(this.minRotation,this.maxRotation);b.gravity.copyFrom(this.gravity);b.angularDrag=this.angularDrag;a.onEmit()},e.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);e.Group.prototype.destroy.call(this,!0,!1)},e.Particles.Arcade.Emitter.prototype.setSize=
function(a,b){return this.area.width=a,this.area.height=b,this},e.Particles.Arcade.Emitter.prototype.setSpeed=function(a,b,c,d){return this.setXSpeed(a,b),this.setYSpeed(c,d),this},e.Particles.Arcade.Emitter.prototype.setXSpeed=function(a,b){return a=a||0,b=b||0,this.minParticleSpeed.x=a,this.maxParticleSpeed.x=b,this},e.Particles.Arcade.Emitter.prototype.setYSpeed=function(a,b){return a=a||0,b=b||0,this.minParticleSpeed.y=a,this.maxParticleSpeed.y=b,this},e.Particles.Arcade.Emitter.prototype.setRotation=
function(a,b){return a=a||0,b=b||0,this.minRotation=a,this.maxRotation=b,this},e.Particles.Arcade.Emitter.prototype.setAlpha=function(a,b,c,d,f){if(void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=0),void 0===d&&(d=e.Easing.Linear.None),void 0===f&&(f=!1),this.minParticleAlpha=a,this.maxParticleAlpha=b,this.autoAlpha=!1,0<c&&a!==b)a=this.game.make.tween({v:a}).to({v:b},c,d),a.yoyo(f),this.alphaData=a.generateData(this.game.time.desiredFps),this.autoAlphaFps=this.game.time.desiredFps,this.alphaData.reverse(),
this.autoAlpha=!0;return this},e.Particles.Arcade.Emitter.prototype.setScale=function(a,b,c,d,f,g,h){if(void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=1),void 0===d&&(d=1),void 0===f&&(f=0),void 0===g&&(g=e.Easing.Linear.None),void 0===h&&(h=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(a,c),this._maxParticleScale.set(b,d),this.autoScale=!1,0<f&&(a!==b||c!==d))a=this.game.make.tween({x:a,y:c}).to({x:b,y:d},f,g),a.yoyo(h),this.scaleData=a.generateData(this.game.time.desiredFps),
this.autoScaleFps=this.game.time.desiredFps,this.scaleData.reverse(),this.autoScale=!0;return this},e.Particles.Arcade.Emitter.prototype.setAngle=function(a,b,c,d){return this.minAngle=a,this.maxAngle=b,null!=c&&(this.minSpeed=c),null!=d&&(this.maxSpeed=d),this},e.Particles.Arcade.Emitter.prototype.setGravity=function(a,b){return a=a||0,b=b||0,this._gravity.set(a,b),this},e.Particles.Arcade.Emitter.prototype.at=function(a){return a.center?(this.emitX=a.center.x,this.emitY=a.center.y):(this.emitX=
a.world.x+a.anchor.x*a.width,this.emitY=a.world.y+a.anchor.y*a.height),this},Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"gravity",{get:function(){return this._gravity},set:function(a){"number"==typeof a?this._gravity.y=a:this._gravity=a}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(a){this.area.width=a}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,
"height",{get:function(){return this.area.height},set:function(a){this.area.height=a}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(a){this.emitX=a}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(a){this.emitY=a}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,
"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"output",{get:function(){return 1E3*this._flowQuantity/this.frequency}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,
"lifespanOutput",{get:function(){return(0===this.lifespan?1/0:this.lifespan)*this._flowQuantity/this.frequency}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"remainder",{get:function(){return this.maxParticles-this.lifespanOutput}}),e.Weapon=function(a,b){e.Plugin.call(this,a,b);this.bullets=null;this.autofire=this.autoExpandBulletsGroup=!1;this.fireLimit=this.shots=0;this.fireRate=100;this.fireRateVariance=0;this.fireFrom=new e.Rectangle(0,0,1,1);this.fireAngle=e.ANGLE_UP;this.bulletInheritSpriteSpeed=
!1;this.bulletAnimation="";this.bulletWorldWrap=this.bulletFrameCycle=this.bulletFrameRandom=!1;this.bulletAngleVariance=this.bulletAngleOffset=this.bulletWorldWrapPadding=0;this.bulletSpeed=200;this.bulletKillDistance=this.bulletLifespan=this.bulletSpeedVariance=0;this.bulletGravity=new e.Point(0,0);this.bulletRotateToVelocity=!1;this.bulletFrame=this.bulletKey="";this._bulletClass=e.Bullet;this._bulletCollideWorldBounds=!1;this._bulletKillType=e.Weapon.KILL_WORLD_BOUNDS;this._data={customBody:!1,
width:0,height:0,offsetX:0,offsetY:0};this.bounds=new e.Rectangle;this.bulletBounds=a.world.bounds;this.bulletFrames=[];this.bulletFrameIndex=0;this.anims={};this.onFire=new e.Signal;this.onKill=new e.Signal;this.onFireLimit=new e.Signal;this.trackedPointer=this.trackedSprite=null;this.trackRotation=this._hasFired=this.multiFire=!1;this.trackOffset=new e.Point;this._tempNextFire=this._nextFire=0;this._rotatedPoint=new e.Point},e.Weapon.prototype=Object.create(e.Plugin.prototype),e.Weapon.prototype.constructor=
e.Weapon,e.Weapon.KILL_NEVER=0,e.Weapon.KILL_LIFESPAN=1,e.Weapon.KILL_DISTANCE=2,e.Weapon.KILL_WEAPON_BOUNDS=3,e.Weapon.KILL_CAMERA_BOUNDS=4,e.Weapon.KILL_WORLD_BOUNDS=5,e.Weapon.KILL_STATIC_BOUNDS=6,e.Weapon.prototype.createBullets=function(a,b,c,d){return void 0===a&&(a=1),void 0===d&&(d=this.game.world),this.bullets&&!this.bullets.game&&(this.bullets=null),this.bullets||(this.bullets=this.game.add.physicsGroup(e.Physics.ARCADE,d),this.bullets.classType=this._bulletClass),0!==a&&(-1===a&&(this.autoExpandBulletsGroup=
!0,a=1),this.bullets.createMultiple(a,b,c),this.bullets.setAll("data.bulletManager",this),this.bulletKey=b,this.bulletFrame=c),this},e.Weapon.prototype.forEach=function(a,b){return this.bullets.forEachExists(a,b,arguments),this},e.Weapon.prototype.pauseAll=function(){return this.bullets.setAll("body.enable",!1),this},e.Weapon.prototype.resumeAll=function(){return this.bullets.setAll("body.enable",!0),this},e.Weapon.prototype.killAll=function(){return this.bullets.callAllExists("kill",!0),this.bullets.setAll("body.enable",
!0),this},e.Weapon.prototype.resetShots=function(a){return void(this.shots=0)!==a&&(this.fireLimit=a),this},e.Weapon.prototype.destroy=function(){this.parent.remove(this,!1);this.bullets.destroy();this.parent=this.game=null;this.visible=this.active=!1},e.Weapon.prototype.update=function(){this._bulletKillType===e.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&
this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY));this.autofire&&this.fire()},e.Weapon.prototype.postRender=function(){this.multiFire&&this._hasFired&&(this._hasFired=!1,this._nextFire=this._tempNextFire)},e.Weapon.prototype.trackSprite=function(a,b,c,d){return void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=!1),this.trackedPointer=null,this.trackedSprite=a,this.trackRotation=d,this.trackOffset.set(b,c),this},e.Weapon.prototype.trackPointer=function(a,b,c){return void 0===
a&&(a=this.game.input.activePointer),void 0===b&&(b=0),void 0===c&&(c=0),this.trackedPointer=a,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(b,c),this},e.Weapon.prototype.fireMany=function(a,b){this.multiFire=!0;var c=[],d=this;return b||this.trackedSprite||this.trackedPointer?a.forEach(function(f){c.push(d.fire(b,null,null,f.x,f.y))}):a.forEach(function(f){c.push(d.fire(f))}),c},e.Weapon.prototype.fireOffset=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),this.fire(null,
null,null,a,b)},e.Weapon.prototype.fire=function(a,b,c,d,f){if(void 0===b&&(b=null),void 0===c&&(c=null),this.game.time.deltaTotal<this._nextFire||0<this.fireLimit&&this.shots===this.fireLimit)return null;var g=this.bulletSpeed;0!==this.bulletSpeedVariance&&(g+=e.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance));a?1<this.fireFrom.width?this.fireFrom.centerOn(a.x,a.y):(this.fireFrom.x=a.x,this.fireFrom.y=a.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+
this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.worldRotation),1<this.fireFrom.width?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+
this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(g+=this.trackedSprite.body.speed)):this.trackedPointer&&(1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y));void 0!==d&&(this.fireFrom.x+=d);void 0!==f&&(this.fireFrom.y+=
f);a=1<this.fireFrom.width?this.fireFrom.randomX:this.fireFrom.x;d=1<this.fireFrom.height?this.fireFrom.randomY:this.fireFrom.y;f=this.trackRotation?this.trackedSprite.angle:this.fireAngle;null!==b&&null!==c&&(f=this.game.math.radToDeg(Math.atan2(c-d,b-a)));0!==this.bulletAngleVariance&&(f+=e.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance));var h=c=0;0===f||180===f?c=Math.cos(this.game.math.degToRad(f))*g:h=(90===f||270===f||(c=Math.cos(this.game.math.degToRad(f))*g),Math.sin(this.game.math.degToRad(f))*
g);b=null;if(this.autoExpandBulletsGroup?(b=this.bullets.getFirstExists(!1,!0,a,d,this.bulletKey,this.bulletFrame)).data.bulletManager=this:b=this.bullets.getFirstExists(!1),b)(b.reset(a,d),b.data.fromX=a,b.data.fromY=d,b.data.killType=this.bulletKillType,b.data.killDistance=this.bulletKillDistance,b.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===e.Weapon.KILL_LIFESPAN&&(b.lifespan=this.bulletLifespan),b.angle=f+this.bulletAngleOffset,""!==this.bulletAnimation)?(null===b.animations.getAnimation(this.bulletAnimation)&&
(a=this.anims[this.bulletAnimation],b.animations.add(a.name,a.frames,a.frameRate,a.loop,a.useNumericIndex)),b.animations.play(this.bulletAnimation)):this.bulletFrameCycle?(b.frame=this.bulletFrames[this.bulletFrameIndex],this.bulletFrameIndex++,this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(b.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]),b.data.bodyDirty&&(this._data.customBody&&b.body.setSize(this._data.width,this._data.height,
this._data.offsetX,this._data.offsetY),b.body.collideWorldBounds=this.bulletCollideWorldBounds,b.data.bodyDirty=!1),b.body.velocity.set(c,h),b.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y),0!==this.bulletSpeedVariance?(c=this.fireRate,0>(c+=e.Math.between(-this.fireRateVariance,this.fireRateVariance))&&(c=0),c=this.game.time.deltaTotal+c):c=this.game.time.deltaTotal+this.fireRate,this.multiFire?this._hasFired||(this._hasFired=!0,this._tempNextFire=c,this.shots++):(this._nextFire=c,this.shots++),
this.onFire.dispatch(b,this,g),0<this.fireLimit&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit);return b},e.Weapon.prototype.fireAtPointer=function(a){return void 0===a&&(a=this.game.input.activePointer),this.fire(null,a.worldX,a.worldY)},e.Weapon.prototype.fireAtSprite=function(a){return this.fire(null,a.world.x,a.world.y)},e.Weapon.prototype.fireAtXY=function(a,b){return this.fire(null,a,b)},e.Weapon.prototype.setBulletBodyOffset=function(a,b,c,d){return void 0===c&&
(c=0),void 0===d&&(d=0),this._data.customBody=!0,this._data.width=a,this._data.height=b,this._data.offsetX=c,this._data.offsetY=d,this.bullets.callAll("body.setSize","body",a,b,c,d),this.bullets.setAll("data.bodyDirty",!1),this},e.Weapon.prototype.setBulletFrames=function(a,b,c,d){return void 0===c&&(c=!0),void 0===d&&(d=!1),this.bulletFrames=e.ArrayUtils.numberArray(a,b),this.bulletFrameIndex=0,this.bulletFrameCycle=c,this.bulletFrameRandom=d,this},e.Weapon.prototype.addBulletAnimation=function(a,
b,c,d,f){return this.anims[a]={name:a,frames:b,frameRate:c,loop:d,useNumericIndex:f},this.bullets.callAll("animations.add","animations",a,b,c,d,f),this.bulletAnimation=a,this},e.Weapon.prototype.debug=function(a,b,c){void 0===a&&(a=16);void 0===b&&(b=32);void 0===c&&(c=!1);this.game.debug.text("Weapon Plugin",a,b);this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,a,b+24);c&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")},
Object.defineProperty(e.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(a){this._bulletClass=a;this.bullets&&(this.bullets.classType=this._bulletClass)}}),Object.defineProperty(e.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(a){switch(a){case e.Weapon.KILL_STATIC_BOUNDS:case e.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case e.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;
case e.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds}this._bulletKillType=a}}),Object.defineProperty(e.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(a){this._bulletCollideWorldBounds=a;this.bullets.setAll("body.collideWorldBounds",a);this.bullets.setAll("data.bodyDirty",!1)}}),Object.defineProperty(e.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(a){this.fireFrom.x=a}}),Object.defineProperty(e.Weapon.prototype,
"y",{get:function(){return this.fireFrom.y},set:function(a){this.fireFrom.y=a}}),e.Bullet=function(a,b,c,d,f){e.Sprite.call(this,a,b,c,d,f);this.anchor.set(.5);this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}},e.Bullet.prototype=Object.create(e.Sprite.prototype),e.Bullet.prototype.constructor=e.Bullet,e.Bullet.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.data.bulletManager.onKill.dispatch(this),this},e.Bullet.prototype.update=
function(){this.exists&&(this.data.killType>e.Weapon.KILL_LIFESPAN&&(this.data.killType===e.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():this.data.bulletManager.bulletBounds.intersects(this)||this.kill()),this.data.rotateToVelocity&&(this.rotation=this.body.velocity.atan()),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))},e.Video=function(a,
b,c){if(void 0===b&&(b=null),void 0===c&&(c=null),this.game=a,this.key=b,this.width=0,this.height=0,this.type=e.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new e.Signal,this.onChangeSource=new e.Signal,this.onComplete=new e.Signal,this.onAccess=new e.Signal,this.onError=new e.Signal,this.onTimeout=new e.Signal,this.onTouchUnlock=new e.Signal,this.playWhenUnlocked=!0,this.timeout=15E3,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=
20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._pendingChangeSource=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null,b&&this.game.cache.checkVideoKey(b)){var d=this.game.cache.getVideo(b);d.isBlob?this.createVideoFromBlob(d.data):this.video=d.data;this.width=this.video.videoWidth;this.height=this.video.videoHeight}else c&&this.createVideoFromURL(c,!1);this.video&&!c?this.baseTexture=
new PIXI.BaseTexture(this.video,null,this.game.resolution):this.baseTexture=new PIXI.BaseTexture(e.Cache.DEFAULT.baseTexture.source,null,this.game.resolution);this.baseTexture.forceLoaded(this.width,this.height);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new e.Frame(0,0,0,this.width,this.height,"video");this.texture.setFrame(this.textureFrame);this.texture.valid=!1;null!==b&&this.video&&(this.texture.valid=this.video.canplay);this.snapshot=null;e.BitmapData&&(this.snapshot=
new e.BitmapData(this.game,"",this.width,this.height));this.game.device.needsTouchUnlock()?this.setTouchLock():d&&(d.locked=!1)},e.Video.prototype={connectToMediaStream:function(a,b){return a&&b&&(this.video=a,this.videoStream=b,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(a,b,c,d){if(void 0===a&&(a=!1),void 0===b&&(b=null),void 0===c&&(c=null),void 0===d&&
(d=!0),!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;if(null!==this.videoStream&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.removeVideoElement(),this.video=document.createElement("video"),this.video.setAttribute("autoplay","autoplay"),this.video.setAttribute("playsinline","playsinline"),null!==b&&(this.video.width=b),null!==c&&(this.video.height=c),this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),
this.timeout),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia({audio:a,video:d}).then(this.getUserMediaSuccess.bind(this)).catch(this.getUserMediaError.bind(this));else try{navigator.getUserMedia({audio:a,video:d},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(f){this.getUserMediaError(f)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID);this.onTimeout.dispatch(this)},getUserMediaError:function(a){clearTimeout(this._timeOutID);
this.onError.dispatch(this,a)},getUserMediaSuccess:function(a){clearTimeout(this._timeOutID);this.videoStream=a;void 0!==this.video.mozSrcObject?this.video.mozSrcObject=a:void 0!==this.video.srcObject?this.video.srcObject=a:this.video.src=window.URL&&window.URL.createObjectURL(a)||a;var b=this;this.video.onloadeddata=function(){var c=10;!function f(){if(0<c)if(0<b.video.videoWidth){var g=b.video.videoWidth,h=b.video.videoHeight;isNaN(b.video.videoHeight)&&(h=g/(4/3));b.video.play();b.isStreaming=
!0;b.baseTexture.source=b.video;b.updateTexture(null,g,h);b.onAccess.dispatch(b)}else window.setTimeout(f,500);else console.warn("Unable to connect to video stream. Webcam error?");c--}()}},createVideoFromBlob:function(a){var b=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.setAttribute("playsinline","playsinline"),this.video.addEventListener("loadeddata",function(c){b.updateTexture(c)},!0),this.video.src=window.URL.createObjectURL(a),
this.video.canplay=!0,this},createVideoFromURL:function(a,b,c){return void 0===b&&(b=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,b&&this.video.setAttribute("autoplay","autoplay"),void 0!==c&&(this.video.crossOrigin=c),this.video.setAttribute("playsinline","playsinline"),this.video.src=a,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),
this.key=a,this},updateTexture:function(a,b,c){a=!1;null==b&&(b=this.video.videoWidth,a=!0);null==c&&(c=this.video.videoHeight);this.width=b;this.height=c;this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video);this.baseTexture.forceLoaded(b,c);this.texture.frame.resize(b,c);this.texture.width=b;this.texture.height=c;this.texture.valid=!0;this.snapshot&&this.snapshot.resize(b,c);a&&null!==this.key&&(this.onChangeSource.dispatch(this,b,c),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,
this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(a,b){return this._pendingChangeSource||(void 0===a&&(a=!1),void 0===b&&(b=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,
!0),this.video.addEventListener("webkitendfullscreen",this._endCallback,!0),this.video.loop=!!a,this.video.playbackRate=b,this.touchLocked?this._pending=!0:(this._pending=!1,null!==this.key&&(4!==this.video.readyState?(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)):(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0))),this.video.play(),this.onPlay.dispatch(this,a,b))),this},
playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0);this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):this.video.srcObject?(this.video.srcObject.stop(),this.video.src=
null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(a){a.stop()}):this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(a){if(Array.isArray(a))for(var b=
0;b<a.length;b++)a[b].loadTexture&&a[b].loadTexture(this);else a.loadTexture(this);return this},addToWorld:function(a,b,c,d,f,g){f=f||1;g=g||1;a=this.game.add.image(a,b,this);return a.anchor.set(c,d),a.scale.set(f,g),a},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){this._muted&&!this._codeMuted&&(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||
(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,this.video.ended||this.video.play())},changeSource:function(a,b){return void 0===b&&(b=!0),this.texture.valid=!1,this.video.pause(),this._pendingChangeSource=!0,this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=a,this.video.load(),(this._autoplay=b)||(this.paused=!0),this},checkVideoProgress:function(){4===
this.video.readyState?(this._pendingChangeSource=!1,this.updateTexture()):(this.retry--,0<this.retry?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming))},setTouchLock:function(){this.game.input.addTouchLockCallback(this.unlock,this,!0);this.touchLocked=!0},unlock:function(){if(this.touchLocked=!1,this.playWhenUnlocked&&(this.video.play(),this.onPlay.dispatch(this,this.loop,
this.playbackRate)),this.key){var a=this.game.cache.getVideo(this.key);a&&!a.isBlob&&(a.locked=!1)}return this.onTouchUnlock.dispatch(this),!0},grab:function(a,b,c){if(void 0===a&&(a=!1),void 0===b&&(b=1),void 0===c&&(c=null),null!==this.snapshot)return a&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,b,c),this.snapshot;console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable")},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&
this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay");this.video.removeAttribute("src");this.video=null}},destroy:function(){this.stop();this.removeVideoElement();this.touchLocked&&this.game.input.removeTouchLockCallback(this.unlock,this);this._retryID&&window.clearTimeout(this._retryID)}},Object.defineProperty(e.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:
0},set:function(a){this.video.currentTime=a}}),Object.defineProperty(e.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}}),Object.defineProperty(e.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}}),Object.defineProperty(e.Video.prototype,"mute",{get:function(){return this._muted},set:function(a){a?this._muted||(this._codeMuted=!0,this.setMute()):this._muted&&(this._codeMuted=!1,this.unsetMute())}}),Object.defineProperty(e.Video.prototype,
"paused",{get:function(){return this._paused},set:function(a){(a=a||null,this.touchLocked)||(a?this._paused||(this._codePaused=!0,this.setPause()):this._paused&&(this._codePaused=!1,this.setResume()))}}),Object.defineProperty(e.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(a){0>a?a=0:1<a&&(a=1);this.video&&(this.video.volume=a)}}),Object.defineProperty(e.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(a){this.video&&
(this.video.playbackRate=a)}}),Object.defineProperty(e.Video.prototype,"loop",{get:function(){return!!this.video&&this.video.loop},set:function(a){a&&this.video?this.video.loop=!0:this.video&&(this.video.loop=!1)}}),Object.defineProperty(e.Video.prototype,"playing",{get:function(){return!!this.video&&!(this.video.paused&&this.video.ended)}}),e.Video.prototype.constructor=e.Video,void 0===PIXI.blendModes&&(PIXI.blendModes=e.blendModes),void 0===PIXI.scaleModes&&(PIXI.scaleModes=e.scaleModes),void 0===
PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)),void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new e.Matrix),PIXI.TextureSilentFail=!0,PIXI.canUseNewCanvasBlendModes=function(){return e.Device.canUseMultiply},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Phaser=e):"undefined"!=typeof define&&define.amd?define("Phaser",this.Phaser=e):this.Phaser=e,e}).call(this);class Vector2{constructor(t,e){"number"==typeof t&&"number"==typeof e||console.error("Could not construct a Vector2 because one ar both of the parameters passed is not of type 'Number'. The parameter types were: x - "+typeof t+", y - "+typeof e+".");this.x=t;this.y=e}Add(t){return new Vector2(this.x+t.x,this.y+t.y)}static Add(t,e){return new Vector2(t.x+e.x,t.y+e.y)}Sub(t){return new Vector2(this.x-t.x,this.y-t.y)}static Sub(t,e){return new Vector2(t.x-e.x,t.y-e.y)}Scale(t){var e=new Vector2(this.x,
this.y);e.x*=t;e.y*=t;return e}Normalized(){var t=new Vector2(this.x,this.y),e=t.Length();t.x/=e;t.y/=e;return t}static Normalized(t){var e=t.Length();t.x/=e;t.y/=e;return e}PairWise(t){return new Vector2(t(this.x),t(this.y))}static PairWise(t,e){return new Vector2(e(t.x),e(t.y))}Length(){return Math.sqrt(this.x*this.x+this.y*this.y)}ClampLength(t,e){let v=new Vector2(this.x,this.y);var l=v.Length();if(0==l)return Vector2.zero;v.x/=l;v.y/=l;t=Mathf.Clamp(l,t,e);v.x*=t;v.y*=t;return v}PerpendicularLeft(){return new Vector2(-this.y,
this.x)}PerpendicularRight(){return new Vector2(this.y,-this.x)}isZero(t){return this.x*this.x+this.y*this.y<=t*t}Equal(t){return this.x==t.x&&this.y==t.y}Clone(){return new Vector2(this.x,this.y)}ToPhaserPoint(){return new Phaser.Point(this.x,this.y)}static ToPhaserPoint(t){return new Phaser.Point(t.x,t.y)}ToPIXIPoint(){return new PIXI.Point(this.x,this.y)}static ToPIXIPoint(t){return new PIXI.Point(t.x,t.y)}Rotate(t){let e=Math.sin(Mathf.Deg2Rad(t));t=Math.cos(Mathf.Deg2Rad(t));let v=this.x,l=this.y;
return new Vector2(t*v-e*l,e*v+t*l)}static Lerp(t,e,v){return Vector2.Add(t.Scale(1-v),e.Scale(v))}static Distance(t,e){return Vector2.Sub(t,e).Length}static FromJSObject(t){return new Vector2(t.x,t.y)}static CrossProduct(t,e){return t.x*e.y-t.y*e.x}static DotProduct(t,e){return t.x*e.x+t.y*e.y}static Angle(t,e){t=Mathf.Rad2Deg(Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x));return Mathf.WrapAngle(t)}static PerpendicularLeft(t){return new Vector2(-t.y,t.x)}static PerpendicularRight(t){return new Vector2(t.y,
-t.x)}static get zero(){return new Vector2(0,0)}static get up(){return new Vector2(0,1)}static get down(){return new Vector2(0,-1)}static get left(){return new Vector2(-1,0)}static get right(){return new Vector2(1,0)}static get one(){return new Vector2(1,1)}};(function(){function t(y,D,S){return y.call.apply(y.bind,arguments)}function e(y,D,S){if(!y)throw Error();if(2<arguments.length){var R=Array.prototype.slice.call(arguments,2);return function(){var Y=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(Y,R);return y.apply(D,Y)}}return function(){return y.apply(D,arguments)}}function v(y,D,S){v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?t:e;return v.apply(null,arguments)}function l(y,D){this.a=
y;this.o=D||y;this.c=this.o.document}function k(y,D,S,R){D=y.c.createElement(D);if(S)for(var Y in S)S.hasOwnProperty(Y)&&("style"==Y?D.style.cssText=S[Y]:D.setAttribute(Y,S[Y]));R&&D.appendChild(y.c.createTextNode(R));return D}function a(y,D,S){(y=y.c.getElementsByTagName(D)[0])||(y=document.documentElement);y.insertBefore(S,y.lastChild)}function b(y){y.parentNode&&y.parentNode.removeChild(y)}function c(y,D,S){D=D||[];S=S||[];for(var R=y.className.split(/\s+/),Y=0;Y<D.length;Y+=1){for(var ha=!1,fa=
0;fa<R.length;fa+=1)if(D[Y]===R[fa]){ha=!0;break}ha||R.push(D[Y])}D=[];for(Y=0;Y<R.length;Y+=1){ha=!1;for(fa=0;fa<S.length;fa+=1)if(R[Y]===S[fa]){ha=!0;break}ha||D.push(R[Y])}y.className=D.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function d(y,D){y=y.className.split(/\s+/);for(var S=0,R=y.length;S<R;S++)if(y[S]==D)return!0;return!1}function f(y){return y.o.location.hostname||y.a.location.hostname}function g(y,D,S){function R(){H&&Y&&ha&&(H(fa),H=null)}D=k(y,"link",{rel:"stylesheet",href:D,
media:"all"});var Y=!1,ha=!0,fa=null,H=S||null;Fa?(D.onload=function(){Y=!0;R()},D.onerror=function(){Y=!0;fa=Error("Stylesheet failed to load");R()}):setTimeout(function(){Y=!0;R()},0);a(y,"head",D)}function h(y,D,S,R){var Y=y.c.getElementsByTagName("head")[0];if(Y){var ha=k(y,"script",{src:D}),fa=!1;ha.onload=ha.onreadystatechange=function(){fa||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(fa=!0,S&&S(null),ha.onload=ha.onreadystatechange=null,"HEAD"==ha.parentNode.tagName&&
Y.removeChild(ha))};Y.appendChild(ha);setTimeout(function(){fa||(fa=!0,S&&S(Error("Script load timeout")))},R||5E3);return ha}return null}function m(){this.a=0;this.c=null}function n(y){y.a++;return function(){y.a--;q(y)}}function p(y,D){y.c=D;q(y)}function q(y){0==y.a&&y.c&&(y.c(),y.c=null)}function r(y){this.a=y||"-"}function u(y,D){this.c=y;this.f=4;this.a="n";(y=(D||"n4").match(/^([nio])([1-9])$/i))&&(this.a=y[1],this.f=parseInt(y[2],10))}function x(y){return C(y)+" "+(y.f+"00 300px ")+w(y.c)}
function w(y){var D=[];y=y.split(/,\s*/);for(var S=0;S<y.length;S++){var R=y[S].replace(/['"]/g,"");-1!=R.indexOf(" ")||/^\d/.test(R)?D.push("'"+R+"'"):D.push(R)}return D.join(",")}function A(y){return y.a+y.f}function C(y){var D="normal";"o"===y.a?D="oblique":"i"===y.a&&(D="italic");return D}function L(y,D){this.c=y;this.f=y.o.document.documentElement;this.h=D;this.a=new r("-");this.j=!1!==D.events;this.g=!1!==D.classes}function M(y){y.g&&c(y.f,[y.a.c("wf","loading")]);V(y,"loading")}function P(y){if(y.g){var D=
d(y.f,y.a.c("wf","active")),S=[],R=[y.a.c("wf","loading")];D||S.push(y.a.c("wf","inactive"));c(y.f,S,R)}V(y,"inactive")}function V(y,D,S){if(y.j&&y.h[D])if(S)y.h[D](S.c,A(S));else y.h[D]()}function aa(){this.c={}}function ja(y,D,S){var R=[],Y;for(Y in D)if(D.hasOwnProperty(Y)){var ha=y.c[Y];ha&&R.push(ha(D[Y],S))}return R}function W(y,D){this.c=y;this.f=D;this.a=k(this.c,"span",{"aria-hidden":"true"},this.f)}function E(y){a(y.c,"body",y.a)}function F(y){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+
w(y.c)+";font-style:"+(C(y)+";font-weight:"+(y.f+"00;"))}function B(y,D,S,R,Y,ha){this.g=y;this.j=D;this.a=R;this.c=S;this.f=Y||3E3;this.h=ha||void 0}function I(y,D,S,R,Y,ha,fa){this.v=y;this.B=D;this.c=S;this.a=R;this.s=fa||"BESbswy";this.f={};this.w=Y||3E3;this.u=ha||null;this.m=this.j=this.h=this.g=null;this.g=new W(this.c,this.s);this.h=new W(this.c,this.s);this.j=new W(this.c,this.s);this.m=new W(this.c,this.s);y=new u(this.a.c+",serif",A(this.a));y=F(y);this.g.a.style.cssText=y;y=new u(this.a.c+
",sans-serif",A(this.a));y=F(y);this.h.a.style.cssText=y;y=new u("serif",A(this.a));y=F(y);this.j.a.style.cssText=y;y=new u("sans-serif",A(this.a));y=F(y);this.m.a.style.cssText=y;E(this.g);E(this.h);E(this.j);E(this.m)}function X(){if(null===va){var y=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);va=!!y&&(536>parseInt(y[1],10)||536===parseInt(y[1],10)&&11>=parseInt(y[2],10))}return va}function U(y,D,S){for(var R in Na)if(Na.hasOwnProperty(R)&&D===y.f[Na[R]]&&S===y.f[Na[R]])return!0;
return!1}function ia(y){var D=y.g.a.offsetWidth,S=y.h.a.offsetWidth,R;(R=D===y.f.serif&&S===y.f["sans-serif"])||(R=X()&&U(y,D,S));R?wa()-y.A>=y.w?X()&&U(y,D,S)&&(null===y.u||y.u.hasOwnProperty(y.a.c))?ma(y,y.v):ma(y,y.B):la(y):ma(y,y.v)}function la(y){setTimeout(v(function(){ia(this)},y),50)}function ma(y,D){setTimeout(v(function(){b(this.g.a);b(this.h.a);b(this.j.a);b(this.m.a);D(this.a)},y),0)}function ka(y,D,S){this.c=y;this.a=D;this.f=0;this.m=this.j=!1;this.s=S}function pa(y){0==--y.f&&y.j&&
(y.m?(y=y.a,y.g&&c(y.f,[y.a.c("wf","active")],[y.a.c("wf","loading"),y.a.c("wf","inactive")]),V(y,"active")):P(y.a))}function ta(y){this.j=y;this.a=new aa;this.h=0;this.f=this.g=!0}function O(y,D,S,R,Y){var ha=0==--y.h;(y.f||y.g)&&setTimeout(function(){var fa=Y||null,H=R||{};if(0===S.length&&ha)P(D.a);else{D.f+=S.length;ha&&(D.j=ha);var z,G=[];for(z=0;z<S.length;z++){var J=S[z],N=H[J.c],K=D.a,Q=J;K.g&&c(K.f,[K.a.c("wf",Q.c,A(Q).toString(),"loading")]);V(K,"fontloading",Q);K=null;if(null===Aa)if(window.FontFace){Q=
/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var T=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);Aa=Q?42<parseInt(Q[1],10):T?!1:!0}else Aa=!1;Aa?K=new B(v(D.g,D),v(D.h,D),D.c,J,D.s,N):K=new I(v(D.g,D),v(D.h,D),D.c,J,D.s,fa,N);G.push(K)}for(z=0;z<G.length;z++)G[z].start()}},0)}function ua(y,D,S){var R=[],Y=S.timeout;M(D);R=ja(y.a,S,y.c);var ha=new ka(y.c,D,Y);y.h=R.length;D=0;for(S=R.length;D<S;D++)R[D].load(function(fa,H,z){O(y,ha,
fa,H,z)})}function ra(y,D){this.c=y;this.a=D}function xa(y,D){this.c=y;this.a=D}function Ta(y,D){y?this.c=y:this.c=Da;this.a=[];this.f=[];this.g=D||""}function Ua(y,D){for(var S=D.length,R=0;R<S;R++){var Y=D[R].split(":");3==Y.length&&y.f.push(Y.pop());var ha="";2==Y.length&&""!=Y[1]&&(ha=":");y.a.push(Y.join(ha))}}function Va(y){if(0==y.a.length)throw Error("No fonts to load!");if(-1!=y.c.indexOf("kit="))return y.c;for(var D=y.a.length,S=[],R=0;R<D;R++)S.push(y.a[R].replace(/ /g,"+"));D=y.c+"?family="+
S.join("%7C");0<y.f.length&&(D+="&subset="+y.f.join(","));0<y.g.length&&(D+="&text="+encodeURIComponent(y.g));return D}function Ea(y){this.f=y;this.a=[];this.c={}}function Ma(y){for(var D=y.f.length,S=0;S<D;S++){var R=y.f[S].split(":"),Y=R[0].replace(/\+/g," "),ha=["n4"];if(2<=R.length){var fa=R[1];var H=[];if(fa){fa=fa.split(",");for(var z=fa.length,G=0;G<z;G++){var J=fa[G];if(J.match(/^[\w-]+$/)){var N=Ga.exec(J.toLowerCase());if(null==N)J="";else{J=N[2];J=null==J||""==J?"n":Sa[J];N=N[1];if(null==
N||""==N)N="4";else{var K=$a[N];N=K?K:isNaN(N)?"4":N.substr(0,1)}J=[J,N].join("")}}else J="";J&&H.push(J)}}0<H.length&&(ha=H);3==R.length&&(R=R[2],H=[],R=R?R.split(","):H,0<R.length&&(R=Oa[R[0]])&&(y.c[Y]=R))}y.c[Y]||(R=Oa[Y])&&(y.c[Y]=R);for(R=0;R<ha.length;R+=1)y.a.push(new u(Y,ha[R]))}}function Ca(y,D){this.c=y;this.a=D}function Ba(y,D){this.c=y;this.a=D}function La(y,D){this.c=y;this.f=D;this.a=[]}var wa=Date.now||function(){return+new Date},Fa=!!window.FontFace;r.prototype.c=function(y){for(var D=
[],S=0;S<arguments.length;S++)D.push(arguments[S].replace(/[\W_]+/g,"").toLowerCase());return D.join(this.a)};B.prototype.start=function(){var y=this.c.o.document,D=this,S=wa(),R=new Promise(function(fa,H){function z(){wa()-S>=D.f?H():y.fonts.load(x(D.a),D.h).then(function(G){1<=G.length?fa():setTimeout(z,25)},function(){H()})}z()}),Y=null,ha=new Promise(function(fa,H){Y=setTimeout(H,D.f)});Promise.race([ha,R]).then(function(){Y&&(clearTimeout(Y),Y=null);D.g(D.a)},function(){D.j(D.a)})};var Na={D:"serif",
C:"sans-serif"},va=null;I.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.m.a.offsetWidth;this.A=wa();ia(this)};var Aa=null;ka.prototype.g=function(y){var D=this.a;D.g&&c(D.f,[D.a.c("wf",y.c,A(y).toString(),"active")],[D.a.c("wf",y.c,A(y).toString(),"loading"),D.a.c("wf",y.c,A(y).toString(),"inactive")]);V(D,"fontactive",y);this.m=!0;pa(this)};ka.prototype.h=function(y){var D=this.a;if(D.g){var S=d(D.f,D.a.c("wf",y.c,A(y).toString(),"active")),R=[],Y=[D.a.c("wf",
y.c,A(y).toString(),"loading")];S||R.push(D.a.c("wf",y.c,A(y).toString(),"inactive"));c(D.f,R,Y)}V(D,"fontinactive",y);pa(this)};ta.prototype.load=function(y){this.c=new l(this.j,y.context||this.j);this.g=!1!==y.events;this.f=!1!==y.classes;ua(this,new L(this.c,y),y)};ra.prototype.load=function(y){function D(){if(ha["__mti_fntLst"+R]){var fa=ha["__mti_fntLst"+R](),H=[],z;if(fa)for(var G=0;G<fa.length;G++){var J=fa[G].fontfamily;void 0!=fa[G].fontStyle&&void 0!=fa[G].fontWeight?(z=fa[G].fontStyle+
fa[G].fontWeight,H.push(new u(J,z))):H.push(new u(J))}y(H)}else setTimeout(function(){D()},50)}var S=this,R=S.a.projectId,Y=S.a.version;if(R){var ha=S.c.o;h(this.c,(S.a.api||"https://fast.fonts.net/jsapi")+"/"+R+".js"+(Y?"?v="+Y:""),function(fa){fa?y([]):(ha["__MonotypeConfiguration__"+R]=function(){return S.a},D())}).id="__MonotypeAPIScript__"+R}else y([])};xa.prototype.load=function(y){var D,S=this.a.urls||[],R=this.a.families||[],Y=this.a.testStrings||{},ha=new m;var fa=0;for(D=S.length;fa<D;fa++)g(this.c,
S[fa],n(ha));var H=[];fa=0;for(D=R.length;fa<D;fa++)if(S=R[fa].split(":"),S[1])for(var z=S[1].split(","),G=0;G<z.length;G+=1)H.push(new u(S[0],z[G]));else H.push(new u(S[0]));p(ha,function(){y(H,Y)})};var Da="https://fonts.googleapis.com/css",Oa={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},$a={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",
light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Sa={i:"i",italic:"i",n:"n",normal:"n"},Ga=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,Ha={Arimo:!0,Cousine:!0,Tinos:!0};Ca.prototype.load=function(y){var D=new m,S=this.c,R=new Ta(this.a.api,this.a.text),
Y=this.a.families;Ua(R,Y);var ha=new Ea(Y);Ma(ha);g(S,Va(R),n(D));p(D,function(){y(ha.a,ha.c,Ha)})};Ba.prototype.load=function(y){var D=this.a.id,S=this.c.o;D?h(this.c,(this.a.api||"https://use.typekit.net")+"/"+D+".js",function(R){if(R)y([]);else if(S.Typekit&&S.Typekit.config&&S.Typekit.config.fn){R=S.Typekit.config.fn;for(var Y=[],ha=0;ha<R.length;ha+=2)for(var fa=R[ha],H=R[ha+1],z=0;z<H.length;z++)Y.push(new u(fa,H[z]));try{S.Typekit.load({events:!1,classes:!1,async:!0})}catch(G){}y(Y)}},2E3):
y([])};La.prototype.load=function(y){var D=this.f.id,S=this.c.o,R=this;D?(S.__webfontfontdeckmodule__||(S.__webfontfontdeckmodule__={}),S.__webfontfontdeckmodule__[D]=function(Y,ha){Y=0;for(var fa=ha.fonts.length;Y<fa;++Y){var H=ha.fonts[Y],z=R.a,G=z.push,J=H.name;H="font-weight:"+H.weight+";font-style:"+H.style;var N=4,K="n",Q=null;H&&((Q=H.match(/(normal|oblique|italic)/i))&&Q[1]&&(K=Q[1].substr(0,1).toLowerCase()),(Q=H.match(/([1-9]00|normal|bold)/i))&&Q[1]&&(/bold/i.test(Q[1])?N=7:/[1-9]00/.test(Q[1])&&
(N=parseInt(Q[1].substr(0,1),10))));G.call(z,new u(J,K+N))}y(R.a)},h(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+f(this.c)+"/"+D+".js",function(Y){Y&&y([])})):y([])};var sa=new ta(window);sa.a.c.custom=function(y,D){return new xa(D,y)};sa.a.c.fontdeck=function(y,D){return new La(D,y)};sa.a.c.monotype=function(y,D){return new ra(D,y)};sa.a.c.typekit=function(y,D){return new Ba(D,y)};sa.a.c.google=function(y,D){return new Ca(D,y)};var Ia={load:v(sa.load,sa)};"function"===typeof define&&
define.amd?define(function(){return Ia}):"undefined"!==typeof module&&module.exports?module.exports=Ia:(window.WebFont=Ia,window.WebFontConfig&&sa.load(window.WebFontConfig))})();const config={width:window.innerWidth,height:window.innerHeight,renderer:Phaser.WEBGL,antialias:!0,multiTexture:!0,physicsConfig:{p2:!0}};let game=new Phaser.Game(config),gameWin=!1,difficulty="easy",totalScore=0,wfConfig={active:function(){startGame()},google:{families:["Merriweather"],urls:["https://fonts.google.com/share?selection.family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900","assets/fonts/Merriweather-Black.ttf"]}};WebFont.load(wfConfig);
async function startGame(){await new Promise(t=>setTimeout(t,50));configurePhysics();game.time.advancedTiming=!0;game.camera.roundPx=!0;game.state.add("welcomescreen",welcomeState);game.state.add("play",playState);game.state.add("about",aboutState);game.state.add("config",configState);game.state.add("instructions",instructionState);game.state.add("endScreen",endState);game.state.start("welcomescreen")}
function configurePhysics(){game.physics.startSystem(Phaser.Physics.P2JS);game.physics.p2.useElapsedTime=!0;game.physics.p2.defaultRestitution=2;game.physics.p2.setImpactEvents(!0)};let levelConfig,maxEnemies=100,spawnDelay=100;const MAX_COLLECTABLE=10;let numOfcollectable,eventSystem,sceneData,debuging=!1,gameConfig,backKey;function FormConfig(t,e){let v=t["default"];ApplyObjectOverride(v,t.diffucultyOverrides[e]);return v}function ApplyObjectOverride(t,e){for(let v in e)"object"===typeof e[v]?(t[v]||(t[v]={}),ApplyObjectOverride(t[v],e[v])):(t[v]||console.warn("Key not found in main object, applying override anyways:",v),t[v]=e[v])}
let playState={preload:function(){game.load.image("healthbar_outline","assets/imgs/healthbar_outline.png");game.load.image("healthbar_mask_red","assets/imgs/healthbar_mask_red.png");game.load.image("manabar_outline","assets/imgs/manabar_outline.png");game.load.image("manabar_mask","assets/imgs/manabar_mask_red.png");game.load.image("hudWall","assets/imgs/hudWall.png");game.load.image("xp","assets/imgs/INTpoints.png");game.load.image("collectible","assets/imgs/collectibleGem.png");game.load.image("Floor",
"assets/imgs/Backgrounds/Tileset.png");game.load.tilemap("levelMap","assets/levels/squareTilemap.json",null,Phaser.Tilemap.TILED_JSON);game.load.json("config","assets/levels/config.json");game.load.image("shadow","assets/imgs/PLACEHOLDERS/shadow.png");game.load.image("main-character","assets/imgs/mage.png");game.load.image("hand0","assets/imgs/hands/1.png");game.load.image("hand1","assets/imgs/hands/2.png");game.load.image("hand2","assets/imgs/hands/3.png");game.load.image("hand3","assets/imgs/hands/4.png");
game.load.image("hand4","assets/imgs/hands/5.png");game.load.image("bullet","assets/imgs/bullet.png");game.load.image("greenSlime","assets/imgs/greenSlime.png");game.load.image("purpleSlime","assets/imgs/purpleSlime.png");game.load.image("characterUpgrade","assets/imgs/books/book1.png");game.load.image("speedUpgrade","assets/imgs/books/book2.png");game.load.image("bulletUpgrade","assets/imgs/books/book3.png");game.load.image("reload","assets/imgs/books/book4.png");game.load.image("upgradeDamage",
"assets/imgs/PLACEHOLDERS/w.jpg");game.load.image("upgradeVelocityAttack","assets/imgs/PLACEHOLDERS/speedAttack.jpg");game.load.image("heal","assets/imgs/PLACEHOLDERS/CaminateBlanco.png");game.load.image("safeZoneArea","assets/imgs/safeZone.png");game.load.image("crystal1","assets/imgs/crystalSprite1.png");game.load.image("crystal2","assets/imgs/crystalSprite2.png");game.load.image("crystal3","assets/imgs/crystalSprite3.png");game.load.audio("sFire","assets/snds/Laser_Shoot43.wav");game.load.audio("sCollectible",
"assets/snds/Pickup_Coin30.wav");game.load.audio("sHurt","assets/snds/Hit_Hurt21.wav");game.load.audio("sSquishy","assets/snds/SlimeDamage97.wav");game.load.audio("purchase","assets/snds/Purchase.wav");game.load.audio("charge","assets/snds/charge.wav");game.load.audio("empty","assets/snds/empty.wav");game.load.audio("explosion","assets/snds/Explosion.wav")},create:function(){var t=game.cache.getJSON("config");gameConfig=FormConfig(t,difficulty);eventSystem=new EventSystem;game.physics.p2.setPostBroadphaseCallback(function(b,
c){eventSystem.CallEvent("on-physics-overlap",[b,c]);return!0});backKey=game.input.keyboard.addKey(27);sceneData={};gameWin=!1;sceneData.gameComplete=!1;sceneData.collisionGroups={player:game.physics.p2.createCollisionGroup(),enemies:game.physics.p2.createCollisionGroup(),projectiles:game.physics.p2.createCollisionGroup(),collectables:game.physics.p2.createCollisionGroup(),safeZones:game.physics.p2.createCollisionGroup(),bounds:game.physics.p2.createCollisionGroup(),walls:game.physics.p2.createCollisionGroup(),
store:game.physics.p2.createCollisionGroup()};sceneData.layers={background:game.add.group(),shadows:game.add.group(),safezone:game.add.group(),world:game.add.group(),player:game.add.group(),enemies:game.add.group(),projectiles:game.add.group(),collectables:game.add.group(),decor:game.add.group(),UI:game.add.group()};t=[];for(var e=0;3>e;e++)t.push({name:`obstacle${e}`,objectCollisions:!0,collisionGroup:sceneData.collisionGroups.walls,collideWith:[sceneData.collisionGroups.player,sceneData.collisionGroups.enemies,
sceneData.collisionGroups.projectiles],parent:game.add.group(),physicsGroup:[]});e=SetupTilemap("levelMap",[{innerKey:"WallsTileset",imageKey:"Floor"}],["Floor","Infill",{name:"Walls",objectCollisions:!0,collisionGroup:sceneData.collisionGroups.walls,resizeWorld:!0,collideWith:[sceneData.collisionGroups.player,sceneData.collisionGroups.enemies,sceneData.collisionGroups.projectiles]},...t],sceneData.layers.background);game.world.setBounds(0,0,game.world.width,game.world.height);var v=e.objects.playerSpawn[0];
sceneData.player=new Player(eventSystem,new Vector2(v.x,v.y));sceneData.HUD=new HUD(eventSystem);v=e.objects.safeZone[0];sceneData.safeZone=new SafeZone(eventSystem,new Vector2(v.x,v.y),new Vector2(1E3,500));sceneData.collectables;sceneData.sounds={fire:game.add.audio("sFire",.2),collectible:game.add.audio("sCollectible",.1),hurt:game.add.audio("sHurt",.1),squishy:game.add.audio("sSquishy",.2),purchase:game.add.audio("purchase",.4),charge:game.add.audio("charge",.2),empty:game.add.audio("empty",.7),
explosion:game.add.audio("explosion",.7)};v={};for(var l of Object.keys(gameConfig.enemies)){const b=e.objects[l];if(b){v[l]=[];for(let c of b)v[l].push(new Vector2(c.x,c.y))}else console.warn("No spawn points found for enemy type:",l)}sceneData.enemyManager=new EnemyManager(eventSystem,v);l=CreatePoints(e.objects.rechargeZones);for(var k of l)new Store(eventSystem,k,{spriteName:"reload",spriteScale:.3,priceHidden:!0,purchaseSound:"purchase",upgradeText:"Reload & Heal",stages:[{changes:[{actionType:"heal",
factor:1},{actionType:"reload",factor:1}],cost:0,repeat:-1}]});let a=5;for(let b of t)k=CreatePoints(e.objects[b.name+"Unlock"])[0],new Store(eventSystem,k,{spriteName:"characterUpgrade",spriteScale:.3,getBalance:()=>sceneData.HUD.crystals,setBalance:c=>sceneData.HUD.setCrystals(c),priceUnits:" Crystals",purchaseSound:"purchase",upgradeText:"Unlock Area",stages:[{changes:[{actionType:"custom",action:function(){b.parent.destroy();b.physicsGroup.forEach(c=>c.destroy());a+=10}}],get cost(){return a}}]});
eventSystem.CallEvent("post-scene-create",[])},update:function(){eventSystem.CallEvent("scene-update",[]);debuging&&cheatActions();backKey.isDown&&game.state.start("welcomescreen");sceneData.player.sprite.inWorld||sceneData.gameComplete||(gameWin=sceneData.gameComplete=!0,game.state.start("endScreen"))}};function CreatePoints(t){const e=[];for(let v of t)e.push(new Vector2(v.x,v.y));return e}
function SetupTilemap(t,e,v,l){let k=game.add.tilemap(t);e.forEach(b=>{k.addTilesetImage(b.innerKey,b.imageKey)});let a={};v.forEach(b=>{"string"===typeof b&&(b={name:b});a[b.name]=k.createLayer(b.name);b.resizeWorld&&a[b.name].resizeWorld();b.debug&&(a[b.name].debug=!0);if(b.objectCollisions){k.setCollisionByExclusion([],!0,a[b.name]);k.collision[b.name]=k.objects[b.name];const c=game.physics.p2.convertCollisionObjects(k,b.name,!0);console.log(c);c.forEach(function(d){d.setCollisionGroup(b.collisionGroup);
b.debug&&(d.debug=!0);d.collides(b.collideWith);b.physicsGroup&&b.physicsGroup.push(d)})}b.parent?b.parent.addChild(a[b.name]):l&&l.addChild(a[b.name])});return k}function cheatActions(){debuging&&(game.input.keyboard.addKey(Phaser.Keyboard.K).isDown&&sceneData.player.takeDamage(sceneData.player.maxHealth),game.input.keyboard.addKey(Phaser.Keyboard.X).isDown&&sceneData.HUD.addScore(100))};let welcomeState={preload:function(){game.load.image("title","assets/imgs/Titles/TITLE.png");game.load.image("scrollDecor","assets/imgs/Titles/SCROLL.png");game.load.image("bg","assets/imgs/Backgrounds/background.jpeg")},create:function(){game.camera.flash(0,1E3);game.input.enabled=!0;background=game.add.image(game.camera.width/2,0,"bg");background.scale.setTo(.6,.6);background.anchor.setTo(.5,0);background.alpha=.2;title=game.add.image(game.camera.width/2,40,"title");title.anchor.setTo(.5,0);title.scale.setTo(.6,
.6);game.add.tween(title).to({y:title.y+10},2E3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0);scroll=game.add.image(game.camera.width/2,game.camera.height/2-170,"scrollDecor");scroll.anchor.setTo(.5,0);scroll.scale.setTo(.8,.8);game.add.tween(scroll).to({y:scroll.y+20},2E3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0);buttonStart=game.add.text(game.camera.width/2,game.camera.height/2,"Play",{font:"50px Merryweather",fill:"#000000"});buttonStart.anchor.setTo(.5,.5);buttonStart.inputEnabled=!0;buttonStart.events.onInputDown.add(onStartButtonPressed,
this);buttonStart.events.onInputOver.add(onButtonHover,this);buttonStart.events.onInputOut.add(onButtonOut,this);buttonAbout=game.add.text(game.camera.width/2,game.camera.height/2+100,"About",{font:"50px Merryweather",fill:"#000000"});buttonAbout.anchor.setTo(.5,.5);buttonAbout.inputEnabled=!0;buttonAbout.events.onInputDown.add(onAboutButtonPressed,this);buttonAbout.events.onInputOver.add(onButtonHover,this);buttonAbout.events.onInputOut.add(onButtonOut,this);buttonConfig=game.add.text(game.camera.width/
2,game.camera.height/2+200,"Config",{font:"50px Merryweather",fill:"#000000"});buttonConfig.anchor.setTo(.5,.5);buttonConfig.inputEnabled=!0;buttonConfig.events.onInputDown.add(onConfigButtonPressed,this);buttonConfig.events.onInputOver.add(onButtonHover,this);buttonConfig.events.onInputOut.add(onButtonOut,this)}},buttonStart,buttonAbout,buttonConfig;function onStartButtonPressed(){game.camera.fade(0,1E3);game.camera.onFadeComplete.add(function(){game.state.start("play")},this)}
function onAboutButtonPressed(){game.camera.fade(0,2E3);game.camera.onFadeComplete.add(function(){game.state.start("about")},this)}function onConfigButtonPressed(){game.camera.fade(0,2E3);game.camera.onFadeComplete.add(function(){game.state.start("config")},this)}function onButtonHover(t){t.text="~"+t.text+"~";game.add.tween(t.scale).to({x:1.1,y:1.1},1E3,Phaser.Easing.Quartic.Out,!0,0,0,!1)}
function onButtonOut(t){t.text=t.text.replaceAll("~","");game.tweens.removeFrom(t.scale);game.add.tween(t.scale).to({x:1,y:1},1E3,Phaser.Easing.Quartic.Out,!0,0,0,!1)};
